

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>DFT (Wien2k) and Wannier orbitals &mdash; TRIQS DFTTools  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=default"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DFT+DMFT tutorial: Ce with Hubbard-I approximation" href="ce-gamma-fscs_wien2k.html" />
    <link rel="prev" title="DFT (Wien2k) and Wannier orbitals" href="sr2mgoso6_nosoc.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #7E588A" >
          

          
            <a href="../index.html" class="icon icon-home"> TRIQS DFTTools
          

          
          </a>

          
            
            
              <div class="version">
                3.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html#packaged-versions-of-dfttools">Packaged Versions of DFTTools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../install.html#ubuntu-debian-packages">Ubuntu Debian packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#anaconda-experimental">Anaconda (experimental)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#id2">Docker</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#compiling-dfttools-from-source">Compiling DFTTools from source</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../install.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#installation-steps">Installation steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#important-note-for-fcsc-dft-dmft-calculations">Important note for FCSC DFT+DMFT calculations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#installation-steps-for-the-use-with-wien2k-version-14-2-and-older">Installation steps for the use with WIEN2K version 14.2 and older</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#version-compatibility">Version compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#custom-cmake-options">Custom CMake options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../documentation.html">Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#basic-notions">Basic notions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basicnotions/first.html">What you should know</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/first.html#what-is-dfttools">What is <strong class="program">DFTTools</strong>?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/first.html#understand-the-philosophy-of-dfttools">Understand the philosophy of <strong class="program">DFTTools</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/first.html#learn-how-to-use-triqs-and-the-cthyb-solver">Learn how to use <span class="xref std std-ref">TRIQS</span> (and the <span class="xref std std-ref">CTHYB</span> solver)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/first.html#analytic-continuation">Analytic Continuation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../basicnotions/dft_dmft.html">Introduction to DFT+DMFT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/dft_dmft.html#density-functional-theory-in-a-very-small-nutshell">Density-functional theory in a (very small) nutshell</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/dft_dmft.html#from-dft-to-dmft">From DFT to DMFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/dft_dmft.html#using-projective-wannier-functions-for-dmft">Using projective Wannier functions for DMFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/dft_dmft.html#full-charge-self-consistency">Full charge self-consistency</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../basicnotions/structure.html">Structure of <strong class="program">DFTTools</strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/structure.html#the-interface-layer">The interface layer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/structure.html#the-dmft-calculation">The DMFT calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/structure.html#full-charge-self-consistency">Full charge self consistency</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/structure.html#post-processing">Post-processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/structure.html#executing-your-python-scripts">Executing your python scripts</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#construction-of-local-orbitals-from-dft">Construction of local orbitals from DFT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guide/conversion.html">Supported interfaces</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guide/conv_wien2k.html">Interface with Wien2k</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/conv_vasp.html">Interface with VASP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/conv_elk.html">Interface with Elk</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/conv_W90.html">Interface with Wannier90</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/conv_generalhk.html">A general H(k)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guide/conversion.html#mpi-issues">MPI issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide/conversion.html#interfaces-to-other-packages">Interfaces to other packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../h5structure.html">standardized hdf5 structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../h5structure.html#groups-and-their-formats">groups and their formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="../h5structure.html#general-and-simple-h-k-converter">General and simple H(k) Converter</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#dft-dmft">DFT+DMFT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guide/dftdmft_singleshot.html">Single-shot DFT+DMFT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guide/dftdmft_singleshot.html#initialization-of-the-calculation">Initialization of the calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/dftdmft_singleshot.html#setting-up-the-impurity-solver">Setting up the impurity solver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/dftdmft_singleshot.html#doing-the-dmft-loop">Doing the DMFT loop</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/dftdmft_singleshot.html#restarting-a-calculation">Restarting a calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/dftdmft_singleshot.html#mixing">Mixing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guide/dftdmft_selfcons.html">Full charge self-consistency</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guide/dftdmft_selfcons.html#wien2k-dmftproj">Wien2k + dmftproj</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/dftdmft_selfcons.html#vasp-plovasp">VASP + PLOVasp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/dftdmft_selfcons.html#elk">Elk</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/dftdmft_selfcons.html#other-dft-codes">Other DFT codes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#advanced-topics">Advanced Topics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guide/blockstructure.html">Manipulating the Green’s functions block structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guide/blockstructure.html#creating-a-block-structure-and-green-s-function">Creating a block structure and Green’s function</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/blockstructure.html#the-solver-structure">The <em>solver</em> structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/blockstructure.html#picking-orbitals">Picking orbitals</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/blockstructure.html#basis-rotations">Basis rotations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/blockstructure.html#diagonal-approximation">Diagonal approximation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guide/BasisRotation.html">Automatic basis rotations in DFT+DMFT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guide/BasisRotation.html#setting-up-the-initial-solver-structure-from-dft">Setting up the initial solver structure from DFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/BasisRotation.html#finding-the-transformation-matrix">Finding the transformation matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/BasisRotation.html#automatic-transformation-during-the-dmft-loop">Automatic transformation during the DMFT loop</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guide/soc.html">Spin-orbit coupled calculations (single-shot)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guide/soc.html#treatment-of-soc-in-dft">Treatment of SOC in DFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/soc.html#treatment-of-soc-in-wien2k">Treatment of SOC in Wien2k</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/soc.html#treatment-of-soc-in-elk">Treatment of SOC in Elk</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/soc.html#after-generating-the-projectors">After generating the projectors</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#postprocessing">Postprocessing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guide/analysis.html">Tools for analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guide/analysis.html#initialisation">Initialisation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/analysis.html#density-of-states-of-the-wannier-orbitals">Density of states of the Wannier orbitals</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/analysis.html#partial-charges">Partial charges</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/analysis.html#correlated-spectral-function-with-real-frequency-self-energy">Correlated spectral function (with real-frequency self energy)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/analysis.html#momentum-resolved-spectral-function-with-real-frequency-self-energy">Momentum resolved spectral function (with real-frequency self energy)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guide/transport.html">Transport calculations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guide/transport.html#formalism">Formalism</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/transport.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/transport.html#wien2k-optics-package">Wien2k optics package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/transport.html#using-the-transport-code">Using the transport code</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/transport.html#references">References</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#reference-manual">Reference manual</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../_python_api/triqs_dft_tools.block_structure.html">block_structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_python_api/triqs_dft_tools.block_structure.BlockStructure.html">triqs_dft_tools.block_structure.BlockStructure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_python_api/triqs_dft_tools.converters.html">converters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_python_api/triqs_dft_tools.converters.converter_tools.html">converter_tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_python_api/triqs_dft_tools.converters.elk.html">elk</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_python_api/triqs_dft_tools.converters.elktools.html">elktools</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_python_api/triqs_dft_tools.converters.hk.html">hk</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_python_api/triqs_dft_tools.converters.plovasp.html">plovasp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_python_api/triqs_dft_tools.converters.vasp.html">vasp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_python_api/triqs_dft_tools.converters.wannier90.html">wannier90</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_python_api/triqs_dft_tools.converters.wien2k.html">wien2k</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_python_api/triqs_dft_tools.sumk_dft.html">sumk_dft</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_python_api/triqs_dft_tools.sumk_dft.SumkDFT.html">triqs_dft_tools.sumk_dft.SumkDFT</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_python_api/triqs_dft_tools.sumk_dft_tools.html">sumk_dft_tools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_python_api/triqs_dft_tools.sumk_dft_tools.SumkDFTTools.html">triqs_dft_tools.sumk_dft_tools.SumkDFTTools</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_python_api/triqs_dft_tools.symmetry.html">symmetry</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_python_api/triqs_dft_tools.symmetry.Symmetry.html">triqs_dft_tools.symmetry.Symmetry</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_python_api/triqs_dft_tools.trans_basis.html">trans_basis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_python_api/triqs_dft_tools.trans_basis.TransBasis.html">triqs_dft_tools.trans_basis.TransBasis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#faqs">FAQs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../faqs/faqs.html">Frequently-Asked Questions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../faqs/faqs.html#wien2k-fermi-error-when-running-x-lapw2-almd-band">wien2k: FERMI ERROR when running <cite>x lapw2 -almd -band</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs/faqs.html#how-do-i-plot-the-output-of-spaghettis">How do I plot the output of <cite>spaghettis</cite>?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs/faqs.html#x-optic-does-not-write-a-case-pmat-file">x optic does not write a case.pmat file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs/faqs.html#how-do-i-get-real-frequency-quantities">How do I get real-frequency quantities?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#a-simple-example-srvo3">A simple example: SrVO3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="srvo3.html">DFT (Wien2k) and Wannier orbitals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="srvo3.html#dft-setup">DFT setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="srvo3.html#wannier-orbitals">Wannier orbitals</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="srvo3.html#the-dmft-calculation">The DMFT calculation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="srvo3.html#loading-modules">Loading modules</a></li>
<li class="toctree-l4"><a class="reference internal" href="srvo3.html#initializing-sumkdft">Initializing SumkDFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="srvo3.html#initializing-the-solver">Initializing the solver</a></li>
<li class="toctree-l4"><a class="reference internal" href="srvo3.html#dmft-cycle">DMFT cycle</a></li>
<li class="toctree-l4"><a class="reference internal" href="srvo3.html#tail-fit-parameters">Tail fit parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#basis-rotations-sr2mgoso6-without-soc">Basis rotations: Sr2MgOsO6 without SOC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="sr2mgoso6_nosoc.html">DFT (Wien2k) and Wannier orbitals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="sr2mgoso6_nosoc.html#dft-setup">DFT setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="sr2mgoso6_nosoc.html#wannier-orbitals">Wannier orbitals</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="sr2mgoso6_nosoc.html#the-dmft-calculation">The DMFT calculation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="sr2mgoso6_nosoc.html#rotating-the-basis">Rotating the basis</a></li>
<li class="toctree-l4"><a class="reference internal" href="sr2mgoso6_nosoc.html#the-interaction-hamiltonian">The interaction Hamiltonian</a></li>
<li class="toctree-l4"><a class="reference internal" href="sr2mgoso6_nosoc.html#the-dmft-loop-with-automatic-basis-rotations">The DMFT loop with automatic basis rotations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../tutorials.html#sr2mgoso6-with-soc-non-magnetic">Sr2MgOsO6 with SOC (non-magnetic)</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">DFT (Wien2k) and Wannier orbitals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dft-setup">DFT setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wannier-orbitals">Wannier orbitals</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-dmft-calculation">The DMFT calculation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#rotating-the-basis">Rotating the basis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-interaction-hamiltonian">The interaction Hamiltonian</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-dmft-loop-with-automatic-basis-rotations">The DMFT loop with automatic basis rotations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#full-charge-self-consistency-with-wien2k-gamma-ce">Full charge self consistency with Wien2k: <span class="math notranslate nohighlight">\(\gamma\)</span>-Ce</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ce-gamma-fscs_wien2k.html">DFT+DMFT tutorial: Ce with Hubbard-I approximation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="ce-gamma-fscs_wien2k.html#wien2k-setup">Wien2k setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="ce-gamma-fscs_wien2k.html#wannier-orbitals-dmftproj">Wannier orbitals: dmftproj</a></li>
<li class="toctree-l4"><a class="reference internal" href="ce-gamma-fscs_wien2k.html#dmft-setup-hubbard-i-calculations-in-triqs">DMFT setup: Hubbard-I calculations in TRIQS</a></li>
<li class="toctree-l4"><a class="reference internal" href="ce-gamma-fscs_wien2k.html#fully-charge-self-consistent-dft-dmft-calculation">Fully charge self-consistent DFT+DMFT calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="ce-gamma-fscs_wien2k.html#post-processing-and-data-analysis">Post-processing and data analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#vasp-interface-examples">VASP interface examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials.html#simple-converter-example-srvo3">Simple Converter example: SrVO3</a><ul>
<li class="toctree-l4"><a class="reference internal" href="svo_vasp/svo_notebook.html">VASP setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="svo_vasp/svo_notebook.html#PLOVASP">PLOVASP</a></li>
<li class="toctree-l4"><a class="reference internal" href="svo_vasp/svo_notebook.html#Converting-to-hdf5-file">Converting to hdf5 file</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials.html#complex-example-nio">Complex example: NiO</a><ul>
<li class="toctree-l4"><a class="reference internal" href="nio_csc.html">DFT and projections</a></li>
<li class="toctree-l4"><a class="reference internal" href="nio_csc.html#dmft">DMFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="nio_csc.html#charge-self-consistent-dmft">Charge self-consistent DMFT</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#elk-interface-examples">Elk interface examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials.html#converter-example-srvo3">Converter example: SrVO3</a><ul>
<li class="toctree-l4"><a class="reference internal" href="svo_elk/srvo3.html">Elk to TRIQS</a></li>
<li class="toctree-l4"><a class="reference internal" href="svo_elk/srvo3.html#the-dmft-calculation">The DMFT calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="svo_elk/srvo3.html#triqs-to-elk-fully-charge-self-consistent-dft-dmft">TRIQS to Elk (Fully Charge Self-Consistent DFT+DMFT)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ChangeLog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-1-0">Version 3.1.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#wannier90-converter">Wannier90 Converter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#change-in-gf-struct">Change in gf_struct</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#documentation">Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#cmake">Cmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#other-changes">Other changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-0-0">Version 3.0.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#restructuring">Restructuring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#dependency-management">Dependency Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id2">Other Changes:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-2-1">Version 2.2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-2-0">Version 2.2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-1-x-changes-since-1-4">Version 2.1.x (changes since 1.4)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about.html#license">License</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#authors-quotation">Authors &amp; Quotation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#disclaimer">Disclaimer</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">TRIQS DFTTools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../tutorials.html">Tutorials</a> &raquo;</li>
        
      <li>DFT (Wien2k) and Wannier orbitals</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/tutorials/sr2mgoso6_soc.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<p id="sr2mgoso6-soc">In this tutorial we will discuss how to set up and perform a calculation including spin-orbit coupling. As an example, we again take Sr2MgOsO6, as we used for the discussion of basis rotations (<span class="xref std std-ref">Sr2MgOsO6_noSOC</span>).</p>
<p>The full script for this calculation is also provided here (<a class="reference download internal" download="" href="../_downloads/dcecdae92ccc54b39cfbe1873329358a/Sr2MgOsO6_SOC.py"><code class="xref download docutils literal notranslate"><span class="pre">Sr2MgOsO6_SOC.py</span></code></a>).</p>
<div class="section" id="dft-wien2k-and-wannier-orbitals">
<h1>DFT (Wien2k) and Wannier orbitals<a class="headerlink" href="#dft-wien2k-and-wannier-orbitals" title="Permalink to this headline">¶</a></h1>
<div class="section" id="dft-setup">
<h2>DFT setup<a class="headerlink" href="#dft-setup" title="Permalink to this headline">¶</a></h2>
<p>First, we do the DFT calculation, using the Wien2k package. As main input file we have to provide the struct file <code class="file docutils literal notranslate"><span class="pre">Sr2MgOs6_noSOC.struct</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Sr2MgOsO6</span>                                       
<span class="n">B</span>                            <span class="mi">5</span>   <span class="mi">87</span>                                            
             <span class="n">RELA</span>                                                              
 <span class="mf">10.507954</span> <span class="mf">10.507954</span> <span class="mf">14.968880</span> <span class="mf">90.000000</span> <span class="mf">90.000000</span> <span class="mf">90.000000</span>                   
<span class="n">ATOM</span>  <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">X</span><span class="o">=</span><span class="mf">0.00000000</span> <span class="n">Y</span><span class="o">=</span><span class="mf">0.50000000</span> <span class="n">Z</span><span class="o">=</span><span class="mf">0.75000000</span>
          <span class="n">MULT</span><span class="o">=</span> <span class="mi">2</span>          <span class="n">ISPLIT</span><span class="o">=-</span><span class="mi">2</span>
      <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">X</span><span class="o">=</span><span class="mf">0.50000000</span> <span class="n">Y</span><span class="o">=</span><span class="mf">0.00000000</span> <span class="n">Z</span><span class="o">=</span><span class="mf">0.75000000</span>
<span class="n">Sr</span>  <span class="mi">2</span><span class="o">+</span>     <span class="n">NPT</span><span class="o">=</span>  <span class="mi">781</span>  <span class="n">R0</span><span class="o">=.</span><span class="mi">000010000</span> <span class="n">RMT</span><span class="o">=</span> <span class="mf">2.50000</span>     <span class="n">Z</span><span class="p">:</span>  <span class="mf">38.00000</span>              
<span class="n">LOCAL</span> <span class="n">ROT</span> <span class="n">MATRIX</span><span class="p">:</span>    <span class="mf">1.0000000</span> <span class="mf">0.0000000</span> <span class="mf">0.0000000</span>
                     <span class="mf">0.0000000</span> <span class="mf">1.0000000</span> <span class="mf">0.0000000</span>
                     <span class="mf">0.0000000</span> <span class="mf">0.0000000</span> <span class="mf">1.0000000</span>
<span class="n">ATOM</span>  <span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="n">X</span><span class="o">=</span><span class="mf">0.00000000</span> <span class="n">Y</span><span class="o">=</span><span class="mf">0.00000000</span> <span class="n">Z</span><span class="o">=</span><span class="mf">0.00000000</span>
          <span class="n">MULT</span><span class="o">=</span> <span class="mi">1</span>          <span class="n">ISPLIT</span><span class="o">=-</span><span class="mi">2</span>
<span class="n">Os</span>  <span class="mi">6</span><span class="o">+</span>     <span class="n">NPT</span><span class="o">=</span>  <span class="mi">781</span>  <span class="n">R0</span><span class="o">=.</span><span class="mi">000005000</span> <span class="n">RMT</span><span class="o">=</span> <span class="mf">1.94</span>        <span class="n">Z</span><span class="p">:</span>  <span class="mf">76.00000</span>              
<span class="n">LOCAL</span> <span class="n">ROT</span> <span class="n">MATRIX</span><span class="p">:</span>    <span class="mf">1.0000000</span> <span class="mf">0.0000000</span> <span class="mf">0.0000000</span>
                     <span class="mf">0.0000000</span> <span class="mf">1.0000000</span> <span class="mf">0.0000000</span>
                     <span class="mf">0.0000000</span> <span class="mf">0.0000000</span> <span class="mf">1.0000000</span>
<span class="n">ATOM</span>  <span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="n">X</span><span class="o">=</span><span class="mf">0.00000000</span> <span class="n">Y</span><span class="o">=</span><span class="mf">0.00000000</span> <span class="n">Z</span><span class="o">=</span><span class="mf">0.50000000</span>
          <span class="n">MULT</span><span class="o">=</span> <span class="mi">1</span>          <span class="n">ISPLIT</span><span class="o">=-</span><span class="mi">2</span>
<span class="n">Mg</span>  <span class="mi">2</span><span class="o">+</span>     <span class="n">NPT</span><span class="o">=</span>  <span class="mi">781</span>  <span class="n">R0</span><span class="o">=.</span><span class="mi">000100000</span> <span class="n">RMT</span><span class="o">=</span> <span class="mf">1.89</span>        <span class="n">Z</span><span class="p">:</span>  <span class="mf">12.00000</span>              
<span class="n">LOCAL</span> <span class="n">ROT</span> <span class="n">MATRIX</span><span class="p">:</span>    <span class="mf">1.0000000</span> <span class="mf">0.0000000</span> <span class="mf">0.0000000</span>
                     <span class="mf">0.0000000</span> <span class="mf">1.0000000</span> <span class="mf">0.0000000</span>
                     <span class="mf">0.0000000</span> <span class="mf">0.0000000</span> <span class="mf">1.0000000</span>
<span class="n">ATOM</span>  <span class="o">-</span><span class="mi">4</span><span class="p">:</span> <span class="n">X</span><span class="o">=</span><span class="mf">0.74270000</span> <span class="n">Y</span><span class="o">=</span><span class="mf">0.21790000</span> <span class="n">Z</span><span class="o">=</span><span class="mf">0.00000000</span>
          <span class="n">MULT</span><span class="o">=</span> <span class="mi">4</span>          <span class="n">ISPLIT</span><span class="o">=</span> <span class="mi">8</span>
      <span class="o">-</span><span class="mi">4</span><span class="p">:</span> <span class="n">X</span><span class="o">=</span><span class="mf">0.25730000</span> <span class="n">Y</span><span class="o">=</span><span class="mf">0.78210000</span> <span class="n">Z</span><span class="o">=</span><span class="mf">0.00000000</span>
      <span class="o">-</span><span class="mi">4</span><span class="p">:</span> <span class="n">X</span><span class="o">=</span><span class="mf">0.21790000</span> <span class="n">Y</span><span class="o">=</span><span class="mf">0.25730000</span> <span class="n">Z</span><span class="o">=</span><span class="mf">0.00000000</span>
      <span class="o">-</span><span class="mi">4</span><span class="p">:</span> <span class="n">X</span><span class="o">=</span><span class="mf">0.78210000</span> <span class="n">Y</span><span class="o">=</span><span class="mf">0.74270000</span> <span class="n">Z</span><span class="o">=</span><span class="mf">0.00000000</span>
<span class="n">O</span>  <span class="mi">2</span><span class="o">-</span>      <span class="n">NPT</span><span class="o">=</span>  <span class="mi">781</span>  <span class="n">R0</span><span class="o">=.</span><span class="mi">000100000</span> <span class="n">RMT</span><span class="o">=</span> <span class="mf">1.58</span>        <span class="n">Z</span><span class="p">:</span>   <span class="mf">8.00000</span>              
<span class="n">LOCAL</span> <span class="n">ROT</span> <span class="n">MATRIX</span><span class="p">:</span>    <span class="mf">1.0000000</span> <span class="mf">0.0000000</span> <span class="mf">0.0000000</span>
                     <span class="mf">0.0000000</span> <span class="mf">1.0000000</span> <span class="mf">0.0000000</span>
                     <span class="mf">0.0000000</span> <span class="mf">0.0000000</span> <span class="mf">1.0000000</span>
<span class="n">ATOM</span>  <span class="o">-</span><span class="mi">5</span><span class="p">:</span> <span class="n">X</span><span class="o">=</span><span class="mf">0.00000000</span> <span class="n">Y</span><span class="o">=</span><span class="mf">0.00000000</span> <span class="n">Z</span><span class="o">=</span><span class="mf">0.75390000</span>
          <span class="n">MULT</span><span class="o">=</span> <span class="mi">2</span>          <span class="n">ISPLIT</span><span class="o">=-</span><span class="mi">2</span>
      <span class="o">-</span><span class="mi">5</span><span class="p">:</span> <span class="n">X</span><span class="o">=</span><span class="mf">0.00000000</span> <span class="n">Y</span><span class="o">=</span><span class="mf">0.00000000</span> <span class="n">Z</span><span class="o">=</span><span class="mf">0.24610000</span>
<span class="n">O</span>  <span class="mi">2</span><span class="o">-</span>      <span class="n">NPT</span><span class="o">=</span>  <span class="mi">781</span>  <span class="n">R0</span><span class="o">=.</span><span class="mi">000100000</span> <span class="n">RMT</span><span class="o">=</span> <span class="mf">1.58</span>        <span class="n">Z</span><span class="p">:</span>   <span class="mf">8.00000</span>              
<span class="n">LOCAL</span> <span class="n">ROT</span> <span class="n">MATRIX</span><span class="p">:</span>    <span class="mf">1.0000000</span> <span class="mf">0.0000000</span> <span class="mf">0.0000000</span>
                     <span class="mf">0.0000000</span> <span class="mf">1.0000000</span> <span class="mf">0.0000000</span>
                     <span class="mf">0.0000000</span> <span class="mf">0.0000000</span> <span class="mf">1.0000000</span>
   <span class="mi">0</span>      <span class="n">NUMBER</span> <span class="n">OF</span> <span class="n">SYMMETRY</span> <span class="n">OPERATIONS</span>
</pre></div>
</div>
<p>The struct file is the same as for non SOC calculations. However, the DFT calculation is done a bit differently now. First, we need to do a spin-polarised DFT calculation, but with magnetic moment set to zero. In the Wien2k initialisation procedure, one can choose for the option -nom when <code class="docutils literal notranslate"><span class="pre">lstart</span></code> is called. This means that the charge densities are initialised without magnetic splitting. After initialisation, do a full SC DFT run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">runsp</span>
</pre></div>
</div>
<p>After this SC cycled finished, we continue with the spin-orbit calculation. We initialise it with the Wien2k command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">init_so</span>
</pre></div>
</div>
<p>In this initialisation procedure, be sure to select a spin-polarised calculation. Then the SC cycle including SOC is done by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">runsp</span> <span class="o">-</span><span class="n">so</span>
</pre></div>
</div>
<p>After the SC cycled finished, you can calculate the DOS with SOC iuncluded. It should look like what you can see in this figure:</p>
<a class="reference internal image-reference" href="../_images/Sr2MgOsO6_SOC_DOS.png"><img alt="../_images/Sr2MgOsO6_SOC_DOS.png" class="align-center" src="../_images/Sr2MgOsO6_SOC_DOS.png" style="width: 700px;" /></a>
</div>
<div class="section" id="wannier-orbitals">
<h2>Wannier orbitals<a class="headerlink" href="#wannier-orbitals" title="Permalink to this headline">¶</a></h2>
<p>As a next step, we calculate localised orbitals for the d orbitals. We use this input file for <strong class="program">dmftproj</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>5                ! Nsort
2 1 1 4 2            ! Mult(Nsort)
3                ! lmax
complex          ! choice of angular harmonics
0 0 0 0          ! l included for each sort
0 0 0 0          ! If split into ireps, gives number of ireps. for a given orbital (otherwise 0)
cubic            ! choice of angular harmonics
0 0 2 0          ! l included for each sort
0 0 0 0          ! If split into ireps, gives number of ireps. for a given orbital (otherwise 0)
1                ! SO flag
complex          ! choice of angular harmonics
0 0 0 0          ! l included for each sort
0 0 0 0          ! If split into ireps, gives number of ireps. for a given orbital (otherwise 0)
complex          ! choice of angular harmonics
0 0 0 0          ! l included for each sort
0 0 0 0          ! If split into ireps, gives number of ireps. for a given orbital (otherwise 0)
complex
0 0 0 0
0 0 0 0
-0.09 0.43
</pre></div>
</div>
<p>Note that, due to the distortions in the crystal structure and the SOC, we include all five d orbitals in the calculation (line 8 in the input file above). The projection window is set such that all d orbitals are included.</p>
<p>To prepare the input data for <strong class="program">dmftproj</strong> we execute lapw2 with the following options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="n">lapw2</span> <span class="o">-</span><span class="n">up</span> <span class="o">-</span><span class="n">c</span> <span class="o">-</span><span class="n">so</span> <span class="o">-</span><span class="n">almd</span>
<span class="n">x</span> <span class="n">lapw2</span> <span class="o">-</span><span class="n">dn</span> <span class="o">-</span><span class="n">c</span> <span class="o">-</span><span class="n">so</span> <span class="o">-</span><span class="n">almd</span>
</pre></div>
</div>
<p>Then  <strong class="program">dmftproj</strong> is executed for SOC:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dmftproj</span> <span class="o">-</span><span class="n">sp</span> <span class="o">-</span><span class="n">so</span>
</pre></div>
</div>
<p>At the end of the run you see the density matrix in Wannier space:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Density</span> <span class="n">Matrices</span> <span class="k">for</span> <span class="n">the</span> <span class="n">Correlated</span> <span class="n">States</span> <span class="p">:</span>

  <span class="n">Sort</span> <span class="o">=</span>   <span class="mi">2</span>  <span class="n">Atom</span> <span class="o">=</span>   <span class="mi">3</span>  <span class="ow">and</span> <span class="n">Orbital</span> <span class="n">l</span> <span class="o">=</span>   <span class="mi">2</span>
<span class="n">Writing</span> <span class="n">the</span> <span class="n">matrix</span> <span class="k">as</span> <span class="p">:</span> <span class="p">[</span> <span class="n">block</span> <span class="n">up</span><span class="o">/</span><span class="n">up</span> <span class="o">|</span> <span class="n">block</span> <span class="n">up</span><span class="o">/</span><span class="n">dn</span> <span class="p">]</span> <span class="k">with</span>
                        <span class="p">[</span> <span class="n">block</span> <span class="n">dn</span><span class="o">/</span><span class="n">up</span> <span class="o">|</span> <span class="n">block</span> <span class="n">dn</span><span class="o">/</span><span class="n">dn</span> <span class="p">]</span>
   <span class="c1"># For the Up/Up block     :</span>
    <span class="mf">0.003574</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>
    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.254943</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.020080</span>    <span class="mf">0.048438</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>
   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.020080</span>   <span class="o">-</span><span class="mf">0.048438</span>    <span class="mf">0.011530</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>
   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.363933</span>   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.157594</span>   <span class="o">-</span><span class="mf">0.000000</span>
   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.157594</span>   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.363933</span>   <span class="o">-</span><span class="mf">0.000000</span>
   <span class="c1"># For the Down/Down block :</span>
    <span class="mf">0.003574</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>
    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.254943</span>    <span class="mf">0.000000</span>    <span class="mf">0.020080</span>    <span class="mf">0.048438</span>   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>
    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.020080</span>   <span class="o">-</span><span class="mf">0.048438</span>    <span class="mf">0.011530</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>
   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.363933</span>    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.157594</span>   <span class="o">-</span><span class="mf">0.000000</span>
    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.157594</span>   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.363933</span>    <span class="mf">0.000000</span>
   <span class="c1"># For the Up/Down block   :</span>
   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.028268</span>    <span class="mf">0.000554</span>   <span class="o">-</span><span class="mf">0.028268</span>   <span class="o">-</span><span class="mf">0.000554</span>
   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.111512</span>    <span class="mf">0.018026</span>   <span class="o">-</span><span class="mf">0.111512</span>    <span class="mf">0.018026</span>
    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.014697</span>    <span class="mf">0.018147</span>    <span class="mf">0.014697</span>    <span class="mf">0.018147</span>
   <span class="o">-</span><span class="mf">0.028268</span>   <span class="o">-</span><span class="mf">0.000554</span>    <span class="mf">0.111512</span>   <span class="o">-</span><span class="mf">0.018026</span>    <span class="mf">0.014697</span>    <span class="mf">0.018147</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>
   <span class="o">-</span><span class="mf">0.028268</span>   <span class="o">-</span><span class="mf">0.000554</span>   <span class="o">-</span><span class="mf">0.111512</span>    <span class="mf">0.018026</span>   <span class="o">-</span><span class="mf">0.014697</span>   <span class="o">-</span><span class="mf">0.018147</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.000000</span>
   <span class="c1"># For the Down/Up block   :</span>
   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.028268</span>    <span class="mf">0.000554</span>   <span class="o">-</span><span class="mf">0.028268</span>    <span class="mf">0.000554</span>
    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.111512</span>    <span class="mf">0.018026</span>   <span class="o">-</span><span class="mf">0.111512</span>   <span class="o">-</span><span class="mf">0.018026</span>
    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.014697</span>   <span class="o">-</span><span class="mf">0.018147</span>   <span class="o">-</span><span class="mf">0.014697</span>    <span class="mf">0.018147</span>
    <span class="mf">0.028268</span>   <span class="o">-</span><span class="mf">0.000554</span>   <span class="o">-</span><span class="mf">0.111512</span>   <span class="o">-</span><span class="mf">0.018026</span>    <span class="mf">0.014697</span>   <span class="o">-</span><span class="mf">0.018147</span>   <span class="o">-</span><span class="mf">0.000000</span>    <span class="mf">0.000000</span>    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>
   <span class="o">-</span><span class="mf">0.028268</span>    <span class="mf">0.000554</span>   <span class="o">-</span><span class="mf">0.111512</span>   <span class="o">-</span><span class="mf">0.018026</span>    <span class="mf">0.014697</span>   <span class="o">-</span><span class="mf">0.018147</span>    <span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>   <span class="o">-</span><span class="mf">0.000000</span>

<span class="n">The</span> <span class="n">charge</span> <span class="n">of</span> <span class="n">the</span> <span class="n">orbital</span> <span class="ow">is</span> <span class="p">:</span>    <span class="mf">1.99583</span>
</pre></div>
</div>
<p>As you can see, there are a lot of off-diagonal elements now, in particular also off-diagonal in spin space. This is just telling us that spin is not a good quantum number any more in the presence of SOC.</p>
<p>We convert the output to the hdf5 archive, using
the python module <code class="xref py py-class docutils literal notranslate"><span class="pre">Wien2kConverter</span></code>. A simple python script doing this is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">triqs_dft_tools.converters.wien2k</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">Converter</span> <span class="o">=</span> <span class="n">Wien2kConverter</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;Sr2MgOsO6_SOC&quot;</span><span class="p">)</span>
<span class="n">Converter</span><span class="o">.</span><span class="n">convert_dft_input</span><span class="p">()</span>
</pre></div>
</div>
<p>This reads all the data, and stores everything that is necessary for the DMFT calculation in the file <code class="file docutils literal notranslate"><span class="pre">Sr2MgOsO6_SOC.h5</span></code>.</p>
</div>
</div>
<div class="section" id="the-dmft-calculation">
<h1>The DMFT calculation<a class="headerlink" href="#the-dmft-calculation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="rotating-the-basis">
<h2>Rotating the basis<a class="headerlink" href="#rotating-the-basis" title="Permalink to this headline">¶</a></h2>
<p>Before starting the DMFT calculation it is beneficial to look a bit more closely at the block structure of the problem. Eventually, we want to use a basis that is as diagonal as possible, and include only the partially filled orbitals in the correlated problem. All this can be done using the functionalities of the <code class="xref py py-class docutils literal notranslate"><span class="pre">BlockStructure</span></code> class, see section <a class="reference internal" href="../guide/blockstructure.html#blockstructure"><span class="std std-ref">Manipulating the Green’s functions block structure</span></a>.</p>
<p>We first initialise the SumK class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">triqs_dft_tools.sumk_dft</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">SK</span> <span class="o">=</span> <span class="n">SumkDFT</span><span class="p">(</span><span class="n">hdf_file</span><span class="o">=</span><span class="s1">&#39;Sr2MgOsO6_SOC.h5&#39;</span><span class="p">,</span><span class="n">use_dft_blocks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The flag <em>use_dft_blocks=True</em> determines, as usual, the smallest possible blocks with non-zero entries, and initialises them as <em>solver</em> block structure. We want to work in the basis that diagonalises the local Hamiltonian, which is often referred to as numerical j-basis. The transformation into this basis is calculated by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span> <span class="o">=</span> <span class="n">SK</span><span class="o">.</span><span class="n">calculate_diagonalization_matrix</span><span class="p">(</span><span class="n">prop_to_be_diagonal</span><span class="o">=</span><span class="s1">&#39;eal&#39;</span><span class="p">,</span><span class="n">calc_in_solver_blocks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>This transformation is stored in the SK.block_structure class and can be used to transform Greens function or operators. The next step is actually not needed for a DMFT calculation, but it is good to do this check to see what the transformation does to the local Hamiltonian. Note that in case of SOC, although spin is not a good quantum number any more, there are two blocks of size 5x5, each corresponding to negative/positive <span class="math notranslate nohighlight">\(m_j\)</span> values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">eal</span>  <span class="o">=</span> <span class="n">SK</span><span class="o">.</span><span class="n">eff_atomic_levels</span><span class="p">()</span>
<span class="n">eal2</span> <span class="o">=</span> <span class="n">SK</span><span class="o">.</span><span class="n">block_structure</span><span class="o">.</span><span class="n">convert_matrix</span><span class="p">(</span><span class="n">eal</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">space_from</span><span class="o">=</span><span class="s1">&#39;sumk&#39;</span><span class="p">,</span> <span class="n">space_to</span><span class="o">=</span><span class="s1">&#39;solver&#39;</span><span class="p">)</span>

<span class="nb">print</span> <span class="n">eal2</span><span class="p">[</span><span class="s1">&#39;ud_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span><span class="o">.</span><span class="n">real</span><span class="o">.</span>   <span class="c1"># diagonal of the first 5x5 block</span>
<span class="p">[</span><span class="mf">0.071</span> <span class="mf">0.131</span> <span class="mf">0.608</span> <span class="mf">4.572</span> <span class="mf">5.128</span><span class="p">]</span>

<span class="nb">print</span> <span class="n">eal2</span><span class="p">[</span><span class="s1">&#39;ud_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span><span class="o">.</span><span class="n">real</span><span class="o">.</span>   <span class="c1"># diagonal of the second 5x5 block</span>
<span class="p">[</span><span class="mf">0.071</span> <span class="mf">0.131</span> <span class="mf">0.608</span> <span class="mf">4.572</span> <span class="mf">5.128</span><span class="p">]</span>
</pre></div>
</div>
<p>We see that the orbitals are ordered from low to high energy, which makes picking the orbitals around the Fermi level quite easy. We just take indices 0 to 2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SK</span><span class="o">.</span><span class="n">block_structure</span><span class="o">.</span><span class="n">pick_gf_struct_solver</span><span class="p">([{</span><span class="s1">&#39;ud_0&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;ud_1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]}])</span>
</pre></div>
</div>
<p>We can now look at the final result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">eal3</span> <span class="o">=</span> <span class="n">SK</span><span class="o">.</span><span class="n">block_structure</span><span class="o">.</span><span class="n">convert_matrix</span><span class="p">(</span><span class="n">eal</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">space_from</span><span class="o">=</span><span class="s1">&#39;sumk&#39;</span><span class="p">,</span> <span class="n">space_to</span><span class="o">=</span><span class="s1">&#39;solver&#39;</span><span class="p">)</span>

<span class="nb">print</span> <span class="n">eal3</span><span class="p">[</span><span class="s1">&#39;ud_0&#39;</span><span class="p">]</span>
<span class="p">[[</span> <span class="mf">0.071</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span>  <span class="mf">0.</span>   <span class="o">+</span><span class="mf">0.</span><span class="n">j</span> <span class="o">-</span><span class="mf">0.</span>   <span class="o">-</span><span class="mf">0.</span><span class="n">j</span><span class="p">]</span>
 <span class="p">[</span><span class="o">-</span><span class="mf">0.</span>   <span class="o">-</span><span class="mf">0.</span><span class="n">j</span>  <span class="mf">0.131</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span> <span class="o">-</span><span class="mf">0.</span>   <span class="o">-</span><span class="mf">0.</span><span class="n">j</span><span class="p">]</span>
 <span class="p">[</span><span class="o">-</span><span class="mf">0.</span>   <span class="o">+</span><span class="mf">0.</span><span class="n">j</span>  <span class="mf">0.</span>   <span class="o">+</span><span class="mf">0.</span><span class="n">j</span>  <span class="mf">0.608</span><span class="o">-</span><span class="mf">0.</span><span class="n">j</span><span class="p">]]</span>

<span class="nb">print</span> <span class="n">eal3</span><span class="p">[</span><span class="s1">&#39;ud_1&#39;</span><span class="p">]</span>
<span class="p">[[</span> <span class="mf">0.071</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span> <span class="o">-</span><span class="mf">0.</span>   <span class="o">-</span><span class="mf">0.</span><span class="n">j</span>  <span class="mf">0.</span>   <span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">]</span>
 <span class="p">[</span><span class="o">-</span><span class="mf">0.</span>   <span class="o">+</span><span class="mf">0.</span><span class="n">j</span>  <span class="mf">0.131</span><span class="o">-</span><span class="mf">0.</span><span class="n">j</span>  <span class="mf">0.</span>   <span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">0.</span>   <span class="o">-</span><span class="mf">0.</span><span class="n">j</span>  <span class="mf">0.</span>   <span class="o">-</span><span class="mf">0.</span><span class="n">j</span>  <span class="mf">0.608</span><span class="o">+</span><span class="mf">0.</span><span class="n">j</span><span class="p">]]</span>
</pre></div>
</div>
<p>We see that we arrived at a diagonal structure with two blocks of size 3x3, and we have picked the orbitals around the Fermi level.</p>
</div>
<div class="section" id="the-interaction-hamiltonian">
<h2>The interaction Hamiltonian<a class="headerlink" href="#the-interaction-hamiltonian" title="Permalink to this headline">¶</a></h2>
<p>We now set up the interaction Hamiltonian. Since we want to rotate the interaction matrix into the local basis, we are using the Slater convention for it. We use <em>l=2</em> for <em>d</em> orbitals. Also, for SOC calculations, we need to inflate the resulting matrix to size 10x10:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">triqs.operators.util</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">triqs.operators.util.U_matrix</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">U</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">J</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">U_sph</span> <span class="o">=</span> <span class="n">U_matrix</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">U_int</span><span class="o">=</span><span class="n">U</span><span class="p">,</span> <span class="n">J_hund</span><span class="o">=</span><span class="n">J</span><span class="p">)</span>
<span class="n">U_sph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span><span class="n">U_sph</span><span class="p">))</span>  <span class="c1"># inflating the matrix</span>
<span class="n">U_mat</span> <span class="o">=</span> <span class="n">transform_U_matrix</span><span class="p">(</span><span class="n">U_sph</span><span class="p">,</span> <span class="n">SK</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">conjugate</span><span class="p">())</span>
</pre></div>
</div>
<p>In the last line we use the Wien2k convention to write the U matrix in the cubic harmonics. Next, we want to set up a Hamiltonian and rotate it into the <em>solver</em> basis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">h_sumk</span> <span class="o">=</span> <span class="n">h_int_slater</span><span class="p">([</span><span class="s1">&#39;ud&#39;</span><span class="p">],</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> <span class="n">U_mat</span><span class="p">,</span>  <span class="n">off_diag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">complex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">h_int</span> <span class="o">=</span> <span class="n">SK</span><span class="o">.</span><span class="n">block_structure</span><span class="o">.</span><span class="n">convert_operator</span><span class="p">(</span><span class="n">h_sumk</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that we needed to set up the interaction Hamiltonian first for the full set of <em>d</em> orbitals. The <code class="xref py py-meth docutils literal notranslate"><span class="pre">convert_operator()</span></code> method then takes care of rotating and picking the relevant orbitals.</p>
<p>Now we have the interaction Hamiltonian for the solver, which we set up next:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">triqs_cthyb</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">triqs.utility.mpi</span> <span class="k">as</span> <span class="nn">mpi</span>

<span class="n">beta</span> <span class="o">=</span> <span class="mf">40.0</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">(</span><span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">,</span> <span class="n">gf_struct</span><span class="o">=</span><span class="n">SK</span><span class="o">.</span><span class="n">block_structure</span><span class="o">.</span><span class="n">gf_struct_solver_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Solver parameters:</span>
<span class="n">p</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c1"># solver</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;random_seed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">123</span> <span class="o">*</span> <span class="n">mpi</span><span class="o">.</span><span class="n">rank</span> <span class="o">+</span> <span class="mi">567</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;length_cycle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;n_warmup_cycles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100000</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;n_cycles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="c1"># tail fit</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;perform_tail_fit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;fit_max_moment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;fit_min_w&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">4.0</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;fit_max_w&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">8.0</span>
</pre></div>
</div>
</div>
<div class="section" id="the-dmft-loop-with-automatic-basis-rotations">
<h2>The DMFT loop with automatic basis rotations<a class="headerlink" href="#the-dmft-loop-with-automatic-basis-rotations" title="Permalink to this headline">¶</a></h2>
<p>After these initialisation steps, the formal DMFT cycle is very similar to a calculation without SOC, since the rotations are done automatically, once the <code class="xref py py-class docutils literal notranslate"><span class="pre">BlockStructure</span></code> property <em>transformation</em> is set, see <a class="reference internal" href="../guide/BasisRotation.html#basisrotation"><span class="std std-ref">Automatic basis rotations in DFT+DMFT</span></a>.</p>
<p>The DMFT loop itself looks very much the same as in <span class="xref std std-ref">SrVO3</span> or <span class="xref std std-ref">Sr2MgOsO6_noSOC</span>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># double counting correction:</span>
<span class="n">dc_type</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># FLL</span>
<span class="c1"># DMFT loops:</span>
<span class="n">n_loops</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">for</span> <span class="n">iteration_number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n_loops</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>

    <span class="n">mpi</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Iteration = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">iteration_number</span><span class="p">)</span>

    <span class="n">SK</span><span class="o">.</span><span class="n">set_Sigma</span><span class="p">([</span> <span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span> <span class="p">])</span>                    <span class="c1"># put Sigma into the SumK class</span>
    <span class="n">chemical_potential</span> <span class="o">=</span> <span class="n">SK</span><span class="o">.</span><span class="n">calc_mu</span><span class="p">(</span> <span class="n">precision</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="p">)</span>  <span class="c1"># find the chemical potential for given density</span>
    <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span> <span class="o">&lt;&lt;</span> <span class="n">SK</span><span class="o">.</span><span class="n">extract_G_loc</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">iteration_number</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
        <span class="c1"># Put Hartree energy on Re Sigma</span>
        <span class="n">dm</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="o">.</span><span class="n">density</span><span class="p">()</span>
        <span class="n">SK</span><span class="o">.</span><span class="n">calc_dc</span><span class="p">(</span><span class="n">dm</span><span class="p">,</span> <span class="n">U_interact</span> <span class="o">=</span> <span class="n">U</span><span class="p">,</span> <span class="n">J_hund</span> <span class="o">=</span> <span class="n">J</span><span class="p">,</span> <span class="n">orb</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">use_dc_formula</span> <span class="o">=</span> <span class="n">dc_type</span><span class="p">)</span>
        <span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span> <span class="o">&lt;&lt;</span> <span class="n">SK</span><span class="o">.</span><span class="n">block_structure</span><span class="o">.</span><span class="n">convert_matrix</span><span class="p">(</span><span class="n">SK</span><span class="o">.</span><span class="n">dc_imp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">space_from</span><span class="o">=</span><span class="s1">&#39;sumk&#39;</span><span class="p">,</span><span class="n">space_to</span><span class="o">=</span><span class="s1">&#39;solver&#39;</span><span class="p">)[</span><span class="s1">&#39;ud_0&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Calculate new G0_iw to input into the solver:</span>
    <span class="n">S</span><span class="o">.</span><span class="n">G0_iw</span> <span class="o">&lt;&lt;</span> <span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span> <span class="o">+</span> <span class="n">inverse</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="p">)</span>
    <span class="n">S</span><span class="o">.</span><span class="n">G0_iw</span> <span class="o">&lt;&lt;</span> <span class="n">inverse</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">G0_iw</span><span class="p">)</span>

    <span class="c1"># Solve the impurity problem:</span>
    <span class="n">S</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">h_int</span><span class="o">=</span><span class="n">h_int</span><span class="p">,</span> <span class="o">**</span><span class="n">p</span><span class="p">)</span>

    <span class="c1"># Solved. Now do post-solution stuff:</span>
    <span class="c1"># Set the new double counting:</span>
    <span class="n">dm</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="o">.</span><span class="n">density</span><span class="p">()</span> <span class="c1"># compute the density matrix of the impurity problem</span>
    <span class="n">SK</span><span class="o">.</span><span class="n">calc_dc</span><span class="p">(</span><span class="n">dm</span><span class="p">,</span> <span class="n">U_interact</span> <span class="o">=</span> <span class="n">U</span><span class="p">,</span> <span class="n">J_hund</span> <span class="o">=</span> <span class="n">J</span><span class="p">,</span> <span class="n">orb</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">use_dc_formula</span> <span class="o">=</span> <span class="n">dc_type</span><span class="p">)</span>

    <span class="c1"># Save stuff into the user_data group of hdf5 archive in case of rerun:</span>
    <span class="n">SK</span><span class="o">.</span><span class="n">save</span><span class="p">([</span><span class="s1">&#39;chemical_potential&#39;</span><span class="p">,</span><span class="s1">&#39;dc_imp&#39;</span><span class="p">,</span><span class="s1">&#39;dc_energ&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>The only difference to the other example is in the initialisation of the real part of the self energy. We cannot just take an element of the <em>dc_imp</em> array, since this array is stored in the <em>sumk</em> structure. Therefore, we first need to transform this matrix into <em>solver</em> space, and then take the appropriate matrix element. After the first iteration (here done with 18e6 MC sweeps), you should get this output at the end of the run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Total</span> <span class="n">number</span> <span class="n">of</span> <span class="n">measures</span><span class="p">:</span> <span class="mi">18000000</span>
<span class="n">Average</span> <span class="n">sign</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.884535</span><span class="p">,</span><span class="o">-</span><span class="mf">4.11253e-06</span><span class="p">)</span>
<span class="n">Orbital</span> <span class="n">densities</span> <span class="n">of</span> <span class="n">impurity</span> <span class="n">Green</span> <span class="n">function</span><span class="p">:</span>
<span class="n">Orbital</span> <span class="n">ud_0</span><span class="p">:</span>
<span class="p">[[</span> <span class="mf">5.20045070e-01</span> <span class="o">-</span><span class="mf">8.24863778e-10</span>  <span class="mf">5.95348202e-12</span><span class="p">]</span>
 <span class="p">[</span><span class="o">-</span><span class="mf">8.24863778e-10</span>  <span class="mf">4.30734642e-01</span> <span class="o">-</span><span class="mf">1.29359496e-03</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">5.95348202e-12</span> <span class="o">-</span><span class="mf">1.29359496e-03</span>  <span class="mf">4.80477133e-02</span><span class="p">]]</span>
<span class="n">Orbital</span> <span class="n">ud_1</span><span class="p">:</span>
<span class="p">[[</span> <span class="mf">5.24181422e-01</span>  <span class="mf">2.22991244e-09</span> <span class="o">-</span><span class="mf">8.16290063e-10</span><span class="p">]</span>
 <span class="p">[</span> <span class="mf">2.22991244e-09</span>  <span class="mf">4.30431196e-01</span>  <span class="mf">2.19004569e-03</span><span class="p">]</span>
 <span class="p">[</span><span class="o">-</span><span class="mf">8.16290063e-10</span>  <span class="mf">2.19004569e-03</span>  <span class="mf">4.77161009e-02</span><span class="p">]]</span>
<span class="n">Total</span> <span class="n">charge</span> <span class="n">of</span> <span class="n">impurity</span> <span class="n">problem</span> <span class="p">:</span> <span class="mf">2.001156</span>
</pre></div>
</div>
<p>We see that there is a small sign problem due to the off-diagonal elements in the hybridisation function. However, this sign problem is treatable, since we have rotated into the local basis where these off-diagonal elements are minimised.</p>
<p>The imaginary part of the self energy matrix of the <em>ud_0</em> block looks like this:</p>
<a class="reference internal image-reference" href="../_images/Sr2MgOsO6_SOC_Sigmas.png"><img alt="../_images/Sr2MgOsO6_SOC_Sigmas.png" class="align-center" src="../_images/Sr2MgOsO6_SOC_Sigmas.png" style="width: 600px;" /></a>
<p>Plotted on the same scale, the off-diagonal elements are very small, only the <em>(1,2)</em> and <em>(2,1)</em> elements are visibly different from zero.</p>
<p>A complete python script for this tutorial, including some more input/output, is available (<a class="reference download internal" download="" href="../_downloads/dcecdae92ccc54b39cfbe1873329358a/Sr2MgOsO6_SOC.py"><code class="xref download docutils literal notranslate"><span class="pre">Sr2MgOsO6_SOC.py</span></code></a>). When running the script, you will encounter warnings during the transformation from the <em>sumk</em> to the <em>solver</em> basis. These warnings just reflect that the off-diagonal elements of the full Greens function are not zero at all frequencies, although the local Hamiltonian is. In that sense, we still do an approximation when restricting ourselves to the low-energy subset.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="ce-gamma-fscs_wien2k.html" class="btn btn-neutral float-right" title="DFT+DMFT tutorial: Ce with Hubbard-I approximation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="sr2mgoso6_nosoc.html" class="btn btn-neutral float-left" title="DFT (Wien2k) and Wannier orbitals" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2011-2021.

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
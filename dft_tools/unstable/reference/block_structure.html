

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Block Structure &mdash; TRIQS DFTTools  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=default"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Frequently-Asked Questions" href="../faqs/faqs.html" />
    <link rel="prev" title="TransBasis" href="transbasis.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #7E588A" >
          

          
            <a href="../index.html" class="icon icon-home"> TRIQS DFTTools
          

          
          </a>

          
            
            
              <div class="version">
                3.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html#packaged-versions-of-dfttools">Packaged Versions of DFTTools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../install.html#ubuntu-debian-packages">Ubuntu Debian packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#anaconda-experimental">Anaconda (experimental)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#id2">Docker</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#compiling-dfttools-from-source">Compiling DFTTools from source</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../install.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#installation-steps">Installation steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#important-note-for-fcsc-dft-dmft-calculations">Important note for FCSC DFT+DMFT calculations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#installation-steps-for-the-use-with-wien2k-version-14-2-and-older">Installation steps for the use with WIEN2K version 14.2 and older</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#version-compatibility">Version compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#custom-cmake-options">Custom CMake options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../documentation.html">Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#basic-notions">Basic notions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basicnotions/first.html">What you should know</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/first.html#what-is-dfttools">What is <strong class="program">DFTTools</strong>?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/first.html#understand-the-philosophy-of-dfttools">Understand the philosophy of <strong class="program">DFTTools</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/first.html#learn-how-to-use-triqs-and-the-cthyb-solver">Learn how to use <span class="xref std std-ref">TRIQS</span> (and the <span class="xref std std-ref">CTHYB</span> solver)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/first.html#analytic-continuation">Analytic Continuation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../basicnotions/dft_dmft.html">Introduction to DFT+DMFT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/dft_dmft.html#density-functional-theory-in-a-very-small-nutshell">Density-functional theory in a (very small) nutshell</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/dft_dmft.html#from-dft-to-dmft">From DFT to DMFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/dft_dmft.html#using-projective-wannier-functions-for-dmft">Using projective Wannier functions for DMFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/dft_dmft.html#full-charge-self-consistency">Full charge self-consistency</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../basicnotions/structure.html">Structure of <strong class="program">DFTTools</strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/structure.html#the-interface-layer">The interface layer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/structure.html#the-dmft-calculation">The DMFT calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/structure.html#full-charge-self-consistency">Full charge self consistency</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/structure.html#post-processing">Post-processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/structure.html#executing-your-python-scripts">Executing your python scripts</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#construction-of-local-orbitals-from-dft">Construction of local orbitals from DFT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guide/conversion.html">Supported interfaces</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guide/conv_wien2k.html">Interface with Wien2k</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/conv_vasp.html">Interface with VASP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/conv_elk.html">Interface with Elk</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/conv_W90.html">Interface with Wannier90</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/conv_generalhk.html">A general H(k)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guide/conversion.html#mpi-issues">MPI issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide/conversion.html#interfaces-to-other-packages">Interfaces to other packages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#dft-dmft">DFT+DMFT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guide/dftdmft_singleshot.html">Single-shot DFT+DMFT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guide/dftdmft_singleshot.html#initialization-of-the-calculation">Initialization of the calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/dftdmft_singleshot.html#setting-up-the-impurity-solver">Setting up the impurity solver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/dftdmft_singleshot.html#doing-the-dmft-loop">Doing the DMFT loop</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/dftdmft_singleshot.html#restarting-a-calculation">Restarting a calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/dftdmft_singleshot.html#mixing">Mixing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guide/dftdmft_selfcons.html">Full charge self-consistency</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guide/dftdmft_selfcons.html#wien2k-dmftproj">Wien2k + dmftproj</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/dftdmft_selfcons.html#vasp-plovasp">VASP + PLOVasp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/dftdmft_selfcons.html#elk">Elk</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/dftdmft_selfcons.html#other-dft-codes">Other DFT codes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#advanced-topics">Advanced Topics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guide/blockstructure.html">Manipulating the Green’s functions block structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guide/blockstructure.html#creating-a-block-structure-and-green-s-function">Creating a block structure and Green’s function</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/blockstructure.html#the-solver-structure">The <em>solver</em> structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/blockstructure.html#picking-orbitals">Picking orbitals</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/blockstructure.html#basis-rotations">Basis rotations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/blockstructure.html#diagonal-approximation">Diagonal approximation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guide/BasisRotation.html">Automatic basis rotations in DFT+DMFT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guide/BasisRotation.html#setting-up-the-initial-solver-structure-from-dft">Setting up the initial solver structure from DFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/BasisRotation.html#finding-the-transformation-matrix">Finding the transformation matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/BasisRotation.html#automatic-transformation-during-the-dmft-loop">Automatic transformation during the DMFT loop</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guide/soc.html">Spin-orbit coupled calculations (single-shot)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guide/soc.html#treatment-of-soc-in-dft">Treatment of SOC in DFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/soc.html#treatment-of-soc-in-wien2k">Treatment of SOC in Wien2k</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/soc.html#treatment-of-soc-in-elk">Treatment of SOC in Elk</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/soc.html#after-generating-the-projectors">After generating the projectors</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#postprocessing">Postprocessing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guide/analysis.html">Tools for analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guide/analysis.html#initialisation">Initialisation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/analysis.html#density-of-states-of-the-wannier-orbitals">Density of states of the Wannier orbitals</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/analysis.html#partial-charges">Partial charges</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/analysis.html#correlated-spectral-function-with-real-frequency-self-energy">Correlated spectral function (with real-frequency self energy)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/analysis.html#momentum-resolved-spectral-function-with-real-frequency-self-energy">Momentum resolved spectral function (with real-frequency self energy)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guide/transport.html">Transport calculations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guide/transport.html#formalism">Formalism</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/transport.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/transport.html#wien2k-optics-package">Wien2k optics package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/transport.html#using-the-transport-code">Using the transport code</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guide/transport.html#references">References</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../documentation.html#reference-manual">Reference manual</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="h5structure.html">hdf5 structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="h5structure.html#groups-and-their-formats">groups and their formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="h5structure.html#general-and-simple-h-k-converter">General and simple H(k) Converter</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="converters.html">Converters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="converters.html#wien2k-converter">Wien2k Converter</a></li>
<li class="toctree-l4"><a class="reference internal" href="converters.html#h-k-converter">H(k) Converter</a></li>
<li class="toctree-l4"><a class="reference internal" href="converters.html#wannier90-converter">Wannier90 Converter</a></li>
<li class="toctree-l4"><a class="reference internal" href="converters.html#plovasp">PLOVASP</a></li>
<li class="toctree-l4"><a class="reference internal" href="converters.html#vasp-converter">VASP Converter</a></li>
<li class="toctree-l4"><a class="reference internal" href="converters.html#elk-converter">Elk Converter</a></li>
<li class="toctree-l4"><a class="reference internal" href="converters.html#elk-tools">Elk Tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="converters.html#converter-tools">Converter Tools</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="sumk_dft.html">SumK DFT</a></li>
<li class="toctree-l3"><a class="reference internal" href="sumk_dft_tools.html">SumK DFT Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="symmetry.html">Symmetry</a></li>
<li class="toctree-l3"><a class="reference internal" href="transbasis.html">TransBasis</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Block Structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#faqs">FAQs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../faqs/faqs.html">Frequently-Asked Questions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../faqs/faqs.html#wien2k-fermi-error-when-running-x-lapw2-almd-band">wien2k: FERMI ERROR when running <cite>x lapw2 -almd -band</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs/faqs.html#how-do-i-plot-the-output-of-spaghettis">How do I plot the output of <cite>spaghettis</cite>?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs/faqs.html#x-optic-does-not-write-a-case-pmat-file">x optic does not write a case.pmat file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs/faqs.html#how-do-i-get-real-frequency-quantities">How do I get real-frequency quantities?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#a-simple-example-srvo3">A simple example: SrVO3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/srvo3.html">DFT (Wien2k) and Wannier orbitals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/srvo3.html#dft-setup">DFT setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/srvo3.html#wannier-orbitals">Wannier orbitals</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/srvo3.html#the-dmft-calculation">The DMFT calculation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/srvo3.html#loading-modules">Loading modules</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/srvo3.html#initializing-sumkdft">Initializing SumkDFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/srvo3.html#initializing-the-solver">Initializing the solver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/srvo3.html#dmft-cycle">DMFT cycle</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/srvo3.html#tail-fit-parameters">Tail fit parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#basis-rotations-sr2mgoso6-without-soc">Basis rotations: Sr2MgOsO6 without SOC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/sr2mgoso6_nosoc.html">DFT (Wien2k) and Wannier orbitals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_nosoc.html#dft-setup">DFT setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_nosoc.html#wannier-orbitals">Wannier orbitals</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/sr2mgoso6_nosoc.html#the-dmft-calculation">The DMFT calculation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_nosoc.html#rotating-the-basis">Rotating the basis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_nosoc.html#the-interaction-hamiltonian">The interaction Hamiltonian</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_nosoc.html#the-dmft-loop-with-automatic-basis-rotations">The DMFT loop with automatic basis rotations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#sr2mgoso6-with-soc-non-magnetic">Sr2MgOsO6 with SOC (non-magnetic)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/sr2mgoso6_soc.html">DFT (Wien2k) and Wannier orbitals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_soc.html#dft-setup">DFT setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_soc.html#wannier-orbitals">Wannier orbitals</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/sr2mgoso6_soc.html#the-dmft-calculation">The DMFT calculation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_soc.html#rotating-the-basis">Rotating the basis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_soc.html#the-interaction-hamiltonian">The interaction Hamiltonian</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_soc.html#the-dmft-loop-with-automatic-basis-rotations">The DMFT loop with automatic basis rotations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#full-charge-self-consistency-with-wien2k-gamma-ce">Full charge self consistency with Wien2k: <span class="math notranslate nohighlight">\(\gamma\)</span>-Ce</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/ce-gamma-fscs_wien2k.html">DFT+DMFT tutorial: Ce with Hubbard-I approximation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/ce-gamma-fscs_wien2k.html#wien2k-setup">Wien2k setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/ce-gamma-fscs_wien2k.html#wannier-orbitals-dmftproj">Wannier orbitals: dmftproj</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/ce-gamma-fscs_wien2k.html#dmft-setup-hubbard-i-calculations-in-triqs">DMFT setup: Hubbard-I calculations in TRIQS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/ce-gamma-fscs_wien2k.html#fully-charge-self-consistent-dft-dmft-calculation">Fully charge self-consistent DFT+DMFT calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/ce-gamma-fscs_wien2k.html#post-processing-and-data-analysis">Post-processing and data analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#vasp-interface-examples">VASP interface examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials.html#simple-converter-example-srvo3">Simple Converter example: SrVO3</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/svo_vasp/svo_notebook.html">VASP setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/svo_vasp/svo_notebook.html#PLOVASP">PLOVASP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/svo_vasp/svo_notebook.html#Converting-to-hdf5-file">Converting to hdf5 file</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials.html#complex-example-nio">Complex example: NiO</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/nio_csc.html">DFT and projections</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/nio_csc.html#dmft">DMFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/nio_csc.html#charge-self-consistent-dmft">Charge self-consistent DMFT</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#elk-interface-examples">Elk interface examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials.html#converter-example-srvo3">Converter example: SrVO3</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/svo_elk/srvo3.html">Elk to TRIQS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/svo_elk/srvo3.html#the-dmft-calculation">The DMFT calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/svo_elk/srvo3.html#triqs-to-elk-fully-charge-self-consistent-dft-dmft">TRIQS to Elk (Fully Charge Self-Consistent DFT+DMFT)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ChangeLog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-0-0">Version 3.0.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#restructuring">Restructuring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#dependency-management">Dependency Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#other-changes">Other Changes:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-2-1">Version 2.2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-2-0">Version 2.2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-1-x-changes-since-1-4">Version 2.1.x (changes since 1.4)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about.html#license">License</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#authors-quotation">Authors &amp; Quotation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#disclaimer">Disclaimer</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">TRIQS DFTTools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../documentation.html">Documentation</a> &raquo;</li>
        
      <li>Block Structure</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/reference/block_structure.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="block-structure">
<h1>Block Structure<a class="headerlink" href="#block-structure" title="Permalink to this headline">¶</a></h1>
<p>The <cite>BlockStructure</cite> class allows to change and manipulate
Green functions structures and mappings from sumk to solver.</p>
<p>The block structure can also be written to and read from HDF files.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Do not write the individual elements of this class to a HDF file,
as they belong together and changing one without the other can
result in unexpected results. Always write the BlockStructure
object as a whole.</p>
<p class="last">Writing the sumk_to_solver and solver_to_sumk elements
individually is not implemented.</p>
</div>
<dl class="py class">
<dt id="triqs_dft_tools.block_structure.BlockStructure">
<em class="property"><span class="pre">class</span> </em><code class="descclassname"><span class="pre">triqs_dft_tools.block_structure.</span></code><code class="descname"><span class="pre">BlockStructure</span></code><span class="sig-paren">(</span><em><span class="n"><span class="pre">gf_struct_sumk</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em><span class="n"><span class="pre">gf_struct_solver</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em><span class="n"><span class="pre">solver_to_sumk</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em><span class="n"><span class="pre">sumk_to_solver</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em><span class="n"><span class="pre">solver_to_sumk_block</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em><span class="n"><span class="pre">deg_shells</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em><span class="n"><span class="pre">corr_to_inequiv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em><span class="n"><span class="pre">transformation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/block_structure.html#BlockStructure"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#triqs_dft_tools.block_structure.BlockStructure" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.8/library/functions.html#object" rel="noopener noreferrer" target="_blank" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Contains information about the Green function structure.</p>
<p>This class contains information about the structure of the solver
and sumk Green functions and the mapping between them.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>gf_struct_sumk</strong> : list of list of tuple</p>
<blockquote>
<div><p>gf_struct_sumk[ish][idx] = (block_name,list of indices in block)</p>
<p>for correlated shell ish; idx is just a counter in the list</p>
</div></blockquote>
<p><strong>gf_struct_solver</strong> : list of dict</p>
<blockquote>
<div><p>gf_struct_solver[ish][block] = list of indices in that block</p>
<p>for <em>inequivalent</em> correlated shell ish</p>
</div></blockquote>
<p><strong>solver_to_sumk</strong> : list of dict</p>
<blockquote>
<div><p>solver_to_sumk[ish][(from_block,from_idx)] = (to_block,to_idx)</p>
<p>maps from the solver block and index to the sumk block and index
for <em>inequivalent</em> correlated shell ish</p>
</div></blockquote>
<p><strong>sumk_to_solver</strong> : list of dict</p>
<blockquote>
<div><p>sumk_to_solver[ish][(from_block,from_idx)] = (to_block,to_idx)</p>
<p>maps from the sumk block and index to the solver block and index
for <em>inequivalent</em> correlated shell ish</p>
</div></blockquote>
<p><strong>solver_to_sumk_block</strong> : list of dict</p>
<blockquote>
<div><p>solver_to_sumk_block[ish][from_block] = to_block</p>
<p>maps from the solver block to the sumk block
for <em>inequivalent</em> correlated shell ish</p>
</div></blockquote>
<p><strong>deg_shells</strong> : list of lists of lists OR list of lists of dicts</p>
<blockquote>
<div><p>In the simple format, <code class="docutils literal notranslate"><span class="pre">deg_shells[ish][grp]</span></code> is a list of
block names; <code class="docutils literal notranslate"><span class="pre">ish</span></code> is the index of the inequivalent correlated shell,
<code class="docutils literal notranslate"><span class="pre">grp</span></code> is the index of the group of symmetry-related blocks.
When the name of two blocks is in the same group, that means that
these two blocks are the same by symmetry.</p>
<p>In the more general format, <code class="docutils literal notranslate"><span class="pre">deg_shells[ish][grp]</span></code> is a
dictionary whose keys are the block names that are part of the
group. The values of the dict for each key are tuples <code class="docutils literal notranslate"><span class="pre">(v,</span> <span class="pre">conj)</span></code>,
where <code class="docutils literal notranslate"><span class="pre">v</span></code> is a transformation matrix with the same matrix dimensions
as the block and <code class="docutils literal notranslate"><span class="pre">conj</span></code> is a bool (whether or not to conjugate).
Two blocks with <code class="docutils literal notranslate"><span class="pre">v_1,</span> <span class="pre">conj_1</span></code> and <code class="docutils literal notranslate"><span class="pre">v_2,</span> <span class="pre">conj_2</span></code> being in the same
symmetry group means that</p>
<div class="math notranslate nohighlight">
\[C_1(v_1^\dagger G_1 v_1) = C_2(v_2^\dagger G_2 v_2),\]</div>
<p>where the <span class="math notranslate nohighlight">\(G_i\)</span> are the Green’s functions of the block,
and the functions <span class="math notranslate nohighlight">\(C_i\)</span> conjugate their argument if the bool
<code class="docutils literal notranslate"><span class="pre">conj_i</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
</div></blockquote>
<p><strong>corr_to_inequiv</strong> : list</p>
<blockquote>
<div><p>a list where, for each correlated shell, the index of the corresponding
inequivalent correlated shell is given</p>
</div></blockquote>
<p><strong>transformation</strong> : list of numpy.array or list of dict</p>
<blockquote class="last">
<div><p>a list with entries for each <code class="docutils literal notranslate"><span class="pre">ish</span></code> giving transformation matrices
that are used on the Green’s function in <code class="docutils literal notranslate"><span class="pre">sumk</span></code> space before
converting to the <code class="docutils literal notranslate"><span class="pre">solver</span></code> space
Up to the change in block structure,</p>
<div class="math notranslate nohighlight">
\[G_{solver} = T G_{sumk} T^\dagger\]</div>
<p>if <span class="math notranslate nohighlight">\(T\)</span> is the <code class="docutils literal notranslate"><span class="pre">transformation</span></code> of that particular shell.</p>
<p>Note that for each shell this can either be a numpy array which
applies to all blocks or a dict with a transformation matrix for
each block.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<dl class="py method">
<dt id="triqs_dft_tools.block_structure.BlockStructure.adapt_deg_shells">
<code class="descname"><span class="pre">adapt_deg_shells</span></code><span class="sig-paren">(</span><em><span class="n"><span class="pre">gf_struct</span></span></em>, <em><span class="n"><span class="pre">ish</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/block_structure.html#BlockStructure.adapt_deg_shells"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#triqs_dft_tools.block_structure.BlockStructure.adapt_deg_shells" title="Permalink to this definition">¶</a></dt>
<dd><p>Adapts the deg_shells to a new gf_struct
Internally called when using pick_gf_struct and map_gf_struct</p>
</dd></dl>

<dl class="py method">
<dt id="triqs_dft_tools.block_structure.BlockStructure.approximate_as_diagonal">
<code class="descname"><span class="pre">approximate_as_diagonal</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/block_structure.html#BlockStructure.approximate_as_diagonal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#triqs_dft_tools.block_structure.BlockStructure.approximate_as_diagonal" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a structure for a GF with zero off-diagonal elements.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In general, this will throw away non-zero elements of the
Green’s function. Be sure to verify whether this approximation
is justified.</p>
</div>
</dd></dl>

<dl class="py method">
<dt id="triqs_dft_tools.block_structure.BlockStructure.check_gf">
<code class="descname"><span class="pre">check_gf</span></code><span class="sig-paren">(</span><em><span class="n"><span class="pre">G</span></span></em>, <em><span class="n"><span class="pre">ish</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em><span class="n"><span class="pre">space</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'solver'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/block_structure.html#BlockStructure.check_gf"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#triqs_dft_tools.block_structure.BlockStructure.check_gf" title="Permalink to this definition">¶</a></dt>
<dd><p>check whether the Green’s function G has the right structure</p>
<p>This throws an error if the structure of G is not the same
as <code class="docutils literal notranslate"><span class="pre">gf_struct_solver</span></code> (for <code class="docutils literal notranslate"><span class="pre">space=solver</span></code>) or
<code class="docutils literal notranslate"><span class="pre">gf_struct_sumk</span></code> (for <code class="docutils literal notranslate"><span class="pre">space=sumk</span></code>)..</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>G</strong> : BlockGf or list of BlockGf</p>
<blockquote>
<div><p>Green’s function to check
if it is a list, there should be as many entries as there
are shells, and the check is performed for all shells (unless
ish is given).</p>
</div></blockquote>
<p><strong>ish</strong> : int</p>
<blockquote>
<div><p>shell index
default: 0 if G is just one Green’s function is given,
check all if list of Green’s functions is given</p>
</div></blockquote>
<p><strong>space</strong> : ‘solver’ or ‘sumk’</p>
<blockquote class="last">
<div><p>which space the structure should correspond to</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="py method">
<dt id="triqs_dft_tools.block_structure.BlockStructure.check_matrix">
<code class="descname"><span class="pre">check_matrix</span></code><span class="sig-paren">(</span><em><span class="n"><span class="pre">G</span></span></em>, <em><span class="n"><span class="pre">ish</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em><span class="n"><span class="pre">space</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'solver'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/block_structure.html#BlockStructure.check_matrix"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#triqs_dft_tools.block_structure.BlockStructure.check_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>check whether the matrix G has the right structure</p>
<p>This throws an error if the structure of G is not the same
as <code class="docutils literal notranslate"><span class="pre">gf_struct_solver</span></code> (for <code class="docutils literal notranslate"><span class="pre">space=solver</span></code>) or
<code class="docutils literal notranslate"><span class="pre">gf_struct_sumk</span></code> (for <code class="docutils literal notranslate"><span class="pre">space=sumk</span></code>)..</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>G</strong> : dict of matrices or list of dict of matrices</p>
<blockquote>
<div><p>matrix to check
if it is a list, there should be as many entries as there
are shells, and the check is performed for all shells (unless
ish is given).</p>
</div></blockquote>
<p><strong>ish</strong> : int</p>
<blockquote>
<div><p>shell index
default: 0 if G is just one matrix is given,
check all if list of dicts is given</p>
</div></blockquote>
<p><strong>space</strong> : ‘solver’ or ‘sumk’</p>
<blockquote class="last">
<div><p>which space the structure should correspond to</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="py method">
<dt id="triqs_dft_tools.block_structure.BlockStructure.convert_gf">
<code class="descname"><span class="pre">convert_gf</span></code><span class="sig-paren">(</span><em><span class="n"><span class="pre">G</span></span></em>, <em><span class="n"><span class="pre">G_struct</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em><span class="n"><span class="pre">ish_from</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em><span class="n"><span class="pre">ish_to</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em><span class="n"><span class="pre">show_warnings</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em><span class="n"><span class="pre">G_out</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em><span class="n"><span class="pre">space_from</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'solver'</span></span></em>, <em><span class="n"><span class="pre">space_to</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'solver'</span></span></em>, <em><span class="n"><span class="pre">ish</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/block_structure.html#BlockStructure.convert_gf"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#triqs_dft_tools.block_structure.BlockStructure.convert_gf" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert BlockGf from its structure to this structure.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Elements that are zero in the new structure due to
the new block structure will be just ignored, thus
approximated to zero.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>G</strong> : BlockGf</p>
<blockquote>
<div><p>the Gf that should be converted</p>
</div></blockquote>
<p><strong>G_struct</strong> : BlockStructure or str</p>
<blockquote>
<div><p>the structure of that G or None (then, this structure
is used)</p>
</div></blockquote>
<p><strong>ish_from</strong> : int</p>
<blockquote>
<div><p>shell index of the input structure</p>
</div></blockquote>
<p><strong>ish_to</strong> : int</p>
<blockquote>
<div><p>shell index of the output structure; if None (the default),
it is the same as ish_from</p>
</div></blockquote>
<p><strong>show_warnings</strong> : bool or float</p>
<blockquote>
<div><p>whether to show warnings when elements of the Green’s
function get thrown away
if float, set the threshold for the magnitude of an element
about to be thrown away to trigger a warning
(default: 1.e-10)</p>
</div></blockquote>
<p><strong>G_out</strong> : BlockGf</p>
<blockquote>
<div><p>the output Green’s function (if not given, a new one is
created)</p>
</div></blockquote>
<p><strong>space_from</strong> : ‘solver’ or ‘sumk’</p>
<blockquote>
<div><p>whether the Green’s function <code class="docutils literal notranslate"><span class="pre">G</span></code> corresponds to the
solver or sumk structure of <code class="docutils literal notranslate"><span class="pre">G_struct</span></code></p>
</div></blockquote>
<p><strong>space_to</strong> : ‘solver’ or ‘sumk’</p>
<blockquote>
<div><p>whether the output Green’s function should be according to
the solver of sumk structure of this structure</p>
</div></blockquote>
<p><strong>**kwargs :</strong> :</p>
<blockquote class="last">
<div><p>options passed to the constructor for the new Gf</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="py method">
<dt id="triqs_dft_tools.block_structure.BlockStructure.convert_matrix">
<code class="descname"><span class="pre">convert_matrix</span></code><span class="sig-paren">(</span><em><span class="n"><span class="pre">G</span></span></em>, <em><span class="n"><span class="pre">G_struct</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em><span class="n"><span class="pre">ish_from</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em><span class="n"><span class="pre">ish_to</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em><span class="n"><span class="pre">show_warnings</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em><span class="n"><span class="pre">G_out</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em><span class="n"><span class="pre">space_from</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'solver'</span></span></em>, <em><span class="n"><span class="pre">space_to</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'solver'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/block_structure.html#BlockStructure.convert_matrix"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#triqs_dft_tools.block_structure.BlockStructure.convert_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert matrix from its structure to this structure.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Elements that are zero in the new structure due to
the new block structure will be just ignored, thus
approximated to zero.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>G</strong> : dict of numpy array</p>
<blockquote>
<div><p>the matrix that should be converted</p>
</div></blockquote>
<p><strong>G_struct</strong> : BlockStructure or str</p>
<blockquote>
<div><p>the structure of that G or None (then, this structure
is used)</p>
</div></blockquote>
<p><strong>ish_from</strong> : int</p>
<blockquote>
<div><p>shell index of the input structure</p>
</div></blockquote>
<p><strong>ish_to</strong> : int</p>
<blockquote>
<div><p>shell index of the output structure; if None (the default),
it is the same as ish_from</p>
</div></blockquote>
<p><strong>show_warnings</strong> : bool or float</p>
<blockquote>
<div><p>whether to show warnings when elements of the Green’s
function get thrown away
if float, set the threshold for the magnitude of an element
about to be thrown away to trigger a warning
(default: 1.e-10)</p>
</div></blockquote>
<p><strong>G_out</strong> : dict of numpy array</p>
<blockquote>
<div><p>the output numpy array (if not given, a new one is
created)</p>
</div></blockquote>
<p><strong>space_from</strong> : ‘solver’ or ‘sumk’</p>
<blockquote>
<div><p>whether the matrix <code class="docutils literal notranslate"><span class="pre">G</span></code> corresponds to the
solver or sumk structure of <code class="docutils literal notranslate"><span class="pre">G_struct</span></code></p>
</div></blockquote>
<p><strong>space_to</strong> : ‘solver’ or ‘sumk’</p>
<blockquote>
<div><p>whether the output matrix should be according to
the solver of sumk structure of this structure</p>
</div></blockquote>
<p><strong>**kwargs :</strong> :</p>
<blockquote class="last">
<div><p>options passed to the constructor for the new Gf</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="py method">
<dt id="triqs_dft_tools.block_structure.BlockStructure.convert_operator">
<code class="descname"><span class="pre">convert_operator</span></code><span class="sig-paren">(</span><em><span class="n"><span class="pre">O</span></span></em>, <em><span class="n"><span class="pre">ish</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/block_structure.html#BlockStructure.convert_operator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#triqs_dft_tools.block_structure.BlockStructure.convert_operator" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Converts a second-quantization operator from sumk structure</dt><dd>to solver structure.</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>O</strong> : triqs.operators.Operator</p>
<blockquote>
<div><p>Operator in sumk structure</p>
</div></blockquote>
<p><strong>ish</strong> : int</p>
<blockquote class="last">
<div><p>shell index on which the operator acts</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="py method">
<dt id="triqs_dft_tools.block_structure.BlockStructure.create_gf">
<code class="descname"><span class="pre">create_gf</span></code><span class="sig-paren">(</span><em><span class="pre">ish=0</span></em>, <em><span class="pre">gf_function=&lt;class</span> <span class="pre">'triqs.gf.backwd_compat.gf_imfreq.GfImFreq'&gt;</span></em>, <em><span class="pre">space='solver'</span></em>, <em><span class="pre">**kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/block_structure.html#BlockStructure.create_gf"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#triqs_dft_tools.block_structure.BlockStructure.create_gf" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a zero BlockGf having the correct structure.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">space='solver'</span></code>, the structure is according to
<code class="docutils literal notranslate"><span class="pre">gf_struct_solver</span></code>, else according to <code class="docutils literal notranslate"><span class="pre">gf_struct_sumk</span></code>.</p>
<p>When using GfImFreq as gf_function, typically you have to
supply beta as keyword argument.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>ish</strong> : int</p>
<blockquote>
<div><p>shell index
If <code class="docutils literal notranslate"><span class="pre">space='solver'</span></code>, the index of the of the inequivalent correlated shell,
if <code class="docutils literal notranslate"><span class="pre">space='sumk'</span></code>, the index of the correlated shell</p>
</div></blockquote>
<p><strong>gf_function</strong> : constructor</p>
<blockquote>
<div><p>function used to construct the Gf objects constituting the
individual blocks; default: GfImFreq</p>
</div></blockquote>
<p><strong>space</strong> : ‘solver’ or ‘sumk’</p>
<blockquote>
<div><p>which space the structure should correspond to</p>
</div></blockquote>
<p><strong>**kwargs :</strong> :</p>
<blockquote class="last">
<div><p>options passed on to the Gf constructor for the individual
blocks</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="py method">
<dt id="triqs_dft_tools.block_structure.BlockStructure.create_matrix">
<code class="descname"><span class="pre">create_matrix</span></code><span class="sig-paren">(</span><em><span class="pre">ish=0</span></em>, <em><span class="pre">space='solver'</span></em>, <em><span class="pre">dtype=&lt;class</span> <span class="pre">'numpy.complex128'&gt;</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/block_structure.html#BlockStructure.create_matrix"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#triqs_dft_tools.block_structure.BlockStructure.create_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a zero matrix having the correct structure.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">space='solver'</span></code>, the structure is according to
<code class="docutils literal notranslate"><span class="pre">gf_struct_solver</span></code>, else according to <code class="docutils literal notranslate"><span class="pre">gf_struct_sumk</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>ish</strong> : int</p>
<blockquote>
<div><p>shell index
If <code class="docutils literal notranslate"><span class="pre">space='solver'</span></code>, the index of the of the inequivalent correlated shell,
if <code class="docutils literal notranslate"><span class="pre">space='sumk'</span></code>, the index of the correlated shell</p>
</div></blockquote>
<p><strong>space</strong> : ‘solver’ or ‘sumk’</p>
<blockquote class="last">
<div><p>which space the structure should correspond to</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="py method">
<dt id="triqs_dft_tools.block_structure.BlockStructure.effective_transformation_solver">
<em class="property"><span class="pre">property</span> </em><code class="descname"><span class="pre">effective_transformation_solver</span></code><a class="headerlink" href="#triqs_dft_tools.block_structure.BlockStructure.effective_transformation_solver" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the effective transformation matrix</p>
<p>A list of dicts, one for every inequivalent correlated shell.
In the dict, there is a transformation matrix (as numpy array)
for each block in solver space, that is used to transform from
the sumk block (see <code class="xref py py-meth docutils literal notranslate"><span class="pre">solver_to_sumk_block()</span></code>) to the
solver block.</p>
<p>For a solver block <code class="docutils literal notranslate"><span class="pre">b</span></code> for inequivalent correlated shell <code class="docutils literal notranslate"><span class="pre">ish</span></code>,
the corresponding block of the solver Green’s function is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># the effective transformation matrix for the block</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">block_structure</span><span class="o">.</span><span class="n">effective_transformation_solver</span><span class="p">[</span><span class="n">ish</span><span class="p">][</span><span class="n">b</span><span class="p">]</span>
<span class="c1"># the index of the correlated shell</span>
<span class="n">icrsh</span> <span class="o">=</span> <span class="n">block_structure</span><span class="o">.</span><span class="n">inequiv_to_corr</span><span class="p">[</span><span class="n">ish</span><span class="p">]</span>
<span class="c1"># the name of the corresponding sumk block</span>
<span class="n">block_sumk</span> <span class="o">=</span> <span class="n">block_structure</span><span class="o">.</span><span class="n">solver_to_sumk_block</span><span class="p">[</span><span class="n">icrsh</span><span class="p">][</span><span class="n">b</span><span class="p">]</span>
<span class="c1"># transform the Green&#39;s function</span>
<span class="n">G_solver</span><span class="p">[</span><span class="n">ish</span><span class="p">][</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">from_L_G_R</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">G_sumk</span><span class="p">[</span><span class="n">icrsh</span><span class="p">][</span><span class="n">block_sumk</span><span class="p">],</span> <span class="n">T</span><span class="o">.</span><span class="n">conjugate</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span>
</pre></div>
</div>
<p>The functionality of that code block is implemented in
<a class="reference internal" href="#triqs_dft_tools.block_structure.BlockStructure.convert_gf" title="triqs_dft_tools.block_structure.BlockStructure.convert_gf"><code class="xref py py-meth docutils literal notranslate"><span class="pre">convert_gf()</span></code></a> (i.e., you don’t need to use this directly).</p>
</dd></dl>

<dl class="py method">
<dt id="triqs_dft_tools.block_structure.BlockStructure.effective_transformation_sumk">
<em class="property"><span class="pre">property</span> </em><code class="descname"><span class="pre">effective_transformation_sumk</span></code><a class="headerlink" href="#triqs_dft_tools.block_structure.BlockStructure.effective_transformation_sumk" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the effective transformation matrix</p>
<p>A list of dicts, one for every correlated shell. In the dict,
there is a transformation matrix (as numpy array) for each
block in sumk space, that is used to transform the block.</p>
</dd></dl>

<dl class="py method">
<dt id="triqs_dft_tools.block_structure.BlockStructure.full_structure">
<em class="property"><span class="pre">classmethod</span> </em><code class="descname"><span class="pre">full_structure</span></code><span class="sig-paren">(</span><em><span class="n"><span class="pre">gf_struct</span></span></em>, <em><span class="n"><span class="pre">corr_to_inequiv</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/block_structure.html#BlockStructure.full_structure"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#triqs_dft_tools.block_structure.BlockStructure.full_structure" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct structure that maps to itself.</p>
<p>This has the same structure for sumk and solver, and the
mapping solver_to_sumk and sumk_to_solver is one-to-one.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>gf_struct</strong> : list of dict</p>
<blockquote>
<div><p>gf_struct[ish][block] = list of indices in that block</p>
<p>for (inequivalent) correlated shell ish</p>
</div></blockquote>
<p><strong>corr_to_inequiv</strong> : list</p>
<blockquote class="last">
<div><p>gives the mapping from correlated shell csh to inequivalent
correlated shell icsh, so that corr_to_inequiv[csh]=icsh
e.g. SumkDFT.corr_to_inequiv</p>
<p>if None, each inequivalent correlated shell is supposed to
be correspond to just one correlated shell with the same
index; there is not default, None has to be set explicitly!</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="py method">
<dt id="triqs_dft_tools.block_structure.BlockStructure.gf_struct_solver_dict">
<em class="property"><span class="pre">property</span> </em><code class="descname"><span class="pre">gf_struct_solver_dict</span></code><a class="headerlink" href="#triqs_dft_tools.block_structure.BlockStructure.gf_struct_solver_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>The structure of the solver Green’s function</p>
<p>This is returned as a
list (for each shell)
of dictionaries.</p>
<p>That is,
<code class="docutils literal notranslate"><span class="pre">gf_struct_solver_dict[ish][bname]</span></code>
is a list of the indices of block <code class="docutils literal notranslate"><span class="pre">bname</span></code> of shell <code class="docutils literal notranslate"><span class="pre">ish</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt id="triqs_dft_tools.block_structure.BlockStructure.gf_struct_solver_list">
<em class="property"><span class="pre">property</span> </em><code class="descname"><span class="pre">gf_struct_solver_list</span></code><a class="headerlink" href="#triqs_dft_tools.block_structure.BlockStructure.gf_struct_solver_list" title="Permalink to this definition">¶</a></dt>
<dd><p>The structure of the solver Green’s function</p>
<p>This is returned as a
list (for each shell)
of lists (for each block)
of tuples (block_name, block_indices).</p>
<p>That is,
<code class="docutils literal notranslate"><span class="pre">gf_struct_solver_list[ish][b][0]</span></code>
is the name of the block number <code class="docutils literal notranslate"><span class="pre">b</span></code> of shell <code class="docutils literal notranslate"><span class="pre">ish</span></code>, and
<code class="docutils literal notranslate"><span class="pre">gf_struct_solver_list[ish][b][1]</span></code>
is a list of its indices.</p>
<p>The list for each shell is sorted alphabetically by block name.</p>
</dd></dl>

<dl class="py method">
<dt id="triqs_dft_tools.block_structure.BlockStructure.gf_struct_sumk_dict">
<em class="property"><span class="pre">property</span> </em><code class="descname"><span class="pre">gf_struct_sumk_dict</span></code><a class="headerlink" href="#triqs_dft_tools.block_structure.BlockStructure.gf_struct_sumk_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>The structure of the sumk Green’s function</p>
<p>This is returned as a
list (for each shell)
of dictionaries.</p>
<p>That is,
<code class="docutils literal notranslate"><span class="pre">gf_struct_sumk_dict[ish][bname]</span></code>
is a list of the indices of block <code class="docutils literal notranslate"><span class="pre">bname</span></code> of shell <code class="docutils literal notranslate"><span class="pre">ish</span></code>.</p>
</dd></dl>

<dl class="py method">
<dt id="triqs_dft_tools.block_structure.BlockStructure.gf_struct_sumk_list">
<em class="property"><span class="pre">property</span> </em><code class="descname"><span class="pre">gf_struct_sumk_list</span></code><a class="headerlink" href="#triqs_dft_tools.block_structure.BlockStructure.gf_struct_sumk_list" title="Permalink to this definition">¶</a></dt>
<dd><p>The structure of the sumk Green’s function</p>
<p>This is returned as a
list (for each shell)
of lists (for each block)
of tuples (block_name, block_indices)</p>
<p>That is,
<code class="docutils literal notranslate"><span class="pre">gf_struct_sumk_list[ish][b][0]</span></code>
is the name of the block number <code class="docutils literal notranslate"><span class="pre">b</span></code> of shell <code class="docutils literal notranslate"><span class="pre">ish</span></code>, and
<code class="docutils literal notranslate"><span class="pre">gf_struct_sumk_list[ish][b][1]</span></code>
is a list of its indices.</p>
</dd></dl>

<dl class="py method">
<dt id="triqs_dft_tools.block_structure.BlockStructure.inequiv_to_corr">
<em class="property"><span class="pre">property</span> </em><code class="descname"><span class="pre">inequiv_to_corr</span></code><a class="headerlink" href="#triqs_dft_tools.block_structure.BlockStructure.inequiv_to_corr" title="Permalink to this definition">¶</a></dt>
<dd><p>A list mapping an inequivalent correlated shell to a correlated shell</p>
</dd></dl>

<dl class="py method">
<dt id="triqs_dft_tools.block_structure.BlockStructure.map_gf_struct_solver">
<code class="descname"><span class="pre">map_gf_struct_solver</span></code><span class="sig-paren">(</span><em><span class="n"><span class="pre">mapping</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/block_structure.html#BlockStructure.map_gf_struct_solver"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#triqs_dft_tools.block_structure.BlockStructure.map_gf_struct_solver" title="Permalink to this definition">¶</a></dt>
<dd><p>Map the Green function structure from one struct to another.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>mapping</strong> : list of dict</p>
<blockquote class="last">
<div><p>the dict consists of elements
(from_block,from_index) : (to_block,to_index)
that maps from one structure to the other
(one for each shell; use a mapping <code class="docutils literal notranslate"><span class="pre">None</span></code> for a shell
you want to leave unchanged)</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p>Consider a <cite>gf_struct_solver</cite> consisting of two <span class="math notranslate nohighlight">\(1 \times 1\)</span>
blocks, <cite>block_1</cite> and <cite>block_2</cite>. Say you want to have a new block
structure where you merge them into one block because you want to
introduce an off-diagonal element. You could perform the mapping
via:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">map_gf_struct_solver</span><span class="p">([{(</span><span class="s1">&#39;block_1&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span> <span class="p">(</span><span class="s1">&#39;block&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                       <span class="p">(</span><span class="s1">&#39;block_2&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span> <span class="p">(</span><span class="s1">&#39;block&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)}])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="triqs_dft_tools.block_structure.BlockStructure.pick_gf_struct_solver">
<code class="descname"><span class="pre">pick_gf_struct_solver</span></code><span class="sig-paren">(</span><em><span class="n"><span class="pre">new_gf_struct</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/block_structure.html#BlockStructure.pick_gf_struct_solver"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#triqs_dft_tools.block_structure.BlockStructure.pick_gf_struct_solver" title="Permalink to this definition">¶</a></dt>
<dd><p>Pick selected orbitals within blocks.</p>
<p>This throws away parts of the Green’s function that (for some
reason - be sure that you know what you’re doing) shouldn’t be
included in the calculation.</p>
<p>To drop an entire block, just don’t include it.
To drop a certain index within a block, just don’t include it.</p>
<p>If it was before:</p>
<p>[{‘up’:[0,1],’down’:[0,1],’left’:[0,1]}]</p>
<p>to choose the 0th index of the up block and the 1st index of
the down block and drop the left block, the new_gf_struct would
have to be</p>
<p>[{‘up’:[0],’down’:[1]}]</p>
<p>Note that the indices will be renamed to be a 0-based
sequence of integers, i.e. the new structure will actually
be  [{‘up’:[0],’down’:[0]}].</p>
<p>For dropped indices, sumk_to_solver will map to (None,None).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>new_gf_struct</strong> : list of dict</p>
<blockquote class="last">
<div><p>formatted the same as gf_struct_solver:</p>
<p>new_gf_struct[ish][block]=list of indices in that block.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="py method">
<dt id="triqs_dft_tools.block_structure.BlockStructure.pick_gf_struct_sumk">
<code class="descname"><span class="pre">pick_gf_struct_sumk</span></code><span class="sig-paren">(</span><em><span class="n"><span class="pre">new_gf_struct</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/block_structure.html#BlockStructure.pick_gf_struct_sumk"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#triqs_dft_tools.block_structure.BlockStructure.pick_gf_struct_sumk" title="Permalink to this definition">¶</a></dt>
<dd><p>Pick selected orbitals within blocks.</p>
<p>This throws away parts of the Green’s function that (for some
reason - be sure that you know what you’re doing) shouldn’t be
included in the calculation.</p>
<p>To drop an entire block, just don’t include it.
To drop a certain index within a block, just don’t include it.</p>
<p>If it was before:</p>
<p>[{‘up’:[0,1],’down’:[0,1],’left’:[0,1]}]</p>
<p>to choose the 0th index of the up block and the 1st index of
the down block and drop the left block, the new_gf_struct would
have to be</p>
<p>[{‘up’:[0],’down’:[1]}]</p>
<p>Note that the indices will be renamed to be a 0-based
sequence of integers.</p>
<p>For dropped indices, sumk_to_solver will map to (None,None).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>new_gf_struct</strong> : list of dict</p>
<blockquote class="last">
<div><p>formatted the same as gf_struct_solver:</p>
<p>new_gf_struct[ish][block]=list of indices in that block.</p>
<p>However, the indices are not according to the solver Gf
but the sumk Gf.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../faqs/faqs.html" class="btn btn-neutral float-right" title="Frequently-Asked Questions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="transbasis.html" class="btn btn-neutral float-left" title="TransBasis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2011-2021.

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
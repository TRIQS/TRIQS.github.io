<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>SumK DFT &mdash; TRIQS DFTTools  documentation</title>
    
    <link rel="stylesheet" href="../_static/triqs.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=default"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="top" title="TRIQS DFTTools  documentation" href="../contents.html" />
    <link rel="up" title="Documentation" href="../documentation.html" />
    <link rel="next" title="SumK DFT Tools" href="sumk_dft_tools.html" />
    <link rel="prev" title="Converters" href="converters.html" />
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>
    <script src="../_static/cufon-yui.js" type="text/javascript"></script>
    <script src="../_static/spaceman.cufonfonts.js" type="text/javascript"></script>
    <script type="text/javascript">
      Cufon.replace('.triqs', { fontFamily: 'spaceman', hover: true }); 
    </script>
 
    <style type="text/css">
      table.right { float: right; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
      
    </style>

  </head>
  <body role="document">
<div class="pageheader">
  <ul>
    
    <li><a href="../install.html">Install</a></li>
    
    <li><a href="../documentation.html">Documentation</a></li>
    
    <li><a href="../issues.html">Issues</a></li>
    
    <li><a href="../about.html">About DFTTools</a></li>
    
  </ul>
  <div>
    <h1 style="padding:0; margin: 10px 0 0 0;"><a class="triqs" href="../index.html">dft tools</a></h1>
    <span style="font-size: 14px; margin: 0px; padding: 0px;">connecting <a class="triqs" style="font-size: 12px" href="http://triqs.github.io/triqs">TRIQS</a> to DFT packages</span>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="sumk_dft_tools.html" title="SumK DFT Tools"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="converters.html" title="Converters"
             accesskey="P">previous</a> |</li>
    <li><a href="../index.html">Home</a> &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../documentation.html" accesskey="U">Documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="converters.html"
                        title="previous chapter">Converters</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="sumk_dft_tools.html"
                        title="next chapter">SumK DFT Tools</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/reference/sumk_dft.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="sumk-dft">
<h1>SumK DFT<a class="headerlink" href="#sumk-dft" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT">
<em class="property">class </em><code class="descclassname">triqs_dft_tools.sumk_dft.</code><code class="descname">SumkDFT</code><span class="sig-paren">(</span><em>hdf_file</em>, <em>h_field=0.0</em>, <em>use_dft_blocks=False</em>, <em>dft_data='dft_input'</em>, <em>symmcorr_data='dft_symmcorr_input'</em>, <em>parproj_data='dft_parproj_input'</em>, <em>symmpar_data='dft_symmpar_input'</em>, <em>bands_data='dft_bands_input'</em>, <em>transp_data='dft_transp_input'</em>, <em>misc_data='dft_misc_input'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="http://docs.python.org/2.7/library/functions.html#object" title="(in Python v2.7)"><code class="xref py py-class docutils literal"><span class="pre">object</span></code></a></p>
<p>This class provides a general SumK method for combining ab-initio code and pytriqs.</p>
<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>hdf_file</em>, <em>h_field=0.0</em>, <em>use_dft_blocks=False</em>, <em>dft_data='dft_input'</em>, <em>symmcorr_data='dft_symmcorr_input'</em>, <em>parproj_data='dft_parproj_input'</em>, <em>symmpar_data='dft_symmpar_input'</em>, <em>bands_data='dft_bands_input'</em>, <em>transp_data='dft_transp_input'</em>, <em>misc_data='dft_misc_input'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.__init__"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialises the class from data previously stored into an hdf5 archive.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>hdf_file</strong> : string</p>
<blockquote>
<div><p>Name of hdf5 containing the data.</p>
</div></blockquote>
<p><strong>h_field</strong> : scalar, optional</p>
<blockquote>
<div><p>The value of magnetic field to add to the DFT Hamiltonian. 
The contribution -h_field*sigma is added to diagonal elements of the Hamiltonian.
It cannot be used with the spin-orbit coupling on; namely h_field is set to 0 if self.SO=True.</p>
</div></blockquote>
<p><strong>use_dft_blocks</strong> : boolean, optional</p>
<blockquote>
<div><dl class="docutils">
<dt>If True, the local Green&#8217;s function matrix for each spin is divided into smaller blocks </dt>
<dd><p class="first last">with the block structure determined from the DFT density matrix of the corresponding correlated shell.</p>
</dd>
</dl>
<p>Alternatively and additionally, the block structure can be analysed using <code class="xref py py-meth docutils literal"><span class="pre">analyse_block_structure</span></code>
and manipulated using the SumkDFT.block_structre attribute (see <code class="xref py py-class docutils literal"><span class="pre">BlockStructure</span></code>).</p>
</div></blockquote>
<p><strong>dft_data</strong> : string, optional</p>
<blockquote>
<div><p>Name of hdf5 subgroup in which DFT data for projector and lattice Green&#8217;s function construction are stored.</p>
</div></blockquote>
<p><strong>symmcorr_data</strong> : string, optional</p>
<blockquote>
<div><p>Name of hdf5 subgroup in which DFT data on symmetries of correlated shells 
(symmetry operations, permutaion matrices etc.) are stored.</p>
</div></blockquote>
<p><strong>parproj_data</strong> : string, optional</p>
<blockquote>
<div><p>Name of hdf5 subgroup in which DFT data on non-normalized projectors for non-correlated
states (used in the partial density of states calculations) are stored.</p>
</div></blockquote>
<p><strong>symmpar_data</strong> : string, optional</p>
<blockquote>
<div><p>Name of hdf5 subgroup in which DFT data on symmetries of the non-normalized projectors
are stored.</p>
</div></blockquote>
<p><strong>bands_data</strong> : string, optional</p>
<blockquote>
<div><p>Name of hdf5 subgroup in which DFT data necessary for band-structure/k-resolved spectral
function calculations (projectors, DFT Hamiltonian for a chosen path in the Brillouin zone etc.)
are stored.</p>
</div></blockquote>
<p><strong>transp_data</strong> : string, optional</p>
<blockquote>
<div><p>Name of hdf5 subgroup in which DFT data necessary for transport calculations are stored.</p>
</div></blockquote>
<p><strong>misc_data</strong> : string, optional</p>
<blockquote class="last">
<div><p>Name of hdf5 subgroup in which miscellaneous DFT data are stored.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.__weakref__">
<code class="descname">__weakref__</code><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.__weakref__" title="Permalink to this definition">¶</a></dt>
<dd><p>list of weak references to the object (if defined)</p>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.add_dc">
<code class="descname">add_dc</code><span class="sig-paren">(</span><em>iw_or_w='iw'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.add_dc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.add_dc" title="Permalink to this definition">¶</a></dt>
<dd><p>Subtracts the double counting term from the impurity self energy.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>iw_or_w</strong> : string, optional</p>
<blockquote>
<div><ul class="simple">
<li><cite>iw_or_w</cite> = &#8216;iw&#8217; for a imaginary-frequency self-energy</li>
<li><cite>iw_or_w</cite> = &#8216;w&#8217; for a real-frequency self-energy</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>sigma_minus_dc</strong> : gf_struct_sumk like</p>
<blockquote class="last">
<div><p>Self-energy with a subtracted double-counting term.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.analyse_block_structure">
<code class="descname">analyse_block_structure</code><span class="sig-paren">(</span><em>threshold=1e-05</em>, <em>include_shells=None</em>, <em>dm=None</em>, <em>hloc=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.analyse_block_structure"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.analyse_block_structure" title="Permalink to this definition">¶</a></dt>
<dd><p>Determines the block structure of local Green&#8217;s functions by analysing the structure of 
the corresponding density matrices and the local Hamiltonian. The resulting block structures 
for correlated shells are stored in the <code class="xref py py-class docutils literal"><span class="pre">SumkDFT.block_structure</span></code> attribute.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>threshold</strong> : real, optional</p>
<blockquote>
<div><p>If the difference between density matrix / hloc elements is below threshold,
they are considered to be equal.</p>
</div></blockquote>
<p><strong>include_shells</strong> : list of integers, optional</p>
<blockquote>
<div><p>List of correlated shells to be analysed.
If include_shells is not provided all correlated shells will be analysed.</p>
</div></blockquote>
<p><strong>dm</strong> : list of dict, optional</p>
<blockquote>
<div><p>List of density matrices from which block stuctures are to be analysed.
Each density matrix is a dict {block names: 2d numpy arrays}.
If not provided, dm will be calculated from the DFT Hamiltonian by a simple-point BZ integration.</p>
</div></blockquote>
<p><strong>hloc</strong> : list of dict, optional</p>
<blockquote class="last">
<div><p>List of local Hamiltonian matrices from which block stuctures are to be analysed
Each Hamiltonian is a dict {block names: 2d numpy arrays}.
If not provided, it will be calculated using eff_atomic_levels.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.analyse_block_structure_from_gf">
<code class="descname">analyse_block_structure_from_gf</code><span class="sig-paren">(</span><em>G</em>, <em>threshold=1e-05</em>, <em>include_shells=None</em>, <em>analyse_deg_shells=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.analyse_block_structure_from_gf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.analyse_block_structure_from_gf" title="Permalink to this definition">¶</a></dt>
<dd><p>Determines the block structure of local Green&#8217;s functions by analysing
the structure of the corresponding non-interacting Green&#8217;s function.
The resulting block structures for correlated shells are
stored in the <code class="xref py py-class docutils literal"><span class="pre">SumkDFT.block_structure</span></code>
attribute.</p>
<p>This is a safer alternative to analyse_block_structure, because
the full non-interacting Green&#8217;s function is taken into account
and not just the density matrix and Hloc.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>G</strong> : list of BlockGf of GfImFreq, GfImTime, GfReFreq or GfReTime</p>
<blockquote>
<div><p>the non-interacting Green&#8217;s function for each inequivalent correlated shell</p>
</div></blockquote>
<p><strong>threshold</strong> : real, optional</p>
<blockquote>
<div><p>If the difference between matrix elements is below threshold,
they are considered to be equal.</p>
</div></blockquote>
<p><strong>include_shells</strong> : list of integers, optional</p>
<blockquote>
<div><p>List of correlated shells to be analysed.
If include_shells is not provided all correlated shells will be analysed.</p>
</div></blockquote>
<p><strong>analyse_deg_shells</strong> : bool</p>
<blockquote>
<div><p>Whether to call the analyse_deg_shells function
after having finished the block structure analysis</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>G</strong> : list of BlockGf of GfImFreq or GfImTime</p>
<blockquote class="last">
<div><p>the Green&#8217;s function transformed into the new block structure</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.analyse_deg_shells">
<code class="descname">analyse_deg_shells</code><span class="sig-paren">(</span><em>G</em>, <em>threshold=1e-05</em>, <em>include_shells=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.analyse_deg_shells"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.analyse_deg_shells" title="Permalink to this definition">¶</a></dt>
<dd><p>Determines the degenerate shells of local Green&#8217;s functions by analysing
the structure of the corresponding non-interacting Green&#8217;s function.
The results are stored in the
<code class="xref py py-class docutils literal"><span class="pre">SumkDFT.block_structure</span></code>
attribute.</p>
<p>Due to the implementation and numerics, the maximum difference between
two matrix elements that are detected as equal can be a bit higher
(e.g. a factor of two) than the actual threshold.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>G</strong> : list of BlockGf of GfImFreq or GfImTime</p>
<blockquote>
<div><p>the non-interacting Green&#8217;s function for each inequivalent correlated shell</p>
</div></blockquote>
<p><strong>threshold</strong> : real, optional</p>
<blockquote>
<div><p>If the difference between matrix elements is below threshold,
they are considered to be equal.</p>
</div></blockquote>
<p><strong>include_shells</strong> : list of integers, optional</p>
<blockquote class="last">
<div><p>List of correlated shells to be analysed.
If include_shells is not provided all correlated shells will be analysed.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.calc_dc">
<code class="descname">calc_dc</code><span class="sig-paren">(</span><em>dens_mat</em>, <em>orb=0</em>, <em>U_interact=None</em>, <em>J_hund=None</em>, <em>use_dc_formula=0</em>, <em>use_dc_value=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.calc_dc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.calc_dc" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates and sets the double counting corrections.</p>
<p>If &#8216;use_dc_value&#8217; is provided the double-counting term is uniformly initialized
with this constant and &#8216;U_interact&#8217; and &#8216;J_hund&#8217; are ignored.</p>
<p>If &#8216;use_dc_value&#8217; is None the correction is evaluated according to 
one of the following formulae:</p>
<ul>
<li><p class="first">use_dc_formula = 0: fully-localised limit (FLL)</p>
</li>
<li><dl class="first docutils">
<dt>use_dc_formula = 1: Held&#8217;s formula, i.e. mean-field formula for the Kanamori</dt>
<dd><p class="first last">type of the interaction Hamiltonian</p>
</dd>
</dl>
</li>
<li><p class="first">use_dc_formula = 2: around mean-field (AMF)</p>
</li>
</ul>
<p>Note that FLL and AMF formulae were derived assuming a full Slater-type interaction
term and should be thus used accordingly. For the Kanamori-type interaction
one should use formula 1.</p>
<p>The double-counting self-energy term is stored in <cite>self.dc_imp</cite> and the energy
correction in <cite>self.dc_energ</cite>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>dens_mat</strong> : gf_struct_solver like</p>
<blockquote>
<div><p>Density matrix for the specified correlated shell.</p>
</div></blockquote>
<p><strong>orb</strong> : int, optional</p>
<blockquote>
<div><p>Index of an inequivalent shell.</p>
</div></blockquote>
<p><strong>U_interact</strong> : float, optional</p>
<blockquote>
<div><p>Value of interaction parameter <cite>U</cite>.</p>
</div></blockquote>
<p><strong>J_hund</strong> : float, optional</p>
<blockquote>
<div><p>Value of interaction parameter <cite>J</cite>.</p>
</div></blockquote>
<p><strong>use_dc_formula</strong> : int, optional</p>
<blockquote>
<div><p>Type of double-counting correction (see description).</p>
</div></blockquote>
<p><strong>use_dc_value</strong> : float, optional</p>
<blockquote class="last">
<div><p>Value of the double-counting correction. If specified
<cite>U_interact</cite>, <cite>J_hund</cite> and <cite>use_dc_formula</cite> are ignored.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.calc_dc_for_density">
<code class="descname">calc_dc_for_density</code><span class="sig-paren">(</span><em>orb</em>, <em>dc_init</em>, <em>dens_mat</em>, <em>density=None</em>, <em>precision=0.01</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.calc_dc_for_density"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.calc_dc_for_density" title="Permalink to this definition">¶</a></dt>
<dd><p>Searches for DC in order to fulfill charge neutrality.
If density is given, then DC is set such that the LOCAL charge of orbital
orb coincides with the given density.</p>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.calc_density_correction">
<code class="descname">calc_density_correction</code><span class="sig-paren">(</span><em>filename=None</em>, <em>dm_type='wien2k'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.calc_density_correction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.calc_density_correction" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the charge density correction and stores it into a file.</p>
<p>The charge density correction is needed for charge-self-consistent DFT+DMFT calculations.
It represents a density matrix of the interacting system defined in Bloch basis
and it is calculated from the sum over Matsubara frequecies of the full GF,</p>
<p>..math:: N_{nunu&#8217;}(k) = sum_{iomega_{n}} G_{nunu&#8217;}(k, iomega_{n})</p>
<p>The density matrix for every <cite>k</cite>-point is stored into a file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>filename</strong> : string</p>
<blockquote>
<div><p>Name of the file to store the charge density correction.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>(deltaN, dens)</strong> : tuple</p>
<blockquote class="last">
<div><p>Returns a tuple containing the density matrix <cite>deltaN</cite> and
the corresponing total charge <cite>dens</cite>.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.calc_mu">
<code class="descname">calc_mu</code><span class="sig-paren">(</span><em>precision=0.01</em>, <em>iw_or_w='iw'</em>, <em>broadening=None</em>, <em>delta=0.5</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.calc_mu"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.calc_mu" title="Permalink to this definition">¶</a></dt>
<dd><p>Searches for the chemical potential that gives the DFT total charge.
A simple bisection method is used.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>precision</strong> : float, optional</p>
<blockquote>
<div><p>A desired precision of the resulting total charge.</p>
</div></blockquote>
<p><strong>iw_or_w</strong> : string, optional</p>
<blockquote>
<div><ul class="simple">
<li><cite>iw_or_w</cite> = &#8216;iw&#8217; for a imaginary-frequency self-energy</li>
<li><cite>iw_or_w</cite> = &#8216;w&#8217; for a real-frequency self-energy</li>
</ul>
</div></blockquote>
<p><strong>broadening</strong> : float, optional</p>
<blockquote>
<div><p>Imaginary shift for the axis along which the real-axis GF is calculated.
If not provided, broadening will be set to double of the distance between mesh points in &#8216;mesh&#8217;.
Only relevant for real-frequency GF.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>mu</strong> : float</p>
<blockquote class="last">
<div><p>Value of the chemical potential giving the DFT total charge
within specified precision.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.check_projectors">
<code class="descname">check_projectors</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.check_projectors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.check_projectors" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculated the density matrix from projectors (DM = P Pdagger) to check that it is correct and 
specifically that it matches DFT.</p>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.density_matrix">
<code class="descname">density_matrix</code><span class="sig-paren">(</span><em>method='using_gf'</em>, <em>beta=40.0</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.density_matrix"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.density_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate density matrices in one of two ways.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>method</strong> : string, optional</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt>if &#8216;using_gf&#8217;: First get lattice gf (g_loc is not set up), then density matrix.</dt>
<dd><p class="first last">It is useful for Hubbard I, and very quick.
No assumption on the hopping structure is made (ie diagonal or not).</p>
</dd>
</dl>
</li>
<li><p class="first">if &#8216;using_point_integration&#8217;: Only works for diagonal hopping matrix (true in wien2k).</p>
</li>
</ul>
</div></blockquote>
<p><strong>beta</strong> : float, optional</p>
<blockquote>
<div><p>Inverse temperature.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>dens_mat</strong> : list of dicts</p>
<blockquote class="last">
<div><p>Density matrix for each spin in each correlated shell.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.downfold">
<code class="descname">downfold</code><span class="sig-paren">(</span><em>ik</em>, <em>ish</em>, <em>bname</em>, <em>gf_to_downfold</em>, <em>gf_inp</em>, <em>shells='corr'</em>, <em>ir=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.downfold"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.downfold" title="Permalink to this definition">¶</a></dt>
<dd><p>Downfolds a block of the Green&#8217;s function for a given shell and k-point using the corresponding projector matrices.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>ik</strong> : integer</p>
<blockquote>
<div><p>k-point index for which the downfolding is to be done.</p>
</div></blockquote>
<p><strong>ish</strong> : integer</p>
<blockquote>
<div><p>Shell index of GF to be downfolded.</p>
<ul class="simple">
<li>if shells=&#8217;corr&#8217;: ish labels all correlated shells (equivalent or not)</li>
<li>if shells=&#8217;all&#8217;: ish labels only representative (inequivalent) non-correlated shells</li>
</ul>
</div></blockquote>
<p><strong>bname</strong> : string</p>
<blockquote>
<div><p>Block name of the target block of the lattice Green&#8217;s function.</p>
</div></blockquote>
<p><strong>gf_to_downfold</strong> : Gf</p>
<blockquote>
<div><p>Block of the Green&#8217;s function that is to be downfolded.</p>
</div></blockquote>
<p><strong>gf_inp</strong> : Gf</p>
<blockquote>
<div><p>FIXME</p>
</div></blockquote>
<p><strong>shells</strong> : string, optional</p>
<blockquote>
<div><ul class="simple">
<li>if shells=&#8217;corr&#8217;: orthonormalized projectors for correlated shells are used for the downfolding.</li>
<li>if shells=&#8217;all&#8217;: non-normalized projectors for all included shells are used for the downfolding.</li>
</ul>
</div></blockquote>
<p><strong>ir</strong> : integer, optional</p>
<blockquote>
<div><p>Index of equivalent site in the non-correlated shell &#8216;ish&#8217;, only used if shells=&#8217;all&#8217;.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>gf_downfolded</strong> : Gf</p>
<blockquote class="last">
<div><p>Downfolded block of the lattice Green&#8217;s function.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.eff_atomic_levels">
<code class="descname">eff_atomic_levels</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.eff_atomic_levels"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.eff_atomic_levels" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the effective local Hamiltonian required as an input for
the Hubbard I Solver.
The local Hamiltonian (effective atomic levels) is calculated by
projecting the on-site Bloch Hamiltonian:</p>
<div class="math">
\[H^{loc}_{m m'} = \sum_{k} P_{m \nu}(k) H_{\nu\nu'}(k) P^{*}_{\nu' m'}(k),\]</div>
<p>where</p>
<div class="math">
\[H_{\nu\nu'}(k) = [\epsilon_{\nu k} - h_{z} \sigma_{z}] \delta_{\nu\nu'}.\]</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>None</strong> :</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>eff_atlevels</strong> : gf_struct_sumk like</p>
<blockquote class="last">
<div><p>Effective local Hamiltonian <span class="math">\(H^{loc}_{m m'}\)</span> for each
inequivalent correlated shell.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.extract_G_loc">
<code class="descname">extract_G_loc</code><span class="sig-paren">(</span><em>mu=None</em>, <em>iw_or_w='iw'</em>, <em>with_Sigma=True</em>, <em>with_dc=True</em>, <em>broadening=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.extract_G_loc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.extract_G_loc" title="Permalink to this definition">¶</a></dt>
<dd><p>Extracts the local downfolded Green function by the Brillouin-zone integration of the lattice Green&#8217;s function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>mu</strong> : real, optional</p>
<blockquote>
<div><p>Input chemical potential. If not provided the value of self.chemical_potential is used as mu.</p>
</div></blockquote>
<p><strong>with_Sigma</strong> : boolean, optional</p>
<blockquote>
<div><p>If True then the local GF is calculated with the self-energy self.Sigma_imp.</p>
</div></blockquote>
<p><strong>with_dc</strong> : boolean, optional</p>
<blockquote>
<div><p>If True then the double-counting correction is subtracted from the self-energy in calculating the GF.</p>
</div></blockquote>
<p><strong>broadening</strong> : float, optional</p>
<blockquote>
<div><p>Imaginary shift for the axis along which the real-axis GF is calculated.
If not provided, broadening will be set to double of the distance between mesh points in &#8216;mesh&#8217;.
Only relevant for real-frequency GF.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>G_loc_inequiv</strong> : list of BlockGf (Green&#8217;s function) objects</p>
<blockquote class="last">
<div><p>List of the local Green&#8217;s functions for all inequivalent correlated shells, 
rotated into the corresponding local frames.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.init_dc">
<code class="descname">init_dc</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.init_dc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.init_dc" title="Permalink to this definition">¶</a></dt>
<dd><p>Initializes the double counting terms.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>None</strong> :</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.lattice_gf">
<code class="descname">lattice_gf</code><span class="sig-paren">(</span><em>ik</em>, <em>mu=None</em>, <em>iw_or_w='iw'</em>, <em>beta=40</em>, <em>broadening=None</em>, <em>mesh=None</em>, <em>with_Sigma=True</em>, <em>with_dc=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.lattice_gf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.lattice_gf" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the lattice Green function for a given k-point from the DFT Hamiltonian and the self energy.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>ik</strong> : integer</p>
<blockquote>
<div><p>k-point index.</p>
</div></blockquote>
<p><strong>mu</strong> : real, optional</p>
<blockquote>
<div><p>Chemical potential for which the Green&#8217;s function is to be calculated.
If not provided, self.chemical_potential is used for mu.</p>
</div></blockquote>
<p><strong>iw_or_w</strong> : string, optional</p>
<blockquote>
<div><ul class="simple">
<li><cite>iw_or_w</cite> = &#8216;iw&#8217; for a imaginary-frequency self-energy</li>
<li><cite>iw_or_w</cite> = &#8216;w&#8217; for a real-frequency self-energy</li>
</ul>
</div></blockquote>
<p><strong>beta</strong> : real, optional</p>
<blockquote>
<div><p>Inverse temperature.</p>
</div></blockquote>
<p><strong>broadening</strong> : real, optional</p>
<blockquote>
<div><p>Imaginary shift for the axis along which the real-axis GF is calculated.
If not provided, broadening will be set to double of the distance between mesh points in &#8216;mesh&#8217;.</p>
</div></blockquote>
<p><strong>mesh</strong> : list, optional</p>
<blockquote>
<div><p>Data defining mesh on which the real-axis GF will be calculated, given in the form
(om_min,om_max,n_points), where om_min is the minimum omega, om_max is the maximum omega and n_points is the number of points.</p>
</div></blockquote>
<p><strong>with_Sigma</strong> : boolean, optional</p>
<blockquote>
<div><p>If True the GF will be calculated with the self-energy stored in self.Sigmaimp_(w/iw), for real/Matsubara GF, respectively. 
In this case the mesh is taken from the self.Sigma_imp object.
If with_Sigma=True but self.Sigmaimp_(w/iw) is not present, with_Sigma is reset to False.</p>
</div></blockquote>
<p><strong>with_dc</strong> : boolean, optional</p>
<blockquote>
<div><p>if True and with_Sigma=True, the dc correction is substracted from the self-energy before it is included into GF.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>G_latt</strong> : BlockGf</p>
<blockquote class="last">
<div><p>Lattice Green&#8217;s function.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.load">
<code class="descname">load</code><span class="sig-paren">(</span><em>things_to_load</em>, <em>subgrp='user_data'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads user data from the HDF file. Raises an exeption if a requested dataset is not found.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>things_to_read</strong> : list of strings</p>
<blockquote>
<div><p>List of datasets to be read from the hdf5 file.</p>
</div></blockquote>
<p><strong>subgrp</strong> : string, optional</p>
<blockquote>
<div><p>Name of hdf5 file subgroup from which the data are to be read.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>list_to_return</strong> : list</p>
<blockquote class="last">
<div><p>A list containing data read from hdf5.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.number_of_atoms">
<code class="descname">number_of_atoms</code><span class="sig-paren">(</span><em>shells</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.number_of_atoms"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.number_of_atoms" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine the number of inequivalent atoms.</p>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.put_Sigma">
<code class="descname">put_Sigma</code><span class="sig-paren">(</span><em>Sigma_imp</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.put_Sigma"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.put_Sigma" title="Permalink to this definition">¶</a></dt>
<dd><p>Inserts the impurity self-energies into the sumk_dft class.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>Sigma_imp</strong> : list of BlockGf (Green&#8217;s function) objects</p>
<blockquote class="last">
<div><p>List containing impurity self-energy for all inequivalent correlated shells.
Self-energies for equivalent shells are then automatically set by this function.
The self-energies can be of the real or imaginary-frequency type.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.read_input_from_hdf">
<code class="descname">read_input_from_hdf</code><span class="sig-paren">(</span><em>subgrp</em>, <em>things_to_read</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.read_input_from_hdf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.read_input_from_hdf" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads data from the HDF file. Prints a warning if a requested dataset is not found.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>subgrp</strong> : string</p>
<blockquote>
<div><p>Name of hdf5 file subgroup from which the data are to be read.</p>
</div></blockquote>
<p><strong>things_to_read</strong> : list of strings</p>
<blockquote>
<div><p>List of datasets to be read from the hdf5 file.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>subgroup_present</strong> : boolean</p>
<blockquote>
<div><p>Is the subgrp is present in hdf5 file?</p>
</div></blockquote>
<p><strong>value_read</strong> : boolean</p>
<blockquote class="last">
<div><p>Did the reading of requested datasets succeed?</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.rotloc">
<code class="descname">rotloc</code><span class="sig-paren">(</span><em>ish</em>, <em>gf_to_rotate</em>, <em>direction</em>, <em>shells='corr'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.rotloc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.rotloc" title="Permalink to this definition">¶</a></dt>
<dd><p>Rotates a block of the local Green&#8217;s function from the local frame to the global frame and vice versa.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>ish</strong> : integer</p>
<blockquote>
<div><p>Shell index of GF to be rotated.</p>
<ul class="simple">
<li>if shells=&#8217;corr&#8217;: ish labels all correlated shells (equivalent or not)</li>
<li>if shells=&#8217;all&#8217;: ish labels only representative (inequivalent) non-correlated shells</li>
</ul>
</div></blockquote>
<p><strong>gf_to_rotate</strong> : Gf</p>
<blockquote>
<div><p>Block of the Green&#8217;s function that is to be rotated.</p>
</div></blockquote>
<p><strong>direction</strong> : string</p>
<blockquote>
<div><p>The direction of rotation can be either</p>
<ul class="simple">
<li>&#8216;toLocal&#8217; : global -&gt; local transformation,</li>
<li>&#8216;toGlobal&#8217; : local -&gt; global transformation.</li>
</ul>
</div></blockquote>
<p><strong>shells</strong> : string, optional</p>
<blockquote>
<div><ul class="simple">
<li>if shells=&#8217;corr&#8217;: the rotation matrix for the correlated shell &#8216;ish&#8217; is used,</li>
<li>if shells=&#8217;all&#8217;: the rotation matrix for the generic (non-correlated) shell &#8216;ish&#8217; is used.</li>
</ul>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>gf_rotated</strong> : Gf</p>
<blockquote class="last">
<div><p>Rotated block of the local Green&#8217;s function.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.save">
<code class="descname">save</code><span class="sig-paren">(</span><em>things_to_save</em>, <em>subgrp='user_data'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Saves data from a list into the HDF file. Prints a warning if a requested data is not found in SumkDFT object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>things_to_save</strong> : list of strings</p>
<blockquote>
<div><p>List of datasets to be saved into the hdf5 file.</p>
</div></blockquote>
<p><strong>subgrp</strong> : string, optional</p>
<blockquote class="last">
<div><p>Name of hdf5 file subgroup in which the data are to be stored.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.set_dc">
<code class="descname">set_dc</code><span class="sig-paren">(</span><em>dc_imp</em>, <em>dc_energ</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.set_dc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.set_dc" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets double counting corrections to given values.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>dc_imp</strong> : gf_struct_sumk like</p>
<blockquote>
<div><p>Double-counting self-energy term.</p>
</div></blockquote>
<p><strong>dc_energ</strong> : list of floats</p>
<blockquote class="last">
<div><p>Double-counting energy corrections for each correlated shell.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.set_mu">
<code class="descname">set_mu</code><span class="sig-paren">(</span><em>mu</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.set_mu"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.set_mu" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets a new chemical potential.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>mu</strong> : float</p>
<blockquote class="last">
<div><p>New value of the chemical potential.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.sorts_of_atoms">
<code class="descname">sorts_of_atoms</code><span class="sig-paren">(</span><em>shells</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.sorts_of_atoms"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.sorts_of_atoms" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine the number of inequivalent sorts.</p>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.symm_deg_gf">
<code class="descname">symm_deg_gf</code><span class="sig-paren">(</span><em>gf_to_symm</em>, <em>orb</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.symm_deg_gf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.symm_deg_gf" title="Permalink to this definition">¶</a></dt>
<dd><p>Averages a GF over degenerate shells.</p>
<p>Degenerate shells of an inequivalent correlated shell are defined by
<cite>self.deg_shells</cite>. This function enforces corresponding degeneracies
in the input GF.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>gf_to_symm</strong> : gf_struct_solver like</p>
<blockquote>
<div><p>Input and output GF (i.e., it gets overwritten)</p>
</div></blockquote>
<p><strong>orb</strong> : int</p>
<blockquote class="last">
<div><p>Index of an inequivalent shell.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.total_density">
<code class="descname">total_density</code><span class="sig-paren">(</span><em>mu=None</em>, <em>iw_or_w='iw'</em>, <em>with_Sigma=True</em>, <em>with_dc=True</em>, <em>broadening=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.total_density"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.total_density" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the total charge within the energy window for a given chemical potential. 
The chemical potential is either given by parameter <cite>mu</cite> or, if it is not specified,
taken from <cite>self.chemical_potential</cite>.</p>
<p>The total charge is calculated from the trace of the GF in the Bloch basis.
By default, a full interacting GF is used. To use the non-interacting GF, set
parameter <cite>with_Sigma = False</cite>.</p>
<p>The number of bands within the energy windows generally depends on <cite>k</cite>. The trace is
therefore calculated separately for each <cite>k</cite>-point.</p>
<p>Since in general n_orbitals depends on k, the calculation is done in the following order:</p>
<div class="math">
\[n_{tot} = \sum_{k} n(k),\]</div>
<p>with</p>
<div class="math">
\[n(k) = Tr G_{\nu\nu'}(k, i\omega_{n}). \]</div>
<p>The calculation is done in the global coordinate system, if distinction is made between local/global.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>mu</strong> : float, optional</p>
<blockquote>
<div><p>Input chemical potential. If not specified, <cite>self.chemical_potential</cite> is used instead.</p>
</div></blockquote>
<p><strong>iw_or_w</strong> : string, optional</p>
<blockquote>
<div><ul class="simple">
<li><cite>iw_or_w</cite> = &#8216;iw&#8217; for a imaginary-frequency self-energy</li>
<li><cite>iw_or_w</cite> = &#8216;w&#8217; for a real-frequency self-energy</li>
</ul>
</div></blockquote>
<p><strong>with_Sigma</strong> : boolean, optional</p>
<blockquote>
<div><p>If <cite>True</cite> the full interacing GF is evaluated, otherwise the self-energy is not
included and the charge would correspond to a non-interacting system.</p>
</div></blockquote>
<p><strong>with_dc</strong> : boolean, optional</p>
<blockquote>
<div><p>Whether or not to subtract the double-counting term from the self-energy.</p>
</div></blockquote>
<p><strong>broadening</strong> : float, optional</p>
<blockquote>
<div><p>Imaginary shift for the axis along which the real-axis GF is calculated.
If not provided, broadening will be set to double of the distance between mesh points in &#8216;mesh&#8217;.
Only relevant for real-frequency GF.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>dens</strong> : float</p>
<blockquote class="last">
<div><p>Total charge <span class="math">\(n_{tot}\)</span>.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="triqs_dft_tools.sumk_dft.SumkDFT.upfold">
<code class="descname">upfold</code><span class="sig-paren">(</span><em>ik</em>, <em>ish</em>, <em>bname</em>, <em>gf_to_upfold</em>, <em>gf_inp</em>, <em>shells='corr'</em>, <em>ir=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/triqs_dft_tools/sumk_dft.html#SumkDFT.upfold"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#triqs_dft_tools.sumk_dft.SumkDFT.upfold" title="Permalink to this definition">¶</a></dt>
<dd><p>Upfolds a block of the Green&#8217;s function for a given shell and k-point using the corresponding projector matrices.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>ik</strong> : integer</p>
<blockquote>
<div><p>k-point index for which the upfolding is to be done.</p>
</div></blockquote>
<p><strong>ish</strong> : integer</p>
<blockquote>
<div><p>Shell index of GF to be upfolded.</p>
<ul class="simple">
<li>if shells=&#8217;corr&#8217;: ish labels all correlated shells (equivalent or not)</li>
<li>if shells=&#8217;all&#8217;: ish labels only representative (inequivalent) non-correlated shells</li>
</ul>
</div></blockquote>
<p><strong>bname</strong> : string</p>
<blockquote>
<div><p>Block name of the target block of the lattice Green&#8217;s function.</p>
</div></blockquote>
<p><strong>gf_to_upfold</strong> : Gf</p>
<blockquote>
<div><p>Block of the Green&#8217;s function that is to be upfolded.</p>
</div></blockquote>
<p><strong>gf_inp</strong> : Gf</p>
<blockquote>
<div><p>FIXME</p>
</div></blockquote>
<p><strong>shells</strong> : string, optional</p>
<blockquote>
<div><ul class="simple">
<li>if shells=&#8217;corr&#8217;: orthonormalized projectors for correlated shells are used for the upfolding.</li>
<li>if shells=&#8217;all&#8217;: non-normalized projectors for all included shells are used for the upfolding.</li>
</ul>
</div></blockquote>
<p><strong>ir</strong> : integer, optional</p>
<blockquote>
<div><p>Index of equivalent site in the non-correlated shell &#8216;ish&#8217;, only used if shells=&#8217;all&#8217;.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>gf_upfolded</strong> : Gf</p>
<blockquote class="last">
<div><p>Upfolded block of the lattice Green&#8217;s function.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="sumk_dft_tools.html" title="SumK DFT Tools"
             >next</a> |</li>
        <li class="right" >
          <a href="converters.html" title="Converters"
             >previous</a> |</li>
    <li><a href="../index.html">Home</a> &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../documentation.html" >Documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2011-2013, M. Aichhorn, L. Pourovskii, V. Vildosola, C. Martins.
    </div>
  </body>
</html>
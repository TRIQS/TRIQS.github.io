<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DFT and projections &mdash; TRIQS DFTTools  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=f7f783a0" />
      <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />

  
    <link rel="shortcut icon" href="../../_static/triqs_favicon.ico"/>
  
        <script src="../../_static/jquery.js?v=8dae8fb0"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=default"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Elk to TRIQS" href="../svo_elk/srvo3.html" />
    <link rel="prev" title="VASP setup" href="../svo_vasp/svo_notebook.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #7E588A" >

          
          
          <a href="../../index.html" class="icon icon-home">
            TRIQS DFTTools
          </a>
              <div class="version">
                3.3.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#packaged-versions-of-dfttools">Packaged Versions of DFTTools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#ubuntu-debian-packages">Ubuntu Debian packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#anaconda-experimental">Anaconda (experimental)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#docker">Docker</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#compiling-dfttools-from-source">Compiling DFTTools from source</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#installation-steps">Installation steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#important-note-for-fcsc-dft-dmft-calculations">Important note for FCSC DFT+DMFT calculations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#installation-steps-for-the-use-with-wien2k-version-14-2-and-older">Installation steps for the use with WIEN2K version 14.2 and older</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#version-compatibility">Version compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#custom-cmake-options">Custom CMake options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#basic-notions">Basic notions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../basicnotions/first.html">What you should know</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/first.html#what-is-dfttools">What is <strong class="program">DFTTools</strong>?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/first.html#understand-the-philosophy-of-dfttools">Understand the philosophy of <strong class="program">DFTTools</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/first.html#learn-how-to-use-triqs-library-and-the-cthyb-solver">Learn how to use TRIQS library (and the CTHYB solver)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/first.html#analytic-continuation">Analytic Continuation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../basicnotions/dft_dmft.html">Introduction to DFT+DMFT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/dft_dmft.html#density-functional-theory-in-a-very-small-nutshell">Density-functional theory in a (very small) nutshell</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/dft_dmft.html#from-dft-to-dmft">From DFT to DMFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/dft_dmft.html#using-projective-wannier-functions-for-dmft">Using projective Wannier functions for DMFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/dft_dmft.html#full-charge-self-consistency">Full charge self-consistency</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../basicnotions/structure.html">Structure of <strong class="program">DFTTools</strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/structure.html#the-interface-layer">The interface layer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/structure.html#the-dmft-calculation">The DMFT calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/structure.html#full-charge-self-consistency">Full charge self consistency</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/structure.html#post-processing">Post-processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/structure.html#executing-your-python-scripts">Executing your python scripts</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#construction-of-local-orbitals-from-dft">Construction of local orbitals from DFT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../guide/conversion.html">Supported interfaces</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../guide/conv_wien2k.html">Interface with Wien2k</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/conv_vasp.html">Interface with VASP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/conv_elk.html">Interface with Elk</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/conv_W90.html">Interface with Wannier90</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/conv_generalhk.html">A general H(k)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../guide/conversion.html#mpi-issues">MPI issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guide/conversion.html#interfaces-to-other-packages">Interfaces to other packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../h5structure.html">standardized hdf5 structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../h5structure.html#groups-and-their-formats">groups and their formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../h5structure.html#general-and-simple-h-k-converter">General and simple H(k) Converter</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#dft-dmft">DFT+DMFT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../guide/dftdmft_singleshot.html">Single-shot DFT+DMFT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../guide/dftdmft_singleshot.html#initialization-of-the-calculation">Initialization of the calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/dftdmft_singleshot.html#setting-up-the-impurity-solver">Setting up the impurity solver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/dftdmft_singleshot.html#doing-the-dmft-loop">Doing the DMFT loop</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/dftdmft_singleshot.html#restarting-a-calculation">Restarting a calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/dftdmft_singleshot.html#mixing">Mixing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../guide/dftdmft_selfcons.html">Full charge self-consistency</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../guide/dftdmft_selfcons.html#wien2k-dmftproj">Wien2k + dmftproj</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/dftdmft_selfcons.html#vasp-plovasp">VASP + PLOVasp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/dftdmft_selfcons.html#elk">Elk</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/dftdmft_selfcons.html#other-dft-codes">Other DFT codes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#advanced-topics">Advanced Topics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../guide/blockstructure.html">Manipulating the Green’s functions block structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../guide/blockstructure.html#creating-a-block-structure-and-green-s-function">Creating a block structure and Green’s function</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/blockstructure.html#the-solver-structure">The <em>solver</em> structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/blockstructure.html#picking-orbitals">Picking orbitals</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/blockstructure.html#basis-rotations">Basis rotations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/blockstructure.html#diagonal-approximation">Diagonal approximation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../guide/BasisRotation.html">Automatic basis rotations in DFT+DMFT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../guide/BasisRotation.html#setting-up-the-initial-solver-structure-from-dft">Setting up the initial solver structure from DFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/BasisRotation.html#finding-the-transformation-matrix">Finding the transformation matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/BasisRotation.html#automatic-transformation-during-the-dmft-loop">Automatic transformation during the DMFT loop</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../guide/soc.html">Spin-orbit coupled calculations (single-shot)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../guide/soc.html#treatment-of-soc-in-dft">Treatment of SOC in DFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/soc.html#treatment-of-soc-in-wien2k">Treatment of SOC in Wien2k</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/soc.html#treatment-of-soc-in-elk">Treatment of SOC in Elk</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/soc.html#after-generating-the-projectors">After generating the projectors</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#postprocessing">Postprocessing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../guide/analysis.html">Tools for analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../guide/analysis.html#initialisation">Initialisation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/analysis.html#density-of-states">Density of states</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/analysis.html#band-resolved-density-matrices">Band resolved density matrices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/analysis.html#momentum-resolved-spectral-function-with-real-frequency-self-energy">Momentum resolved spectral function (with real-frequency self energy)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/analysis.html#energy-contours-of-the-k-resolved-spectral-function">Energy contours of the k-resolved Spectral function</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/analysis.html#partial-charges">Partial charges</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../guide/transport.html">Transport calculations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../guide/transport.html#formalism">Formalism</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/transport.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/transport.html#using-the-transport-code">Using the transport code</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/transport.html#example">Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/transport.html#references">References</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#reference-manual">Reference manual</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_python_api/triqs_dft_tools.block_structure.html">block_structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.block_structure.BlockStructure.html">triqs_dft_tools.block_structure.BlockStructure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_python_api/triqs_dft_tools.converters.html">converters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.converters.converter_tools.html">converter_tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.converters.elk.html">elk</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.converters.elktools.html">elktools</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.converters.hk.html">hk</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.converters.plovasp.html">plovasp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.converters.vasp.html">vasp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.converters.wannier90.html">wannier90</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.converters.wien2k.html">wien2k</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_python_api/triqs_dft_tools.sumk_dft.html">sumk_dft</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.sumk_dft.SumkDFT.html">triqs_dft_tools.sumk_dft.SumkDFT</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_python_api/triqs_dft_tools.sumk_dft_tools.html">sumk_dft_tools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.sumk_dft_tools.SumkDFTTools.html">triqs_dft_tools.sumk_dft_tools.SumkDFTTools</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_python_api/triqs_dft_tools.symmetry.html">symmetry</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.symmetry.Symmetry.html">triqs_dft_tools.symmetry.Symmetry</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_python_api/triqs_dft_tools.trans_basis.html">trans_basis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.trans_basis.TransBasis.html">triqs_dft_tools.trans_basis.TransBasis</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_python_api/triqs_dft_tools.util.html">util</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.util.compute_DC_from_density.html">triqs_dft_tools.util.compute_DC_from_density</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#faqs">FAQs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../faqs/faqs.html">Frequently-Asked Questions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../faqs/faqs.html#wien2k-fermi-error-when-running-x-lapw2-almd-band">wien2k: FERMI ERROR when running <cite>x lapw2 -almd -band</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../faqs/faqs.html#how-do-i-plot-the-output-of-spaghettis">How do I plot the output of <cite>spaghettis</cite>?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../faqs/faqs.html#x-optic-does-not-write-a-case-pmat-file">x optic does not write a case.pmat file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../faqs/faqs.html#how-do-i-get-real-frequency-quantities">How do I get real-frequency quantities?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../tutorials.html#a-simple-example-srvo3">A simple example: SrVO3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../srvo3.html">DFT (Wien2k) and Wannier orbitals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../srvo3.html#dft-setup">DFT setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../srvo3.html#wannier-orbitals">Wannier orbitals</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../srvo3.html#the-dmft-calculation">The DMFT calculation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../srvo3.html#loading-modules">Loading modules</a></li>
<li class="toctree-l4"><a class="reference internal" href="../srvo3.html#initializing-sumkdft">Initializing SumkDFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../srvo3.html#initializing-the-solver">Initializing the solver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../srvo3.html#dmft-cycle">DMFT cycle</a></li>
<li class="toctree-l4"><a class="reference internal" href="../srvo3.html#tail-fit-parameters">Tail fit parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials.html#basis-rotations-sr2mgoso6-without-soc">Basis rotations: Sr2MgOsO6 without SOC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../sr2mgoso6_nosoc.html">DFT (Wien2k) and Wannier orbitals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../sr2mgoso6_nosoc.html#dft-setup">DFT setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../sr2mgoso6_nosoc.html#wannier-orbitals">Wannier orbitals</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../sr2mgoso6_nosoc.html#the-dmft-calculation">The DMFT calculation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../sr2mgoso6_nosoc.html#rotating-the-basis">Rotating the basis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../sr2mgoso6_nosoc.html#the-interaction-hamiltonian">The interaction Hamiltonian</a></li>
<li class="toctree-l4"><a class="reference internal" href="../sr2mgoso6_nosoc.html#the-dmft-loop-with-automatic-basis-rotations">The DMFT loop with automatic basis rotations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials.html#sr2mgoso6-with-soc-non-magnetic">Sr2MgOsO6 with SOC (non-magnetic)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../sr2mgoso6_soc.html">DFT (Wien2k) and Wannier orbitals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../sr2mgoso6_soc.html#dft-setup">DFT setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../sr2mgoso6_soc.html#wannier-orbitals">Wannier orbitals</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../sr2mgoso6_soc.html#the-dmft-calculation">The DMFT calculation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../sr2mgoso6_soc.html#rotating-the-basis">Rotating the basis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../sr2mgoso6_soc.html#the-interaction-hamiltonian">The interaction Hamiltonian</a></li>
<li class="toctree-l4"><a class="reference internal" href="../sr2mgoso6_soc.html#the-dmft-loop-with-automatic-basis-rotations">The DMFT loop with automatic basis rotations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials.html#full-charge-self-consistency-with-wien2k-gamma-ce">Full charge self consistency with Wien2k: <span class="math notranslate nohighlight">\(\gamma\)</span>-Ce</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ce-gamma-fscs_wien2k.html">DFT+DMFT tutorial: Ce with Hubbard-I approximation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../ce-gamma-fscs_wien2k.html#wien2k-setup">Wien2k setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ce-gamma-fscs_wien2k.html#wannier-orbitals-dmftproj">Wannier orbitals: dmftproj</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ce-gamma-fscs_wien2k.html#dmft-setup-hubbard-i-calculations-in-triqs">DMFT setup: Hubbard-I calculations in TRIQS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ce-gamma-fscs_wien2k.html#fully-charge-self-consistent-dft-dmft-calculation">Fully charge self-consistent DFT+DMFT calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ce-gamma-fscs_wien2k.html#post-processing-and-data-analysis">Post-processing and data analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../../tutorials.html#vasp-interface-examples">VASP interface examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../tutorials.html#simple-converter-example-srvo3">Simple Converter example: SrVO3</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../svo_vasp/svo_notebook.html">VASP setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../svo_vasp/svo_notebook.html#PLOVASP">PLOVASP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../svo_vasp/svo_notebook.html#Converting-to-hdf5-file">Converting to hdf5 file</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="reference internal" href="../../tutorials.html#complex-example-nio">Complex example: NiO</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">DFT and projections</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dmft">DMFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="#charge-self-consistent-dmft">Charge self-consistent DMFT</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials.html#elk-interface-examples">Elk interface examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials.html#converter-example-srvo3">Converter example: SrVO3</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../svo_elk/srvo3.html">Elk to TRIQS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../svo_elk/srvo3.html#the-dmft-calculation">The DMFT calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../svo_elk/srvo3.html#triqs-to-elk-fully-charge-self-consistent-dft-dmft">TRIQS to Elk (Fully Charge Self-Consistent DFT+DMFT)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ChangeLog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-3-3-0">Version 3.3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-3-2-1">Version 3.2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-3-2-0">Version 3.2.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#general">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#elk">Elk</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#vasp">Vasp</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#w90-qe">w90 + QE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#clean">clean</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-3-1-1">Version 3.1.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#id2">General</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-3-1-0">Version 3.1.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#wannier90-converter">Wannier90 Converter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#change-in-gf-struct">Change in gf_struct</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#documentation">Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#cmake">Cmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#other-changes">Other changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-3-0-0">Version 3.0.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#restructuring">Restructuring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#dependency-management">Dependency Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#id3">Other Changes:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-2-2-1">Version 2.2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-2-2-0">Version 2.2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-2-1-x-changes-since-1-4">Version 2.1.x (changes since 1.4)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../about.html#license">License</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about.html#authors-quotation">Authors &amp; Quotation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about.html#disclaimer">Disclaimer</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #7E588A" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TRIQS DFTTools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../tutorials.html">Tutorials</a></li>
      <li class="breadcrumb-item active">DFT and projections</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/tutorials/nio_csc_vasp/nio_csc.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="dft-and-projections">
<span id="nio-csc"></span><h1>DFT and projections<a class="headerlink" href="#dft-and-projections" title="Link to this heading"></a></h1>
<p>We will perform DFT+DMFT calculations for the charge-transfer insulator NiO. We start from scratch and provide all necessary input files to do the calculations: First for doing a single-shot calculation (and then for charge-self consistency).</p>
<section id="vasp-setup">
<h2>VASP setup<a class="headerlink" href="#vasp-setup" title="Link to this heading"></a></h2>
<p>We start by running a simple VASP calculation to converge the charge density initially.
Use the <a class="reference internal" href="INCAR.html#incar"><span class="std std-ref">INCAR</span></a>, <a class="reference internal" href="POSCAR.html#poscar"><span class="std std-ref">POSCAR</span></a>, and <a class="reference internal" href="KPOINTS.html#kpoints"><span class="std std-ref">KPOINTS</span></a> provided and use your
own <code class="file docutils literal notranslate"><span class="pre">POTCAR</span></code> file.</p>
<p>Let us take a look in the <code class="file docutils literal notranslate"><span class="pre">INCAR</span></code>, where we have to specify local orbitals as basis
for our many-body calculation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">System</span>  <span class="o">=</span> <span class="n">NiO</span>

<span class="c1"># for PLOT DOS</span>
<span class="c1"># ISMEAR = -5</span>
<span class="c1"># better convergence for small kpt grids</span>
<span class="n">ISMEAR</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">SIGMA</span> <span class="o">=</span> <span class="mf">0.05</span>

<span class="c1"># converge wave functions</span>
<span class="n">EDIFF</span> <span class="o">=</span> <span class="mf">1.E-7</span>
<span class="n">NELMIN</span> <span class="o">=</span> <span class="mi">35</span>

<span class="c1"># the energy window to optimize projector channels (absolute)</span>
<span class="n">EMIN</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
<span class="n">EMAX</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">LMAXMIX</span> <span class="o">=</span> <span class="mi">6</span>

<span class="c1"># switch off all symmetries</span>
<span class="n">ISYM</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

<span class="c1"># project to Ni d and O p states</span>
<span class="n">LORBIT</span> <span class="o">=</span> <span class="mi">14</span>
<span class="n">LOCPROJ</span> <span class="o">=</span> <span class="s2">&quot;1 : d : Pr</span>
           <span class="mi">2</span> <span class="p">:</span> <span class="n">p</span> <span class="p">:</span> <span class="n">Pr</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p><cite>LORBIT = 14</cite> takes care of optimizing the projectors in the energy window defined
by <cite>EMIN</cite> and <cite>EMAX</cite>. We switch off all symmetries with <cite>ISYM=-1</cite> since symmetries
are not implemented in the later DMFT scripts. Finally, we select the relevant orbitals
for atom 1 (Ni, d-orbitals) and 2 (O, p-orbitals) by the two <cite>LOCPROJ</cite> lines.
For details refer to the VASP wiki on the <a class="reference external" href="https://cms.mpi.univie.ac.at/wiki/index.php/LOCPROJ" rel="noopener noreferrer" target="_blank">LOCPROJ</a> flag. The projectors are stored in the file <cite>LOCPROJ</cite>.</p>
</section>
<section id="plovasp">
<h2>PLOVASP<a class="headerlink" href="#plovasp" title="Link to this heading"></a></h2>
<p>Next, we post-process the projectors, which VASP stored in the file <cite>LOCPROJ</cite>.
We do this by invoking <strong class="program">plovasp plo.cfg</strong> which is configured by an input file, e.g., named <a class="reference internal" href="plo.cfg.html#plo-cfg"><span class="std std-ref">plo.cfg</span></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">General</span><span class="p">]</span>
<span class="c1"># DOSMESH = -21 55 400</span>
<span class="n">HK</span> <span class="o">=</span> <span class="kc">True</span> 
<span class="n">COMPLEMENT</span> <span class="o">=</span> <span class="kc">True</span>

<span class="p">[</span><span class="n">Group</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">SHELLS</span> <span class="o">=</span> <span class="mi">1</span> <span class="mi">2</span>
<span class="n">EWINDOW</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9</span> <span class="mi">2</span>
<span class="n">NORMION</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">NORMALIZE</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">BANDS</span> <span class="o">=</span> <span class="mi">2</span> <span class="mi">9</span>

<span class="p">[</span><span class="n">Shell</span> <span class="mi">1</span><span class="p">]</span> <span class="c1"># Ni d shell</span>
<span class="n">LSHELL</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">IONS</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">CORR</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">TRANSFORM</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="mf">0.0</span>  <span class="mf">0.0</span>  <span class="mf">0.0</span>  <span class="mf">0.0</span>
            <span class="mf">0.0</span>  <span class="mf">1.0</span>  <span class="mf">0.0</span>  <span class="mf">0.0</span>  <span class="mf">0.0</span>
            <span class="mf">0.0</span>  <span class="mf">0.0</span>  <span class="mf">1.0</span>  <span class="mf">0.0</span>  <span class="mf">0.0</span>
            <span class="mf">0.0</span>  <span class="mf">0.0</span>  <span class="mf">0.0</span>  <span class="mf">1.0</span>  <span class="mf">0.0</span>
            <span class="mf">0.0</span>  <span class="mf">0.0</span>  <span class="mf">0.0</span>  <span class="mf">0.0</span>  <span class="mf">1.0</span>

<span class="p">[</span><span class="n">Shell</span> <span class="mi">2</span><span class="p">]</span> <span class="c1"># O p shell</span>
<span class="n">LSHELL</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">IONS</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">CORR</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">TRANSFORM</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="mf">0.0</span>  <span class="mf">0.0</span>
            <span class="mf">0.0</span>  <span class="mf">1.0</span>  <span class="mf">0.0</span>
            <span class="mf">0.0</span>  <span class="mf">0.0</span>  <span class="mf">1.0</span>
</pre></div>
</div>
<p>Here, in <cite>[General]</cite> we set the basename and the grid for calculating the density of
states. In <cite>[Group 1]</cite> we define a group of two shells which are orthonormalized with
respect to states in an energy window from <cite>-9</cite> to <cite>2</cite> for all ions simultaneously
(<cite>NORMION = False</cite>). We define the two shells, which correspond to the Ni d states
and the O p states. Only the Ni shell is treated as correlated (<cite>CORR = True</cite>), i.e.,
is supplemented with a Coulomb interaction later in the DMFT calculation. Here, we
chose to use the Hamiltonian mode of the vasp converter by setting <cite>COMPLEMENT=TRUE</cite>,
and specifying to use explicitly only bands with indices 2 to 9 (<cite>BANDS</cite>). This is
optional but later used in the post-processing.</p>
</section>
<section id="converting-to-hdf5-file">
<h2>Converting to hdf5 file<a class="headerlink" href="#converting-to-hdf5-file" title="Link to this heading"></a></h2>
<p>We run the whole conversion to a dft_tools readable h5 archive by running the converter script provided <strong class="program">python converter.py</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">triqs_dft_tools.converters.vasp</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">triqs_dft_tools.converters.plovasp.converter</span> <span class="k">as</span> <span class="nn">plo_converter</span>

<span class="c1"># Generate and store PLOs</span>
<span class="n">plo_converter</span><span class="o">.</span><span class="n">generate_and_output_as_text</span><span class="p">(</span><span class="s1">&#39;plo.cfg&#39;</span><span class="p">,</span> <span class="n">vasp_dir</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">)</span>

<span class="c1"># run the converter</span>
<span class="n">Converter</span> <span class="o">=</span> <span class="n">VaspConverter</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;vasp&#39;</span><span class="p">,</span> <span class="n">proj_or_hk</span> <span class="o">=</span> <span class="s1">&#39;hk&#39;</span><span class="p">)</span>
<span class="n">Converter</span><span class="o">.</span><span class="n">convert_dft_input</span><span class="p">()</span>
</pre></div>
</div>
<p>A h5 archive should be created with the name <cite>vasp.h5</cite> Now we are all set to perform a dmft calculation.</p>
</section>
</section>
<section id="dmft">
<h1>DMFT<a class="headerlink" href="#dmft" title="Link to this heading"></a></h1>
<section id="dmft-script">
<h2>dmft script<a class="headerlink" href="#dmft-script" title="Link to this heading"></a></h2>
<p>Since the python script for performing the dmft loop pretty much resembles that presented in the tutorial on <a class="reference internal" href="../srvo3.html#srvo3"><span class="std std-ref">SrVO3</span></a>, we will not go into detail here but simply provide the script <a class="reference internal" href="nio.py.html#nio-py"><span class="std std-ref">nio.py</span></a>. Following Kunes et al. in <a class="reference external" href="https://journals.aps.org/prb/abstract/10.1103/PhysRevB.75.165115" rel="noopener noreferrer" target="_blank">PRB 75 165115 (2007)</a> we use <span class="math notranslate nohighlight">\(U=8\)</span> and <span class="math notranslate nohighlight">\(J=1\)</span>. We select <span class="math notranslate nohighlight">\(\beta=5\)</span> instead of <span class="math notranslate nohighlight">\(\beta=10\)</span> to ease the problem slightly. For simplicity we fix the double-counting potential to <span class="math notranslate nohighlight">\(\mu_{DC}=59\)</span> eV by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DC_value</span> <span class="o">=</span> <span class="mf">59.0</span>
<span class="n">SK</span><span class="o">.</span><span class="n">calc_dc</span><span class="p">(</span><span class="n">dm</span><span class="p">,</span> <span class="n">U_interact</span><span class="o">=</span><span class="n">U</span><span class="p">,</span> <span class="n">J_hund</span><span class="o">=</span><span class="n">J</span><span class="p">,</span> <span class="n">orb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">use_dc_value</span><span class="o">=</span><span class="n">DC_value</span><span class="p">)</span>
</pre></div>
</div>
<p>For sensible results run this script in parallel on at least 20 cores. As a quick check of the results, we can compare the orbital occupation from the paper cited above (<span class="math notranslate nohighlight">\(n_{eg} = 0.54\)</span> and <span class="math notranslate nohighlight">\(n_{t2g}=1.0\)</span>) and those from the cthyb output (check lines <cite>Orbital up_0 density:</cite> for a t2g  and <cite>Orbital up_2 density:</cite> for an eg orbital). They should coincide well.</p>
</section>
<section id="local-lattice-green-s-function-for-all-projected-orbitals">
<h2>Local lattice Green’s function for all projected orbitals<a class="headerlink" href="#local-lattice-green-s-function-for-all-projected-orbitals" title="Link to this heading"></a></h2>
<p>We calculate the local lattice Green’s function - now also for the uncorrelated orbitals, i.e., the O p states, for what we use the script <a class="reference internal" href="NiO_local_lattice_GF.py.html#nio-local-lattice-gf-py"><span class="std std-ref">NiO_local_lattice_GF.py</span></a>. The result is saved in the h5 file as <cite>G_latt_orb_it&lt;n_it&gt;</cite>, where <cite>&lt;n_it&gt;</cite> is the number of the last DMFT iteration.</p>
</section>
<section id="spectral-function-on-real-axis-maxent">
<h2>Spectral function on real axis: MaxEnt<a class="headerlink" href="#spectral-function-on-real-axis-maxent" title="Link to this heading"></a></h2>
<p>To compare to results from literature we make use of the <a class="reference external" href="https://triqs.github.io/maxent/master/" rel="noopener noreferrer" target="_blank">maxent triqs application</a> and calculate the spectral function on real axis. Use this script to perform a crude but quick calculation: <a class="reference internal" href="maxent.py.html#maxent-py"><span class="std std-ref">maxent.py</span></a> using a linear real axis and a line-fit analyzer to determine the optimal <span class="math notranslate nohighlight">\(\alpha\)</span>. The output is saved in the h5 file in <cite>DMFT_results/Iterations/G_latt_orb_w_o&lt;n_o&gt;_it&lt;n_it&gt;</cite>, where <cite>&lt;n_o&gt;</cite> is the number of the orbital and <cite>n_it</cite> is again the number of the last iteration. The real axis information is stored in <cite>DMFT_results/Iterations/w_it&lt;n_it&gt;</cite>.</p>
<a class="reference internal image-reference" href="../../_images/nio_Aw.png"><img alt="../../_images/nio_Aw.png" class="align-center" src="../../_images/nio_Aw.png" style="width: 400px;" /></a>
</section>
</section>
<section id="charge-self-consistent-dmft">
<h1>Charge self-consistent DMFT<a class="headerlink" href="#charge-self-consistent-dmft" title="Link to this heading"></a></h1>
<p>In this part we will perform charge self-consistent DMFT calculations. To do so we have to adapt the VASP <cite>INCAR</cite> such that <strong class="program">VASP</strong> reads the updated charge density after each step. We add the lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ICHARG</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">NELM</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">NELMIN</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">IMIX</span><span class="o">=</span><span class="mi">1</span>
<span class="n">BMIX</span><span class="o">=</span><span class="mf">0.5</span>
<span class="n">AMIX</span><span class="o">=</span><span class="mf">0.02</span>
</pre></div>
</div>
<p>which makes VASP wait after each step of its iterative diagonalization until the file vasp.lock is created. It then reads the update of the charge density in the file <cite>GAMMA</cite>. We change the mixing here to stabilize the updating, which can be problem for charge ordered systems. Vasp is terminated by an external script after a desired amount of steps, such that we deactivate all automatic stoping criterion by setting the number of steps to a very high number.</p>
<p>We take the respective converged DFT and DMFT calculations from before as a starting point. I.e., we copy the <cite>CHGCAR</cite> and <cite>nio.h5</cite> together with the other <strong class="program">VASP</strong> input files and <code class="file docutils literal notranslate"><span class="pre">plo.cfg</span></code> in a new directory. We use a script called <strong class="program">vasp_dmft</strong> to invoke <strong class="program">VASP</strong> in the background and start the DMFT calculation together with <strong class="program">plovasp</strong> and the converter. This script assumes that the dmft sript contains a function <cite>dmft_cycle()</cite> and also the conversion from text files to the h5 file. Additionally we have to add a few lines to calculate the density correction and calculate the correlation energy. We adapt the script straightforwardly (for a working example see <a class="reference internal" href="nio_csc.py.html#nio-csc-py"><span class="std std-ref">nio_csc.py</span></a>). The most important new lines are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SK</span><span class="o">.</span><span class="n">chemical_potential</span> <span class="o">=</span> <span class="n">SK</span><span class="o">.</span><span class="n">calc_mu</span><span class="p">(</span> <span class="n">precision</span> <span class="o">=</span> <span class="mf">0.000001</span> <span class="p">)</span>
<span class="n">SK</span><span class="o">.</span><span class="n">calc_density_correction</span><span class="p">(</span><span class="n">dm_type</span><span class="o">=</span><span class="s1">&#39;vasp&#39;</span><span class="p">)</span>
<span class="n">correnerg</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">G_iw</span> <span class="o">*</span> <span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span><span class="p">)</span><span class="o">.</span><span class="n">total_density</span><span class="p">()</span>
</pre></div>
</div>
<p>where the chemical potential is determined to a greater precision than before, the correction to the dft density matrix is calculated and output to the file <code class="file docutils literal notranslate"><span class="pre">GAMMA</span></code>. The correlation energy is calculated via Migdal-Galitski formula. We also slightly increase the tolerance for the detection of blocks since the DFT calculation now includes some QMC noise.</p>
<p>To help convergence, we keep the density (i.e., the GAMMA file) fixed for a few DFT iterations. We do so since VASP uses an iterative diagonalization. Within these steps we still need to update the projectors and recalculate the GAMMA file to not shuffle eigenvalues around by accident.</p>
<p>We can start the whole machinery by executing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vasp_dmft</span> <span class="o">-</span><span class="n">n</span> <span class="o">&lt;</span><span class="n">n_procs</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">n_iters</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">j</span> <span class="o">&lt;</span><span class="n">n_iters_dft</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="o">&lt;</span><span class="n">vasp_exec</span><span class="o">&gt;</span>  <span class="n">nio_csc</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../svo_vasp/svo_notebook.html" class="btn btn-neutral float-left" title="VASP setup" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../svo_elk/srvo3.html" class="btn btn-neutral float-right" title="Elk to TRIQS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2011-2021.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Elk to TRIQS &mdash; TRIQS DFTTools  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=f7f783a0" />
      <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />

  
    <link rel="shortcut icon" href="../../_static/triqs_favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=default"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Reporting issues" href="../../issues.html" />
    <link rel="prev" title="DFT and projections" href="../nio_csc_vasp/nio_csc.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #7E588A" >

          
          
          <a href="../../index.html" class="icon icon-home">
            TRIQS DFTTools
          </a>
              <div class="version">
                3.2.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#packaged-versions-of-dfttools">Packaged Versions of DFTTools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#ubuntu-debian-packages">Ubuntu Debian packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#anaconda-experimental">Anaconda (experimental)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#docker">Docker</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../install.html#compiling-dfttools-from-source">Compiling DFTTools from source</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#installation-steps">Installation steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#important-note-for-fcsc-dft-dmft-calculations">Important note for FCSC DFT+DMFT calculations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#installation-steps-for-the-use-with-wien2k-version-14-2-and-older">Installation steps for the use with WIEN2K version 14.2 and older</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#version-compatibility">Version compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../install.html#custom-cmake-options">Custom CMake options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#basic-notions">Basic notions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../basicnotions/first.html">What you should know</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/first.html#what-is-dfttools">What is <strong class="program">DFTTools</strong>?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/first.html#understand-the-philosophy-of-dfttools">Understand the philosophy of <strong class="program">DFTTools</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/first.html#learn-how-to-use-triqs-library-and-the-cthyb-solver">Learn how to use TRIQS library (and the CTHYB solver)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/first.html#analytic-continuation">Analytic Continuation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../basicnotions/dft_dmft.html">Introduction to DFT+DMFT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/dft_dmft.html#density-functional-theory-in-a-very-small-nutshell">Density-functional theory in a (very small) nutshell</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/dft_dmft.html#from-dft-to-dmft">From DFT to DMFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/dft_dmft.html#using-projective-wannier-functions-for-dmft">Using projective Wannier functions for DMFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/dft_dmft.html#full-charge-self-consistency">Full charge self-consistency</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../basicnotions/structure.html">Structure of <strong class="program">DFTTools</strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/structure.html#the-interface-layer">The interface layer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/structure.html#the-dmft-calculation">The DMFT calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/structure.html#full-charge-self-consistency">Full charge self consistency</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/structure.html#post-processing">Post-processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../basicnotions/structure.html#executing-your-python-scripts">Executing your python scripts</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#construction-of-local-orbitals-from-dft">Construction of local orbitals from DFT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../guide/conversion.html">Supported interfaces</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../guide/conv_wien2k.html">Interface with Wien2k</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/conv_vasp.html">Interface with VASP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/conv_elk.html">Interface with Elk</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/conv_W90.html">Interface with Wannier90</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/conv_generalhk.html">A general H(k)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../guide/conversion.html#mpi-issues">MPI issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../guide/conversion.html#interfaces-to-other-packages">Interfaces to other packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../h5structure.html">standardized hdf5 structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../h5structure.html#groups-and-their-formats">groups and their formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../h5structure.html#general-and-simple-h-k-converter">General and simple H(k) Converter</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#dft-dmft">DFT+DMFT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../guide/dftdmft_singleshot.html">Single-shot DFT+DMFT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../guide/dftdmft_singleshot.html#initialization-of-the-calculation">Initialization of the calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/dftdmft_singleshot.html#setting-up-the-impurity-solver">Setting up the impurity solver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/dftdmft_singleshot.html#doing-the-dmft-loop">Doing the DMFT loop</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/dftdmft_singleshot.html#restarting-a-calculation">Restarting a calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/dftdmft_singleshot.html#mixing">Mixing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../guide/dftdmft_selfcons.html">Full charge self-consistency</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../guide/dftdmft_selfcons.html#wien2k-dmftproj">Wien2k + dmftproj</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/dftdmft_selfcons.html#vasp-plovasp">VASP + PLOVasp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/dftdmft_selfcons.html#elk">Elk</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/dftdmft_selfcons.html#other-dft-codes">Other DFT codes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#advanced-topics">Advanced Topics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../guide/blockstructure.html">Manipulating the Green’s functions block structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../guide/blockstructure.html#creating-a-block-structure-and-green-s-function">Creating a block structure and Green’s function</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/blockstructure.html#the-solver-structure">The <em>solver</em> structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/blockstructure.html#picking-orbitals">Picking orbitals</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/blockstructure.html#basis-rotations">Basis rotations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/blockstructure.html#diagonal-approximation">Diagonal approximation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../guide/BasisRotation.html">Automatic basis rotations in DFT+DMFT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../guide/BasisRotation.html#setting-up-the-initial-solver-structure-from-dft">Setting up the initial solver structure from DFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/BasisRotation.html#finding-the-transformation-matrix">Finding the transformation matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/BasisRotation.html#automatic-transformation-during-the-dmft-loop">Automatic transformation during the DMFT loop</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../guide/soc.html">Spin-orbit coupled calculations (single-shot)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../guide/soc.html#treatment-of-soc-in-dft">Treatment of SOC in DFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/soc.html#treatment-of-soc-in-wien2k">Treatment of SOC in Wien2k</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/soc.html#treatment-of-soc-in-elk">Treatment of SOC in Elk</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/soc.html#after-generating-the-projectors">After generating the projectors</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#postprocessing">Postprocessing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../guide/analysis.html">Tools for analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../guide/analysis.html#initialisation">Initialisation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/analysis.html#density-of-states">Density of states</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/analysis.html#band-resolved-density-matrices">Band resolved density matrices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/analysis.html#momentum-resolved-spectral-function-with-real-frequency-self-energy">Momentum resolved spectral function (with real-frequency self energy)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/analysis.html#energy-contours-of-the-k-resolved-spectral-function">Energy contours of the k-resolved Spectral function</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/analysis.html#partial-charges">Partial charges</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../guide/transport.html">Transport calculations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../guide/transport.html#formalism">Formalism</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/transport.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/transport.html#using-the-transport-code">Using the transport code</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/transport.html#example">Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../guide/transport.html#references">References</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#reference-manual">Reference manual</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../_python_api/triqs_dft_tools.block_structure.html">block_structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.block_structure.BlockStructure.html">triqs_dft_tools.block_structure.BlockStructure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_python_api/triqs_dft_tools.converters.html">converters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.converters.converter_tools.html">converter_tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.converters.elk.html">elk</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.converters.elktools.html">elktools</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.converters.hk.html">hk</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.converters.plovasp.html">plovasp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.converters.vasp.html">vasp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.converters.wannier90.html">wannier90</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.converters.wien2k.html">wien2k</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_python_api/triqs_dft_tools.sumk_dft.html">sumk_dft</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.sumk_dft.SumkDFT.html">triqs_dft_tools.sumk_dft.SumkDFT</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_python_api/triqs_dft_tools.sumk_dft_tools.html">sumk_dft_tools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.sumk_dft_tools.SumkDFTTools.html">triqs_dft_tools.sumk_dft_tools.SumkDFTTools</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_python_api/triqs_dft_tools.symmetry.html">symmetry</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.symmetry.Symmetry.html">triqs_dft_tools.symmetry.Symmetry</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_python_api/triqs_dft_tools.trans_basis.html">trans_basis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.trans_basis.TransBasis.html">triqs_dft_tools.trans_basis.TransBasis</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../_python_api/triqs_dft_tools.util.html">util</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../_python_api/triqs_dft_tools.util.compute_DC_from_density.html">triqs_dft_tools.util.compute_DC_from_density</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation.html#faqs">FAQs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../faqs/faqs.html">Frequently-Asked Questions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../faqs/faqs.html#wien2k-fermi-error-when-running-x-lapw2-almd-band">wien2k: FERMI ERROR when running <cite>x lapw2 -almd -band</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../faqs/faqs.html#how-do-i-plot-the-output-of-spaghettis">How do I plot the output of <cite>spaghettis</cite>?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../faqs/faqs.html#x-optic-does-not-write-a-case-pmat-file">x optic does not write a case.pmat file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../faqs/faqs.html#how-do-i-get-real-frequency-quantities">How do I get real-frequency quantities?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../tutorials.html#a-simple-example-srvo3">A simple example: SrVO3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../srvo3.html">DFT (Wien2k) and Wannier orbitals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../srvo3.html#dft-setup">DFT setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../srvo3.html#wannier-orbitals">Wannier orbitals</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../srvo3.html#the-dmft-calculation">The DMFT calculation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../srvo3.html#loading-modules">Loading modules</a></li>
<li class="toctree-l4"><a class="reference internal" href="../srvo3.html#initializing-sumkdft">Initializing SumkDFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../srvo3.html#initializing-the-solver">Initializing the solver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../srvo3.html#dmft-cycle">DMFT cycle</a></li>
<li class="toctree-l4"><a class="reference internal" href="../srvo3.html#tail-fit-parameters">Tail fit parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials.html#basis-rotations-sr2mgoso6-without-soc">Basis rotations: Sr2MgOsO6 without SOC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../sr2mgoso6_nosoc.html">DFT (Wien2k) and Wannier orbitals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../sr2mgoso6_nosoc.html#dft-setup">DFT setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../sr2mgoso6_nosoc.html#wannier-orbitals">Wannier orbitals</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../sr2mgoso6_nosoc.html#the-dmft-calculation">The DMFT calculation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../sr2mgoso6_nosoc.html#rotating-the-basis">Rotating the basis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../sr2mgoso6_nosoc.html#the-interaction-hamiltonian">The interaction Hamiltonian</a></li>
<li class="toctree-l4"><a class="reference internal" href="../sr2mgoso6_nosoc.html#the-dmft-loop-with-automatic-basis-rotations">The DMFT loop with automatic basis rotations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials.html#sr2mgoso6-with-soc-non-magnetic">Sr2MgOsO6 with SOC (non-magnetic)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../sr2mgoso6_soc.html">DFT (Wien2k) and Wannier orbitals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../sr2mgoso6_soc.html#dft-setup">DFT setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../sr2mgoso6_soc.html#wannier-orbitals">Wannier orbitals</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../sr2mgoso6_soc.html#the-dmft-calculation">The DMFT calculation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../sr2mgoso6_soc.html#rotating-the-basis">Rotating the basis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../sr2mgoso6_soc.html#the-interaction-hamiltonian">The interaction Hamiltonian</a></li>
<li class="toctree-l4"><a class="reference internal" href="../sr2mgoso6_soc.html#the-dmft-loop-with-automatic-basis-rotations">The DMFT loop with automatic basis rotations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials.html#full-charge-self-consistency-with-wien2k-gamma-ce">Full charge self consistency with Wien2k: <span class="math notranslate nohighlight">\(\gamma\)</span>-Ce</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ce-gamma-fscs_wien2k.html">DFT+DMFT tutorial: Ce with Hubbard-I approximation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../ce-gamma-fscs_wien2k.html#wien2k-setup">Wien2k setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ce-gamma-fscs_wien2k.html#wannier-orbitals-dmftproj">Wannier orbitals: dmftproj</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ce-gamma-fscs_wien2k.html#dmft-setup-hubbard-i-calculations-in-triqs">DMFT setup: Hubbard-I calculations in TRIQS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ce-gamma-fscs_wien2k.html#fully-charge-self-consistent-dft-dmft-calculation">Fully charge self-consistent DFT+DMFT calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ce-gamma-fscs_wien2k.html#post-processing-and-data-analysis">Post-processing and data analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorials.html#vasp-interface-examples">VASP interface examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials.html#simple-converter-example-srvo3">Simple Converter example: SrVO3</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../svo_vasp/svo_notebook.html">VASP setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../svo_vasp/svo_notebook.html#PLOVASP">PLOVASP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../svo_vasp/svo_notebook.html#Converting-to-hdf5-file">Converting to hdf5 file</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../tutorials.html#complex-example-nio">Complex example: NiO</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../nio_csc_vasp/nio_csc.html">DFT and projections</a></li>
<li class="toctree-l4"><a class="reference internal" href="../nio_csc_vasp/nio_csc.html#dmft">DMFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../nio_csc_vasp/nio_csc.html#charge-self-consistent-dmft">Charge self-consistent DMFT</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../../tutorials.html#elk-interface-examples">Elk interface examples</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../../tutorials.html#converter-example-srvo3">Converter example: SrVO3</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Elk to TRIQS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-dmft-calculation">The DMFT calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#triqs-to-elk-fully-charge-self-consistent-dft-dmft">TRIQS to Elk (Fully Charge Self-Consistent DFT+DMFT)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ChangeLog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-3-3-0">Version 3.3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-3-2-1">Version 3.2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-3-2-0">Version 3.2.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#general">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#elk">Elk</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#vasp">Vasp</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#w90-qe">w90 + QE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#clean">clean</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-3-1-1">Version 3.1.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#id2">General</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-3-1-0">Version 3.1.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#wannier90-converter">Wannier90 Converter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#change-in-gf-struct">Change in gf_struct</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#documentation">Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#cmake">Cmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#other-changes">Other changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-3-0-0">Version 3.0.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#restructuring">Restructuring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#dependency-management">Dependency Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ChangeLog.html#id3">Other Changes:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-2-2-1">Version 2.2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-2-2-0">Version 2.2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ChangeLog.html#version-2-1-x-changes-since-1-4">Version 2.1.x (changes since 1.4)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../about.html#license">License</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about.html#authors-quotation">Authors &amp; Quotation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about.html#disclaimer">Disclaimer</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #7E588A" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">TRIQS DFTTools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../tutorials.html">Tutorials</a></li>
      <li class="breadcrumb-item active">Elk to TRIQS</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/tutorials/svo_elk/srvo3.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p id="srvo3-elk">This example is almost identical to the <a class="reference internal" href="../srvo3.html#srvo3"><span class="std std-ref">Wien2k-TRIQS SrVO3 example</span></a>. On the example of SrVO3 we will discuss now how to set up a full working calculation using Elk, including the initialization of the <a class="reference external" href="https://triqs.github.io/cthyb/latest" rel="noopener noreferrer" target="_blank">CTHYB solver</a>. Some additional parameter are introduced to make the calculation more efficient. This is a more advanced example, which is also suited for parallel execution.</p>
<p>For the convenience of the user, we provide also a full python script (<a class="reference download internal" download="" href="../../_downloads/4331612df7a91990008a11e40e2223cf/dft_dmft_cthyb_elk.py"><code class="xref download docutils literal notranslate"><span class="pre">dft_dmft_cthyb_elk.py</span></code></a>). The user has to adapt it to their own needs. How to execute your script is described <a class="reference internal" href="../../basicnotions/structure.html#runpy"><span class="std std-ref">here</span></a>.</p>
<p>For more details we refer to the <a class="reference internal" href="../../guide/conversion.html#conversion"><span class="std std-ref">documentation</span></a>, now we will discuss the conversion for Elk.</p>
<p>A brief note before discussing the example. This interface works for any type of ground state Elk calculation using the interface calls described in this example (i.e. the interface is universal). If the user wishes to perform a spin-polarized calculation in DMFT alone (non magnetic DFT inputs), they have to lift the up / down spin symmetry manually (not shown here).</p>
<section id="elk-to-triqs">
<h1>Elk to TRIQS<a class="headerlink" href="#elk-to-triqs" title="Link to this heading"></a></h1>
<p>First, we perform a DFT calculation, using the Elk package. As main input file we have to provide the so-called elk.in <code class="file docutils literal notranslate"><span class="pre">elk.in</span></code>. We use the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!Calculates the V t2g Wannier projectors, Wannier charge and Wannier DOS of SrVO3

!Example by Alyn D. N. James

tasks
 0
 805

ngridk
 12 12 12

sppath
  &#39;../../../species/&#39;

rgkmax
 7.0

avec
   7.260500000       0.000000000       0.000000000
   0.000000000       7.260500000       0.000000000
   0.000000000       0.000000000       7.260500000

atoms
   3                                    : nspecies
&#39;Sr.in&#39;                                 : spfname
   1                                    : natoms; atposl, bfcmt below
    0.50000000    0.50000000    0.50000000    0.00000000  0.00000000  0.00000000
&#39;V.in&#39;                                  : spfname
   1                                    : natoms; atposl, bfcmt below
    0.00000000    0.00000000    0.00000000    0.00000000  0.00000000  0.00000000
&#39;O.in&#39;                                  : spfname
   3                                    : natoms; atposl, bfcmt below
    0.50000000    0.00000000    0.00000000    0.00000000  0.00000000  0.00000000
    0.00000000    0.50000000    0.00000000    0.00000000  0.00000000  0.00000000
    0.00000000    0.00000000    0.50000000    0.00000000  0.00000000  0.00000000

wanproj		!projector flag
 1		!number of projectors - next 3 lines are repeated for each projector
 2 2 3		!species, l, reduced max lm (rlmmax) value
 7 8 9 		!the lm quanties which will be projected (vector length eq. rlmmax)
-0.055 0.07	![-1.5, 1.9] eV t2g correlated energy window
</pre></div>
</div>
<p>This <a class="reference download internal" download="" href="../../_downloads/d1b05aab1517eea0a610c6e2311bd75b/elk.in"><code class="xref download docutils literal notranslate"><span class="pre">elk.in</span></code></a> will generate the ground state (task 0) and the Wannier projectors (task 805) in a small energy window for the <span class="math notranslate nohighlight">\(V\)</span> <span class="math notranslate nohighlight">\(t_{2g}\)</span> orbitals. The elk executable is run in the directory including the elk.in file.</p>
<p>A simple python script that initializes the converter is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">triqs_dft_tools.converters.elk</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">Converter</span> <span class="o">=</span> <span class="n">elkConverter</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;SrVO3&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>After initializing the converter, we can now convert the input text files into an hdf5 archive by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Converter</span><span class="o">.</span><span class="n">convert_dft_input</span><span class="p">()</span>
</pre></div>
</div>
<p>This reads all necessary data from the <a class="reference internal" href="../../guide/conv_elk.html#elk-files"><span class="std std-ref">Elk output</span></a>, and stores the converted input for the DMFT calculation in the file <code class="file docutils literal notranslate"><span class="pre">SrVO3.h5</span></code>.</p>
</section>
<section id="the-dmft-calculation">
<h1>The DMFT calculation<a class="headerlink" href="#the-dmft-calculation" title="Link to this heading"></a></h1>
<p>The DMFT script itself is, except very few details, independent of the DFT package that was used to calculate the local orbitals. As soon as one has converted everything to the hdf5 format, the following procedure is practically the same.</p>
<section id="loading-modules">
<h2>Loading modules<a class="headerlink" href="#loading-modules" title="Link to this heading"></a></h2>
<p>First, we load the necessary modules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">triqs_dft_tools.sumk_dft</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">triqs.gf</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">h5</span> <span class="kn">import</span> <span class="n">HDFArchive</span>
<span class="kn">from</span> <span class="nn">triqs.operators.util</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">triqs_cthyb</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">triqs.utility.mpi</span> <span class="k">as</span> <span class="nn">mpi</span>
</pre></div>
</div>
<p>The last two lines load the modules for the construction of the
<a class="reference external" href="https://triqs.github.io/cthyb/latest/" rel="noopener noreferrer" target="_blank">CTHYB solver</a>.</p>
</section>
<section id="initializing-sumkdft">
<h2>Initializing SumkDFT<a class="headerlink" href="#initializing-sumkdft" title="Link to this heading"></a></h2>
<p>We define some parameters, which should be self-explanatory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dft_filename</span> <span class="o">=</span> <span class="s1">&#39;SrVO3&#39;</span>          <span class="c1"># filename</span>
<span class="n">U</span> <span class="o">=</span> <span class="mf">4.0</span>                         <span class="c1"># interaction parameters</span>
<span class="n">J</span> <span class="o">=</span> <span class="mf">0.65</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">40</span>                       <span class="c1"># inverse temperature</span>
<span class="n">loops</span> <span class="o">=</span> <span class="mi">15</span>                      <span class="c1"># number of DMFT loops</span>
<span class="n">mix</span> <span class="o">=</span> <span class="mf">0.8</span>                       <span class="c1"># mixing factor of Sigma after solution of the AIM</span>
<span class="n">dc_type</span> <span class="o">=</span> <span class="mi">1</span>                     <span class="c1"># DC type: 0 FLL, 1 Held, 2 AMF</span>
<span class="n">use_blocks</span> <span class="o">=</span> <span class="kc">True</span>               <span class="c1"># use bloc structure from DFT input</span>
<span class="n">prec_mu</span> <span class="o">=</span> <span class="mf">0.0001</span>                <span class="c1"># precision of chemical potential</span>
</pre></div>
</div>
<p>And next, we can initialize the <code class="xref py py-class docutils literal notranslate"><span class="pre">SumkDFT</span></code> class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SK</span> <span class="o">=</span> <span class="n">SumkDFT</span><span class="p">(</span><span class="n">hdf_file</span><span class="o">=</span><span class="n">dft_filename</span><span class="o">+</span><span class="s1">&#39;.h5&#39;</span><span class="p">,</span><span class="n">use_dft_blocks</span><span class="o">=</span><span class="n">use_blocks</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="initializing-the-solver">
<h2>Initializing the solver<a class="headerlink" href="#initializing-the-solver" title="Link to this heading"></a></h2>
<p>We also have to specify the <a class="reference external" href="https://triqs.github.io/cthyb/latest" rel="noopener noreferrer" target="_blank">CTHYB solver</a> related settings. We assume that the DMFT script for SrVO3 is executed on 16 cores. A sufficient set of parameters for a first guess is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c1"># solver</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;length_cycle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;n_warmup_cycles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100000</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;n_cycles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000000</span>
<span class="c1"># tail fit</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;perform_tail_fit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;fit_max_moment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;fit_min_n&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">p</span><span class="p">[</span><span class="s2">&quot;fit_max_n&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span>
</pre></div>
</div>
<p>Here we use a tail fit to deal with numerical noise of higher Matsubara frequencies. For other options and more details on the solver parameters, we refer to the <a class="reference external" href="https://triqs.github.io/cthyb/latest/reference/constr_parameters.html" rel="noopener noreferrer" target="_blank">CTHYB solver</a> documentation. It is important to note that the solver parameters have to be adjusted for each material individually. A guide on how to set the tail fit parameters is given <a class="reference internal" href="../srvo3.html#tailfit"><span class="std std-ref">below</span></a>.</p>
<p>The next step is to initialize the <code class="xref py py-class docutils literal notranslate"><span class="pre">solver</span> <span class="pre">class</span></code>. It consist of two parts:</p>
<ol class="arabic simple">
<li><p>Calculating the multi-band interaction matrix, and constructing the
interaction Hamiltonian.</p></li>
<li><p>Initializing the solver class itself.</p></li>
</ol>
<p>The first step is done using methods of the <a class="reference external" href="https://triqs.github.io/triqs/latest/index.html#welcome" rel="noopener noreferrer" target="_blank" title="(in TRIQS v3.2.1)"><span class="xref std std-ref">TRIQS</span></a> library:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">n_orb</span> <span class="o">=</span> <span class="n">SK</span><span class="o">.</span><span class="n">corr_shells</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;dim&#39;</span><span class="p">]</span>
<span class="n">l</span> <span class="o">=</span> <span class="n">SK</span><span class="o">.</span><span class="n">corr_shells</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;l&#39;</span><span class="p">]</span>
<span class="n">spin_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;up&quot;</span><span class="p">,</span><span class="s2">&quot;down&quot;</span><span class="p">]</span>
<span class="c1"># Use GF structure determined by DFT blocks:</span>
<span class="n">gf_struct</span> <span class="o">=</span> <span class="p">[(</span><span class="n">block</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span> <span class="k">for</span> <span class="n">block</span><span class="p">,</span> <span class="n">indices</span> <span class="ow">in</span> <span class="n">SK</span><span class="o">.</span><span class="n">gf_struct_solver</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()]</span>
<span class="c1"># Construct U matrix for density-density calculations:</span>
<span class="n">Umat</span><span class="p">,</span> <span class="n">Upmat</span> <span class="o">=</span> <span class="n">U_matrix_kanamori</span><span class="p">(</span><span class="n">n_orb</span><span class="o">=</span><span class="n">n_orb</span><span class="p">,</span> <span class="n">U_int</span><span class="o">=</span><span class="n">U</span><span class="p">,</span> <span class="n">J_hund</span><span class="o">=</span><span class="n">J</span><span class="p">)</span>
</pre></div>
</div>
<p>We assumed here that we want to use an interaction matrix with Kanamori definitions of <span class="math notranslate nohighlight">\(U\)</span> and <span class="math notranslate nohighlight">\(J\)</span>.</p>
<p>Next, we construct the Hamiltonian and the solver:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">h_int</span> <span class="o">=</span> <span class="n">h_int_density</span><span class="p">(</span><span class="n">spin_names</span><span class="p">,</span> <span class="n">n_orb</span><span class="p">,</span> <span class="n">map_operator_structure</span><span class="o">=</span><span class="n">SK</span><span class="o">.</span><span class="n">sumk_to_solver</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">U</span><span class="o">=</span><span class="n">Umat</span><span class="p">,</span> <span class="n">Uprime</span><span class="o">=</span><span class="n">Upmat</span><span class="p">)</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">(</span><span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">,</span> <span class="n">gf_struct</span><span class="o">=</span><span class="n">gf_struct</span><span class="p">)</span>
</pre></div>
</div>
<p>For simplicity, we take only density-density interactions into account here. Other Hamiltonians with, e.g. with full rotational invariant interactions are:</p>
<ul class="simple">
<li><p>h_int_kanamori</p></li>
<li><p>h_int_slater</p></li>
</ul>
<p>For other choices of the interaction matrices (e.g Slater representation) or Hamiltonians, we refer to the reference manual of the <a class="reference external" href="https://triqs.github.io/triqs/latest/index.html#welcome" rel="noopener noreferrer" target="_blank" title="(in TRIQS v3.2.1)"><span class="xref std std-ref">TRIQS</span></a> library.</p>
<p>As a last step, we initialize the subgroup in the hdf5 archive to store the results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">mpi</span><span class="o">.</span><span class="n">is_master_node</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="n">dft_filename</span><span class="o">+</span><span class="s1">&#39;.h5&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ar</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">ar</span><span class="o">.</span><span class="n">is_group</span><span class="p">(</span><span class="s1">&#39;dmft_output&#39;</span><span class="p">)):</span>
            <span class="n">ar</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;dmft_output&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="dmft-cycle">
<h2>DMFT cycle<a class="headerlink" href="#dmft-cycle" title="Link to this heading"></a></h2>
<p>Now we can go to the definition of the self-consistency step. It consists again of the basic steps with some additional refinements:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">iteration_number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">loops</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">mpi</span><span class="o">.</span><span class="n">is_master_node</span><span class="p">():</span> <span class="nb">print</span> <span class="s2">&quot;Iteration = &quot;</span><span class="p">,</span> <span class="n">iteration_number</span>

    <span class="n">SK</span><span class="o">.</span><span class="n">symm_deg_gf</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span><span class="p">,</span><span class="n">ish</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>                        <span class="c1"># symmetrizing Sigma</span>
    <span class="n">SK</span><span class="o">.</span><span class="n">set_Sigma</span><span class="p">([</span> <span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span> <span class="p">])</span>                            <span class="c1"># put Sigma into the SumK class</span>
    <span class="n">chemical_potential</span> <span class="o">=</span> <span class="n">SK</span><span class="o">.</span><span class="n">calc_mu</span><span class="p">(</span> <span class="n">precision</span> <span class="o">=</span> <span class="n">prec_mu</span> <span class="p">)</span>  <span class="c1"># find the chemical potential for given density</span>
    <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span> <span class="o">&lt;&lt;</span> <span class="n">SK</span><span class="o">.</span><span class="n">extract_G_loc</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>                         <span class="c1"># calc the local Green function</span>
    <span class="n">mpi</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Total charge of Gloc : </span><span class="si">%.6f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="o">.</span><span class="n">total_density</span><span class="p">())</span>

    <span class="c1"># In the first loop, init the DC term and the real part of Sigma:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iteration_number</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">dm</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="o">.</span><span class="n">density</span><span class="p">()</span>
        <span class="n">SK</span><span class="o">.</span><span class="n">calc_dc</span><span class="p">(</span><span class="n">dm</span><span class="p">,</span> <span class="n">U_interact</span> <span class="o">=</span> <span class="n">U</span><span class="p">,</span> <span class="n">J_hund</span> <span class="o">=</span> <span class="n">J</span><span class="p">,</span> <span class="n">orb</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">use_dc_formula</span> <span class="o">=</span> <span class="n">dc_type</span><span class="p">)</span>
        <span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span> <span class="o">&lt;&lt;</span> <span class="n">SK</span><span class="o">.</span><span class="n">dc_imp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;up&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Calculate new G0_iw to input into the solver:</span>
    <span class="n">S</span><span class="o">.</span><span class="n">G0_iw</span> <span class="o">&lt;&lt;</span> <span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span> <span class="o">+</span> <span class="n">inverse</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="p">)</span>
    <span class="n">S</span><span class="o">.</span><span class="n">G0_iw</span> <span class="o">&lt;&lt;</span> <span class="n">inverse</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">G0_iw</span><span class="p">)</span>

    <span class="c1"># Solve the impurity problem:</span>
    <span class="n">S</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">h_int</span><span class="o">=</span><span class="n">h_int</span><span class="p">,</span> <span class="o">**</span><span class="n">p</span><span class="p">)</span>

    <span class="c1"># Solved. Now do post-solution stuff:</span>
    <span class="n">mpi</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Total charge of impurity problem : </span><span class="si">%.6f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="o">.</span><span class="n">total_density</span><span class="p">())</span>

    <span class="c1"># Now mix Sigma and G with factor mix, if wanted:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">iteration_number</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">mpi</span><span class="o">.</span><span class="n">is_master_node</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="n">dft_filename</span><span class="o">+</span><span class="s1">&#39;.h5&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ar</span><span class="p">:</span>
                <span class="n">mpi</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Mixing Sigma and G with factor </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">mix</span><span class="p">)</span>
                <span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span> <span class="o">&lt;&lt;</span> <span class="n">mix</span> <span class="o">*</span> <span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">mix</span><span class="p">)</span> <span class="o">*</span> <span class="n">ar</span><span class="p">[</span><span class="s1">&#39;dmft_output&#39;</span><span class="p">][</span><span class="s1">&#39;Sigma_iw&#39;</span><span class="p">]</span>
                <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span> <span class="o">&lt;&lt;</span> <span class="n">mix</span> <span class="o">*</span> <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">mix</span><span class="p">)</span> <span class="o">*</span> <span class="n">ar</span><span class="p">[</span><span class="s1">&#39;dmft_output&#39;</span><span class="p">][</span><span class="s1">&#39;G_iw&#39;</span><span class="p">]</span>
        <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span> <span class="o">&lt;&lt;</span> <span class="n">mpi</span><span class="o">.</span><span class="n">bcast</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="p">)</span>
        <span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span> <span class="o">&lt;&lt;</span> <span class="n">mpi</span><span class="o">.</span><span class="n">bcast</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span><span class="p">)</span>

    <span class="c1"># Write the final Sigma and G to the hdf5 archive:</span>
    <span class="k">if</span> <span class="n">mpi</span><span class="o">.</span><span class="n">is_master_node</span><span class="p">():</span>
        <span class="k">with</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="n">dft_filename</span><span class="o">+</span><span class="s1">&#39;.h5&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ar</span><span class="p">:</span>
              <span class="n">ar</span><span class="p">[</span><span class="s1">&#39;dmft_output&#39;</span><span class="p">][</span><span class="s1">&#39;iterations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">iteration_number</span>
              <span class="n">ar</span><span class="p">[</span><span class="s1">&#39;dmft_output&#39;</span><span class="p">][</span><span class="s1">&#39;G_0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">G0_iw</span>
              <span class="n">ar</span><span class="p">[</span><span class="s1">&#39;dmft_output&#39;</span><span class="p">][</span><span class="s1">&#39;G_tau&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">G_tau</span>
              <span class="n">ar</span><span class="p">[</span><span class="s1">&#39;dmft_output&#39;</span><span class="p">][</span><span class="s1">&#39;G_iw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span>
              <span class="n">ar</span><span class="p">[</span><span class="s1">&#39;dmft_output&#39;</span><span class="p">][</span><span class="s1">&#39;Sigma_iw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span>

    <span class="c1"># Set the new double counting:</span>
    <span class="n">dm</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="o">.</span><span class="n">density</span><span class="p">()</span> <span class="c1"># compute the density matrix of the impurity problem</span>
    <span class="n">SK</span><span class="o">.</span><span class="n">calc_dc</span><span class="p">(</span><span class="n">dm</span><span class="p">,</span> <span class="n">U_interact</span> <span class="o">=</span> <span class="n">U</span><span class="p">,</span> <span class="n">J_hund</span> <span class="o">=</span> <span class="n">J</span><span class="p">,</span> <span class="n">orb</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">use_dc_formula</span> <span class="o">=</span> <span class="n">dc_type</span><span class="p">)</span>

    <span class="c1"># Save stuff into the user_data group of hdf5 archive in case of rerun:</span>
    <span class="n">SK</span><span class="o">.</span><span class="n">save</span><span class="p">([</span><span class="s1">&#39;chemical_potential&#39;</span><span class="p">,</span><span class="s1">&#39;dc_imp&#39;</span><span class="p">,</span><span class="s1">&#39;dc_energ&#39;</span><span class="p">])</span>
</pre></div>
</div>
</section>
</section>
<section id="triqs-to-elk-fully-charge-self-consistent-dft-dmft">
<h1>TRIQS to Elk (Fully Charge Self-Consistent DFT+DMFT)<a class="headerlink" href="#triqs-to-elk-fully-charge-self-consistent-dft-dmft" title="Link to this heading"></a></h1>
<p>To output the DMATDMFT.OUT file for a fully charge self-consistent calculation, add the following lines to the end of the DMFT python script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#output the density matrix for Elk interface</span>
<span class="n">dN</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">SK</span><span class="o">.</span><span class="n">calc_density_correction</span><span class="p">()</span>
<span class="c1">#correlation energy via the Migdal formula</span>
<span class="n">correnerg</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">G_iw</span> <span class="o">*</span> <span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span><span class="p">)</span><span class="o">.</span><span class="n">total_density</span><span class="p">()</span>
<span class="c1">#subtract the double counting energy</span>
<span class="n">correnerg</span> <span class="o">-=</span> <span class="n">SK</span><span class="o">.</span><span class="n">dc_energ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">#convert to Hartree</span>
<span class="n">correnerg</span> <span class="o">=</span> <span class="n">correnerg</span><span class="o">/</span><span class="n">SK</span><span class="o">.</span><span class="n">energy_unit</span>
<span class="c1">#save the correction to energy</span>
<span class="k">if</span> <span class="p">(</span><span class="n">mpi</span><span class="o">.</span><span class="n">is_master_node</span><span class="p">()):</span>
  <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;DMATDMFT.OUT&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
  <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.16f</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">correnerg</span><span class="p">)</span>
  <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>To update the electron density and solve the Kohn-Sham equations once, run task 808 in elk.in. Automating this cycle can be done by running the shell script (<a class="reference download internal" download="" href="../../_downloads/5473e1c8ea5d5fdabfe61307c2a9e13c/elk_fcsc.sh"><code class="xref download docutils literal notranslate"><span class="pre">elk_fcsc.sh</span></code></a>) and having an <a class="reference download internal" download="" href="../../_downloads/feed3685c149783c14ebe43558c67e89/elk_master.in"><code class="xref download docutils literal notranslate"><span class="pre">elk_master.in</span></code></a> file which replaces the tasks in elk.in for each new task in the FCSC DFT+DMFT cycle (see <a class="reference download internal" download="" href="../../_downloads/feed3685c149783c14ebe43558c67e89/elk_master.in"><code class="xref download docutils literal notranslate"><span class="pre">elk_master.in</span></code></a>.  Assuming that the ground state has been calculated, this shell script executes the following:</p>
<ol class="arabic simple">
<li><p>generate the projectors (task 805)</p></li>
<li><p>execute the DMFT cycle(s)</p></li>
<li><p>update the electron density</p></li>
<li><p>-&gt; (1) …</p></li>
</ol>
<p>The user just needs to specify the maximum number of FCSC cycles, as well as the number of OpenMP threads for Elk (<cite>OMP_NUM_THREADS</cite>) and the number of MPI ranks in the bash script.</p>
<p>This is all we need for the one-shot or FCSC DFT+DMFT calculation. All results of this calculation will be stored in a separate subgroup in the hdf5 file, called <cite>dmft_output</cite>. Note that the script performs 15 DMFT cycles, but does not check for convergence. It would be possible to build in convergence criteria.  A simple check for convergence can be also done if you store multiple quantities of each iteration and analyse the convergence manually. In general, it is advisable to start with less good statistics (fewer measurements), and increase the number of measurements close to convergence (e.g. after a few initial iterations). This helps to keep computational costs low during the first iterations.</p>
<p>Using the Kanamori Hamiltonian and the parameters above (but on 16 cores), your self energy after the <strong>first iteration</strong> should look something like:</p>
<a class="reference internal image-reference" href="../../_images/SrVO3_Sigma_iw_it1.png"><img alt="../../_images/SrVO3_Sigma_iw_it1.png" class="align-center" src="../../_images/SrVO3_Sigma_iw_it1.png" style="width: 700px;" /></a>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../nio_csc_vasp/nio_csc.html" class="btn btn-neutral float-left" title="DFT and projections" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../issues.html" class="btn btn-neutral float-right" title="Reporting issues" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2011-2021.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
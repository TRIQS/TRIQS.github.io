
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Single-shot DFT+DMFT &#8212; triqs_dft_tools  documentation</title>
    <link rel="stylesheet" href="../_static/triqs.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" type="text/javascript" src="https://raw.githubusercontent.com/mathjax/MathJax/2.7.8/MathJax.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Full charge self-consistency" href="dftdmft_selfcons.html" />
    <link rel="prev" title="A general H(k)" href="conv_generalhk.html" />
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>
    <script src="../_static/cufon-yui.js" type="text/javascript"></script>
    <script src="../_static/spaceman.cufonfonts.js" type="text/javascript"></script>
    <script type="text/javascript">
      Cufon.replace('.triqs', { fontFamily: 'spaceman', hover: true }); 
    </script>
 
    <style type="text/css">
      table.right { float: right; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
      
    </style>

  </head><body>
<div class="pageheader">
  <ul>
    
    <li><a href="../install.html">Install</a></li>
    
    <li><a href="../documentation.html">Documentation</a></li>
    
    <li><a href="../tutorials.html">Tutorials</a></li>
    
    <li><a href="../issues.html">Issues</a></li>
    
    <li><a href="../about.html">About DFTTools</a></li>
    
  </ul>
  <div>
    <h1 style="padding:0; margin: 10px 0 0 0;"><a class="triqs" href="../index.html">dft tools</a></h1>
    <span style="font-size: 14px; margin: 0px; padding: 0px;">connecting <a class="triqs" style="font-size: 12px" href="http://triqs.github.io/triqs">TRIQS</a> to DFT packages</span>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="dftdmft_selfcons.html" title="Full charge self-consistency"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="conv_generalhk.html" title="A general H(k)"
             accesskey="P">previous</a> |</li>
    <li><a href="../index.html">Home</a> &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../documentation.html" accesskey="U">Documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Single-shot DFT+DMFT</a><ul>
<li><a class="reference internal" href="#initialization-of-the-calculation">Initialization of the calculation</a></li>
<li><a class="reference internal" href="#setting-up-the-impurity-solver">Setting up the impurity solver</a></li>
<li><a class="reference internal" href="#doing-the-dmft-loop">Doing the DMFT loop</a></li>
<li><a class="reference internal" href="#restarting-a-calculation">Restarting a calculation</a></li>
<li><a class="reference internal" href="#mixing">Mixing</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="conv_generalhk.html"
                        title="previous chapter">A general H(k)</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="dftdmft_selfcons.html"
                        title="next chapter">Full charge self-consistency</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/guide/dftdmft_singleshot.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="single-shot-dft-dmft">
<span id="singleshot"></span><h1>Single-shot DFT+DMFT<a class="headerlink" href="#single-shot-dft-dmft" title="Permalink to this headline">¶</a></h1>
<p>After having set up the hdf5 archive, we can now proceed to our first DFT+DMFT calculation.
It consists of initialization steps, and the actual DMFT self-consistency loop,
With the code snippets below you can build your own script and target
it to your needs. Little examples on <a class="reference internal" href="#mixing"><span class="std std-ref">mixing</span></a> and on
<a class="reference internal" href="#restartcalc"><span class="std std-ref">restarting from a previous calculation</span></a> at the end of this page
should also demonstrate how simple you can modify your own DMFT script. A full working
calculation for SrVO3 is discussed in the <a class="reference internal" href="../tutorials/srvo3.html#srvo3"><span class="std std-ref">next section</span></a>.</p>
<div class="section" id="initialization-of-the-calculation">
<h2>Initialization of the calculation<a class="headerlink" href="#initialization-of-the-calculation" title="Permalink to this headline">¶</a></h2>
<p>Before doing the actual calculation, we have to initialize all needed objects.
The first thing is the <code class="xref py py-class docutils literal notranslate"><span class="pre">SumkDFT</span></code> class.
It contains all basic routines that are necessary to perform a summation in k-space
to get the local quantities used in DMFT. It is initialized by:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">triqs_dft_tools.sumk_dft</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">SK</span> <span class="o">=</span> <span class="n">SumkDFT</span><span class="p">(</span><span class="n">hdf_file</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.h5&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-up-the-impurity-solver">
<h2>Setting up the impurity solver<a class="headerlink" href="#setting-up-the-impurity-solver" title="Permalink to this headline">¶</a></h2>
<p>The next step is to setup an impurity solver. There are different
solvers available within the <a class="reference external" href="https://triqs.github.io/triqs/latest/index.html#welcome" title="(in TRIQS v2.2.3)"><span class="xref std std-ref">TRIQS</span></a> framework.
E.g. for <a class="reference internal" href="../tutorials/srvo3.html#srvo3"><span class="std std-ref">SrVO3</span></a>, we will use the hybridization
expansion <a class="reference external" href="https://triqs.github.io/cthyb/latest/index.html#welcome" title="(in TRIQS Hybridization Expansion Solver v2.2.0)"><span class="xref std std-ref">CTHYB solver</span></a>. Later on, we will
see also the example of the <a class="reference external" href="https://triqs.github.io/triqs/1.4/applications/hubbardI/">Hubbard-I solver</a>.
They all have in common, that they are called by an uniform command:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">S</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
<p>where <em>params</em> are the solver parameters and depend on the actual
solver. Setting up the <a class="reference external" href="https://triqs.github.io/cthyb/latest/index.html#welcome" title="(in TRIQS Hybridization Expansion Solver v2.2.0)"><span class="xref std std-ref">CTHYB solver</span></a> for SrVO3 is
discussed on the <a class="reference internal" href="../tutorials/srvo3.html#srvo3"><span class="std std-ref">next page</span></a>. Here, let us now perform the DMFT
loop using the methods of <strong class="program">DFTTools</strong>, assuming that we have already
set up a working solver instance.</p>
</div>
<div class="section" id="doing-the-dmft-loop">
<h2>Doing the DMFT loop<a class="headerlink" href="#doing-the-dmft-loop" title="Permalink to this headline">¶</a></h2>
<p>Having initialized the <code class="xref py py-class docutils literal notranslate"><span class="pre">Sumk</span> <span class="pre">class</span></code>
and the solver, we can proceed with the actual DMFT part of the calculation.
We set up the loop over DMFT iterations and the self-consistency condition:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n_loops</span> <span class="o">=</span> <span class="mi">15</span>
<span class="k">for</span> <span class="n">iteration_number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_loops</span><span class="p">)</span> <span class="p">:</span>        <span class="c1"># start the DMFT loop</span>
    <span class="n">SK</span><span class="o">.</span><span class="n">set_Sigma</span><span class="p">([</span> <span class="n">S</span><span class="o">.</span><span class="n">Sigma</span> <span class="p">])</span>                   <span class="c1"># Put self energy to the SumK class</span>
    <span class="n">chemical_potential</span> <span class="o">=</span> <span class="n">SK</span><span class="o">.</span><span class="n">calc_mu</span><span class="p">()</span>           <span class="c1"># calculate the chemical potential for the given density</span>
    <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span> <span class="o">&lt;&lt;</span> <span class="n">SK</span><span class="o">.</span><span class="n">extract_G_loc</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>                     <span class="c1"># extract the local Green function</span>
    <span class="n">S</span><span class="o">.</span><span class="n">G0_iw</span> <span class="o">&lt;&lt;</span> <span class="n">inverse</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span> <span class="o">+</span> <span class="n">inverse</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="p">))</span>    <span class="c1"># finally get G0, the input for the solver</span>

    <span class="n">S</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">h_int</span><span class="o">=</span><span class="n">h_int</span><span class="p">,</span> <span class="o">**</span><span class="n">p</span><span class="p">)</span>                   <span class="c1"># now solve the impurity problem</span>

    <span class="n">dm</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="o">.</span><span class="n">density</span><span class="p">()</span>                                           <span class="c1"># Density matrix of the impurity problem</span>
    <span class="n">SK</span><span class="o">.</span><span class="n">calc_dc</span><span class="p">(</span><span class="n">dm</span><span class="p">,</span> <span class="n">U_interact</span><span class="o">=</span><span class="n">U</span><span class="p">,</span> <span class="n">J_hund</span><span class="o">=</span><span class="n">J</span><span class="p">,</span> <span class="n">orb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">use_dc_formula</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Set the double counting term</span>
    <span class="n">SK</span><span class="o">.</span><span class="n">save</span><span class="p">([</span><span class="s1">&#39;chemical_potential&#39;</span><span class="p">,</span><span class="s1">&#39;dc_imp&#39;</span><span class="p">,</span><span class="s1">&#39;dc_energ&#39;</span><span class="p">])</span>             <span class="c1"># Save data in the hdf5 archive</span>
</pre></div>
</div>
<p>These steps are enough for a basic DMFT Loop.
After the self-consistency steps, which lead to a new <span class="math notranslate nohighlight">\(G^0(i\omega)\)</span>,
the impurity solver is called. Different to model calculations, we have to do a few
more steps after this, because of the double-counting correction. We first
calculate the density of the impurity problem. Then, the routine <code class="xref py py-meth docutils literal notranslate"><span class="pre">calc_dc</span></code>
takes as parameters this density matrix, the Coulomb interaction, Hund’s rule
coupling, and the type of double-counting that should be used. Possible values
for <em>use_dc_formula</em> are:</p>
<blockquote>
<div><ul class="simple">
<li><cite>0</cite>: Full-localised limit (FLL)</li>
<li><cite>1</cite>: DC formula as given in K. Held, Adv. Phys. 56, 829 (2007).</li>
<li><cite>2</cite>: Around-mean-field (AMF)</li>
</ul>
</div></blockquote>
<p>At the end of the calculation, we can save the Green function and self energy into a file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">h5</span> <span class="kn">import</span> <span class="n">HDFArchive</span>
<span class="kn">import</span> <span class="nn">triqs.utility.mpi</span> <span class="kn">as</span> <span class="nn">mpi</span>
<span class="k">if</span> <span class="n">mpi</span><span class="o">.</span><span class="n">is_master_node</span><span class="p">():</span>
    <span class="n">ar</span> <span class="o">=</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="s2">&quot;YourDFTDMFTcalculation.h5&quot;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">ar</span><span class="p">[</span><span class="s2">&quot;G&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span>
    <span class="n">ar</span><span class="p">[</span><span class="s2">&quot;Sigma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span>
</pre></div>
</div>
<p>These are the essential steps necessary for a one-shot DFT+DMFT calculation.
For a detailed description of the <code class="xref py py-class docutils literal notranslate"><span class="pre">SumkDFT</span></code>
routines, see the <a class="reference external" href="https://docs.python.org/3.8/distutils/commandref.html#reference" title="(in Python v3.8)"><span class="xref std std-ref">reference manual</span></a>. To perform full charge self-consistent calculations, there
are some more things to consider, which we will see <a class="reference internal" href="dftdmft_selfcons.html#full-charge-selfcons"><span class="std std-ref">later on</span></a>.</p>
</div>
<div class="section" id="restarting-a-calculation">
<span id="restartcalc"></span><h2>Restarting a calculation<a class="headerlink" href="#restarting-a-calculation" title="Permalink to this headline">¶</a></h2>
<p>Often only a few DMFT iterations are performed first, and thus, it is desirable to
carry out further iterations, e.g. to improve on the convergence. With a little modification
at the initialization stage (before the DMFT loop) it is possible to detect if previous runs
are present, or if the calculation should start from scratch:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">previous_runs</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">previous_present</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">if</span> <span class="n">mpi</span><span class="o">.</span><span class="n">is_master_node</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="n">dft_filename</span><span class="o">+</span><span class="s1">&#39;.h5&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;dmft_output&#39;</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">ar</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;dmft_output&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;iterations&#39;</span> <span class="ow">in</span> <span class="n">ar</span><span class="p">:</span>
                <span class="n">previous_present</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">previous_runs</span> <span class="o">=</span> <span class="n">ar</span><span class="p">[</span><span class="s1">&#39;iterations&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;dmft_output&#39;</span><span class="p">)</span>

<span class="n">previous_runs</span> <span class="o">=</span> <span class="n">mpi</span><span class="o">.</span><span class="n">bcast</span><span class="p">(</span><span class="n">previous_runs</span><span class="p">)</span>
<span class="n">previous_present</span> <span class="o">=</span> <span class="n">mpi</span><span class="o">.</span><span class="n">bcast</span><span class="p">(</span><span class="n">previous_present</span><span class="p">)</span>
</pre></div>
</div>
<p>You can see from this code snippet, that removing the subgroup <em>dmft_results</em> from the
hdf file has the effect of reseting the calculation to the starting point. If there are previous
runs stored in the hdf5 archive, we can now load the self energy, the chemical potential and
double counting values of the last iteration:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">previous_present</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">mpi</span><span class="o">.</span><span class="n">is_master_node</span><span class="p">():</span>
        <span class="k">with</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="n">dft_filename</span><span class="o">+</span><span class="s1">&#39;.h5&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ar</span><span class="p">:</span>
            <span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span> <span class="o">&lt;&lt;</span> <span class="n">ar</span><span class="p">[</span><span class="s1">&#39;dmft_output&#39;</span><span class="p">][</span><span class="s1">&#39;Sigma_iw&#39;</span><span class="p">]</span>

    <span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span> <span class="o">&lt;&lt;</span> <span class="n">mpi</span><span class="o">.</span><span class="n">bcast</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span><span class="p">)</span>
    <span class="n">chemical_potential</span><span class="p">,</span><span class="n">dc_imp</span><span class="p">,</span><span class="n">dc_energ</span> <span class="o">=</span> <span class="n">SK</span><span class="o">.</span><span class="n">load</span><span class="p">([</span><span class="s1">&#39;chemical_potential&#39;</span><span class="p">,</span><span class="s1">&#39;dc_imp&#39;</span><span class="p">,</span><span class="s1">&#39;dc_energ&#39;</span><span class="p">])</span>
    <span class="n">SK</span><span class="o">.</span><span class="n">set_mu</span><span class="p">(</span><span class="n">chemical_potential</span><span class="p">)</span>
    <span class="n">SK</span><span class="o">.</span><span class="n">set_dc</span><span class="p">(</span><span class="n">dc_imp</span><span class="p">,</span><span class="n">dc_energ</span><span class="p">)</span>
</pre></div>
</div>
<p>The data is loaded only on the master node, and therefore we broadcast it to the slave nodes.
Be careful when storing the <em>iteration_number</em> as we also have to add the previous
iteration count:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ar</span><span class="p">[</span><span class="s1">&#39;dmft_output&#39;</span><span class="p">][</span><span class="s1">&#39;iterations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">iteration_number</span> <span class="o">+</span> <span class="n">previous_runs</span>
</pre></div>
</div>
</div>
<div class="section" id="mixing">
<span id="id1"></span><h2>Mixing<a class="headerlink" href="#mixing" title="Permalink to this headline">¶</a></h2>
<p>In some cases a mixing of two consecutive self energies (or alternatively two hybridization
functions) can be necessary in order to ensure convergence:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mix</span> <span class="o">=</span> <span class="mf">0.8</span> <span class="c1"># mixing factor</span>
<span class="k">if</span> <span class="p">(</span><span class="n">iteration_number</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">previous_present</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">mpi</span><span class="o">.</span><span class="n">is_master_node</span><span class="p">():</span>
        <span class="k">with</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="n">dft_filename</span><span class="o">+</span><span class="s1">&#39;.h5&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ar</span><span class="p">:</span>
            <span class="n">mpi</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Mixing Sigma and G with factor </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">mix</span><span class="p">)</span>
            <span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span> <span class="o">&lt;&lt;</span> <span class="n">mix</span> <span class="o">*</span> <span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">mix</span><span class="p">)</span> <span class="o">*</span> <span class="n">ar</span><span class="p">[</span><span class="s1">&#39;dmft_output&#39;</span><span class="p">][</span><span class="s1">&#39;Sigma_iw&#39;</span><span class="p">]</span>
            <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span> <span class="o">&lt;&lt;</span> <span class="n">mix</span> <span class="o">*</span> <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">mix</span><span class="p">)</span> <span class="o">*</span> <span class="n">ar</span><span class="p">[</span><span class="s1">&#39;dmft_output&#39;</span><span class="p">][</span><span class="s1">&#39;G_iw&#39;</span><span class="p">]</span>
    <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span> <span class="o">&lt;&lt;</span> <span class="n">mpi</span><span class="o">.</span><span class="n">bcast</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="p">)</span>
    <span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span> <span class="o">&lt;&lt;</span> <span class="n">mpi</span><span class="o">.</span><span class="n">bcast</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span><span class="p">)</span>
</pre></div>
</div>
<p>In this little piece of code, which should be placed after calling the solver, two consecutive
self energies are linearly mixed with the factor <em>mix</em>. Of course, it is possible
to implement more advanced mixing schemes (e.g. Broyden’s methods), however, in most cases
simple linear mixing or even no mixing is sufficient for a reasonably fast convergence.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="dftdmft_selfcons.html" title="Full charge self-consistency"
             >next</a> |</li>
        <li class="right" >
          <a href="conv_generalhk.html" title="A general H(k)"
             >previous</a> |</li>
    <li><a href="../index.html">Home</a> &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../documentation.html" >Documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2011-2020.
    </div>
  </body>
</html>
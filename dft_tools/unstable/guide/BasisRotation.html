

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Automatic basis rotations in DFT+DMFT &mdash; TRIQS DFTTools  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Spin-orbit coupled calculations (single-shot)" href="soc.html" />
    <link rel="prev" title="Manipulating the Greenâ€™s functions block structure" href="blockstructure.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #7E588A" >
          

          
            <a href="../index.html" class="icon icon-home"> TRIQS DFTTools
          

          
          </a>

          
            
            
              <div class="version">
                3.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html#packaged-versions-of-dfttools">Packaged Versions of DFTTools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../install.html#ubuntu-debian-packages">Ubuntu Debian packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#anaconda-experimental">Anaconda (experimental)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#id2">Docker</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#compiling-dfttools-from-source">Compiling DFTTools from source</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../install.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#installation-steps">Installation steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#important-note-for-fcsc-dft-dmft-calculations">Important note for FCSC DFT+DMFT calculations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#installation-steps-for-the-use-with-wien2k-version-14-2-and-older">Installation steps for the use with WIEN2K version 14.2 and older</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#version-compatibility">Version compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#custom-cmake-options">Custom CMake options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../documentation.html">Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#basic-notions">Basic notions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basicnotions/first.html">What you should know</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/first.html#what-is-dfttools">What is <strong class="program">DFTTools</strong>?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/first.html#understand-the-philosophy-of-dfttools">Understand the philosophy of <strong class="program">DFTTools</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/first.html#learn-how-to-use-triqs-and-the-cthyb-solver">Learn how to use <span class="xref std std-ref">TRIQS</span> (and the <span class="xref std std-ref">CTHYB</span> solver)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/first.html#analytic-continuation">Analytic Continuation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../basicnotions/dft_dmft.html">Introduction to DFT+DMFT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/dft_dmft.html#density-functional-theory-in-a-very-small-nutshell">Density-functional theory in a (very small) nutshell</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/dft_dmft.html#from-dft-to-dmft">From DFT to DMFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/dft_dmft.html#using-projective-wannier-functions-for-dmft">Using projective Wannier functions for DMFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/dft_dmft.html#full-charge-self-consistency">Full charge self-consistency</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../basicnotions/structure.html">Structure of <strong class="program">DFTTools</strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/structure.html#the-interface-layer">The interface layer</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../basicnotions/structure.html#wien2k-interface">Wien2k interface</a></li>
<li class="toctree-l5"><a class="reference internal" href="../basicnotions/structure.html#general-interface">General interface</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/structure.html#the-dmft-calculation">The DMFT calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/structure.html#full-charge-self-consistency">Full charge self consistency</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/structure.html#post-processing">Post-processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/structure.html#executing-your-python-scripts">Executing your python scripts</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#construction-of-local-orbitals-from-dft">Construction of local orbitals from DFT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="conversion.html">Supported interfaces</a><ul>
<li class="toctree-l4"><a class="reference internal" href="conv_wien2k.html">Interface with Wien2k</a><ul>
<li class="toctree-l5"><a class="reference internal" href="conv_wien2k.html#conversion-for-the-dmft-self-consistency-cycle">Conversion for the DMFT self-consistency cycle</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_wien2k.html#data-for-post-processing">Data for post-processing</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_wien2k.html#data-for-transport-calculations">Data for transport calculations</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="conv_vasp.html">Interface with VASP</a><ul>
<li class="toctree-l5"><a class="reference internal" href="conv_vasp.html#limitations-of-the-interface">Limitations of the interface</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_vasp.html#vasp-generating-raw-projectors">VASP: generating raw projectors</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_vasp.html#conversion-for-the-dmft-self-consistency-cycle">Conversion for the DMFT self-consistency cycle</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_vasp.html#plovasp-detailed-guide">PLOVASP detailed guide</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_vasp.html#remarks-on-the-vasp-version">Remarks on the VASP version</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="conv_elk.html">Interface with Elk</a><ul>
<li class="toctree-l5"><a class="reference internal" href="conv_elk.html#conversion-for-the-dmft-self-consistency-cycle">Conversion for the DMFT self-consistency cycle</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_elk.html#data-for-post-processing-correlated-spectral-functions">Data for post-processing - Correlated Spectral functions</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_elk.html#spectral-function-from-elk-inputs">Spectral function from Elk inputs</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_elk.html#spectral-function-contour-plots-fermi-surfaces-from-elk-inputs">Spectral function Contour Plots (Fermi Surfaces) from Elk inputs</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_elk.html#dft-dmft-wavefunction-dependent-quantities">DFT+DMFT wavefunction dependent quantities</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="conv_W90.html">Interface with Wannier90</a><ul>
<li class="toctree-l5"><a class="reference internal" href="conv_W90.html#orbital-mode">Orbital mode</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_W90.html#band-mode">Band mode</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_W90.html#rotation-matrix">Rotation matrix</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_W90.html#current-limitations">Current limitations</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="conv_generalhk.html">A general H(k)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="conversion.html#mpi-issues">MPI issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="conversion.html#interfaces-to-other-packages">Interfaces to other packages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#dft-dmft">DFT+DMFT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dftdmft_singleshot.html">Single-shot DFT+DMFT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="dftdmft_singleshot.html#initialization-of-the-calculation">Initialization of the calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="dftdmft_singleshot.html#setting-up-the-impurity-solver">Setting up the impurity solver</a></li>
<li class="toctree-l4"><a class="reference internal" href="dftdmft_singleshot.html#doing-the-dmft-loop">Doing the DMFT loop</a></li>
<li class="toctree-l4"><a class="reference internal" href="dftdmft_singleshot.html#restarting-a-calculation">Restarting a calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="dftdmft_singleshot.html#mixing">Mixing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="dftdmft_selfcons.html">Full charge self-consistency</a><ul>
<li class="toctree-l4"><a class="reference internal" href="dftdmft_selfcons.html#wien2k-dmftproj">Wien2k + dmftproj</a></li>
<li class="toctree-l4"><a class="reference internal" href="dftdmft_selfcons.html#vasp-plovasp">VASP + PLOVasp</a></li>
<li class="toctree-l4"><a class="reference internal" href="dftdmft_selfcons.html#elk">Elk</a></li>
<li class="toctree-l4"><a class="reference internal" href="dftdmft_selfcons.html#other-dft-codes">Other DFT codes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../documentation.html#advanced-topics">Advanced Topics</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="blockstructure.html">Manipulating the Greenâ€™s functions block structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="blockstructure.html#creating-a-block-structure-and-green-s-function">Creating a block structure and Greenâ€™s function</a></li>
<li class="toctree-l4"><a class="reference internal" href="blockstructure.html#the-solver-structure">The <em>solver</em> structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="blockstructure.html#picking-orbitals">Picking orbitals</a></li>
<li class="toctree-l4"><a class="reference internal" href="blockstructure.html#basis-rotations">Basis rotations</a></li>
<li class="toctree-l4"><a class="reference internal" href="blockstructure.html#diagonal-approximation">Diagonal approximation</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Automatic basis rotations in DFT+DMFT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-the-initial-solver-structure-from-dft">Setting up the initial solver structure from DFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="#finding-the-transformation-matrix">Finding the transformation matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="#automatic-transformation-during-the-dmft-loop">Automatic transformation during the DMFT loop</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="soc.html">Spin-orbit coupled calculations (single-shot)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="soc.html#treatment-of-soc-in-dft">Treatment of SOC in DFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="soc.html#treatment-of-soc-in-wien2k">Treatment of SOC in Wien2k</a><ul>
<li class="toctree-l5"><a class="reference internal" href="soc.html#performing-the-projection-in-wien2k">Performing the projection in Wien2k</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="soc.html#treatment-of-soc-in-elk">Treatment of SOC in Elk</a></li>
<li class="toctree-l4"><a class="reference internal" href="soc.html#after-generating-the-projectors">After generating the projectors</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#postprocessing">Postprocessing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="analysis.html">Tools for analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#initialisation">Initialisation</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#density-of-states-of-the-wannier-orbitals">Density of states of the Wannier orbitals</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#partial-charges">Partial charges</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#correlated-spectral-function-with-real-frequency-self-energy">Correlated spectral function (with real-frequency self energy)</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#momentum-resolved-spectral-function-with-real-frequency-self-energy">Momentum resolved spectral function (with real-frequency self energy)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="transport.html">Transport calculations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="transport.html#formalism">Formalism</a></li>
<li class="toctree-l4"><a class="reference internal" href="transport.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="transport.html#wien2k-optics-package">Wien2k optics package</a></li>
<li class="toctree-l4"><a class="reference internal" href="transport.html#using-the-transport-code">Using the transport code</a></li>
<li class="toctree-l4"><a class="reference internal" href="transport.html#references">References</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#reference-manual">Reference manual</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/h5structure.html">hdf5 structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/h5structure.html#groups-and-their-formats">groups and their formats</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../reference/h5structure.html#main-data">Main data</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/h5structure.html#converter-specific-data">Converter specific data</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/h5structure.html#symmetry-operations">Symmetry operations</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../reference/h5structure.html#general-and-simple-h-k-converter">General and simple H(k) Converter</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/converters.html">Converters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/converters.html#wien2k-converter">Wien2k Converter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/converters.html#h-k-converter">H(k) Converter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/converters.html#wannier90-converter">Wannier90 Converter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/converters.html#plovasp">PLOVASP</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../reference/converters.html#plovasp-converter">plovasp.converter</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/converters.html#plovasp-inpconfig">plovasp.inpconfig</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/converters.html#plovasp-vaspio">plovasp.vaspio</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/converters.html#plovasp-elstruct">plovasp.elstruct</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/converters.html#plovasp-plotools">plovasp.plotools</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/converters.html#plovasp-proj-shell">plovasp.proj_shell</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/converters.html#plovasp-proj-group">plovasp.proj_group</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../reference/converters.html#vasp-converter">VASP Converter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/converters.html#elk-converter">Elk Converter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/converters.html#elk-tools">Elk Tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/converters.html#converter-tools">Converter Tools</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/sumk_dft.html">SumK DFT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/sumk_dft_tools.html">SumK DFT Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/symmetry.html">Symmetry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/transbasis.html">TransBasis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/block_structure.html">Block Structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#faqs">FAQs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../faqs/faqs.html">Frequently-Asked Questions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../faqs/faqs.html#wien2k-fermi-error-when-running-x-lapw2-almd-band">wien2k: FERMI ERROR when running <cite>x lapw2 -almd -band</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs/faqs.html#how-do-i-plot-the-output-of-spaghettis">How do I plot the output of <cite>spaghettis</cite>?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs/faqs.html#x-optic-does-not-write-a-case-pmat-file">x optic does not write a case.pmat file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs/faqs.html#how-do-i-get-real-frequency-quantities">How do I get real-frequency quantities?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#a-simple-example-srvo3">A simple example: SrVO3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/srvo3.html">DFT (Wien2k) and Wannier orbitals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/srvo3.html#dft-setup">DFT setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/srvo3.html#wannier-orbitals">Wannier orbitals</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/srvo3.html#the-dmft-calculation">The DMFT calculation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/srvo3.html#loading-modules">Loading modules</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/srvo3.html#initializing-sumkdft">Initializing SumkDFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/srvo3.html#initializing-the-solver">Initializing the solver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/srvo3.html#dmft-cycle">DMFT cycle</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/srvo3.html#tail-fit-parameters">Tail fit parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#basis-rotations-sr2mgoso6-without-soc">Basis rotations: Sr2MgOsO6 without SOC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/sr2mgoso6_nosoc.html">DFT (Wien2k) and Wannier orbitals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_nosoc.html#dft-setup">DFT setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_nosoc.html#wannier-orbitals">Wannier orbitals</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/sr2mgoso6_nosoc.html#the-dmft-calculation">The DMFT calculation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_nosoc.html#rotating-the-basis">Rotating the basis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_nosoc.html#the-interaction-hamiltonian">The interaction Hamiltonian</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_nosoc.html#the-dmft-loop-with-automatic-basis-rotations">The DMFT loop with automatic basis rotations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#sr2mgoso6-with-soc-non-magnetic">Sr2MgOsO6 with SOC (non-magnetic)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/sr2mgoso6_soc.html">DFT (Wien2k) and Wannier orbitals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_soc.html#dft-setup">DFT setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_soc.html#wannier-orbitals">Wannier orbitals</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/sr2mgoso6_soc.html#the-dmft-calculation">The DMFT calculation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_soc.html#rotating-the-basis">Rotating the basis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_soc.html#the-interaction-hamiltonian">The interaction Hamiltonian</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_soc.html#the-dmft-loop-with-automatic-basis-rotations">The DMFT loop with automatic basis rotations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#full-charge-self-consistency-with-wien2k-gamma-ce">Full charge self consistency with Wien2k: <span class="math notranslate nohighlight">\(\gamma\)</span>-Ce</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/ce-gamma-fscs_wien2k.html">DFT+DMFT tutorial: Ce with Hubbard-I approximation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/ce-gamma-fscs_wien2k.html#wien2k-setup">Wien2k setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/ce-gamma-fscs_wien2k.html#wannier-orbitals-dmftproj">Wannier orbitals: dmftproj</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/ce-gamma-fscs_wien2k.html#dmft-setup-hubbard-i-calculations-in-triqs">DMFT setup: Hubbard-I calculations in TRIQS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/ce-gamma-fscs_wien2k.html#fully-charge-self-consistent-dft-dmft-calculation">Fully charge self-consistent DFT+DMFT calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/ce-gamma-fscs_wien2k.html#post-processing-and-data-analysis">Post-processing and data analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#vasp-interface-examples">VASP interface examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials.html#simple-converter-example-srvo3">Simple Converter example: SrVO3</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/svo_vasp/svo_notebook.html">VASP setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/svo_vasp/svo_notebook.html#PLOVASP">PLOVASP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/svo_vasp/svo_notebook.html#Converting-to-hdf5-file">Converting to hdf5 file</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials.html#complex-example-nio">Complex example: NiO</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/nio_csc.html">DFT and projections</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../tutorials/nio_csc.html#vasp-setup">VASP setup</a></li>
<li class="toctree-l5"><a class="reference internal" href="../tutorials/nio_csc.html#plovasp">PLOVASP</a></li>
<li class="toctree-l5"><a class="reference internal" href="../tutorials/nio_csc.html#converting-to-hdf5-file">Converting to hdf5 file</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/nio_csc.html#dmft">DMFT</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../tutorials/nio_csc.html#dmft-script">dmft script</a></li>
<li class="toctree-l5"><a class="reference internal" href="../tutorials/nio_csc.html#local-lattice-green-s-function-for-all-projected-orbitals">Local lattice Greenâ€™s function for all projected orbitals</a></li>
<li class="toctree-l5"><a class="reference internal" href="../tutorials/nio_csc.html#spectral-function-on-real-axis-maxent">Spectral function on real axis: MaxEnt</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/nio_csc.html#charge-self-consistent-dmft">Charge self-consistent DMFT</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#elk-interface-examples">Elk interface examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials.html#converter-example-srvo3">Converter example: SrVO3</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/svo_elk/srvo3.html">Elk to TRIQS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/svo_elk/srvo3.html#the-dmft-calculation">The DMFT calculation</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../tutorials/svo_elk/srvo3.html#loading-modules">Loading modules</a></li>
<li class="toctree-l5"><a class="reference internal" href="../tutorials/svo_elk/srvo3.html#initializing-sumkdft">Initializing SumkDFT</a></li>
<li class="toctree-l5"><a class="reference internal" href="../tutorials/svo_elk/srvo3.html#initializing-the-solver">Initializing the solver</a></li>
<li class="toctree-l5"><a class="reference internal" href="../tutorials/svo_elk/srvo3.html#dmft-cycle">DMFT cycle</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/svo_elk/srvo3.html#triqs-to-elk-fully-charge-self-consistent-dft-dmft">TRIQS to Elk (Fully Charge Self-Consistent DFT+DMFT)</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../tutorials/svo_elk/srvo3.html#tail-fit-parameters">Tail fit parameters</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ChangeLog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-1-0">Version 3.1.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#wannier90-converter">Wannier90 Converter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#documentation">Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#cmake">Cmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#other-changes">Other changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-0-0">Version 3.0.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#restructuring">Restructuring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#dependency-management">Dependency Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id2">Other Changes:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-2-1">Version 2.2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-2-0">Version 2.2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-1-x-changes-since-1-4">Version 2.1.x (changes since 1.4)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about.html#license">License</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#authors-quotation">Authors &amp; Quotation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#disclaimer">Disclaimer</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">TRIQS DFTTools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../documentation.html">Documentation</a> &raquo;</li>
        
      <li>Automatic basis rotations in DFT+DMFT</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/guide/BasisRotation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="automatic-basis-rotations-in-dft-dmft">
<span id="basisrotation"></span><h1>Automatic basis rotations in DFT+DMFT<a class="headerlink" href="#automatic-basis-rotations-in-dft-dmft" title="Permalink to this headline">Â¶</a></h1>
<p>When performing calculations with off-diagonal terms in the hybridisation function or in the local Hamiltonian, one is
often limited by the fermionic sign-problem slowing down the QMC calculations significantly. This can occur for instance if the crystal shows locally rotated or distorted cages, or when spin-orbit coupling is included. The examples for this are included in the <a class="reference internal" href="../tutorials.html#tutorials"><span class="std std-ref">Tutorials</span></a> of this documentation.</p>
<p>However, as the fermonic sign in the QMC calculation is no
physical observable, one can try to improve the calculation by rotating
to another basis. While this basis can in principle be chosen arbitrarily,
two choices which have shown good results; name the basis sets that diagonalize the local Hamiltonian or the local density matrix of the
system.</p>
<p>As outlined in section <a class="reference internal" href="blockstructure.html#blockstructure"><span class="std std-ref">Manipulating the Greenâ€™s functions block structure</span></a>, the <code class="xref py py-class docutils literal notranslate"><span class="pre">BlockStructure</span></code> includes all necessary functionalities. While it is possible to manually transform each Greenâ€™s functions and self energies between the <em>sumk</em> and the <em>solver</em> basis, this leads to cumbersum code and is discouraged. Instead, in order to facilitate the block-structure manipulations for an actual DFT+DMFT calculation, some of the necessary steps are automatically included automatically. As soon as the
transformation matrix is stored in the <code class="xref py py-class docutils literal notranslate"><span class="pre">BlockStructure</span></code>, the
transformation is automatically performed when using <code class="xref py py-class docutils literal notranslate"><span class="pre">SumkDFT</span></code>â€™s <code class="xref py py-meth docutils literal notranslate"><span class="pre">extract_G_loc()</span></code>,
<code class="xref py py-meth docutils literal notranslate"><span class="pre">put_Sigma()</span></code>, and <code class="xref py py-meth docutils literal notranslate"><span class="pre">calc_dc()</span></code> (see below).</p>
<div class="section" id="setting-up-the-initial-solver-structure-from-dft">
<h2>Setting up the initial solver structure from DFT<a class="headerlink" href="#setting-up-the-initial-solver-structure-from-dft" title="Permalink to this headline">Â¶</a></h2>
<p>Before the actual calculation one has to specify the <em>solver</em> basis structure, in which the impurity problem will be tackled. The different available approximation were introduced in section <a class="reference internal" href="blockstructure.html#blockstructure"><span class="std std-ref">Manipulating the Greenâ€™s functions block structure</span></a>. An important feature of DFTTools is that there is an automatic way to determine the entries of the Greenâ€™s function matrix that are zero by symmetry, when initialising the class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">triqs_dft_tools.sumk_dft</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">SK</span> <span class="o">=</span> <span class="n">SumkDFT</span><span class="p">(</span><span class="n">hdf_file</span><span class="p">,</span><span class="n">use_dft_blocks</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The flag <em>use_dft_blocks=True</em> analysis the local density matrix, determines the zero entries, and sets up a minimal <em>solver</em> structure. Alternatively, this step can be achieved by (see the reference manual for options):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SK</span><span class="o">.</span><span class="n">analyse_block_structure</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="finding-the-transformation-matrix">
<h2>Finding the transformation matrix<a class="headerlink" href="#finding-the-transformation-matrix" title="Permalink to this headline">Â¶</a></h2>
<p>The SumkDFT class offers a method that can determine transformation matrices to certain new basis. It is called as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SK</span><span class="o">.</span><span class="n">calculate_diagonalization_matrix</span><span class="p">(</span><span class="n">prop_to_be_diagonal</span><span class="o">=</span><span class="s1">&#39;eal&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Possible option for <em>prop_to_be_diagonal</em> are <em>eal</em> (diagonalises the local hamiltonian) or <em>dm</em> (diagonalises the local density matrix). This routine stores the transformation matrix in the <code class="xref py py-class docutils literal notranslate"><span class="pre">SK.block_structure</span></code> class, such that it can be used to rotate the basis.</p>
</div>
<div class="section" id="automatic-transformation-during-the-dmft-loop">
<h2>Automatic transformation during the DMFT loop<a class="headerlink" href="#automatic-transformation-during-the-dmft-loop" title="Permalink to this headline">Â¶</a></h2>
<p>During a DMFT loop one is often switching back and forth between the unrotated basis (Sumk-Space) and the rotated basis that is used by the QMC Solver.
Once the SK.block_structure.transformation property is set as shown above, this is
done automatically, meaning that <code class="xref py py-class docutils literal notranslate"><span class="pre">SumkDFT</span></code>â€™s <code class="xref py py-meth docutils literal notranslate"><span class="pre">extract_G_loc()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">put_Sigma()</span></code>, and <code class="xref py py-meth docutils literal notranslate"><span class="pre">calc_dc()</span></code> are doing the transformations by default:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iteration_offset</span><span class="p">,</span> <span class="n">iteration_offset</span> <span class="o">+</span> <span class="n">n_iterations</span><span class="p">):</span>
    <span class="c1"># every GF is in solver space here</span>
    <span class="n">S</span><span class="o">.</span><span class="n">G0_iw</span> <span class="o">&lt;&lt;</span> <span class="n">inverse</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span> <span class="o">+</span> <span class="n">inverse</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="p">))</span>

    <span class="c1"># solve the impurity in solver space -&gt; hopefully better sign</span>
    <span class="n">S</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">h_int</span> <span class="o">=</span> <span class="n">H</span><span class="p">,</span> <span class="o">**</span><span class="n">p</span><span class="p">)</span>

    <span class="c1"># calc_dc(..., transform = True) by default</span>
    <span class="n">SK</span><span class="o">.</span><span class="n">calc_dc</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="o">.</span><span class="n">density</span><span class="p">(),</span> <span class="n">U_interact</span><span class="o">=</span><span class="n">U</span><span class="p">,</span> <span class="n">J_hund</span><span class="o">=</span><span class="n">J</span><span class="p">,</span> <span class="n">orb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">use_dc_formula</span><span class="o">=</span><span class="n">DC_type</span><span class="p">)</span>

    <span class="c1"># put_Sigma(..., transform_to_sumk_blocks = True) by default</span>
    <span class="n">SK</span><span class="o">.</span><span class="n">put_Sigma</span><span class="p">([</span><span class="n">S</span><span class="o">.</span><span class="n">Sigma_iw</span><span class="p">])</span>

    <span class="n">SK</span><span class="o">.</span><span class="n">calc_mu</span><span class="p">()</span>

    <span class="c1"># extract_G_loc(..., transform_to_solver_blocks = True) by default</span>
    <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span> <span class="o">&lt;&lt;</span> <span class="n">SK</span><span class="o">.</span><span class="n">extract_G_loc</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Before doing the DMFT self-consistency loop, one must not forget to also transform the
interaction Hamiltonian to the diagonal basis!
This can be also be done with a method of the <code class="xref py py-class docutils literal notranslate"><span class="pre">BlockStructure</span></code> class,
namely the <code class="xref py py-meth docutils literal notranslate"><span class="pre">convert_operator()</span></code> method. Having set up a Hamiltonian in the <em>sumk</em> structure, it can easily
be transformed to the <em>solver</em> structure (including rotations of basis, picking of orbitals,
making matrices diagonal, etc) by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">H_solver</span> <span class="o">=</span> <span class="n">SK</span><span class="o">.</span><span class="n">block_structure</span><span class="o">.</span><span class="n">convert_operator</span><span class="p">(</span><span class="n">H_sumk</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">We refer to the tutorials on how to set up the Hamiltonian H_sumk in selected cases.
Note that this transformation might generally lead to complex values in the
interaction Hamiltonian. Unless you know better and can make everything real,
you should take care of using the correct version of the TRIQS CTQMC solver.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="soc.html" class="btn btn-neutral float-right" title="Spin-orbit coupled calculations (single-shot)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="blockstructure.html" class="btn btn-neutral float-left" title="Manipulating the Greenâ€™s functions block structure" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2011-2021.

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
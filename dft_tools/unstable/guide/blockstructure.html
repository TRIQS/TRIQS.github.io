

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Manipulating the Green’s functions block structure &mdash; TRIQS DFTTools  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=default"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Automatic basis rotations in DFT+DMFT" href="BasisRotation.html" />
    <link rel="prev" title="Full charge self-consistency" href="dftdmft_selfcons.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #7E588A" >
          

          
            <a href="../index.html" class="icon icon-home"> TRIQS DFTTools
          

          
          </a>

          
            
            
              <div class="version">
                3.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html#packaged-versions-of-dfttools">Packaged Versions of DFTTools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../install.html#ubuntu-debian-packages">Ubuntu Debian packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#anaconda-experimental">Anaconda (experimental)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#id2">Docker</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#compiling-dfttools-from-source">Compiling DFTTools from source</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../install.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#installation-steps">Installation steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#important-note-for-fcsc-dft-dmft-calculations">Important note for FCSC DFT+DMFT calculations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#installation-steps-for-the-use-with-wien2k-version-14-2-and-older">Installation steps for the use with WIEN2K version 14.2 and older</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#version-compatibility">Version compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#custom-cmake-options">Custom CMake options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../documentation.html">Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#basic-notions">Basic notions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basicnotions/first.html">What you should know</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/first.html#what-is-dfttools">What is <strong class="program">DFTTools</strong>?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/first.html#understand-the-philosophy-of-dfttools">Understand the philosophy of <strong class="program">DFTTools</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/first.html#learn-how-to-use-triqs-and-the-cthyb-solver">Learn how to use <span class="xref std std-ref">TRIQS</span> (and the <span class="xref std std-ref">CTHYB</span> solver)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/first.html#analytic-continuation">Analytic Continuation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../basicnotions/dft_dmft.html">Introduction to DFT+DMFT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/dft_dmft.html#density-functional-theory-in-a-very-small-nutshell">Density-functional theory in a (very small) nutshell</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/dft_dmft.html#from-dft-to-dmft">From DFT to DMFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/dft_dmft.html#using-projective-wannier-functions-for-dmft">Using projective Wannier functions for DMFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/dft_dmft.html#full-charge-self-consistency">Full charge self-consistency</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../basicnotions/structure.html">Structure of <strong class="program">DFTTools</strong></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/structure.html#the-interface-layer">The interface layer</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../basicnotions/structure.html#wien2k-interface">Wien2k interface</a></li>
<li class="toctree-l5"><a class="reference internal" href="../basicnotions/structure.html#general-interface">General interface</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/structure.html#the-dmft-calculation">The DMFT calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/structure.html#full-charge-self-consistency">Full charge self consistency</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/structure.html#post-processing">Post-processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/structure.html#executing-your-python-scripts">Executing your python scripts</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#construction-of-local-orbitals-from-dft">Construction of local orbitals from DFT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="conversion.html">Supported interfaces</a><ul>
<li class="toctree-l4"><a class="reference internal" href="conv_wien2k.html">Interface with Wien2k</a><ul>
<li class="toctree-l5"><a class="reference internal" href="conv_wien2k.html#conversion-for-the-dmft-self-consistency-cycle">Conversion for the DMFT self-consistency cycle</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_wien2k.html#data-for-post-processing">Data for post-processing</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_wien2k.html#data-for-transport-calculations">Data for transport calculations</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="conv_vasp.html">Interface with VASP</a><ul>
<li class="toctree-l5"><a class="reference internal" href="conv_vasp.html#limitations-of-the-interface">Limitations of the interface</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_vasp.html#vasp-generating-raw-projectors">VASP: generating raw projectors</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_vasp.html#conversion-for-the-dmft-self-consistency-cycle">Conversion for the DMFT self-consistency cycle</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_vasp.html#plovasp-detailed-guide">PLOVASP detailed guide</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_vasp.html#remarks-on-the-vasp-version">Remarks on the VASP version</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="conv_elk.html">Interface with Elk</a><ul>
<li class="toctree-l5"><a class="reference internal" href="conv_elk.html#conversion-for-the-dmft-self-consistency-cycle">Conversion for the DMFT self-consistency cycle</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_elk.html#data-for-post-processing-correlated-spectral-functions">Data for post-processing - Correlated Spectral functions</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_elk.html#spectral-function-from-elk-inputs">Spectral function from Elk inputs</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_elk.html#spectral-function-contour-plots-fermi-surfaces-from-elk-inputs">Spectral function Contour Plots (Fermi Surfaces) from Elk inputs</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_elk.html#dft-dmft-wavefunction-dependent-quantities">DFT+DMFT wavefunction dependent quantities</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="conv_W90.html">Interface with Wannier90</a><ul>
<li class="toctree-l5"><a class="reference internal" href="conv_W90.html#orbital-mode">Orbital mode</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_W90.html#band-mode">Band mode</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_W90.html#rotation-matrix">Rotation matrix</a></li>
<li class="toctree-l5"><a class="reference internal" href="conv_W90.html#current-limitations">Current limitations</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="conv_generalhk.html">A general H(k)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="conversion.html#mpi-issues">MPI issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="conversion.html#interfaces-to-other-packages">Interfaces to other packages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#dft-dmft">DFT+DMFT</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dftdmft_singleshot.html">Single-shot DFT+DMFT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="dftdmft_singleshot.html#initialization-of-the-calculation">Initialization of the calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="dftdmft_singleshot.html#setting-up-the-impurity-solver">Setting up the impurity solver</a></li>
<li class="toctree-l4"><a class="reference internal" href="dftdmft_singleshot.html#doing-the-dmft-loop">Doing the DMFT loop</a></li>
<li class="toctree-l4"><a class="reference internal" href="dftdmft_singleshot.html#restarting-a-calculation">Restarting a calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="dftdmft_singleshot.html#mixing">Mixing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="dftdmft_selfcons.html">Full charge self-consistency</a><ul>
<li class="toctree-l4"><a class="reference internal" href="dftdmft_selfcons.html#wien2k-dmftproj">Wien2k + dmftproj</a></li>
<li class="toctree-l4"><a class="reference internal" href="dftdmft_selfcons.html#vasp-plovasp">VASP + PLOVasp</a></li>
<li class="toctree-l4"><a class="reference internal" href="dftdmft_selfcons.html#elk">Elk</a></li>
<li class="toctree-l4"><a class="reference internal" href="dftdmft_selfcons.html#other-dft-codes">Other DFT codes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../documentation.html#advanced-topics">Advanced Topics</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Manipulating the Green’s functions block structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-block-structure-and-green-s-function">Creating a block structure and Green’s function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-solver-structure">The <em>solver</em> structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#picking-orbitals">Picking orbitals</a></li>
<li class="toctree-l4"><a class="reference internal" href="#basis-rotations">Basis rotations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#diagonal-approximation">Diagonal approximation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="BasisRotation.html">Automatic basis rotations in DFT+DMFT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="BasisRotation.html#setting-up-the-initial-solver-structure-from-dft">Setting up the initial solver structure from DFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="BasisRotation.html#finding-the-transformation-matrix">Finding the transformation matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="BasisRotation.html#automatic-transformation-during-the-dmft-loop">Automatic transformation during the DMFT loop</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="soc.html">Spin-orbit coupled calculations (single-shot)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="soc.html#treatment-of-soc-in-dft">Treatment of SOC in DFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="soc.html#treatment-of-soc-in-wien2k">Treatment of SOC in Wien2k</a><ul>
<li class="toctree-l5"><a class="reference internal" href="soc.html#performing-the-projection-in-wien2k">Performing the projection in Wien2k</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="soc.html#treatment-of-soc-in-elk">Treatment of SOC in Elk</a></li>
<li class="toctree-l4"><a class="reference internal" href="soc.html#after-generating-the-projectors">After generating the projectors</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#postprocessing">Postprocessing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="analysis.html">Tools for analysis</a><ul>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#initialisation">Initialisation</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#density-of-states-of-the-wannier-orbitals">Density of states of the Wannier orbitals</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#partial-charges">Partial charges</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#correlated-spectral-function-with-real-frequency-self-energy">Correlated spectral function (with real-frequency self energy)</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#momentum-resolved-spectral-function-with-real-frequency-self-energy">Momentum resolved spectral function (with real-frequency self energy)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="transport.html">Transport calculations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="transport.html#formalism">Formalism</a></li>
<li class="toctree-l4"><a class="reference internal" href="transport.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="transport.html#wien2k-optics-package">Wien2k optics package</a></li>
<li class="toctree-l4"><a class="reference internal" href="transport.html#using-the-transport-code">Using the transport code</a></li>
<li class="toctree-l4"><a class="reference internal" href="transport.html#references">References</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#reference-manual">Reference manual</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/h5structure.html">hdf5 structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/h5structure.html#groups-and-their-formats">groups and their formats</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../reference/h5structure.html#main-data">Main data</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/h5structure.html#converter-specific-data">Converter specific data</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/h5structure.html#symmetry-operations">Symmetry operations</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../reference/h5structure.html#general-and-simple-h-k-converter">General and simple H(k) Converter</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/converters.html">Converters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/converters.html#wien2k-converter">Wien2k Converter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/converters.html#h-k-converter">H(k) Converter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/converters.html#wannier90-converter">Wannier90 Converter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/converters.html#plovasp">PLOVASP</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../reference/converters.html#plovasp-converter">plovasp.converter</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/converters.html#plovasp-inpconfig">plovasp.inpconfig</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/converters.html#plovasp-vaspio">plovasp.vaspio</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/converters.html#plovasp-elstruct">plovasp.elstruct</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/converters.html#plovasp-plotools">plovasp.plotools</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/converters.html#plovasp-proj-shell">plovasp.proj_shell</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/converters.html#plovasp-proj-group">plovasp.proj_group</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../reference/converters.html#vasp-converter">VASP Converter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/converters.html#elk-converter">Elk Converter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/converters.html#elk-tools">Elk Tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/converters.html#converter-tools">Converter Tools</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/sumk_dft.html">SumK DFT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/sumk_dft_tools.html">SumK DFT Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/symmetry.html">Symmetry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/transbasis.html">TransBasis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/block_structure.html">Block Structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#faqs">FAQs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../faqs/faqs.html">Frequently-Asked Questions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../faqs/faqs.html#wien2k-fermi-error-when-running-x-lapw2-almd-band">wien2k: FERMI ERROR when running <cite>x lapw2 -almd -band</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs/faqs.html#how-do-i-plot-the-output-of-spaghettis">How do I plot the output of <cite>spaghettis</cite>?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs/faqs.html#x-optic-does-not-write-a-case-pmat-file">x optic does not write a case.pmat file</a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs/faqs.html#how-do-i-get-real-frequency-quantities">How do I get real-frequency quantities?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#a-simple-example-srvo3">A simple example: SrVO3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/srvo3.html">DFT (Wien2k) and Wannier orbitals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/srvo3.html#dft-setup">DFT setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/srvo3.html#wannier-orbitals">Wannier orbitals</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/srvo3.html#the-dmft-calculation">The DMFT calculation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/srvo3.html#loading-modules">Loading modules</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/srvo3.html#initializing-sumkdft">Initializing SumkDFT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/srvo3.html#initializing-the-solver">Initializing the solver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/srvo3.html#dmft-cycle">DMFT cycle</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/srvo3.html#tail-fit-parameters">Tail fit parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#basis-rotations-sr2mgoso6-without-soc">Basis rotations: Sr2MgOsO6 without SOC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/sr2mgoso6_nosoc.html">DFT (Wien2k) and Wannier orbitals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_nosoc.html#dft-setup">DFT setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_nosoc.html#wannier-orbitals">Wannier orbitals</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/sr2mgoso6_nosoc.html#the-dmft-calculation">The DMFT calculation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_nosoc.html#rotating-the-basis">Rotating the basis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_nosoc.html#the-interaction-hamiltonian">The interaction Hamiltonian</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_nosoc.html#the-dmft-loop-with-automatic-basis-rotations">The DMFT loop with automatic basis rotations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#sr2mgoso6-with-soc-non-magnetic">Sr2MgOsO6 with SOC (non-magnetic)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/sr2mgoso6_soc.html">DFT (Wien2k) and Wannier orbitals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_soc.html#dft-setup">DFT setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_soc.html#wannier-orbitals">Wannier orbitals</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/sr2mgoso6_soc.html#the-dmft-calculation">The DMFT calculation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_soc.html#rotating-the-basis">Rotating the basis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_soc.html#the-interaction-hamiltonian">The interaction Hamiltonian</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/sr2mgoso6_soc.html#the-dmft-loop-with-automatic-basis-rotations">The DMFT loop with automatic basis rotations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#full-charge-self-consistency-with-wien2k-gamma-ce">Full charge self consistency with Wien2k: <span class="math notranslate nohighlight">\(\gamma\)</span>-Ce</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/ce-gamma-fscs_wien2k.html">DFT+DMFT tutorial: Ce with Hubbard-I approximation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/ce-gamma-fscs_wien2k.html#wien2k-setup">Wien2k setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/ce-gamma-fscs_wien2k.html#wannier-orbitals-dmftproj">Wannier orbitals: dmftproj</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/ce-gamma-fscs_wien2k.html#dmft-setup-hubbard-i-calculations-in-triqs">DMFT setup: Hubbard-I calculations in TRIQS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/ce-gamma-fscs_wien2k.html#fully-charge-self-consistent-dft-dmft-calculation">Fully charge self-consistent DFT+DMFT calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/ce-gamma-fscs_wien2k.html#post-processing-and-data-analysis">Post-processing and data analysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#vasp-interface-examples">VASP interface examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials.html#simple-converter-example-srvo3">Simple Converter example: SrVO3</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/svo_vasp/svo_notebook.html">VASP setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/svo_vasp/svo_notebook.html#PLOVASP">PLOVASP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/svo_vasp/svo_notebook.html#Converting-to-hdf5-file">Converting to hdf5 file</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials.html#complex-example-nio">Complex example: NiO</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/nio_csc.html">DFT and projections</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../tutorials/nio_csc.html#vasp-setup">VASP setup</a></li>
<li class="toctree-l5"><a class="reference internal" href="../tutorials/nio_csc.html#plovasp">PLOVASP</a></li>
<li class="toctree-l5"><a class="reference internal" href="../tutorials/nio_csc.html#converting-to-hdf5-file">Converting to hdf5 file</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/nio_csc.html#dmft">DMFT</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../tutorials/nio_csc.html#dmft-script">dmft script</a></li>
<li class="toctree-l5"><a class="reference internal" href="../tutorials/nio_csc.html#local-lattice-green-s-function-for-all-projected-orbitals">Local lattice Green’s function for all projected orbitals</a></li>
<li class="toctree-l5"><a class="reference internal" href="../tutorials/nio_csc.html#spectral-function-on-real-axis-maxent">Spectral function on real axis: MaxEnt</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/nio_csc.html#charge-self-consistent-dmft">Charge self-consistent DMFT</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html#elk-interface-examples">Elk interface examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials.html#converter-example-srvo3">Converter example: SrVO3</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/svo_elk/srvo3.html">Elk to TRIQS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/svo_elk/srvo3.html#the-dmft-calculation">The DMFT calculation</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../tutorials/svo_elk/srvo3.html#loading-modules">Loading modules</a></li>
<li class="toctree-l5"><a class="reference internal" href="../tutorials/svo_elk/srvo3.html#initializing-sumkdft">Initializing SumkDFT</a></li>
<li class="toctree-l5"><a class="reference internal" href="../tutorials/svo_elk/srvo3.html#initializing-the-solver">Initializing the solver</a></li>
<li class="toctree-l5"><a class="reference internal" href="../tutorials/svo_elk/srvo3.html#dmft-cycle">DMFT cycle</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/svo_elk/srvo3.html#triqs-to-elk-fully-charge-self-consistent-dft-dmft">TRIQS to Elk (Fully Charge Self-Consistent DFT+DMFT)</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../tutorials/svo_elk/srvo3.html#tail-fit-parameters">Tail fit parameters</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ChangeLog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-1-0">Version 3.1.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#wannier90-converter">Wannier90 Converter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#documentation">Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#cmake">Cmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#other-changes">Other changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-0-0">Version 3.0.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#restructuring">Restructuring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#dependency-management">Dependency Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id2">Other Changes:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-2-1">Version 2.2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-2-0">Version 2.2.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-1-x-changes-since-1-4">Version 2.1.x (changes since 1.4)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about.html#license">License</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#authors-quotation">Authors &amp; Quotation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#disclaimer">Disclaimer</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">TRIQS DFTTools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../documentation.html">Documentation</a> &raquo;</li>
        
      <li>Manipulating the Green’s functions block structure</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/guide/blockstructure.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="manipulating-the-green-s-functions-block-structure">
<span id="blockstructure"></span><h1>Manipulating the Green’s functions block structure<a class="headerlink" href="#manipulating-the-green-s-functions-block-structure" title="Permalink to this headline">¶</a></h1>
<p>The DFTTools package includes the general <code class="xref py py-class docutils literal notranslate"><span class="pre">BlockStructure</span></code> class for manipulating the blocks of Green’s functions (see also the TRIQS documentation on BlockGF). In the following, we will introduce its basic and most commonly used functionalities that might show up in an actual DFT+DMFT calculation, and will illustrate them on a very basic fictitious problem.</p>
<p>The main idea is to have two structures for the Greens functions available. The first one is used in the procedures of the <code class="xref py py-class docutils literal notranslate"><span class="pre">SumkDFT</span></code> to calculate Dysons equations, lattice Greens functions, and so on, and is normally a full matrix. For instance, in a calculation using <span class="math notranslate nohighlight">\(t_{2g}\)</span> orbitals without spin-orbit-coupling, you have an spin-up block of size 3x3 and a spin-down block of the same size. In the following, wee will refer to this structure as <em>sumk</em> structure.</p>
<p>The second structure, called <em>solver</em> structure, is the one which is used for the solution of the Anderson impurity problem. As a matter of fact, in particular in combination with quantum Monte Carlo techniques, it is advisable to use as small blocks as possible in order to run into numerical problems. In particular, it should contain information about the symmetry of the local problem.</p>
<div class="section" id="creating-a-block-structure-and-green-s-function">
<h2>Creating a block structure and Green’s function<a class="headerlink" href="#creating-a-block-structure-and-green-s-function" title="Permalink to this headline">¶</a></h2>
<p>For the purpose of this documentation, we focus on an example of a 3x3 Green’s function, consisting of a 1x1 block and a 2x2 block (with off-diagonal coupling). This is reminiscent of a <span class="math notranslate nohighlight">\(t_{2g}\)</span> manifold. Note that this initialisation is normally done automatically by DFTTools, we do it here manually for demonstration purposes only.</p>
<p>We can create a simple <code class="xref py py-class docutils literal notranslate"><span class="pre">BlockStructure</span></code> object as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">triqs_dft_tools</span> <span class="kn">import</span> <span class="n">BlockStructure</span>
<span class="n">BS</span> <span class="o">=</span> <span class="n">BlockStructure</span><span class="o">.</span><span class="n">full_structure</span><span class="p">([{</span><span class="s1">&#39;up&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]}],</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>This creates a block structure with one 3x3 block named <em>up</em>. Note that we have not created any Green’s function yet; this is just the structure of those objects. If you want to create a Green’s function with this structure, you can do (we will if with some content also):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">triqs.gf</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">GF_sumk</span> <span class="o">=</span> <span class="n">BS</span><span class="o">.</span><span class="n">create_gf</span><span class="p">(</span><span class="n">space</span><span class="o">=</span><span class="s1">&#39;sumk&#39;</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span> <span class="n">n_points</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">GF_sumk</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">iOmega_n</span> <span class="o">-</span> <span class="mf">2.0</span>
<span class="n">GF_sumk</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">iOmega_n</span> <span class="o">+</span> <span class="mf">0.5</span>
<span class="n">GF_sumk</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">iOmega_n</span> <span class="o">+</span> <span class="mf">0.5</span>
<span class="n">GF_sumk</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mf">0.1</span>
<span class="n">GF_sumk</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mf">0.1</span>
<span class="n">GF_sumk</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">inverse</span><span class="p">(</span><span class="n">GF_sumk</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Technically, we use the <em>sumk</em> block structure for this Green’s function. However, at this point, sumk and solver structure are still the same.</p>
<p>A plot of this structure looks like this. Note that there are off-diagonal elements which are exactly zero by construction.</p>
<a class="reference internal image-reference" href="../_images/BS_GFsumk.png"><img alt="../_images/BS_GFsumk.png" class="align-center" src="../_images/BS_GFsumk.png" style="width: 600px;" /></a>
</div>
<div class="section" id="the-solver-structure">
<h2>The <em>solver</em> structure<a class="headerlink" href="#the-solver-structure" title="Permalink to this headline">¶</a></h2>
<p>The method:<cite>BlockStructure.full_structure()</cite> method, as we used it above to create our BlockStructure object, yields - as the name suggests - a full structure, where <em>sumk</em> and <em>solver</em> structure are identical. Now we want to take advantage of the symmetries of the problem to reduce the <em>solver</em> block structure to the relevant matrix elements only. In our case the [0,0] matrix element of the Green’s function is completely decoupled from the 2x2 matrix of [1:2,1:2] elements. We simplify the <em>solver</em> structure by setting the mapping of each orbital to its target block and orbital:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BS</span><span class="o">.</span><span class="n">map_gf_struct_solver</span><span class="p">([{(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">):(</span><span class="s1">&#39;up_0&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">):(</span><span class="s1">&#39;up_1&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">):(</span><span class="s1">&#39;up_1&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)}])</span>
</pre></div>
</div>
<p>This creates a <em>solver</em> structure different from the <em>sumk</em> structure. To see the result, let us look at the Green’s function in the <em>solver</em> structure now:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GF_solver</span> <span class="o">=</span> <span class="n">BS</span><span class="o">.</span><span class="n">convert_gf</span><span class="p">(</span><span class="n">GF_sumk</span><span class="p">,</span> <span class="n">space_from</span><span class="o">=</span><span class="s1">&#39;sumk&#39;</span><span class="p">,</span> <span class="n">space_to</span><span class="o">=</span><span class="s1">&#39;solver&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This converts the GF_sumk into GF_solver, which looks like this.</p>
<a class="reference internal image-reference" href="../_images/BS_GF_up_0.png"><img alt="../_images/BS_GF_up_0.png" class="align-center" src="../_images/BS_GF_up_0.png" style="width: 200px;" /></a>
<a class="reference internal image-reference" href="../_images/BS_GF_up_1.png"><img alt="../_images/BS_GF_up_1.png" class="align-center" src="../_images/BS_GF_up_1.png" style="width: 400px;" /></a>
<p>As you can see, the Green’s function in the <em>solver</em> structure now consists of two blocks: one 1x1 block (called <em>up_0</em>) and one 2x2 block (called <em>up_1</em>). This is no approximation, as the off-diagonal elements between these blocks are exactly zero anyway.</p>
</div>
<div class="section" id="picking-orbitals">
<h2>Picking orbitals<a class="headerlink" href="#picking-orbitals" title="Permalink to this headline">¶</a></h2>
<p>In some cases it might happen that for the projection to localised orbitals a full <em>d</em> or <em>f</em>-shell has to be used. However, for the Anderson impurity problem, just a subset of the orbitals are needed. This is the case, e.g., when the projection leads to completely empty or full orbitals that you don’t want to include in the AIM.</p>
<p>For the example here, the local energy of the <em>up_0</em> block (2 eV) is higher than that of the <em>up_1</em> block (0.4 and 0.6 eV). Assuming that the chemical potential lies somewhere in the range of the <em>up_1</em> block, we might restrict our calculation to only this <em>up_1</em> block. The <code class="xref py py-class docutils literal notranslate"><span class="pre">BlockStructure</span></code> class includes methods to pick a subset or orbitals:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BS</span><span class="o">.</span><span class="n">pick_gf_struct_solver</span><span class="p">([{</span><span class="s1">&#39;up_1&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]}])</span>
<span class="n">GF2</span> <span class="o">=</span> <span class="n">BS</span><span class="o">.</span><span class="n">convert_gf</span><span class="p">(</span><span class="n">GF_sumk</span><span class="p">,</span> <span class="n">space_from</span><span class="o">=</span><span class="s1">&#39;sumk&#39;</span><span class="p">,</span> <span class="n">space_to</span><span class="o">=</span><span class="s1">&#39;solver&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now the Green’s function GF2 consists of only one 2x2 block, called <em>up_1</em>, as we have left out the <em>up_0</em> block.</p>
</div>
<div class="section" id="basis-rotations">
<h2>Basis rotations<a class="headerlink" href="#basis-rotations" title="Permalink to this headline">¶</a></h2>
<p>In cases where the Greens function or the local Hamiltonian shows off diagonal entries in the chosen basis, it is often beneficial to rotate to a different basis. This is of particular interest when using a QMC solver, since off-diagonal contributions lead to a famous fermionic sign problem. The <code class="xref py py-class docutils literal notranslate"><span class="pre">BlockStructure</span></code> class includes methods to perform such basis rotations.</p>
<p>In our example, the local Hamiltonian is given by</p>
<div class="math notranslate nohighlight">
\[\begin{split}\varepsilon_{mm'} = \begin{pmatrix} 2.0 &amp; 0.0 &amp; 0.0 \\0.0  &amp; -0.5 &amp; -0.1\\0.0 &amp; -0.1 &amp; -0.5 \end{pmatrix}\end{split}\]</div>
<p>It is easy to check that the following matrix diagonalises this local Hamiltonian:</p>
<div class="math notranslate nohighlight">
\[\begin{split}T_{mm'} = \begin{pmatrix} 1.0 &amp; 0.0 &amp; 0.0 \\0.0  &amp; 1/\sqrt{2} &amp; -1/\sqrt{2}\\0.0 &amp; 1/\sqrt{2} &amp; 1/\sqrt{2} \end{pmatrix}\end{split}\]</div>
<p>With this unitary matrix, we can do a basis rotation to reduce the size of the off-diagonal matrix elements. Note that the transformation matrix has to be given in the <em>sumk</em> basis form (a 3x3 matrix in this case):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1"># Unitary transformation matrix</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)],[</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="mf">1.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)]])</span>

<span class="n">BS</span><span class="o">.</span><span class="n">transformation</span> <span class="o">=</span> <span class="p">[</span><span class="n">T</span><span class="p">]</span>
<span class="n">GF3</span> <span class="o">=</span> <span class="n">BS</span><span class="o">.</span><span class="n">convert_gf</span><span class="p">(</span><span class="n">GF_sumk</span><span class="p">,</span> <span class="n">space_from</span><span class="o">=</span><span class="s1">&#39;sumk&#39;</span><span class="p">,</span> <span class="n">space_to</span><span class="o">=</span><span class="s1">&#39;solver&#39;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/BS_GF_up_1_rotated.png"><img alt="../_images/BS_GF_up_1_rotated.png" class="align-center" src="../_images/BS_GF_up_1_rotated.png" style="width: 400px;" /></a>
<p>As you can see, the offdiagonal elements are reduced to 1e-16 in this basis. Please note that our example is not the most generic case. Normally, due to non-local hybridisation, the off-diagonals can be made smaller, but not exactly zero.</p>
</div>
<div class="section" id="diagonal-approximation">
<h2>Diagonal approximation<a class="headerlink" href="#diagonal-approximation" title="Permalink to this headline">¶</a></h2>
<p>As said above, off diagonal contributions lead to some troubles. However,
when you are exactly sure that you know what you are doing, there is functionality to take only the diagonal parts into account in the block structure. Be careful, there is no automatic check whether this approximation is justified or not!</p>
<p>Starting from the rotated basis as done above, we can get rid of the off-diagonals as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BS</span><span class="o">.</span><span class="n">approximate_as_diagonal</span><span class="p">()</span>
<span class="n">GF4</span> <span class="o">=</span> <span class="n">BS</span><span class="o">.</span><span class="n">convert_gf</span><span class="p">(</span><span class="n">GF_sumk</span><span class="p">,</span> <span class="n">space_from</span><span class="o">=</span><span class="s1">&#39;sumk&#39;</span><span class="p">,</span> <span class="n">space_to</span><span class="o">=</span><span class="s1">&#39;solver&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The Green’s function GF4 consists now only of two 1x1 blocks, where <em>up_1</em> was the [0,0] element of the former 2x2 block, and <em>up_2</em> was the [1,1] element:</p>
<a class="reference internal image-reference" href="../_images/BS_GF_up_1_rotated_diag.png"><img alt="../_images/BS_GF_up_1_rotated_diag.png" class="align-center" src="../_images/BS_GF_up_1_rotated_diag.png" style="width: 200px;" /></a>
<a class="reference internal image-reference" href="../_images/BS_GF_up_2_rotated_diag.png"><img alt="../_images/BS_GF_up_2_rotated_diag.png" class="align-center" src="../_images/BS_GF_up_2_rotated_diag.png" style="width: 200px;" /></a>
<p>In summary, we started with a full 3x3 matrix in the very beginning, and ended with two 1x1 blocks containing the relevant matrix elements for the calculation.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="BasisRotation.html" class="btn btn-neutral float-right" title="Automatic basis rotations in DFT+DMFT" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="dftdmft_selfcons.html" class="btn btn-neutral float-left" title="Full charge self-consistency" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2011-2021.

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
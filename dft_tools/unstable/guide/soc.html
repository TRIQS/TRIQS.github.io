
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Spin-orbit coupled calculations (single-shot) &#8212; TRIQS DFTTools  documentation</title>
    <link rel="stylesheet" href="../_static/triqs.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=default"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tools for analysis" href="analysis.html" />
    <link rel="prev" title="Automatic basis rotations in DFT+DMFT" href="BasisRotation.html" />
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>
    <script src="../_static/cufon-yui.js" type="text/javascript"></script>
    <script src="../_static/spaceman.cufonfonts.js" type="text/javascript"></script>
    <script type="text/javascript">
      Cufon.replace('.triqs', { fontFamily: 'spaceman', hover: true }); 
    </script>
 
    <style type="text/css">
      table.right { float: right; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
      
    </style>

  </head>
  <body>
<div class="pageheader">
  <ul>
    
    <li><a href="../install.html">Install</a></li>
    
    <li><a href="../documentation.html">Documentation</a></li>
    
    <li><a href="../tutorials.html">Tutorials</a></li>
    
    <li><a href="../issues.html">Issues</a></li>
    
    <li><a href="../about.html">About DFTTools</a></li>
    
  </ul>
  <div>
    <h1 style="padding:0; margin: 10px 0 0 0;"><a class="triqs" href="../index.html">dft tools</a></h1>
    <span style="font-size: 14px; margin: 0px; padding: 0px;">connecting <a class="triqs" style="font-size: 12px" href="http://triqs.github.io/triqs">TRIQS</a> to DFT packages</span>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="analysis.html" title="Tools for analysis"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="BasisRotation.html" title="Automatic basis rotations in DFT+DMFT"
             accesskey="P">previous</a> |</li>
    <li><a href="../index.html">Home</a> &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../documentation.html" accesskey="U">Documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Spin-orbit coupled calculations (single-shot)</a><ul>
<li><a class="reference internal" href="#treatment-of-soc-in-dft">Treatment of SOC in DFT</a><ul>
<li><a class="reference internal" href="#performing-the-projection">Performing the projection</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="BasisRotation.html"
                        title="previous chapter">Automatic basis rotations in DFT+DMFT</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="analysis.html"
                        title="next chapter">Tools for analysis</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/guide/soc.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="spin-orbit-coupled-calculations-single-shot">
<span id="soc"></span><h1>Spin-orbit coupled calculations (single-shot)<a class="headerlink" href="#spin-orbit-coupled-calculations-single-shot" title="Permalink to this headline">¶</a></h1>
<p>There are two main ways of including the spin-orbit coupling (SOC) term into
DFT+DMFT calculations:</p>
<ul class="simple">
<li>by performing a DFT calculation including SOC and then doing a DMFT calculation on top, or</li>
<li>by performing a DFT calculation without SOC and then adding the SOC term on the model level.</li>
</ul>
<p>The second variant is a bit more involved and needs quite some expertise, so this guide will cover only the first variant with SOC included in the DFT calculations.</p>
<div class="section" id="treatment-of-soc-in-dft">
<h2>Treatment of SOC in DFT<a class="headerlink" href="#treatment-of-soc-in-dft" title="Permalink to this headline">¶</a></h2>
<p>For now, TRIQS/DFTTools does only work with Wien2k when performing calculations with SO.
The treatment of SOC in the VASP package is fundamentally different to the way Wien2k treats it, and the interface does not handle that at the moment.
Therefore, this guide describes how to do an SOC calculation using the Wien2k DFT package.</p>
<p>First, a Wien2k calculation including SOC has to be performed.
For details, we refer the reader to the <a class="reference external" href="http://susi.theochem.tuwien.ac.at/reg_user/textbooks/">documentation of Wien2k</a> . As a matter of fact, we need the output for the DFT band structure for both spin directions explicitly. That means that one needs to do a spin-polarised DFT calculation with SOC, but, however, with magnetic moment set to zero. In the Wien2k initialisation procedure, one can choose for the option -nom when <code class="docutils literal"><span class="pre">lstart</span></code> is called. This means that the charge densities are initialised without magnetic splitting. The SOC calculation is then performed in a standard way as described in the Wien2k manual.</p>
<div class="section" id="performing-the-projection">
<h3>Performing the projection<a class="headerlink" href="#performing-the-projection" title="Permalink to this headline">¶</a></h3>
<p>Note that the final <code class="docutils literal"><span class="pre">x</span> <span class="pre">lapw2</span> <span class="pre">-almd</span> <span class="pre">-so</span> <span class="pre">-up</span></code> and <code class="docutils literal"><span class="pre">x</span> <span class="pre">lapw2</span> <span class="pre">-almd</span> <span class="pre">-so</span> <span class="pre">-dn</span></code> have to be run <em>on a single core</em>, which implies that, before, <code class="docutils literal"><span class="pre">x</span> <span class="pre">lapw2</span> <span class="pre">-up</span></code>, <code class="docutils literal"><span class="pre">x</span> <span class="pre">lapw2</span> <span class="pre">-dn</span></code>, and <code class="docutils literal"><span class="pre">x</span> <span class="pre">lapwso</span> <span class="pre">-up</span></code> have to be run in single-core mode (at least once).</p>
<p>In the <code class="docutils literal"><span class="pre">case.indmftpr</span></code> file, the spin-orbit flag has to be set to <code class="docutils literal"><span class="pre">1</span></code> for the correlated atoms.
For example, for the compound Sr<sub>2</sub>MgOsO<sub>6</sub>, with the struct file <a class="reference download internal" href="../_downloads/Sr2MgOsO6.struct" download=""><code class="xref download docutils literal"><span class="pre">Sr2MgOsO6.struct</span></code></a>, we would, e.g., use the <code class="docutils literal"><span class="pre">indmftpr</span></code> file <a class="reference download internal" href="../_downloads/Sr2MgOsO6_SOC.indmftpr" download=""><code class="xref download docutils literal"><span class="pre">found</span> <span class="pre">here</span></code></a>.
Then, <code class="docutils literal"><span class="pre">dmftproj</span> <span class="pre">-sp</span> <span class="pre">-so</span></code> has to be called.
As usual, it is important to check for warnings (e.g., about eigenvalues of the overlap matrix) in the output of <code class="docutils literal"><span class="pre">dmftproj</span></code> and adapt the window until these warnings disappear.</p>
<p>Note that in presence of SOC, it is not possible to project only onto the <span class="math">\(t_{2g}\)</span> subshell because it is not an irreducible representation.</p>
<p>We strongly suggest using the <a class="reference internal" href="../reference/sumk_dft_tools.html#triqs_dft_tools.sumk_dft_tools.SumkDFTTools.dos_wannier_basis" title="triqs_dft_tools.sumk_dft_tools.SumkDFTTools.dos_wannier_basis"><code class="xref py py-meth docutils literal"><span class="pre">dos_wannier_basis()</span></code></a> functionality of the <a class="reference internal" href="../reference/sumk_dft_tools.html#triqs_dft_tools.sumk_dft_tools.SumkDFTTools" title="triqs_dft_tools.sumk_dft_tools.SumkDFTTools"><code class="xref py py-class docutils literal"><span class="pre">SumkDFTTools</span></code></a> class (see <a class="reference download internal" href="../_downloads/calculate_dos_wannier_basis.py" download=""><code class="xref download docutils literal"><span class="pre">calculate_dos_wannier_basis.py</span></code></a>) and compare the Wannier-projected orbitals to the original DFT DOS (they should be more or less equal).
Note that, with SOC, there are usually off-diagonal elements of the spectral function, which can also be imaginary.
The imaginary part can be found in the third column of the files <code class="docutils literal"><span class="pre">DOS_wann_...</span></code>.</p>
<p>After the projection, one can proceed with the DMFT calculation. However, two things need to be noted here. First, since the spin is not a good quantum number any more, there are off-diagonal elements in the hybridisation function and the local Hamiltonian coupling the two spin directions. This will eventually lead to a fermonic sign problem when QMC is used as a impurity solver. Second, although the <span class="math">\(e_{g}\)</span> subshell needs to be included in the projection, it can in many cases be neglected in the solution of the Anderson impurity model, after a transformation to a rotated local basis is done. This basis, diagonalising the local Hamiltonian in the presence of SOC, is often called the numerical j-basis. How rotations are performed is described in <a class="reference internal" href="BasisRotation.html#basisrotation"><span class="std std-ref">Automatic basis rotations in DFT+DMFT</span></a>, and the cutting of the orbitals in <a class="reference internal" href="blockstructure.html#blockstructure"><span class="std std-ref">Manipulating the Green’s functions block structure</span></a>.</p>
<p>A DMFT calculation including SOC for Sr2MgOsO6 is included in the <a class="reference internal" href="../tutorials.html#tutorials"><span class="std std-ref">Tutorials</span></a>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="analysis.html" title="Tools for analysis"
             >next</a> |</li>
        <li class="right" >
          <a href="BasisRotation.html" title="Automatic basis rotations in DFT+DMFT"
             >previous</a> |</li>
    <li><a href="../index.html">Home</a> &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../documentation.html" >Documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2011-2019.
    </div>
  </body>
</html>
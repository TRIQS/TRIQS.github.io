<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The det_manip class &mdash; TRIQS  documentation</title>
    
    <link rel="stylesheet" href="../../_static/triqs.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=default"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="top" title="TRIQS  documentation" href="../../contents.html" />
    <link rel="up" title="[triqs/det_manip] Manipulations of determinants" href="contents.html" />
    <link rel="next" title="How does it work ?" href="implementation_notes.html" />
    <link rel="prev" title="[triqs/det_manip] Manipulations of determinants" href="contents.html" />
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>
    <script src="../../_static/cufon-yui.js" type="text/javascript"></script>
    <script src="../../_static/spaceman.cufonfonts.js" type="text/javascript"></script>
    <script type="text/javascript">
      Cufon.replace('.triqs', { fontFamily: 'spaceman', hover: true }); 
    </script>
 
    <style type="text/css">
      table.right { float: right; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
      
    </style>

  </head>
  <body role="document">
<div class="pageheader">
  <ul>
    
    <li><a href="../../install.html">Install</a></li>
    
    <li><a href="../../reference.html">Reference</a></li>
    
    <li><a href="../../tutorials.html">Tutorials</a></li>
    
    <li><a href="../../applications.html">Applications</a></li>
    
    <li><a href="../../issues.html">Issues</a></li>
    
    <li><a href="../../about.html">About TRIQS</a></li>
    
  </ul>
  <div>
    <h1 style="padding:0; margin: 10px 0 0 0;"><a class="triqs" href="../../index.html">triqs</a></h1>
    <span style="font-size: 14px; margin: 0px; padding: 0px;">a Toolbox for Research on Interacting Quantum Systems</span>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="implementation_notes.html" title="How does it work ?"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="contents.html" title="[triqs/det_manip] Manipulations of determinants"
             accesskey="P">previous</a> |</li>
    <li><a href="../../index.html">Home</a> &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../../reference.html" >Reference</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="contents.html" accesskey="U"><strong>[triqs/det_manip]</strong> Manipulations of determinants</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">The det_manip class</a><ul>
<li><a class="reference internal" href="#parameter-construction">Parameter &amp; construction</a></li>
<li><a class="reference internal" href="#public-types">Public types</a></li>
<li><a class="reference internal" href="#public-member-functions">Public member functions</a></li>
<li><a class="reference internal" href="#synopsis">Synopsis</a></li>
<li><a class="reference internal" href="#under-the-hood">Under the hood ...</a></li>
<li><a class="reference internal" href="#full-reference">Full reference</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="contents.html"
                        title="previous chapter"><strong>[triqs/det_manip]</strong> Manipulations of determinants</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="implementation_notes.html"
                        title="next chapter">How does it work ?</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/reference/determinant_manipulation/det_manip.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="the-det-manip-class">
<h1>The det_manip class<a class="headerlink" href="#the-det-manip-class" title="Permalink to this headline">¶</a></h1>
<div class="section" id="parameter-construction">
<h2>Parameter &amp; construction<a class="headerlink" href="#parameter-construction" title="Permalink to this headline">¶</a></h2>
<p>The template parameter is the <strong>FunctionType</strong>, the type of F,
which is completely general but has to model the concept</p>
<blockquote>
<div><ul class="simple">
<li>return_type: type returned by the function</li>
<li>argument_type: type of the argument of the function (type of x and y).</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="public-types">
<h2>Public types<a class="headerlink" href="#public-types" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="62%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">name</th>
<th class="head">description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>xy_type</td>
<td>?</td>
</tr>
<tr class="row-odd"><td>value_type</td>
<td>?</td>
</tr>
<tr class="row-even"><td>vector_type</td>
<td>tqa::vector&lt;value_type&gt;</td>
</tr>
<tr class="row-odd"><td>matrix_type</td>
<td>tqa::matrix&lt;value_type&gt;</td>
</tr>
<tr class="row-even"><td>matrix_view_type</td>
<td>tqa::matrix_view&lt;value_type</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="public-member-functions">
<h2>Public member functions<a class="headerlink" href="#public-member-functions" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="38%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">return type</th>
<th class="head">member function</th>
<th class="head">description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&nbsp;</td>
<td>det_manip(FunctionType F, size_t init_size)</td>
<td>constructor</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>det_manip(FunctionType F, ArgumentContainer1 const &amp;X, ArgumentContainer2 const &amp;Y)</td>
<td>constructor</td>
</tr>
<tr class="row-even"><td>&nbsp;</td>
<td>det_manip(det_manip const &amp;)</td>
<td>constructor</td>
</tr>
<tr class="row-odd"><td>&nbsp;</td>
<td>det_manip(det_manip &amp;&amp;rhs) noexcept</td>
<td>constructor</td>
</tr>
<tr class="row-even"><td>det_manip &amp;</td>
<td>operator=(const det_manip &amp;)</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>det_manip &amp;</td>
<td>operator=(det_manip &amp;&amp; rhs) no except</td>
<td>?</td>
</tr>
<tr class="row-even"><td>void</td>
<td>clear()</td>
<td>put to size 0 (like a vector)</td>
</tr>
<tr class="row-odd"><td>size_t</td>
<td>size() const</td>
<td>current size of the matrix</td>
</tr>
<tr class="row-even"><td>xy_type const &amp;</td>
<td>get_x(size_t i) const</td>
<td>returns the i-th values of x</td>
</tr>
<tr class="row-odd"><td>xy_type const &amp;</td>
<td>get_y(size_t j) const</td>
<td>returns the j-th values of y</td>
</tr>
<tr class="row-even"><td>value_type</td>
<td>determinant() const</td>
<td>determinant</td>
</tr>
<tr class="row-odd"><td>value_type</td>
<td>inverse_matrix(size_t i, size_t j) const</td>
<td>?</td>
</tr>
<tr class="row-even"><td>matrix_view_type</td>
<td>inverse_matrix() const</td>
<td>Returns the inverse matrix. Warning: this is slow, since it create a new copy, and reorder the lines/cols.</td>
</tr>
<tr class="row-odd"><td>matrix_view_type</td>
<td>matrix() const</td>
<td>Rebuild the matrix. Warning: this is slow, since it create a new matrix and re-evaluate the function.</td>
</tr>
<tr class="row-even"><td>value_type</td>
<td>try_insert(size_t i, size_t j, xy_type const &amp;x, xy_type const &amp;y)</td>
<td>returns determinant ratio corresponding to the insertion of an element x-y on line i, column j without actually doing it. In particular, does not change determinant size.</td>
</tr>
<tr class="row-odd"><td>template&lt;typename Fx, typename Fy&gt; value_type</td>
<td>try_insert_from_function (size_t i, size_t j, Fx fx, Fy fy, value_type const ksi)</td>
<td>?</td>
</tr>
<tr class="row-even"><td>value_type</td>
<td>try_insert2 (size_t i0, size_t i1, size_t j0, size_t j1, xy_type const &amp;x0, xy_type const &amp;x1, xy_type const &amp;y0, xy_type const &amp;y1)</td>
<td>?</td>
</tr>
<tr class="row-odd"><td>value_type</td>
<td>try_remove (size_t i, size_t j)</td>
<td>?</td>
</tr>
<tr class="row-even"><td>value_type</td>
<td>try_remove2 (size_t i0, size_t i1, size_t j0, size_t j1)</td>
<td>?</td>
</tr>
<tr class="row-odd"><td>value_type</td>
<td>try_change_col (size_t j, xy_type const &amp;y)</td>
<td>?</td>
</tr>
<tr class="row-even"><td>value_type</td>
<td>try_change_row (size_t i, xy_type const &amp;x)</td>
<td>?</td>
</tr>
<tr class="row-odd"><td>void</td>
<td>complete_operation()</td>
<td>?</td>
</tr>
<tr class="row-even"><td>int</td>
<td>roll_matrix (RollDirection roll)</td>
<td>?</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>The possible operations on the matrix M are:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Operation</th>
<th class="head">Effect</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>insert</td>
<td>adding a line and a column</td>
</tr>
<tr class="row-odd"><td>remove</td>
<td>removing a line and a column</td>
</tr>
<tr class="row-even"><td>insert2</td>
<td>adding 2 lines and 2 columns</td>
</tr>
<tr class="row-odd"><td>remove2</td>
<td>removing 2 lines and 2 columns</td>
</tr>
<tr class="row-even"><td>change_col</td>
<td>changing one <em>y</em></td>
</tr>
<tr class="row-odd"><td>change_raw</td>
<td>changing one <em>x</em></td>
</tr>
</tbody>
</table>
<ul>
<li><p class="first">Each operation <em>OP</em> is called in two steps:</p>
<ul>
<li><div class="first highlight-c"><div class="highlight"><pre><span class="n">value_type</span> <span class="n">try_OP</span><span class="p">(</span><span class="n">arguments</span> <span class="p">...)</span>
</pre></div>
</div>
<p>Returns the ratio</p>
<div class="math">
\[\frac{det M'}{det M}\]</div>
<p>where M&#8217; would be the matrix after the operation is completed.</p>
<p>try_OP <strong>does NOT</strong> modify the matrix <span class="math">\(M\)</span>.</p>
</li>
<li><div class="first highlight-c"><div class="highlight"><pre><span class="kt">void</span> <span class="n">complete_operation</span><span class="p">()</span>
</pre></div>
</div>
<p>Complete the last operation OP (the last called try_OP), by updating the list of x and y
and the inverse of the matrix to <span class="math">\((M')^{-1}\)</span>.</p>
</li>
</ul>
</li>
<li><p class="first">This structure is designed to write  Monte Carlo algorithms:</p>
<ul class="simple">
<li>the try part of the move calls some try_OP</li>
<li>if and only if the move is accepted, is the complete_operation called.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="under-the-hood">
<h2>Under the hood ...<a class="headerlink" href="#under-the-hood" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>All matrix algebra is made with BLAS calls.</li>
<li>The storage is done in a compact way: when a column or row is added,
no data are shifted, it is added at the end of the matrix.
However, the permutation of row and columns are handled by this class
so that this is transparent for the user.</li>
</ul>
</div>
<div class="section" id="full-reference">
<h2>Full reference<a class="headerlink" href="#full-reference" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In construction</p>
</div>
<div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c"><div class="highlight"><pre><span class="cp">#include</span> <span class="cpf">&lt;triqs/det_manip/det_manip.hpp&gt;</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">fun</span> <span class="p">{</span>

  <span class="k">typedef</span> <span class="kt">double</span> <span class="n">result_type</span><span class="p">;</span>
  <span class="k">typedef</span> <span class="kt">double</span> <span class="n">argument_type</span><span class="p">;</span>

  <span class="kt">double</span> <span class="nf">operator</span><span class="p">()(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">double</span> <span class="n">pi</span>   <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">);</span>
    <span class="k">const</span> <span class="kt">double</span> <span class="n">beta</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">double</span> <span class="n">epsi</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">tau</span>        <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">s</span>            <span class="o">=</span> <span class="p">(</span><span class="n">tau</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">tau</span>               <span class="o">=</span> <span class="p">(</span><span class="n">s</span> <span class="o">?</span> <span class="nl">tau</span> <span class="p">:</span> <span class="n">beta</span> <span class="o">+</span> <span class="n">tau</span><span class="p">);</span>
    <span class="kt">double</span> <span class="n">r</span>          <span class="o">=</span> <span class="n">epsi</span> <span class="o">+</span> <span class="n">tau</span> <span class="o">/</span> <span class="n">beta</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">epsi</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="n">beta</span><span class="p">)</span> <span class="o">/</span> <span class="n">std</span><span class="o">::</span><span class="n">sin</span><span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="n">r</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>

  <span class="n">fun</span> <span class="n">f</span><span class="p">;</span>
  <span class="n">triqs</span><span class="o">::</span><span class="n">det_manip</span><span class="o">::</span><span class="n">det_manip</span><span class="o">&lt;</span><span class="n">fun</span><span class="o">&gt;</span> <span class="n">D</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

  <span class="c1">/// insertions of 3 lines and 3 columns</span>
  <span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mf">9.</span><span class="p">,</span> <span class="n">detratio</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">D</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">detratio</span> <span class="o">=</span> <span class="n">D</span><span class="p">.</span><span class="n">try_insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">D</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">D</span><span class="p">.</span><span class="n">complete_operation</span><span class="p">();</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">D</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">detratio</span> <span class="o">=</span> <span class="n">D</span><span class="p">.</span><span class="n">try_insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">);</span>
  <span class="n">D</span><span class="p">.</span><span class="n">complete_operation</span><span class="p">();</span>
  <span class="n">detratio</span> <span class="o">=</span> <span class="n">D</span><span class="p">.</span><span class="n">try_insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">);</span>
  <span class="n">D</span><span class="p">.</span><span class="n">complete_operation</span><span class="p">();</span>

  <span class="c1">/// removal of a line (the 3rd) and a column (the 2nd)</span>
  <span class="n">detratio</span> <span class="o">=</span> <span class="n">D</span><span class="p">.</span><span class="n">try_remove</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">D</span><span class="p">.</span><span class="n">complete_operation</span><span class="p">();</span>
<span class="p">}</span>
<span class="o">----------</span> <span class="n">Result</span> <span class="n">is</span> <span class="o">-------</span>
<span class="mi">0</span>
<span class="mi">0</span>
<span class="mi">1</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="implementation_notes.html" title="How does it work ?"
             >next</a> |</li>
        <li class="right" >
          <a href="contents.html" title="[triqs/det_manip] Manipulations of determinants"
             >previous</a> |</li>
    <li><a href="../../index.html">Home</a> &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../../reference.html" >Reference</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="contents.html" ><strong>[triqs/det_manip]</strong> Manipulations of determinants</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2011-2017, The TRIQS collaboration.
    </div>
  </body>
</html>
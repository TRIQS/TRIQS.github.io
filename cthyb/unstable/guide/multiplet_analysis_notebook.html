<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Multiplet analysis &amp; particle number histograms &mdash; TRIQS Hybridization Expansion Solver  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../_static/nbsphinx-code-cells.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/triqs_favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=default"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Dynamical spin-spin susceptibility \(\chi_{S_z S_z}(\tau)\)" href="dynamic_susceptibility_notebook.html" />
    <link rel="prev" title="Measuring static observables / impurity density matrix" href="static_observables_notebook.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #7E588A" >

          
          
          <a href="../index.html" class="icon icon-home">
            TRIQS Hybridization Expansion Solver
          </a>
              <div class="version">
                3.2.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Install CTHYB</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html#packaged-versions-of-cthyb">Packaged Versions of CTHyb</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../install.html#ubuntu-debian-packages">Ubuntu Debian packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#anaconda-experimental">Anaconda (experimental)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#docker">Docker</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#compiling-cthyb-from-source">Compiling CTHYB from source</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../install.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#installation-steps">Installation steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#version-compatibility">Version compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#custom-cmake-options">Custom CMake options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../documentation.html">Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#basic-notions">Basic notions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basicnotions/cthyb.html">A word on the algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basicnotions/moves.html">QMC moves</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/moves.html#insert-one-pair-of-operators">Insert one pair of operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/moves.html#remove-one-pair-of-operators">Remove one pair of operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/moves.html#insert-two-pairs-of-operators">Insert two pairs of operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/moves.html#remove-two-pairs-of-operators">Remove two pairs of operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/moves.html#shift-one-operator">Shift one operator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/moves.html#global-move-change-of-operator-indices">Global move - change of operator indices</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../basicnotions/measurements.html">Measurements: definitions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/measurements.html#green-s-function">Green’s function</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../basicnotions/measurements.html#imaginary-time">Imaginary time</a></li>
<li class="toctree-l5"><a class="reference internal" href="../basicnotions/measurements.html#legendre-polynomial-basis">Legendre polynomial basis</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/measurements.html#local-susceptibility-and-other-operator-pairs">Local susceptibility and other operator pairs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/measurements.html#two-particle-green-s-functions">Two-particle Green’s functions</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../basicnotions/measurements.html#imaginary-time-binning">Imaginary time binning</a></li>
<li class="toctree-l5"><a class="reference internal" href="../basicnotions/measurements.html#matsubara-frequency-measurements">Matsubara frequency measurements</a></li>
<li class="toctree-l5"><a class="reference internal" href="../basicnotions/measurements.html#mixed-matsubara-frequency-and-legendre-measurements">Mixed Matsubara Frequency and Legendre measurements</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/measurements.html#impurity-density-matrix">Impurity density matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/measurements.html#perturbation-order-histograms">Perturbation order histograms</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/measurements.html#average-sign">Average sign</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../documentation.html#user-guide">User guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="settingparameters.html">Setting the parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-1-construct-the-solver-instance">Step 1 - construct the solver instance</a><ul>
<li class="toctree-l5"><a class="reference internal" href="settingparameters.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-2-the-hamiltonian">Step 2 - the Hamiltonian</a><ul>
<li class="toctree-l5"><a class="reference internal" href="settingparameters.html#id1">Examples</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-3-the-monte-carlo-parameters">Step 3 - the Monte Carlo parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-6-legendre-or-not">Step 6 - Legendre or not?</a></li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-7-prepare-the-non-interacting-green-s-function">Step 7 - prepare the non-interacting Green’s function</a></li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-8-we-re-ready-to-go">Step 8 - we’re ready to go!</a></li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#final-step-analyze-the-output">Final Step - analyze the output</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="dmft.html">Building DMFT calculations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="dmft.html#plain-vanilla-dmft-the-bethe-lattice">Plain-vanilla DMFT: the Bethe lattice</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="random.html">Random number generators</a></li>
<li class="toctree-l3"><a class="reference internal" href="static_observables_notebook.html">Measuring static observables / impurity density matrix</a><ul>
<li class="toctree-l4"><a class="reference internal" href="static_observables_notebook.html#Measuring-\hat{\rho}_\mathrm{imp}-in-cthyb">Measuring <span class="math notranslate nohighlight">\(\hat{\rho}_\mathrm{imp}\)</span> in cthyb</a></li>
<li class="toctree-l4"><a class="reference internal" href="static_observables_notebook.html#Compute-expactation-values-of-static-observables">Compute expactation values of static observables</a></li>
<li class="toctree-l4"><a class="reference internal" href="static_observables_notebook.html#Measuring-moments-of-Green's-function-and-self-energy">Measuring moments of Green’s function and self-energy</a></li>
<li class="toctree-l4"><a class="reference internal" href="static_observables_notebook.html#Evaluation-of-the-impurity-interaction-energy">Evaluation of the impurity interaction energy</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Multiplet analysis &amp; particle number histograms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Analysis-of-results">Analysis of results</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#plot-particle-number-histogram">plot particle number histogram</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#More-complex-example">More complex example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="dynamic_susceptibility_notebook.html">Dynamical spin-spin susceptibility <span class="math notranslate nohighlight">\(\chi_{S_z S_z}(\tau)\)</span></a></li>
<li class="toctree-l3"><a class="reference internal" href="perturbation_order_notebook.html">Perturbation order histograms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="perturbation_order_notebook.html#Plotting-perturbation-order-histograms">Plotting perturbation order histograms</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#tutorials">Tutorials</a><ul>
<li class="toctree-l3"><a class="reference internal" href="aim.html">The Anderson impurity model</a></li>
<li class="toctree-l3"><a class="reference internal" href="slater_five_band.html">Multiorbital impurity model</a></li>
<li class="toctree-l3"><a class="reference internal" href="cthyb_convergence_tests.html">Convergence test of CTHYB solver parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cthyb_convergence_tests.html#Overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="cthyb_convergence_tests.html#1.-length_cycle">1. length_cycle</a></li>
<li class="toctree-l4"><a class="reference internal" href="cthyb_convergence_tests.html#2.-n_warmup_cycles">2. n_warmup_cycles</a></li>
<li class="toctree-l4"><a class="reference internal" href="cthyb_convergence_tests.html#3.-n_cycles">3. n_cycles</a></li>
<li class="toctree-l4"><a class="reference internal" href="cthyb_convergence_tests.html#4.-n_iw">4. n_iw</a></li>
<li class="toctree-l4"><a class="reference internal" href="cthyb_convergence_tests.html#5.-n_l">5. n_l</a></li>
<li class="toctree-l4"><a class="reference internal" href="cthyb_convergence_tests.html#6.-n_tau">6. n_tau</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="high_freq_moments.html">High Frequency Moments of the Green’s Functions and Self-energy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="high_freq_moments.html#Derivation">Derivation</a></li>
<li class="toctree-l4"><a class="reference internal" href="high_freq_moments.html#Implentation-in-TRIQS/cthyb">Implentation in TRIQS/cthyb</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#reference-manual">Reference manual</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../_ref/triqs_cthyb.multiplet_tools.html">triqs_cthyb.multiplet_tools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.multiplet_tools.multiplet_analysis.html">triqs_cthyb.multiplet_tools.multiplet_analysis</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.multiplet_tools.multiplet_analysis.html#triqs_cthyb.multiplet_tools.multiplet_analysis"><code class="docutils literal notranslate"><span class="pre">multiplet_analysis()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_ref/triqs_cthyb.solver.html">triqs_cthyb.solver</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.html">triqs_cthyb.solver.Solver</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.html#triqs_cthyb.solver.Solver"><code class="docutils literal notranslate"><span class="pre">Solver</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.__init__.html">triqs_cthyb.solver.Solver.__init__</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.solve.html">triqs_cthyb.solver.Solver.solve</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.Delta_infty.html">triqs_cthyb.solver.Solver.Delta_infty</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.Delta_tau.html">triqs_cthyb.solver.Solver.Delta_tau</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G0_iw.html">triqs_cthyb.solver.Solver.G0_iw</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iw.html">triqs_cthyb.solver.Solver.G2_iw</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iw_nfft.html">triqs_cthyb.solver.Solver.G2_iw_nfft</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iw_ph.html">triqs_cthyb.solver.Solver.G2_iw_ph</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iw_ph_nfft.html">triqs_cthyb.solver.Solver.G2_iw_ph_nfft</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iw_pp.html">triqs_cthyb.solver.Solver.G2_iw_pp</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iw_pp_nfft.html">triqs_cthyb.solver.Solver.G2_iw_pp_nfft</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iwll_ph.html">triqs_cthyb.solver.Solver.G2_iwll_ph</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iwll_pp.html">triqs_cthyb.solver.Solver.G2_iwll_pp</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_tau.html">triqs_cthyb.solver.Solver.G2_tau</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G_l.html">triqs_cthyb.solver.Solver.G_l</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G_tau.html">triqs_cthyb.solver.Solver.G_tau</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G_tau_accum.html">triqs_cthyb.solver.Solver.G_tau_accum</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.O_tau.html">triqs_cthyb.solver.Solver.O_tau</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.asymmetry_G_tau.html">triqs_cthyb.solver.Solver.asymmetry_G_tau</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.auto_corr_time.html">triqs_cthyb.solver.Solver.auto_corr_time</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.average_order.html">triqs_cthyb.solver.Solver.average_order</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.average_sign.html">triqs_cthyb.solver.Solver.average_sign</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.constr_parameters.html">triqs_cthyb.solver.Solver.constr_parameters</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.density_matrix.html">triqs_cthyb.solver.Solver.density_matrix</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.h_loc.html">triqs_cthyb.solver.Solver.h_loc</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.h_loc0.html">triqs_cthyb.solver.Solver.h_loc0</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.h_loc_diagonalization.html">triqs_cthyb.solver.Solver.h_loc_diagonalization</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.hybridisation_is_complex.html">triqs_cthyb.solver.Solver.hybridisation_is_complex</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.last_constr_parameters.html">triqs_cthyb.solver.Solver.last_constr_parameters</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.last_solve_parameters.html">triqs_cthyb.solver.Solver.last_solve_parameters</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.local_hamiltonian_is_complex.html">triqs_cthyb.solver.Solver.local_hamiltonian_is_complex</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.performance_analysis.html">triqs_cthyb.solver.Solver.performance_analysis</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.perturbation_order.html">triqs_cthyb.solver.Solver.perturbation_order</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.perturbation_order_total.html">triqs_cthyb.solver.Solver.perturbation_order_total</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.solve_parameters.html">triqs_cthyb.solver.Solver.solve_parameters</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.solve_status.html">triqs_cthyb.solver.Solver.solve_status</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_ref/triqs_cthyb.tail_fit.html">triqs_cthyb.tail_fit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.tail_fit.green_high_frequency_moments.html">triqs_cthyb.tail_fit.green_high_frequency_moments</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.tail_fit.green_high_frequency_moments.html#triqs_cthyb.tail_fit.green_high_frequency_moments"><code class="docutils literal notranslate"><span class="pre">green_high_frequency_moments()</span></code></a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.tail_fit.sigma_high_frequency_moments.html">triqs_cthyb.tail_fit.sigma_high_frequency_moments</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.tail_fit.sigma_high_frequency_moments.html#triqs_cthyb.tail_fit.sigma_high_frequency_moments"><code class="docutils literal notranslate"><span class="pre">sigma_high_frequency_moments()</span></code></a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.tail_fit.tail_fit.html">triqs_cthyb.tail_fit.tail_fit</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.tail_fit.tail_fit.html#triqs_cthyb.tail_fit.tail_fit"><code class="docutils literal notranslate"><span class="pre">tail_fit()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_ref/triqs_cthyb.util.html">triqs_cthyb.util</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.util.block_size_from_gf_struct.html">triqs_cthyb.util.block_size_from_gf_struct</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.util.block_size_from_gf_struct.html#triqs_cthyb.util.block_size_from_gf_struct"><code class="docutils literal notranslate"><span class="pre">block_size_from_gf_struct()</span></code></a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.util.estimate_nfft_buf_size.html">triqs_cthyb.util.estimate_nfft_buf_size</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.util.estimate_nfft_buf_size.html#triqs_cthyb.util.estimate_nfft_buf_size"><code class="docutils literal notranslate"><span class="pre">estimate_nfft_buf_size()</span></code></a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.util.orbital_occupations.html">triqs_cthyb.util.orbital_occupations</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.util.orbital_occupations.html#triqs_cthyb.util.orbital_occupations"><code class="docutils literal notranslate"><span class="pre">orbital_occupations()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.solve_parameters.html">triqs_cthyb.solver.Solver.solve_parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.solve_parameters.html#triqs_cthyb.solver.Solver.solve_parameters"><code class="docutils literal notranslate"><span class="pre">Solver.solve_parameters</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.constr_parameters.html">triqs_cthyb.solver.Solver.constr_parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.constr_parameters.html#triqs_cthyb.solver.Solver.constr_parameters"><code class="docutils literal notranslate"><span class="pre">Solver.constr_parameters</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#faqs">FAQs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../faqs.html">Frequently-asked questions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../faqs.html#q-why-is-my-code-running-so-slowly">Q: Why is my code running so slowly?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs.html#q-how-do-i-save-the-triqs-and-cthyb-hash-and-script-for-debugging-purposes">Q: How do I save the triqs and cthyb hash and script for debugging purposes?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs.html#q-why-does-my-data-look-so-noisy">Q: Why does my data look so noisy?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs.html#q-how-do-i-use-the-segment-picture">Q: How do I use the segment picture?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ChangeLog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-2-1">Version 3.2.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#general">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#doc">doc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#jenkins">jenkins</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-2-0">Version 3.2.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id2">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id3">doc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#fix">fix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-1-1">Version 3.1.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id4">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id5">Doc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#numpy">Numpy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-1-0">Version 3.1.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#delta-interface">Delta Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id6">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id7">jenkins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id8">doc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#cmake">cmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#gh-actions">gh-actions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-0-0">Version 3.0.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#fundamental-green-function-symmetries">Fundamental Green Function Symmetries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#dependency-management">Dependency Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#other-changes">Other Changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-2-1">Version 2.2.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id9">doc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id10">General</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-2-0">Version 2.2.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id11">cmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id12">doc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id13">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#h5">h5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#packaging">packaging</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-1-0">Version 2.1.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#contributors">Contributors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#testers">Testers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#changes-in-installation-and-cmake-files">Changes in installation and cmake files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#solver-interface">Solver Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#changes-in-behavior">Changes in behavior</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#dependencies">Dependencies</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">Authors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about.html#citation">Citation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#license">License</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#disclaimer">Disclaimer</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #7E588A" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">TRIQS Hybridization Expansion Solver</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../documentation.html">Documentation</a></li>
      <li class="breadcrumb-item active">Multiplet analysis &amp; particle number histograms</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/guide/multiplet_analysis_notebook.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Multiplet-analysis-&amp;-particle-number-histograms">
<h1>Multiplet analysis &amp; particle number histograms<a class="headerlink" href="#Multiplet-analysis-&-particle-number-histograms" title="Link to this heading"></a></h1>
<p>Utilizing the cthyb functionality to measure the <a class="reference external" href="https://triqs.github.io/cthyb/unstable/guide/static_observables_notebook.html" rel="noopener noreferrer" target="_blank">many body density matrix</a>, it is possible to analyze the multiplet structure of the impurity states, e.g. occupation probabilities of eigenstates, find the associated particle number, and obtaining the spin state of those eigenstates. In principle all observables can be examined that are good quantum numbers of the system. More information of the measurement of the
density matrix in cthyb can be found here: <a class="reference external" href="https://triqs.github.io/cthyb/unstable/guide/static_observables_notebook.html" rel="noopener noreferrer" target="_blank">cthyb measure static observables</a>.</p>
<p>This tutorial will demonstrate, based on the above mentioned <a class="reference external" href="https://triqs.github.io/cthyb/unstable/guide/static_observables_notebook.html" rel="noopener noreferrer" target="_blank">tutorial</a>, how to analyze the multiplet structure from a measured density matrix and the <code class="docutils literal notranslate"><span class="pre">h_loc_diag</span></code> object of the solver. For more information on how to measure those properties please take a look first <a class="reference external" href="https://triqs.github.io/cthyb/unstable/guide/static_observables_notebook.html" rel="noopener noreferrer" target="_blank">here</a>. This tutorial will not give the reader a full introduction
to the physical background of the discussed matter, it is more designed for someone who is already familiar with the matter itself, seeking for a guide on how to perform such analysis with triqs.</p>
<p>Let us consider a single-orbital Anderson impurity problem. At first, we import all necessary modules, define some input parameters and construct a cthyb Solver object in the usual way:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">h5</span> <span class="kn">import</span> <span class="n">HDFArchive</span>
<span class="kn">from</span> <span class="nn">triqs.gf.descriptors</span> <span class="kn">import</span> <span class="n">Fourier</span>
<span class="kn">from</span> <span class="nn">triqs.gf</span> <span class="kn">import</span> <span class="n">Gf</span><span class="p">,</span> <span class="n">MeshImFreq</span><span class="p">,</span> <span class="n">iOmega_n</span><span class="p">,</span> <span class="n">inverse</span><span class="p">,</span> <span class="n">GfImTime</span><span class="p">,</span> <span class="n">BlockGf</span><span class="p">,</span> <span class="n">Wilson</span>
<span class="kn">from</span> <span class="nn">triqs.operators</span> <span class="kn">import</span> <span class="n">c</span><span class="p">,</span> <span class="n">c_dag</span><span class="p">,</span> <span class="n">n</span>

<span class="c1"># redirect cthyb c++ output to notebook</span>
<span class="kn">from</span> <span class="nn">triqs.utility.redirect</span> <span class="kn">import</span> <span class="n">start_redirect</span>
<span class="n">start_redirect</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">triqs_cthyb.solver</span> <span class="kn">import</span> <span class="n">Solver</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Starting run with 1 MPI rank(s) at : 2020-09-18 07:57:58.642240
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters</span>
<span class="n">D</span> <span class="o">=</span> <span class="mf">1.0</span>         <span class="c1"># Half-bandwidth of the bath</span>
<span class="n">V</span> <span class="o">=</span> <span class="mf">0.4</span>         <span class="c1"># Hybridisation amplitude</span>
<span class="n">U</span> <span class="o">=</span> <span class="mf">4.0</span>         <span class="c1"># Coulomb interaction</span>
<span class="n">e_f</span> <span class="o">=</span> <span class="o">-</span><span class="n">U</span><span class="o">/</span><span class="mi">2</span>      <span class="c1"># Local energy level</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span>       <span class="c1"># Inverse temperature</span>

<span class="c1"># Construct the impurity solver with the inverse temperature</span>
<span class="c1"># and the structure of the Green&#39;s functions</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">(</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gf_struct</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,[</span><span class="mi">0</span><span class="p">])</span> <span class="p">])</span>

<span class="c1"># Initialize the non-interacting Green&#39;s function S.G0_iw</span>
<span class="n">S</span><span class="o">.</span><span class="n">G0_iw</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">]</span>   <span class="o">&lt;&lt;</span> <span class="n">inverse</span><span class="p">(</span><span class="n">iOmega_n</span> <span class="o">-</span> <span class="n">e_f</span> <span class="o">-</span> <span class="n">V</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Wilson</span><span class="p">(</span><span class="n">D</span><span class="p">))</span>
<span class="n">S</span><span class="o">.</span><span class="n">G0_iw</span><span class="p">[</span><span class="s1">&#39;down&#39;</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">inverse</span><span class="p">(</span><span class="n">iOmega_n</span> <span class="o">-</span> <span class="n">e_f</span> <span class="o">-</span> <span class="n">V</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Wilson</span><span class="p">(</span><span class="n">D</span><span class="p">))</span>

<span class="c1"># setting up a local interaction Hamiltonian</span>
<span class="n">h_int</span> <span class="o">=</span> <span class="n">U</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Next, we instruct the <code class="docutils literal notranslate"><span class="pre">solve</span></code> function to accumulate the density matrix by passing the solver parameters <code class="docutils literal notranslate"><span class="pre">measure_density_matrix</span> <span class="pre">=</span> <span class="pre">True</span></code> and <code class="docutils literal notranslate"><span class="pre">use_norm_as_weight</span> <span class="pre">=</span> <span class="pre">True</span></code>. See also <a class="reference external" href="https://triqs.github.io/cthyb/latest/reference/solve_parameters.html" rel="noopener noreferrer" target="_blank">cthyb solver parameters</a> for more information.</p>
<p>Now we run the solver:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run the solver</span>
<span class="n">S</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">h_int</span> <span class="o">=</span> <span class="n">h_int</span><span class="p">,</span>                  <span class="c1"># interaction Hamiltonian</span>
        <span class="n">n_cycles</span>  <span class="o">=</span> <span class="mi">500000</span><span class="p">,</span>             <span class="c1"># Number of QMC cycles</span>
        <span class="n">length_cycle</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>             <span class="c1"># Length of one cycle</span>
        <span class="n">n_warmup_cycles</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>        <span class="c1"># Warmup cycles</span>
        <span class="n">measure_density_matrix</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># Measure the reduced density matrix</span>
        <span class="n">use_norm_as_weight</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>      <span class="c1"># Required to measure the density matrix</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

╔╦╗╦═╗╦╔═╗ ╔═╗  ┌─┐┌┬┐┬ ┬┬ ┬┌┐
 ║ ╠╦╝║║═╬╗╚═╗  │   │ ├─┤└┬┘├┴┐
 ╩ ╩╚═╩╚═╝╚╚═╝  └─┘ ┴ ┴ ┴ ┴ └─┘

The local Hamiltonian of the problem:
-2*c_dag(&#39;down&#39;,0)*c(&#39;down&#39;,0) + -2*c_dag(&#39;up&#39;,0)*c(&#39;up&#39;,0) + 4*c_dag(&#39;down&#39;,0)*c_dag(&#39;up&#39;,0)*c(&#39;up&#39;,0)*c(&#39;down&#39;,0)
Using autopartition algorithm to partition the local Hilbert space
Found 4 subspaces.

Warming up ...
07:57:58  12% ETA 00:00:00 cycle 1279 of 10000



Accumulating ...
07:57:59   0% ETA 00:00:30 cycle 1620 of 500000
07:58:01   6% ETA 00:00:31 cycle 31153 of 500000
07:58:04  14% ETA 00:00:27 cycle 72956 of 500000
07:58:07  24% ETA 00:00:23 cycle 124185 of 500000
07:58:11  37% ETA 00:00:19 cycle 189226 of 500000
07:58:16  54% ETA 00:00:14 cycle 270958 of 500000
07:58:22  73% ETA 00:00:08 cycle 365660 of 500000
07:58:30  98% ETA 00:00:00 cycle 490624 of 500000


[Rank 0] Collect results: Waiting for all mpi-threads to finish accumulating...
[Rank 0] Timings for all measures:
Measure                                    | seconds
Average sign                               | 0.0188487
Density Matrix for local static observable | 0.171204
G_tau measure                              | 0.0382508
Total measure time                         | 0.228303
[Rank 0] Acceptance rate for all moves:
Move set Insert two operators: 0.0767329
  Move  Insert Delta_up: 0.0767082
  Move  Insert Delta_down: 0.0767575
Move set Remove two operators: 0.0767529
  Move  Remove Delta_up: 0.076729
  Move  Remove Delta_down: 0.0767768
Move set Insert four operators: 0.0018322
  Move  Insert Delta_up_up: 0.000226071
  Move  Insert Delta_up_down: 0.00346066
  Move  Insert Delta_down_up: 0.00341485
  Move  Insert Delta_down_down: 0.000228812
Move set Remove four operators: 0.00182204
  Move  Remove Delta_up_up: 0.00023108
  Move  Remove Delta_up_down: 0.00338986
  Move  Remove Delta_down_up: 0.00344724
  Move  Remove Delta_down_down: 0.000219039
Move  Shift one operator: 0.130805
[Rank 0] Warmup lasted: 0.654128 seconds [00:00:00]
[Rank 0] Simulation lasted: 31.2514 seconds [00:00:31]
[Rank 0] Number of measures: 500000
Total number of measures: 500000
Average sign: 1
</pre></div></div>
</div>
<section id="Analysis-of-results">
<h2>Analysis of results<a class="headerlink" href="#Analysis-of-results" title="Link to this heading"></a></h2>
<p>Next we do the actual analysis of the multiplet structure. First we need to setup the operators, that we want to measure:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">triqs.operators.util</span> <span class="kn">import</span> <span class="n">make_operator_real</span>
<span class="kn">from</span> <span class="nn">triqs.operators.util.observables</span> <span class="kn">import</span> <span class="n">S_op</span><span class="p">,</span> <span class="n">S2_op</span>
<span class="kn">from</span> <span class="nn">triqs.atom_diag</span> <span class="kn">import</span> <span class="n">quantum_number_eigenvalues</span>
</pre></div>
</div>
</div>
<p>Here, we are going to take a look at <span class="math notranslate nohighlight">\(S_z, \ S^2,\)</span> and <span class="math notranslate nohighlight">\(N\)</span>. The two central objects we need for the analysis are:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># accumulated many body density matrix</span>
<span class="n">rho</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">density_matrix</span>
<span class="c1"># the atom diag object containing information about the H_loc entering the solver</span>
<span class="n">h_loc_diag</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">h_loc_diagonalization</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">rho</span></code> is the many body density matrix, which stores the occupation probability for each eigenstate of the impurity Hamiltonian, and <code class="docutils literal notranslate"><span class="pre">h_loc_diag</span></code> contains information about the impurity Hamiltonian, e.g. eigenstates, eigenvalues, Fock states …</p>
<p>To evaluate the expectation values of <span class="math notranslate nohighlight">\(S_z, \ S^2,\)</span> and <span class="math notranslate nohighlight">\(N\)</span> values we first create the operators:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># first get fundamental operators of H_loc from atom_diag object</span>
<span class="n">occ_operators</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="p">(</span><span class="o">*</span><span class="n">op</span><span class="p">)</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">h_loc_diag</span><span class="o">.</span><span class="n">fops</span><span class="p">]</span>

<span class="c1"># construct total occupation operator from list</span>
<span class="n">N_op</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">occ_operators</span><span class="p">)</span>

<span class="c1"># create S2 and Sz operator</span>
<span class="n">spin_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;down&#39;</span><span class="p">]</span>
<span class="n">orb_names</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># The spin operators are created from orbital and spin names</span>
<span class="c1"># the flag off_diag determines if blocks of Gf are down_0 / up_0 ,</span>
<span class="c1"># or down / up</span>
<span class="n">S2</span> <span class="o">=</span> <span class="n">S2_op</span><span class="p">(</span><span class="n">spin_names</span><span class="p">,</span> <span class="n">orb_names</span><span class="p">,</span> <span class="n">off_diag</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">Sz</span><span class="o">=</span><span class="n">S_op</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">spin_names</span><span class="p">,</span> <span class="n">orb_names</span><span class="p">,</span> <span class="n">off_diag</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Next we evaluate the operators in the impurity eigenstates by using the <a class="reference external" href="https://triqs.github.io/triqs/latest/documentation/manual/triqs/atom_diag/contents.html" rel="noopener noreferrer" target="_blank">triqs.atom_diag</a> function <a class="reference external" href="https://triqs.github.io/triqs/latest/documentation/cpp_api/triqs/atom_diag/quantum_number_eigenvalues.html" rel="noopener noreferrer" target="_blank">quantum_number_eigenvalues</a>. The object will be sorted by the subspaces contained in h_loc_diag:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get eigenvalues of S2 and Sz</span>
<span class="n">S2_states</span> <span class="o">=</span> <span class="n">quantum_number_eigenvalues</span><span class="p">(</span><span class="n">S2</span><span class="p">,</span> <span class="n">h_loc_diag</span><span class="p">)</span>
<span class="n">Sz_states</span> <span class="o">=</span> <span class="n">quantum_number_eigenvalues</span><span class="p">(</span><span class="n">Sz</span><span class="p">,</span> <span class="n">h_loc_diag</span><span class="p">)</span>

<span class="c1"># get particle numbers from h_loc_diag</span>
<span class="n">particle_numbers</span> <span class="o">=</span> <span class="n">quantum_number_eigenvalues</span><span class="p">(</span><span class="n">N_op</span><span class="p">,</span> <span class="n">h_loc_diag</span><span class="p">)</span>
<span class="n">N_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">max</span><span class="p">,</span> <span class="n">particle_numbers</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">particle_numbers</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[array([1.]), array([1.]), array([0.]), array([2.])]
</pre></div></div>
</div>
<p>One can see, that <code class="docutils literal notranslate"><span class="pre">particle_numbers</span></code> contains now 4 numpy arrays, representing the 4 subspaces of the impurity problem. Those are actually identified by different particle numbers <span class="math notranslate nohighlight">\(0,1,\)</span> and <span class="math notranslate nohighlight">\(2\)</span>. Each array has the size of number of eigenstates in that particular subspace.</p>
<p>Now we construct the eigenstates for each eigenvalue of <code class="docutils literal notranslate"><span class="pre">h_loc_diag</span></code> in their corresponding subspace, which can be also labeled by the quantum numbers that we just extracted. Finally, <code class="docutils literal notranslate"><span class="pre">rho</span></code> will contain the actual probability that this eigenstate is occupied:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">multiplet_occ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># we loop through all subspaces, which are just indexed as integers</span>
<span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">h_loc_diag</span><span class="o">.</span><span class="n">n_subspaces</span><span class="p">):</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;subspace No.:&quot;</span><span class="p">,</span> <span class="n">sub</span><span class="p">)</span>

    <span class="c1"># first get Fock space spanning the subspace</span>
    <span class="n">fs_states</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">fs</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">h_loc_diag</span><span class="o">.</span><span class="n">fock_states</span><span class="p">[</span><span class="n">sub</span><span class="p">]):</span>
        <span class="c1"># get state in binary representation</span>
        <span class="n">state</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">fs</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">N_max</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span>
        <span class="n">fs_states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="o">+</span><span class="n">state</span><span class="o">+</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)</span>

    <span class="c1"># now we loop over all eigenstates within the subspace</span>
    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h_loc_diag</span><span class="o">.</span><span class="n">get_subspace_dim</span><span class="p">(</span><span class="n">sub</span><span class="p">)):</span>

        <span class="c1"># get particle number</span>
        <span class="c1"># carefully here to not cast to int as the particle number</span>
        <span class="c1"># can be something like 1.999999996 and would get then 1!</span>
        <span class="n">particle_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">particle_numbers</span><span class="p">[</span><span class="n">sub</span><span class="p">][</span><span class="n">ind</span><span class="p">]))</span>
        <span class="c1"># here you can see that the object obtained from quantum_number_eigenvalues</span>
        <span class="c1"># is structured in the same way as h_loc_diag</span>

        <span class="c1"># get spin operator values in the same way</span>
        <span class="n">ms</span><span class="o">=</span><span class="n">Sz_states</span><span class="p">[</span><span class="n">sub</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span>
        <span class="n">s_square</span><span class="o">=</span><span class="n">S2_states</span><span class="p">[</span><span class="n">sub</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span>

        <span class="c1"># energy of state</span>
        <span class="n">eng</span><span class="o">=</span><span class="n">h_loc_diag</span><span class="o">.</span><span class="n">energies</span><span class="p">[</span><span class="n">sub</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span>

        <span class="c1"># probability that this state is occupied is obtained from rho</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="n">rho</span><span class="p">[</span><span class="n">sub</span><span class="p">][</span><span class="n">ind</span><span class="p">,</span><span class="n">ind</span><span class="p">]</span>

        <span class="c1"># add to multiplet histogram sorted by particle number</span>
        <span class="n">multiplet_occ</span><span class="p">[</span><span class="n">particle_number</span><span class="p">]</span> <span class="o">+=</span> <span class="n">prob</span>

        <span class="c1"># construct eigenvector in Fock state basis by rotation</span>
        <span class="n">ev_state</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">h_loc_diag</span><span class="o">.</span><span class="n">unitary_matrices</span><span class="p">[</span><span class="n">sub</span><span class="p">][:,</span><span class="n">ind</span><span class="p">]):</span>
            <span class="n">ev_state</span> <span class="o">+=</span> <span class="s1">&#39; </span><span class="si">{:+1.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="o">+</span><span class="n">fs_states</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># print info obtained</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;EV No:&quot;</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span>
              <span class="s2">&quot;, N=&quot;</span><span class="p">,</span><span class="n">particle_number</span><span class="p">,</span>
              <span class="s2">&quot;, E=&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:1.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eng</span><span class="p">)</span> <span class="p">,</span>
              <span class="s2">&quot;, prob:&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:1.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prob</span><span class="p">),</span>
              <span class="s2">&quot;, S(S+1): &quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:1.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s_square</span><span class="p">),</span>
              <span class="s2">&quot;, ms: &quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:1.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ms</span><span class="p">),</span>
              <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2"> eigenstate:&quot;</span><span class="p">,</span> <span class="n">ev_state</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;multiplet occupation by particle number: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">multiplet_occ</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sum of multiplet occ: &#39;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:1.5f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">multiplet_occ</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
subspace No.: 0
EV No: 0 , N= 1 , E=0.00000 , prob:0.43381 , S(S+1): 0.75 , ms: 0.50 ,
 eigenstate:  +1.0000|01&gt;
----
subspace No.: 1
EV No: 0 , N= 1 , E=0.00000 , prob:0.43393 , S(S+1): 0.75 , ms: -0.50 ,
 eigenstate:  +1.0000|10&gt;
----
subspace No.: 2
EV No: 0 , N= 0 , E=2.00000 , prob:0.06625 , S(S+1): 0.00 , ms: 0.00 ,
 eigenstate:  +1.0000|00&gt;
----
subspace No.: 3
EV No: 0 , N= 2 , E=2.00000 , prob:0.06601 , S(S+1): 0.00 , ms: 0.00 ,
 eigenstate:  +1.0000|11&gt;
----
multiplet occupation by particle number:
 [0.06624796 0.86774326 0.06600878]
sum of multiplet occ: 1.00000
</pre></div></div>
</div>
<p>It can be observed that the main contribution is coming from eigenstates with <span class="math notranslate nohighlight">\(N=1\)</span> with <span class="math notranslate nohighlight">\(m_s=\pm 0.5\)</span> as expected, and that the Fock states are the eigenvectors of the impurity system. The order of the orbitals in the Fock states is given by the order of operators in <code class="docutils literal notranslate"><span class="pre">h_loc_diag.fops</span></code> starting from the right site, with the first half representing one spin-channel and the second half representing the other spin-channel. Note, that in general each eigenstate can be a linear
combination of Fock states. This can be important in sub-spaces with dimension <span class="math notranslate nohighlight">\(&gt;1\)</span>, when manually using the information stored in <code class="docutils literal notranslate"><span class="pre">rho</span></code>.</p>
<p>The occupations can now be ploted has histogram.</p>
<section id="plot-particle-number-histogram">
<h3>plot particle number histogram<a class="headerlink" href="#plot-particle-number-histogram" title="Link to this heading"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">multiplet_occ</span><span class="p">))</span> <span class="p">,</span><span class="n">multiplet_occ</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>


<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;N&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;prob amplitude&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">multiplet_occ</span><span class="p">))))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/guide_multiplet_analysis_notebook_19_0.svg" src="../_images/guide_multiplet_analysis_notebook_19_0.svg" /></div>
</div>
<p>It can be observed, that due to the high temperature of <span class="math notranslate nohighlight">\(\beta=1\)</span> the two excited states are slightly populated, but the <span class="math notranslate nohighlight">\(N=1\)</span> states have the highest occupation probability.</p>
</section>
</section>
<section id="More-complex-example">
<h2>More complex example<a class="headerlink" href="#More-complex-example" title="Link to this heading"></a></h2>
<p>The previous example was quite simple. We also provide a function doing the analysis with a few extra checks, storing the result as <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html" rel="noopener noreferrer" target="_blank">Pandas DataFrame</a>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.width&#39;</span><span class="p">,</span> <span class="mi">130</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">triqs_cthyb.multiplet_tools</span> <span class="kn">import</span> <span class="n">multiplet_analysis</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">multiplet_analysis</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

    Computes operator expectation values from measured
    density matrix and h_loc_diag object from cthyb solver.

    Measures N, Sz, S(S+1), constructs eigenstates in Fock state
    basis, assigns the according probabilities from rho for all
    impurity eigenstates, and stores the data in a Panda DataFrame.
    For more information check the guide in the documentation of cthyb
    regarding `Multiplet analysis &amp; particle number histograms`.

    Warning: function assumes that N, Sz, and S(S+1) are good
    quantum numbers, labeling the eigenstates of the system.

    Parameters
    ----------
    rho : numpy array
        measured density matrix from cthyb or equivalent solver, structured in subspaces
    h_loc_diag: triqs atom_diag object
        contains information about the local Hamiltonian (Hloc_0 + H_int)
    orb_names : list of int
        list of orbital indices
    spin_names : list of string
        list of strings containing the spin channel names
    off_diag: boolean
        determines whether blocks of Gf are named up_0 (false) or just up (true)

    Returns:
    --------
    res : Panda DataFrame
        containing all results structured

</pre></div></div>
</div>
<p>Now we can use this function to analyze a stored result from a realistic five orbital calculation with an occupation of ~8.5 electrons:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="s1">&#39;density_matrix_example.h5&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ar</span><span class="p">:</span>
    <span class="n">rho_5orb</span> <span class="o">=</span> <span class="n">ar</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span>
    <span class="n">h_loc_diag_5orb</span> <span class="o">=</span> <span class="n">ar</span><span class="p">[</span><span class="s1">&#39;h_loc_diag&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Calling the function does the whole analysis at once:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_5orb</span> <span class="o">=</span> <span class="n">multiplet_analysis</span><span class="p">(</span><span class="n">rho</span> <span class="o">=</span> <span class="n">rho_5orb</span><span class="p">,</span>
                             <span class="n">h_loc_diag</span> <span class="o">=</span> <span class="n">h_loc_diag_5orb</span><span class="p">,</span>
                             <span class="c1"># five orbitals</span>
                             <span class="n">orb_names</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
                             <span class="c1"># two spin channels</span>
                             <span class="n">spin_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="s1">&#39;down&#39;</span><span class="p">],</span>
                             <span class="c1"># and no off-diag elements have been used in the solver</span>
                             <span class="n">off_diag</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>print the 15 eigenstates with highest occupation probability</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">res_5orb</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;prob&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="mi">15</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
    Sub#  EV#   N    energy      prob    S2  m_s  |m_s|                                              state
3      1    1   9  0.144618  0.185854  0.75  0.5    0.5            +1.0000|1111111101&gt; +0.0000|1111111110&gt;
1      0    1   9  0.144618  0.185387  0.75 -0.5    0.5            +1.0000|1110111111&gt; +0.0000|1111011111&gt;
12     4    0   8  0.048852  0.063419  2.00  1.0    1.0                                +1.0000|1111111100&gt;
4      2    0   8  0.048852  0.063355  2.00 -0.0    0.0   -0.0000|0111101111&gt; -0.0000|1011110111&gt; +0.00...
11     3    0   8  0.048852  0.063293  2.00 -1.0    1.0                                +1.0000|1110011111&gt;
55    20    0  10  6.036870  0.043536  0.00  0.0    0.0                                +1.0000|1111111111&gt;
0      0    0   9  0.000000  0.042266  0.75 -0.5    0.5            +0.0000|1110111111&gt; +1.0000|1111011111&gt;
2      1    0   9  0.000000  0.042165  0.75  0.5    0.5            +0.0000|1111111101&gt; +1.0000|1111111110&gt;
5      2    1   8  1.190955  0.034021  0.00 -0.0    0.0   -0.2346|0111101111&gt; -0.2346|1011110111&gt; +0.00...
6      2    2   8  1.206474  0.030471  0.00 -0.0    0.0   +0.0686|0111101111&gt; -0.0686|1011110111&gt; -0.19...
7      2    3   8  1.832629  0.023962  0.00 -0.0    0.0   +0.4135|0111101111&gt; -0.4135|1011110111&gt; +0.04...
38    14    0   8  0.382981  0.008635  2.00  1.0    1.0   -0.8096|1111101101&gt; -0.5841|1111101110&gt; -0.05...
35    13    0   8  0.382981  0.008633  2.00  1.0    1.0   +0.0581|1111101011&gt; +0.8096|1111110101&gt; -0.58...
23    11    0   8  0.382981  0.008632  2.00 -0.0    0.0   -0.0411|0111111011&gt; -0.5725|1011111101&gt; +0.41...
29    12    0   8  0.382981  0.008625  2.00  0.0    0.0   +0.5725|0111111101&gt; +0.4130|0111111110&gt; +0.04...
</pre></div></div>
</div>
<p>This shows a nice representation of the top occupied eigenstates and their quantum numbers.</p>
<p>A side note: as earlier mentioned, one can see that the eigenstates are linear combinations of Fock states here. This becomes important when for example analyzing the occupation of a single orbital in that given subspace. Let’s assume we want to know what the probability is of the first orbital to be occupied in the <span class="math notranslate nohighlight">\(N=8\)</span> particle sector. To obtain the result one needs to evaluate <span class="math notranslate nohighlight">\(Tr(\rho n_0)\)</span> in the given subspace. <span class="math notranslate nohighlight">\(n_0\)</span> is diagonal in the Fock basis, but it is not
necessarily diagonal in the eigenbasis of the system. Therefore, one needs to first rotate <span class="math notranslate nohighlight">\(\rho\)</span> into the Fock basis: <span class="math notranslate nohighlight">\(U \cdot \rho \cdot U^\dagger\)</span>, with <span class="math notranslate nohighlight">\(U\)</span> beeing <code class="docutils literal notranslate"><span class="pre">h_loc_diag.unitary_matrices[sub]</span></code>, and then one can obtain the occupation probability of this orbital from the diagonal elements of <span class="math notranslate nohighlight">\(\rho\)</span> in the Fock basis.</p>
<p>The results obtained from the multiplet analysis can now be easily accessed for further post-processing. For example the occupation probabilities per particle number are obtained by running the command:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">res_5orb</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;N&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()[</span><span class="s1">&#39;prob&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
N
0     0.000000e+00
1     0.000000e+00
2     0.000000e+00
3     0.000000e+00
4     9.937759e-08
5     2.319210e-05
6     1.790289e-03
7     5.183764e-02
8     4.129959e-01
9     4.898165e-01
10    4.353634e-02
Name: prob, dtype: float64
</pre></div></div>
</div>
<p>Plotting the data is also achieved in similar ways. Here, we plot the particle number histogram, as well as the particle number histogram resolved by spin state:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="n">mult_occ_5orb</span> <span class="o">=</span> <span class="n">res_5orb</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;N&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()[</span><span class="s1">&#39;prob&#39;</span><span class="p">]</span>
<span class="n">mult_occ_5orb</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;prob&#39;</span> <span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">rot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;N&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;prob amplitude&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># split into ms occupations</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="n">spin_occ_five</span> <span class="o">=</span> <span class="n">res_5orb</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;|m_s|&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">pivot_df</span> <span class="o">=</span> <span class="n">spin_occ_five</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;|m_s|&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;prob&#39;</span><span class="p">)</span>
<span class="n">pivot_df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">stacked</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">rot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;prob amplitude&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/guide_multiplet_analysis_notebook_33_0.svg" src="../_images/guide_multiplet_analysis_notebook_33_0.svg" /></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/guide_multiplet_analysis_notebook_33_1.svg" src="../_images/guide_multiplet_analysis_notebook_33_1.svg" /></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="static_observables_notebook.html" class="btn btn-neutral float-left" title="Measuring static observables / impurity density matrix" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="dynamic_susceptibility_notebook.html" class="btn btn-neutral float-right" title="Dynamical spin-spin susceptibility \(\chi_{S_z S_z}(\tau)\)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2014-2021, Simons Foundation, P. Seth, I. Krivenko, H. Strand, M. Ferrero, O. Parcollet.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
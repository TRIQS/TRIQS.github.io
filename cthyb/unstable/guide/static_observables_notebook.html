<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Measuring static observables / impurity density matrix &mdash; TRIQS Hybridization Expansion Solver  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../_static/nbsphinx-code-cells.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/triqs_favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=default"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Multiplet analysis &amp; particle number histograms" href="multiplet_analysis_notebook.html" />
    <link rel="prev" title="Random number generators" href="random.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #7E588A" >

          
          
          <a href="../index.html" class="icon icon-home">
            TRIQS Hybridization Expansion Solver
          </a>
              <div class="version">
                3.2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Install CTHYB</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html#packaged-versions-of-cthyb">Packaged Versions of CTHyb</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../install.html#ubuntu-debian-packages">Ubuntu Debian packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#anaconda-experimental">Anaconda (experimental)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#docker">Docker</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#compiling-cthyb-from-source">Compiling CTHYB from source</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../install.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#installation-steps">Installation steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#version-compatibility">Version compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#custom-cmake-options">Custom CMake options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../documentation.html">Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#basic-notions">Basic notions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basicnotions/cthyb.html">A word on the algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basicnotions/moves.html">QMC moves</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/moves.html#insert-one-pair-of-operators">Insert one pair of operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/moves.html#remove-one-pair-of-operators">Remove one pair of operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/moves.html#insert-two-pairs-of-operators">Insert two pairs of operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/moves.html#remove-two-pairs-of-operators">Remove two pairs of operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/moves.html#shift-one-operator">Shift one operator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/moves.html#global-move-change-of-operator-indices">Global move - change of operator indices</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../basicnotions/measurements.html">Measurements: definitions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/measurements.html#green-s-function">Green’s function</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../basicnotions/measurements.html#imaginary-time">Imaginary time</a></li>
<li class="toctree-l5"><a class="reference internal" href="../basicnotions/measurements.html#legendre-polynomial-basis">Legendre polynomial basis</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/measurements.html#local-susceptibility-and-other-operator-pairs">Local susceptibility and other operator pairs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/measurements.html#two-particle-green-s-functions">Two-particle Green’s functions</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../basicnotions/measurements.html#imaginary-time-binning">Imaginary time binning</a></li>
<li class="toctree-l5"><a class="reference internal" href="../basicnotions/measurements.html#matsubara-frequency-measurements">Matsubara frequency measurements</a></li>
<li class="toctree-l5"><a class="reference internal" href="../basicnotions/measurements.html#mixed-matsubara-frequency-and-legendre-measurements">Mixed Matsubara Frequency and Legendre measurements</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/measurements.html#impurity-density-matrix">Impurity density matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/measurements.html#perturbation-order-histograms">Perturbation order histograms</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/measurements.html#average-sign">Average sign</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../documentation.html#user-guide">User guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="settingparameters.html">Setting the parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-1-construct-the-solver-instance">Step 1 - construct the solver instance</a><ul>
<li class="toctree-l5"><a class="reference internal" href="settingparameters.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-2-the-hamiltonian">Step 2 - the Hamiltonian</a><ul>
<li class="toctree-l5"><a class="reference internal" href="settingparameters.html#id1">Examples</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-3-the-monte-carlo-parameters">Step 3 - the Monte Carlo parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-6-legendre-or-not">Step 6 - Legendre or not?</a></li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-7-prepare-the-non-interacting-green-s-function">Step 7 - prepare the non-interacting Green’s function</a></li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-8-we-re-ready-to-go">Step 8 - we’re ready to go!</a></li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#final-step-analyze-the-output">Final Step - analyze the output</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="dmft.html">Building DMFT calculations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="dmft.html#plain-vanilla-dmft-the-bethe-lattice">Plain-vanilla DMFT: the Bethe lattice</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="random.html">Random number generators</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Measuring static observables / impurity density matrix</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Measuring-\hat{\rho}_\mathrm{imp}-in-cthyb">Measuring <span class="math notranslate nohighlight">\(\hat{\rho}_\mathrm{imp}\)</span> in cthyb</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Compute-expactation-values-of-static-observables">Compute expactation values of static observables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Measuring-moments-of-Green's-function-and-self-energy">Measuring moments of Green’s function and self-energy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Evaluation-of-the-impurity-interaction-energy">Evaluation of the impurity interaction energy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="multiplet_analysis_notebook.html">Multiplet analysis &amp; particle number histograms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="multiplet_analysis_notebook.html#Analysis-of-results">Analysis of results</a><ul>
<li class="toctree-l5"><a class="reference internal" href="multiplet_analysis_notebook.html#plot-particle-number-histogram">plot particle number histogram</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="multiplet_analysis_notebook.html#More-complex-example">More complex example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="dynamic_susceptibility_notebook.html">Dynamical spin-spin susceptibility <span class="math notranslate nohighlight">\(\chi_{S_z S_z}(\tau)\)</span></a></li>
<li class="toctree-l3"><a class="reference internal" href="perturbation_order_notebook.html">Perturbation order histograms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="perturbation_order_notebook.html#Plotting-perturbation-order-histograms">Plotting perturbation order histograms</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#tutorials">Tutorials</a><ul>
<li class="toctree-l3"><a class="reference internal" href="aim.html">The Anderson impurity model</a></li>
<li class="toctree-l3"><a class="reference internal" href="slater_five_band.html">Multiorbital impurity model</a></li>
<li class="toctree-l3"><a class="reference internal" href="cthyb_convergence_tests.html">Convergence test of CTHYB solver parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cthyb_convergence_tests.html#Overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="cthyb_convergence_tests.html#1.-length_cycle">1. length_cycle</a></li>
<li class="toctree-l4"><a class="reference internal" href="cthyb_convergence_tests.html#2.-n_warmup_cycles">2. n_warmup_cycles</a></li>
<li class="toctree-l4"><a class="reference internal" href="cthyb_convergence_tests.html#3.-n_cycles">3. n_cycles</a></li>
<li class="toctree-l4"><a class="reference internal" href="cthyb_convergence_tests.html#4.-n_iw">4. n_iw</a></li>
<li class="toctree-l4"><a class="reference internal" href="cthyb_convergence_tests.html#5.-n_l">5. n_l</a></li>
<li class="toctree-l4"><a class="reference internal" href="cthyb_convergence_tests.html#6.-n_tau">6. n_tau</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="high_freq_moments.html">High Frequency Moments of the Green’s Functions and Self-energy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="high_freq_moments.html#Derivation">Derivation</a></li>
<li class="toctree-l4"><a class="reference internal" href="high_freq_moments.html#Implentation-in-TRIQS/cthyb">Implentation in TRIQS/cthyb</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#reference-manual">Reference manual</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../_ref/triqs_cthyb.multiplet_tools.html">triqs_cthyb.multiplet_tools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.multiplet_tools.multiplet_analysis.html">triqs_cthyb.multiplet_tools.multiplet_analysis</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.multiplet_tools.multiplet_analysis.html#triqs_cthyb.multiplet_tools.multiplet_analysis"><code class="docutils literal notranslate"><span class="pre">multiplet_analysis()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_ref/triqs_cthyb.solver.html">triqs_cthyb.solver</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.html">triqs_cthyb.solver.Solver</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.html#triqs_cthyb.solver.Solver"><code class="docutils literal notranslate"><span class="pre">Solver</span></code></a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.__init__.html">triqs_cthyb.solver.Solver.__init__</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.solve.html">triqs_cthyb.solver.Solver.solve</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.Delta_infty.html">triqs_cthyb.solver.Solver.Delta_infty</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.Delta_tau.html">triqs_cthyb.solver.Solver.Delta_tau</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G0_iw.html">triqs_cthyb.solver.Solver.G0_iw</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iw.html">triqs_cthyb.solver.Solver.G2_iw</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iw_nfft.html">triqs_cthyb.solver.Solver.G2_iw_nfft</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iw_ph.html">triqs_cthyb.solver.Solver.G2_iw_ph</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iw_ph_nfft.html">triqs_cthyb.solver.Solver.G2_iw_ph_nfft</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iw_pp.html">triqs_cthyb.solver.Solver.G2_iw_pp</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iw_pp_nfft.html">triqs_cthyb.solver.Solver.G2_iw_pp_nfft</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iwll_ph.html">triqs_cthyb.solver.Solver.G2_iwll_ph</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iwll_pp.html">triqs_cthyb.solver.Solver.G2_iwll_pp</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_tau.html">triqs_cthyb.solver.Solver.G2_tau</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G_l.html">triqs_cthyb.solver.Solver.G_l</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G_tau.html">triqs_cthyb.solver.Solver.G_tau</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G_tau_accum.html">triqs_cthyb.solver.Solver.G_tau_accum</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.O_tau.html">triqs_cthyb.solver.Solver.O_tau</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.asymmetry_G_tau.html">triqs_cthyb.solver.Solver.asymmetry_G_tau</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.auto_corr_time.html">triqs_cthyb.solver.Solver.auto_corr_time</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.average_order.html">triqs_cthyb.solver.Solver.average_order</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.average_sign.html">triqs_cthyb.solver.Solver.average_sign</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.constr_parameters.html">triqs_cthyb.solver.Solver.constr_parameters</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.density_matrix.html">triqs_cthyb.solver.Solver.density_matrix</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.h_loc.html">triqs_cthyb.solver.Solver.h_loc</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.h_loc0.html">triqs_cthyb.solver.Solver.h_loc0</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.h_loc_diagonalization.html">triqs_cthyb.solver.Solver.h_loc_diagonalization</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.hybridisation_is_complex.html">triqs_cthyb.solver.Solver.hybridisation_is_complex</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.last_constr_parameters.html">triqs_cthyb.solver.Solver.last_constr_parameters</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.last_solve_parameters.html">triqs_cthyb.solver.Solver.last_solve_parameters</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.local_hamiltonian_is_complex.html">triqs_cthyb.solver.Solver.local_hamiltonian_is_complex</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.performance_analysis.html">triqs_cthyb.solver.Solver.performance_analysis</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.perturbation_order.html">triqs_cthyb.solver.Solver.perturbation_order</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.perturbation_order_total.html">triqs_cthyb.solver.Solver.perturbation_order_total</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.solve_parameters.html">triqs_cthyb.solver.Solver.solve_parameters</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.solve_status.html">triqs_cthyb.solver.Solver.solve_status</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_ref/triqs_cthyb.tail_fit.html">triqs_cthyb.tail_fit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.tail_fit.green_high_frequency_moments.html">triqs_cthyb.tail_fit.green_high_frequency_moments</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.tail_fit.green_high_frequency_moments.html#triqs_cthyb.tail_fit.green_high_frequency_moments"><code class="docutils literal notranslate"><span class="pre">green_high_frequency_moments()</span></code></a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.tail_fit.sigma_high_frequency_moments.html">triqs_cthyb.tail_fit.sigma_high_frequency_moments</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.tail_fit.sigma_high_frequency_moments.html#triqs_cthyb.tail_fit.sigma_high_frequency_moments"><code class="docutils literal notranslate"><span class="pre">sigma_high_frequency_moments()</span></code></a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.tail_fit.tail_fit.html">triqs_cthyb.tail_fit.tail_fit</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.tail_fit.tail_fit.html#triqs_cthyb.tail_fit.tail_fit"><code class="docutils literal notranslate"><span class="pre">tail_fit()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_ref/triqs_cthyb.util.html">triqs_cthyb.util</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.util.block_size_from_gf_struct.html">triqs_cthyb.util.block_size_from_gf_struct</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.util.block_size_from_gf_struct.html#triqs_cthyb.util.block_size_from_gf_struct"><code class="docutils literal notranslate"><span class="pre">block_size_from_gf_struct()</span></code></a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.util.estimate_nfft_buf_size.html">triqs_cthyb.util.estimate_nfft_buf_size</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.util.estimate_nfft_buf_size.html#triqs_cthyb.util.estimate_nfft_buf_size"><code class="docutils literal notranslate"><span class="pre">estimate_nfft_buf_size()</span></code></a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.util.orbital_occupations.html">triqs_cthyb.util.orbital_occupations</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.util.orbital_occupations.html#triqs_cthyb.util.orbital_occupations"><code class="docutils literal notranslate"><span class="pre">orbital_occupations()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.solve_parameters.html">triqs_cthyb.solver.Solver.solve_parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.solve_parameters.html#triqs_cthyb.solver.Solver.solve_parameters"><code class="docutils literal notranslate"><span class="pre">Solver.solve_parameters</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.constr_parameters.html">triqs_cthyb.solver.Solver.constr_parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.constr_parameters.html#triqs_cthyb.solver.Solver.constr_parameters"><code class="docutils literal notranslate"><span class="pre">Solver.constr_parameters</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#faqs">FAQs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../faqs.html">Frequently-asked questions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../faqs.html#q-why-is-my-code-running-so-slowly">Q: Why is my code running so slowly?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs.html#q-how-do-i-save-the-triqs-and-cthyb-hash-and-script-for-debugging-purposes">Q: How do I save the triqs and cthyb hash and script for debugging purposes?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs.html#q-why-does-my-data-look-so-noisy">Q: Why does my data look so noisy?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs.html#q-how-do-i-use-the-segment-picture">Q: How do I use the segment picture?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ChangeLog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-1-0">Version 3.1.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#delta-interface">Delta Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#general">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#jenkins">jenkins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#doc">doc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#cmake">cmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#gh-actions">gh-actions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-0-0">Version 3.0.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#fundamental-green-function-symmetries">Fundamental Green Function Symmetries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#dependency-management">Dependency Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#other-changes">Other Changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-2-1">Version 2.2.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id2">doc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id3">General</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-2-0">Version 2.2.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id4">cmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id5">doc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id6">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#h5">h5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#packaging">packaging</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-1-0">Version 2.1.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#contributors">Contributors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#testers">Testers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#changes-in-installation-and-cmake-files">Changes in installation and cmake files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#solver-interface">Solver Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#changes-in-behavior">Changes in behavior</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#dependencies">Dependencies</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">Authors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about.html#citation">Citation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#license">License</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#disclaimer">Disclaimer</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #7E588A" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">TRIQS Hybridization Expansion Solver</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../documentation.html">Documentation</a></li>
      <li class="breadcrumb-item active">Measuring static observables / impurity density matrix</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/guide/static_observables_notebook.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="Measuring-static-observables-/-impurity-density-matrix">
<h1>Measuring static observables / impurity density matrix<a class="headerlink" href="#Measuring-static-observables-/-impurity-density-matrix" title="Permalink to this heading"></a></h1>
<p>In addition to the interacting Green’s functions one is often interested in such observables, as orbital occupation numbers and double occupancy of the impurity. Expectation values of these time-independent operators are readily expressed in terms of the reduced many-body density matrix of the system,</p>
<div class="math notranslate nohighlight">
\[\hat\rho_\mathrm{imp} = \mathrm{Tr}_\mathrm{bath}[e^{-\beta\hat H}/Z].\]</div>
<p>Here, <span class="math notranslate nohighlight">\(e^{-\beta\hat H}/Z\)</span> is the density matrix of the full system (impurity + bath) described by the Hamiltonian <span class="math notranslate nohighlight">\(\hat H\)</span>, and the Tr operator runs only over the bath degrees. Knowledge of <span class="math notranslate nohighlight">\(\hat{\rho}_\mathrm{imp}\)</span> allows to compute the thermodynamic expectation value of any time independent operator <span class="math notranslate nohighlight">\(\hat{O}\)</span> acting on the impurity degrees of freedom (<a class="reference external" href="https://en.wikipedia.org/wiki/Density_matrix#Measurement" rel="noopener noreferrer" target="_blank">wikipedia: density matrix</a>):</p>
<div class="math notranslate nohighlight">
\[\langle\hat O\rangle = \mathrm{Tr}_\mathrm{imp}[\hat\rho_\mathrm{imp} \hat O].\]</div>
<p>The ctyhb solver allows to measure the impurity density matrix in the many-body basis, with only little additional calculational cost, and thus gives access to the multiplet structure of the impurity problem.</p>
<div class="section" id="Measuring-\hat{\rho}_\mathrm{imp}-in-cthyb">
<h2>Measuring <span class="math notranslate nohighlight">\(\hat{\rho}_\mathrm{imp}\)</span> in cthyb<a class="headerlink" href="#Measuring-\hat{\rho}_\mathrm{imp}-in-cthyb" title="Permalink to this heading"></a></h2>
<p>Let us consider a single-orbital Anderson impurity problem in a weak external magnetic field (<a class="reference external" href="static.py" rel="noopener noreferrer" target="_blank">script: static.py</a>).</p>
<p>At first, we import all necessary modules, define some input parameters and construct a ctyhb <code class="docutils literal notranslate"><span class="pre">Solver</span></code> object in the usual way:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">h5</span> <span class="kn">import</span> <span class="n">HDFArchive</span>
<span class="kn">from</span> <span class="nn">triqs.gf.descriptors</span> <span class="kn">import</span> <span class="n">Fourier</span>
<span class="kn">from</span> <span class="nn">triqs.gf</span> <span class="kn">import</span> <span class="n">Gf</span><span class="p">,</span> <span class="n">MeshImFreq</span><span class="p">,</span> <span class="n">iOmega_n</span><span class="p">,</span> <span class="n">inverse</span><span class="p">,</span> <span class="n">GfImTime</span><span class="p">,</span> <span class="n">BlockGf</span><span class="p">,</span> <span class="n">Wilson</span>
<span class="kn">from</span> <span class="nn">triqs.operators</span> <span class="kn">import</span> <span class="n">c</span><span class="p">,</span> <span class="n">c_dag</span><span class="p">,</span> <span class="n">n</span>

<span class="c1"># plotting interface</span>
<span class="kn">from</span> <span class="nn">triqs.plot.mpl_interface</span> <span class="kn">import</span> <span class="n">plt</span><span class="p">,</span><span class="n">oplot</span>

<span class="c1"># redirect ctyhb c++ output to notebook</span>
<span class="kn">from</span> <span class="nn">triqs.utility.redirect</span> <span class="kn">import</span> <span class="n">start_redirect</span>
<span class="n">start_redirect</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">triqs_cthyb.solver</span> <span class="kn">import</span> <span class="n">Solver</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Warning: could not identify MPI environment!
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Starting serial run at: 2023-08-14 16:13:15.854417
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters</span>
<span class="n">D</span> <span class="o">=</span> <span class="mf">1.0</span>         <span class="c1"># Half-bandwidth of the bath</span>
<span class="n">V</span> <span class="o">=</span> <span class="mf">0.2</span>         <span class="c1"># Hybridisation amplitude</span>
<span class="n">U</span> <span class="o">=</span> <span class="mf">4.0</span>         <span class="c1"># Coulomb interaction</span>
<span class="n">e_f</span> <span class="o">=</span> <span class="o">-</span><span class="n">U</span><span class="o">/</span><span class="mi">2</span>      <span class="c1"># Local energy level</span>
<span class="n">h</span> <span class="o">=</span> <span class="mf">0.01</span>        <span class="c1"># External field</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">50</span>       <span class="c1"># Inverse temperature</span>

<span class="c1"># Construct the impurity solver with the inverse temperature</span>
<span class="c1"># and the structure of the Green&#39;s functions</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">(</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gf_struct</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="p">])</span>

<span class="c1"># Initialize the non-interacting Green&#39;s function S.G0_iw</span>
<span class="c1"># External magnetic field introduces Zeeman energy splitting between</span>
<span class="c1"># different spin components</span>
<span class="n">S</span><span class="o">.</span><span class="n">G0_iw</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">]</span>   <span class="o">&lt;&lt;</span> <span class="n">inverse</span><span class="p">(</span><span class="n">iOmega_n</span> <span class="o">-</span> <span class="n">e_f</span> <span class="o">+</span> <span class="n">h</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">V</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Wilson</span><span class="p">(</span><span class="n">D</span><span class="p">))</span>
<span class="n">S</span><span class="o">.</span><span class="n">G0_iw</span><span class="p">[</span><span class="s1">&#39;down&#39;</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">inverse</span><span class="p">(</span><span class="n">iOmega_n</span> <span class="o">-</span> <span class="n">e_f</span> <span class="o">-</span> <span class="n">h</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">V</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Wilson</span><span class="p">(</span><span class="n">D</span><span class="p">))</span>

<span class="c1"># setting up a local interaction Hamiltonian</span>
<span class="n">h_int</span> <span class="o">=</span> <span class="n">U</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Next, we instruct the <code class="docutils literal notranslate"><span class="pre">solve</span></code> function to accumulate the density matrix by passing the solver parameters <code class="docutils literal notranslate"><span class="pre">measure_density_matrix</span> <span class="pre">=</span> <span class="pre">True</span></code> and <code class="docutils literal notranslate"><span class="pre">use_norm_as_weight</span> <span class="pre">=</span> <span class="pre">True</span></code>. The latter parameter tells the solver to employ a reweighting scheme, using a spherical norm instead of the trace to calculate the atomic weight. This reweighting allows to take into account important contributions to <span class="math notranslate nohighlight">\(\hat\rho_\mathrm{imp}\)</span>, which otherwise would be missed. See also <a class="reference external" href="https://triqs.github.io/cthyb/latest/reference/solve_parameters.html" rel="noopener noreferrer" target="_blank">cthyb solver
parameters</a> for more information.</p>
<p>Now we run the solver:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run the solver</span>
<span class="n">S</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">h_int</span> <span class="o">=</span> <span class="n">h_int</span><span class="p">,</span>                  <span class="c1"># interaction Hamiltonian</span>
        <span class="n">n_cycles</span>  <span class="o">=</span> <span class="mi">500000</span><span class="p">,</span>             <span class="c1"># Number of QMC cycles</span>
        <span class="n">length_cycle</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>             <span class="c1"># Length of one cycle</span>
        <span class="n">n_warmup_cycles</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>        <span class="c1"># Warmup cycles</span>
        <span class="n">measure_density_matrix</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># Measure the reduced density matrix</span>
        <span class="n">use_norm_as_weight</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>      <span class="c1"># Required to measure the density matrix</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Insert error : recovering ...
</pre></div></div>
</div>
<p>The results of the density matrix accumulation are accessible via the <code class="docutils literal notranslate"><span class="pre">density_matrix</span></code> attribute of the solver:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract accumulated density matrix</span>
<span class="n">rho</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">density_matrix</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Compute-expactation-values-of-static-observables">
<h2>Compute expactation values of static observables<a class="headerlink" href="#Compute-expactation-values-of-static-observables" title="Permalink to this heading"></a></h2>
<p>Now we can use the function <code class="docutils literal notranslate"><span class="pre">trace_rho_op()</span></code> from <code class="docutils literal notranslate"><span class="pre">triqs.atom_diag</span></code> (<a class="reference external" href="https://triqs.github.io/triqs/latest/documentation/cpp_api/triqs/atom_diag/trace_rho_op.html" rel="noopener noreferrer" target="_blank">see doc</a>) to compute expectation values <span class="math notranslate nohighlight">\(\langle\hat O\rangle = \mathrm{Tr}_\mathrm{imp}[\hat\rho_\mathrm{imp} \hat O]\)</span> of any time independent operator.</p>
<p>To do so, information about the structure of the local Hilbert space is also needed. This information is stored as a special object in <code class="docutils literal notranslate"><span class="pre">h_loc_diagonalization</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Object containing eigensystem of the local Hamiltonian</span>
<span class="n">h_loc_diag</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">h_loc_diagonalization</span>
</pre></div>
</div>
</div>
<p>This allows now to compute for example the expectation values of the impurity occupations, or the double occupancy:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">triqs.atom_diag</span> <span class="kn">import</span> <span class="n">trace_rho_op</span>

<span class="c1"># Evaluate impurity occupations</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&lt;N_up&gt; =&quot;</span><span class="p">,</span> <span class="n">trace_rho_op</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">h_loc_diag</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&lt;N_down&gt; = &quot;</span><span class="p">,</span> <span class="n">trace_rho_op</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">h_loc_diag</span><span class="p">))</span>

<span class="c1"># Evaluate double occupancy</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&lt;N_up*N_down&gt; =&quot;</span><span class="p">,</span> <span class="n">trace_rho_op</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">h_loc_diag</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;N_up&gt; = 0.6200042407162714
&lt;N_down&gt; =  0.3801439064667559
&lt;N_up*N_down&gt; = 0.003665497313727422
</pre></div></div>
</div>
</div>
<div class="section" id="Measuring-moments-of-Green's-function-and-self-energy">
<h2>Measuring moments of Green’s function and self-energy<a class="headerlink" href="#Measuring-moments-of-Green's-function-and-self-energy" title="Permalink to this heading"></a></h2>
<p>The high-frequency moments of the Green’s function and self-energy contain crucial high-frequency information that can be used to (1) improve the Fourier transform of the Green’s function from imaginary time to Matsubara frequencies and (2) improve the tail fit of the self-energy. When a user turns on the measurement of the density matrix (<code class="docutils literal notranslate"><span class="pre">measure_density_matrix</span> <span class="pre">=</span> <span class="pre">True</span></code>), these high-frequency moments are automatically calculated and used.</p>
<p>The moments are stored as members of the <code class="docutils literal notranslate"><span class="pre">Solver</span></code> class. <code class="docutils literal notranslate"><span class="pre">Solver.Sigma_moments</span></code> are the calculated self-energy moments and <code class="docutils literal notranslate"><span class="pre">Solver.G_moments</span></code> are the calculated Green’s function moments. For example,</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># accessing the high frequency moments stored in the Solver class</span>
<span class="n">S</span><span class="o">.</span><span class="n">Sigma_moments</span><span class="p">,</span> <span class="n">S</span><span class="o">.</span><span class="n">G_moments</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
({&#39;up&#39;: array([[[1.52057563+0.j]],

         [[3.77015227+0.j]]]),
  &#39;down&#39;: array([[[2.48001696+0.j]],

         [[3.76958372+0.j]]])},
 {&#39;up&#39;: array([[[ 0.        +0.j]],

         [[ 1.        +0.j]],

         [[-0.48442437+0.j]]]),
  &#39;down&#39;: array([[[0.        +0.j]],

         [[1.        +0.j]],

         [[0.48501696+0.j]]])})
</pre></div></div>
</div>
<p>The moments are stored as Python dictonaries and have the same structure as <code class="docutils literal notranslate"><span class="pre">gf_struct</span></code>. For more technical information and details, see the <a class="reference internal" href="high_freq_moments.html"><span class="doc">high frequency moments notebook</span></a>.</p>
</div>
<div class="section" id="Evaluation-of-the-impurity-interaction-energy">
<h2>Evaluation of the impurity interaction energy<a class="headerlink" href="#Evaluation-of-the-impurity-interaction-energy" title="Permalink to this heading"></a></h2>
<p>The function <code class="docutils literal notranslate"><span class="pre">trace_rho_op()</span></code> can also be used to evaluate the interaction energy of the impurity by computing the expectation value of <span class="math notranslate nohighlight">\(\hat{H}_\mathrm{int}\)</span>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Eint</span> <span class="o">=</span> <span class="n">trace_rho_op</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">h_int</span><span class="p">,</span> <span class="n">h_loc_diag</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;E_int=&lt;H_int&gt;=&quot;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{:5.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Eint</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
E_int=&lt;H_int&gt;= 0.0147
</pre></div></div>
</div>
<p>This provides a powerful way to calculate the impurity interaction energy, which is for example needed for calculating the total energy in a combined DFT+DMFT calculation.</p>
<p>In comparison to the widely used Galitski-Migdal Formula: <span class="math notranslate nohighlight">\(\frac{1}{2} Tr [ \Sigma G]\)</span> (<a class="reference external" href="http://www.jetp.ac.ru/cgi-bin/e/index/e/7/1/p96?a=list" rel="noopener noreferrer" target="_blank">Ref: Galitski &amp; Migdal paper</a>), using <span class="math notranslate nohighlight">\(\mathrm{Tr}_\mathrm{imp}[ \hat\rho_\mathrm{imp} \hat{H}_\mathrm{int}]\)</span> has the advantage that the self-energy <span class="math notranslate nohighlight">\(\Sigma\)</span> is not needed for calculating the interaction energy, which can be very noisy, especially for large <span class="math notranslate nohighlight">\(i \omega_n\)</span>. Especially, the influence of the high-frequency tail of
the real part of the self-energy <span class="math notranslate nohighlight">\(Re \Sigma (i \omega_n \rightarrow \infty)\)</span>, the so-called Hartree shift, critically determines the value calculated in the Galitski-Migdal formula. Therefore, calculating the interaction energy with <code class="docutils literal notranslate"><span class="pre">trace_rho_op()</span></code> provides a significantly more stable procedure when using a QMC based solver.</p>
<p>To test and benchmark this feature of the cthyb solver, we performed calculations for a Dimer coupled to two discrete bath states, including a full Kanamori interaction Hamiltonian. See <a class="reference external" href="https://github.com/TRIQS/benchmarks/blob/master/Dimer/" rel="noopener noreferrer" target="_blank">triqs benchmark Dimer</a> for more information. We first used the <a class="reference external" href="https://github.com/TRIQS/benchmarks/blob/master/common/pyed" rel="noopener noreferrer" target="_blank">pyED exact diagonalization benchmark</a> to compute the exact interaction energy of the impurity. Next, we compared these results
with interaction energies obtained from <code class="docutils literal notranslate"><span class="pre">trace_rho_op()</span></code>, and the Galitski-Migdal formula using the cthyb solver. We performed either a tail-fit, or used sampling directly in the Legendre basis to obtain smooth high-frequency behavior of <span class="math notranslate nohighlight">\(\Sigma (i \omega_n)\)</span>.</p>
<p>The results are depicted below:</p>
<p><img alt="image0" src="../_images/Eint_benchmark.svg" /></p>
<p>The black dashed horizontal line represents the interaction energy calculated with the exact diagonalization solver. The green crosses show the interaction energy computed with cthyb using <code class="docutils literal notranslate"><span class="pre">trace_rho_op()</span></code> for an increasing number of total QMC cycles (<code class="docutils literal notranslate"><span class="pre">n_cycles*mpi.size</span></code>). The error in the interaction energy is smaller than 1 meV compared to the ED result in this system, even for only <span class="math notranslate nohighlight">\(48 \times 10^6\)</span> QMC cycles. In comparison, the interaction energy obtained from the Galitski-Migdal
formula using Legendre sampling (blue circles), or using a tail-fitting procedure (orange squares), show errors as large as 70 meV. Even for incredible large numbers of QMC cylces (<span class="math notranslate nohighlight">\(4 \times 10^9\)</span>), the error is still as large as <span class="math notranslate nohighlight">\(\approx 10\)</span> meV. Even though, the high-frequency tail of <span class="math notranslate nohighlight">\(\Sigma(i \omega_n)\)</span> looks very smooth for this large number of QMC cycles, <span class="math notranslate nohighlight">\(Re \Sigma (i \omega_n \rightarrow \infty)\)</span> has not exactly the same value as the <span class="math notranslate nohighlight">\(\Sigma\)</span> calculated with
the ED solver, resulting directly in an error in the interaction energy. Hence, we highly recommend to calculate the interaction energy via <code class="docutils literal notranslate"><span class="pre">trace_rho_op()</span></code>, which converges very fast and reliably with increasing number of QMC cycles.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="random.html" class="btn btn-neutral float-left" title="Random number generators" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="multiplet_analysis_notebook.html" class="btn btn-neutral float-right" title="Multiplet analysis &amp; particle number histograms" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2014-2021, Simons Foundation, P. Seth, I. Krivenko, H. Strand, M. Ferrero, O. Parcollet.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
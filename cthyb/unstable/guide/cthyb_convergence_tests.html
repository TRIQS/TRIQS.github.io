<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Convergence test of CTHYB solver parameters &mdash; TRIQS Hybridization Expansion Solver  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/triqs_favicon.ico"/>
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script defer="defer" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=default"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="triqs_cthyb.multiplet_tools" href="../_ref/triqs_cthyb.multiplet_tools.html" />
    <link rel="prev" title="Multiorbital impurity model" href="slater_five_band.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #7E588A" >
            <a href="../index.html" class="icon icon-home"> TRIQS Hybridization Expansion Solver
          </a>
              <div class="version">
                3.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Install CTHYB</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html#packaged-versions-of-cthyb">Packaged Versions of CTHyb</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../install.html#ubuntu-debian-packages">Ubuntu Debian packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#anaconda-experimental">Anaconda (experimental)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#id2">Docker</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#compiling-cthyb-from-source">Compiling CTHYB from source</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../install.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#installation-steps">Installation steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#version-compatibility">Version compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#custom-cmake-options">Custom CMake options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../documentation.html">Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#basic-notions">Basic notions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basicnotions/cthyb.html">A word on the algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basicnotions/moves.html">QMC moves</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/moves.html#insert-one-pair-of-operators">Insert one pair of operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/moves.html#remove-one-pair-of-operators">Remove one pair of operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/moves.html#insert-two-pairs-of-operators">Insert two pairs of operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/moves.html#remove-two-pairs-of-operators">Remove two pairs of operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/moves.html#shift-one-operator">Shift one operator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/moves.html#global-move-change-of-operator-indices">Global move - change of operator indices</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../basicnotions/measurements.html">Measurements: definitions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/measurements.html#green-s-function">Green’s function</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../basicnotions/measurements.html#imaginary-time">Imaginary time</a></li>
<li class="toctree-l5"><a class="reference internal" href="../basicnotions/measurements.html#legendre-polynomial-basis">Legendre polynomial basis</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/measurements.html#local-susceptibility-and-other-operator-pairs">Local susceptibility and other operator pairs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/measurements.html#two-particle-green-s-functions">Two-particle Green’s functions</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../basicnotions/measurements.html#imaginary-time-binning">Imaginary time binning</a></li>
<li class="toctree-l5"><a class="reference internal" href="../basicnotions/measurements.html#matsubara-frequency-measurements">Matsubara frequency measurements</a></li>
<li class="toctree-l5"><a class="reference internal" href="../basicnotions/measurements.html#mixed-matsubara-frequency-and-legendre-measurements">Mixed Matsubara Frequency and Legendre measurements</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/measurements.html#impurity-density-matrix">Impurity density matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/measurements.html#perturbation-order-histograms">Perturbation order histograms</a></li>
<li class="toctree-l4"><a class="reference internal" href="../basicnotions/measurements.html#average-sign">Average sign</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#user-guide">User guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="settingparameters.html">Setting the parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-1-construct-the-solver-instance">Step 1 - construct the solver instance</a><ul>
<li class="toctree-l5"><a class="reference internal" href="settingparameters.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-2-the-hamiltonian">Step 2 - the Hamiltonian</a><ul>
<li class="toctree-l5"><a class="reference internal" href="settingparameters.html#id1">Examples</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-3-the-monte-carlo-parameters">Step 3 - the Monte Carlo parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-6-legendre-or-not">Step 6 - Legendre or not?</a></li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-7-prepare-the-non-interacting-green-s-function">Step 7 - prepare the non-interacting Green’s function</a></li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-8-we-re-ready-to-go">Step 8 - we’re ready to go!</a></li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#final-step-analyze-the-output">Final Step - analyze the output</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="dmft.html">Building DMFT calculations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="dmft.html#plain-vanilla-dmft-the-bethe-lattice">Plain-vanilla DMFT: the Bethe lattice</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="random.html">Random number generators</a></li>
<li class="toctree-l3"><a class="reference internal" href="static_observables_notebook.html">Measuring static observables / impurity density matrix</a><ul>
<li class="toctree-l4"><a class="reference internal" href="static_observables_notebook.html#Measuring-\hat{\rho}_\mathrm{imp}-in-cthyb">Measuring <span class="math notranslate nohighlight">\(\hat{\rho}_\mathrm{imp}\)</span> in cthyb</a></li>
<li class="toctree-l4"><a class="reference internal" href="static_observables_notebook.html#Compute-expactation-values-of-static-observables">Compute expactation values of static observables</a></li>
<li class="toctree-l4"><a class="reference internal" href="static_observables_notebook.html#Evaluation-of-the-impurity-interaction-energy">Evaluation of the impurity interaction energy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="multiplet_analysis_notebook.html">Multiplet analysis &amp; particle number histograms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="multiplet_analysis_notebook.html#Analysis-of-results">Analysis of results</a><ul>
<li class="toctree-l5"><a class="reference internal" href="multiplet_analysis_notebook.html#plot-particle-number-histogram">plot particle number histogram</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="multiplet_analysis_notebook.html#More-complex-example">More complex example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="dynamic_susceptibility_notebook.html">Dynamical spin-spin susceptibility <span class="math notranslate nohighlight">\(\chi_{S_z S_z}(\tau)\)</span></a></li>
<li class="toctree-l3"><a class="reference internal" href="perturbation_order_notebook.html">Perturbation order histograms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="perturbation_order_notebook.html#Plotting-perturbation-order-histograms">Plotting perturbation order histograms</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../documentation.html#tutorials">Tutorials</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="aim.html">The Anderson impurity model</a></li>
<li class="toctree-l3"><a class="reference internal" href="slater_five_band.html">Multiorbital impurity model</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Convergence test of CTHYB solver parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#1.-length_cycle">1. length_cycle</a></li>
<li class="toctree-l4"><a class="reference internal" href="#2.-n_warmup_cycles">2. n_warmup_cycles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#3.-n_cycles">3. n_cycles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#4.-n_iw">4. n_iw</a></li>
<li class="toctree-l4"><a class="reference internal" href="#5.-n_l">5. n_l</a></li>
<li class="toctree-l4"><a class="reference internal" href="#6.-n_tau">6. n_tau</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#reference-manual">Reference manual</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../_ref/triqs_cthyb.multiplet_tools.html">triqs_cthyb.multiplet_tools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.multiplet_tools.multiplet_analysis.html">triqs_cthyb.multiplet_tools.multiplet_analysis</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_ref/triqs_cthyb.solver.html">triqs_cthyb.solver</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.html">triqs_cthyb.solver.Solver</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.__init__.html">triqs_cthyb.solver.Solver.__init__</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.solve.html">triqs_cthyb.solver.Solver.solve</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.Delta_infty.html">triqs_cthyb.solver.Solver.Delta_infty</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.Delta_tau.html">triqs_cthyb.solver.Solver.Delta_tau</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G0_iw.html">triqs_cthyb.solver.Solver.G0_iw</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iw.html">triqs_cthyb.solver.Solver.G2_iw</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iw_nfft.html">triqs_cthyb.solver.Solver.G2_iw_nfft</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iw_ph.html">triqs_cthyb.solver.Solver.G2_iw_ph</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iw_ph_nfft.html">triqs_cthyb.solver.Solver.G2_iw_ph_nfft</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iw_pp.html">triqs_cthyb.solver.Solver.G2_iw_pp</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iw_pp_nfft.html">triqs_cthyb.solver.Solver.G2_iw_pp_nfft</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iwll_ph.html">triqs_cthyb.solver.Solver.G2_iwll_ph</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_iwll_pp.html">triqs_cthyb.solver.Solver.G2_iwll_pp</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G2_tau.html">triqs_cthyb.solver.Solver.G2_tau</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G_l.html">triqs_cthyb.solver.Solver.G_l</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G_tau.html">triqs_cthyb.solver.Solver.G_tau</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.G_tau_accum.html">triqs_cthyb.solver.Solver.G_tau_accum</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.O_tau.html">triqs_cthyb.solver.Solver.O_tau</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.asymmetry_G_tau.html">triqs_cthyb.solver.Solver.asymmetry_G_tau</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.auto_corr_time.html">triqs_cthyb.solver.Solver.auto_corr_time</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.average_order.html">triqs_cthyb.solver.Solver.average_order</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.average_sign.html">triqs_cthyb.solver.Solver.average_sign</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.constr_parameters.html">triqs_cthyb.solver.Solver.constr_parameters</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.density_matrix.html">triqs_cthyb.solver.Solver.density_matrix</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.h_loc.html">triqs_cthyb.solver.Solver.h_loc</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.h_loc0.html">triqs_cthyb.solver.Solver.h_loc0</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.h_loc_diagonalization.html">triqs_cthyb.solver.Solver.h_loc_diagonalization</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.hybridisation_is_complex.html">triqs_cthyb.solver.Solver.hybridisation_is_complex</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.last_constr_parameters.html">triqs_cthyb.solver.Solver.last_constr_parameters</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.last_solve_parameters.html">triqs_cthyb.solver.Solver.last_solve_parameters</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.local_hamiltonian_is_complex.html">triqs_cthyb.solver.Solver.local_hamiltonian_is_complex</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.performance_analysis.html">triqs_cthyb.solver.Solver.performance_analysis</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.perturbation_order.html">triqs_cthyb.solver.Solver.perturbation_order</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.perturbation_order_total.html">triqs_cthyb.solver.Solver.perturbation_order_total</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.solve_parameters.html">triqs_cthyb.solver.Solver.solve_parameters</a></li>
<li class="toctree-l5"><a class="reference internal" href="../_ref/triqs_cthyb.solver.Solver.solve_status.html">triqs_cthyb.solver.Solver.solve_status</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_ref/triqs_cthyb.tail_fit.html">triqs_cthyb.tail_fit</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.tail_fit.green_high_frequency_moments.html">triqs_cthyb.tail_fit.green_high_frequency_moments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.tail_fit.sigma_high_frequency_moments.html">triqs_cthyb.tail_fit.sigma_high_frequency_moments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.tail_fit.tail_fit.html">triqs_cthyb.tail_fit.tail_fit</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_ref/triqs_cthyb.util.html">triqs_cthyb.util</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.util.block_size_from_gf_struct.html">triqs_cthyb.util.block_size_from_gf_struct</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.util.estimate_nfft_buf_size.html">triqs_cthyb.util.estimate_nfft_buf_size</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_ref/triqs_cthyb.util.orbital_occupations.html">triqs_cthyb.util.orbital_occupations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/constr_parameters.html">triqs_cthyb construction parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/solve_parameters.html">triqs_cthyb solve parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#faqs">FAQs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../faqs.html">Frequently-asked questions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../faqs.html#q-why-is-my-code-running-so-slowly">Q: Why is my code running so slowly?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs.html#q-how-do-i-save-the-triqs-and-cthyb-hash-and-script-for-debugging-purposes">Q: How do I save the triqs and cthyb hash and script for debugging purposes?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs.html#q-why-does-my-data-look-so-noisy">Q: Why does my data look so noisy?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs.html#q-how-do-i-use-the-segment-picture">Q: How do I use the segment picture?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ChangeLog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-1-0">Version 3.1.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#delta-interface">Delta Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#general">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#jenkins">jenkins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#doc">doc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#cmake">cmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#gh-actions">gh-actions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-0-0">Version 3.0.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#fundamental-green-function-symmetries">Fundamental Green Function Symmetries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#dependency-management">Dependency Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#other-changes">Other Changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-2-1">Version 2.2.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id2">doc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id3">General</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-2-0">Version 2.2.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id4">cmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id5">doc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id6">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#h5">h5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#packaging">packaging</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-1-0">Version 2.1.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#contributors">Contributors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#testers">Testers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#changes-in-installation-and-cmake-files">Changes in installation and cmake files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#solver-interface">Solver Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#changes-in-behavior">Changes in behavior</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#dependencies">Dependencies</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">Authors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about.html#citation">Citation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#license">License</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#disclaimer">Disclaimer</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #7E588A" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">TRIQS Hybridization Expansion Solver</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../documentation.html">Documentation</a> &raquo;</li>
      <li>Convergence test of CTHYB solver parameters</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/guide/cthyb_convergence_tests.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Convergence-test-of-CTHYB-solver-parameters">
<h1>Convergence test of CTHYB solver parameters<a class="headerlink" href="#Convergence-test-of-CTHYB-solver-parameters" title="Permalink to this headline"></a></h1>
<div class="section" id="Overview">
<h2>Overview<a class="headerlink" href="#Overview" title="Permalink to this headline"></a></h2>
<p>The goal of this tutorial is to learn how to choose the parameters for the CTHYB solver in order to obtain accurate results with an optimized efficiency. The solver parameters investigated in this notebook are the following:</p>
<ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">length_cycle</span></code> : The number of Monte Carlo updates in a cycle, i.e.&nbsp;between two consecutive measurements.</li>
<li><code class="docutils literal notranslate"><span class="pre">n_warmup_cycles</span></code> : The number of warmup (thermalization) cycles at the beginning of the simulation before any measurements are made.</li>
<li><code class="docutils literal notranslate"><span class="pre">n_cycles</span></code> : The total number of QMC measurements.</li>
<li><code class="docutils literal notranslate"><span class="pre">n_iw</span></code> : The number of Matsubara frequencies used for the representation of the Green’s functions.</li>
<li><code class="docutils literal notranslate"><span class="pre">n_l</span></code> : The number of Legendre polynomials used in the accumulations of the Green’s functions.</li>
<li><code class="docutils literal notranslate"><span class="pre">n_tau</span></code> : The number of imaginary time points used for the representation of the Green’s functions.</li>
</ol>
<p>This tutorial will help the user develop an intuition on how to perform the convergence tests for each parameter. Every test needs to be tailored according to the user’s case of study.</p>
<p>To run this notebook you need to import the modules below. For installation guide please refer to <a class="reference external" href="https://triqs.github.io/triqs/latest/install.html" rel="noopener noreferrer" target="_blank">TRIQS</a> and <a class="reference external" href="https://triqs.github.io/cthyb/latest/install.html" rel="noopener noreferrer" target="_blank">CTHYB</a> webpages.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span>
<span class="kn">from</span> <span class="nn">triqs.gf</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">triqs.plot.mpl_interface</span> <span class="kn">import</span> <span class="n">oplot</span><span class="p">,</span><span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
<span class="kn">from</span> <span class="nn">triqs.gf</span> <span class="kn">import</span> <span class="n">make_gf_from_fourier</span>
<span class="kn">from</span> <span class="nn">triqs.operators</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">h5</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">h5</span> <span class="kn">import</span> <span class="n">HDFArchive</span>
<span class="kn">from</span> <span class="nn">triqs_cthyb</span> <span class="kn">import</span> <span class="n">Solver</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">opt</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">matplotlib.markers</span> <span class="kn">import</span> <span class="n">MarkerStyle</span>

<span class="c1"># To make plots in interactive mode</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># Make all figures slightly bigger</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">120</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Warning: could not identify MPI environment!
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Starting serial run at: 2022-09-27 11:43:09.629092
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">triqs_cthyb.version</span> <span class="kn">import</span> <span class="n">show_version</span>
<span class="n">show_version</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

You are using triqs_cthyb version 3.1.0

</pre></div></div>
</div>
</div>
<div class="section" id="1.-length_cycle">
<h2>1. length_cycle<a class="headerlink" href="#1.-length_cycle" title="Permalink to this headline"></a></h2>
<p>Number of moves (or updates) between each measurement. In CTHYB, the Markov Chain is based on a sampling of the partition function. One of the measured observables in CTHYB is the Green’s function in imaginary time <span class="math notranslate nohighlight">\(G(\tau)\)</span>. Each “move” modifies the configuration of the system (or state of the system which here is <span class="math notranslate nohighlight">\(\mathcal{C}=d^{\dagger}_{\alpha_{1}}(\tau_1) d_{\alpha^{'}_{1}}(\tau^{'}_1) d^{\dagger}_{\alpha_{2}}(\tau_2) . . . d_{\alpha}(\tau_N)\)</span>) by inserting/removing pairs of
operators, or by moving operators in the configuration. Let’s imagine each measurement is made every <strong>L</strong> moves, then we can say that these <strong>L</strong> moves form a cycle and the length of the cycle is <strong>L</strong>.</p>
<p>The reason why we do not want to measure, for example <span class="math notranslate nohighlight">\(G(\tau)\)</span>, after each move is because we want the configurations to be decorrelated from each other. To get an idea of decorrelation, we can look at the sign or expansion order which vary from one configuration to another. Plotting the standard deviation of sign/order versus the size of the data bins used to determine the error shows that it converges to a value called <code class="docutils literal notranslate"><span class="pre">auto-correlation</span> <span class="pre">time</span></code>. If,</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">auto-correlation</span> <span class="pre">time</span></code> <span class="math notranslate nohighlight">\(&gt;\)</span> 1 : Consecutive measurements are correlated, i.e.&nbsp;measurements are performed too close to one another. This is not recommended if the the measurement process is time-consuming or if the error bars need to be accurate. <code class="docutils literal notranslate"><span class="pre">Length_cycle</span></code> should be increased.</li>
<li><code class="docutils literal notranslate"><span class="pre">auto-correlation</span> <span class="pre">time</span></code> <span class="math notranslate nohighlight">\(\sim\)</span> 1 : Consecutive measurements are uncorrelated often enough. <code class="docutils literal notranslate"><span class="pre">Length_cycle</span></code> is the correct value.</li>
<li><code class="docutils literal notranslate"><span class="pre">auto-correlation</span> <span class="pre">time</span></code> <span class="math notranslate nohighlight">\(\ll\)</span> 1 : Many more moves are performed even though the measurements would be uncorrelated. It means many less samples will be measured, requiring much longer calculation times for the same statistical noise. Moreover, it increases the error on <span class="math notranslate nohighlight">\(G(\tau)\)</span>. <code class="docutils literal notranslate"><span class="pre">Length_cycle</span></code> should be decreased.</li>
</ul>
<p>It must be noted that <code class="docutils literal notranslate"><span class="pre">auto-correlation</span> <span class="pre">time</span></code> depends on the measured observable (i.e.&nbsp;sign or expansion order), therefore it should be taken with caution. Ideally <code class="docutils literal notranslate"><span class="pre">auto-correlation</span> <span class="pre">time</span></code> should be of order one. If the measurement process is fast, there is no drawback in measuring too often (<code class="docutils literal notranslate"><span class="pre">auto-correlation</span> <span class="pre">time</span></code> <span class="math notranslate nohighlight">\(&gt;\)</span> 1). However there is a drawback in measuring too rarely (<code class="docutils literal notranslate"><span class="pre">auto-correlation</span> <span class="pre">time</span></code> <span class="math notranslate nohighlight">\(\ll\)</span> 1).</p>
<p>Here we take a single orbital Hubbard model at half-filling with a semi-circular density of states for three different betas <span class="math notranslate nohighlight">\(\mathcal{\beta} = 10, 20, 30 (1/eV)\)</span> and plot <code class="docutils literal notranslate"><span class="pre">auto_correlation</span> <span class="pre">time</span></code> vs <code class="docutils literal notranslate"><span class="pre">length_cycle</span></code>. The fit of a 1/x function approximately shows the converged value of <code class="docutils literal notranslate"><span class="pre">length_cycle</span></code> for each <span class="math notranslate nohighlight">\(\beta\)</span>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t</span> <span class="o">=</span> <span class="mf">1.0</span>    <span class="c1"># Half bandwidth</span>
<span class="n">betas</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
<span class="n">n_loops</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">length_cycle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">520</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>

<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">betas</span><span class="p">)):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;../../../data/len_cyc_b</span><span class="si">%i</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">betas</span>[b]):
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;../../../data/len_cyc_b</span><span class="si">%i</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">betas</span>[b])

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">length_cycle</span><span class="p">)):</span>
        <span class="n">S</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">(</span><span class="n">beta</span> <span class="o">=</span> <span class="n">betas</span><span class="p">[</span><span class="n">b</span><span class="p">],</span> <span class="n">gf_struct</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)])</span>
        <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span> <span class="o">&lt;&lt;</span> <span class="n">SemiCircular</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
        <span class="c1"># DMFT loop with self-consistency</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_loops</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Iteration = </span><span class="si">%i</span><span class="s2"> / </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_loops</span><span class="p">))</span>
            <span class="c1"># Symmetrize the Green&#39;s function and use self-consistency</span>
            <span class="n">g</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span> <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="p">[</span><span class="s1">&#39;down&#39;</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">g0</span> <span class="ow">in</span> <span class="n">S</span><span class="o">.</span><span class="n">G0_iw</span><span class="p">:</span>
                <span class="n">g0</span> <span class="o">&lt;&lt;</span> <span class="n">inverse</span><span class="p">(</span> <span class="n">iOmega_n</span> <span class="o">+</span> <span class="n">U</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">mu</span> <span class="o">-</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g</span> <span class="p">)</span>

                <span class="c1"># Solve the impurity problem</span>
            <span class="n">S</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">h_int</span> <span class="o">=</span> <span class="n">U</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>     <span class="c1"># Local Hamiltonian</span>
                <span class="n">n_cycles</span>  <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>                           <span class="c1"># Number of QMC cycles</span>
                <span class="n">length_cycle</span> <span class="o">=</span> <span class="n">length_cycle</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>              <span class="c1"># Number of Monte Carlo moves in a cycle</span>
                <span class="n">n_warmup_cycles</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">,</span>                      <span class="c1"># Warmup cycles</span>
                <span class="p">)</span>
            <span class="c1"># Save iterations in archive</span>
            <span class="k">with</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="s1">&#39;../../../data/len_cyc_b</span><span class="si">%i</span><span class="s1">/half-U-lc</span><span class="si">%i</span><span class="s1">.h5&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">betas</span><span class="p">[</span><span class="n">b</span><span class="p">],</span> <span class="n">length_cycle</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span> <span class="k">as</span> <span class="n">A</span><span class="p">:</span>
                <span class="n">A</span><span class="p">[</span><span class="s1">&#39;a</span><span class="si">%i</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">i</span>] = S.auto_corr_time
                <span class="n">A</span><span class="p">[</span><span class="s1">&#39;b</span><span class="si">%i</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">i</span>] = S.average_order
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Define the function for fitting a curve</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
     <span class="k">return</span> <span class="n">a</span><span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">marker</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-^&#39;</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="s1">&#39;-s&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">betas</span><span class="p">)):</span>
    <span class="n">auto_corr_time</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">length_cycle</span><span class="p">)):</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="s1">&#39;../../../data/len_cyc_b</span><span class="si">%i</span><span class="s1">/half-U-lc</span><span class="si">%i</span><span class="s1">.h5&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">betas</span><span class="p">[</span><span class="n">b</span><span class="p">],</span> <span class="n">length_cycle</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">auto_corr_time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="s1">&#39;a0&#39;</span><span class="p">])</span>
    <span class="n">optimizedParameters</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">curve_fit</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">length_cycle</span><span class="p">,</span> <span class="n">auto_corr_time</span><span class="p">);</span>      <span class="c1"># Fit the curve</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">length_cycle</span><span class="p">,</span> <span class="n">func</span><span class="p">(</span><span class="n">length_cycle</span><span class="p">,</span> <span class="o">*</span><span class="n">optimizedParameters</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">length_cycle</span><span class="p">,</span> <span class="n">auto_corr_time</span><span class="p">,</span> <span class="n">marker</span><span class="p">[</span><span class="n">b</span><span class="p">],</span> <span class="n">fillstyle</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">betas</span>[b])
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.03</span><span class="o">/</span><span class="p">(</span><span class="mf">1.9</span><span class="o">**</span><span class="n">b</span><span class="p">),</span> <span class="sa">r</span><span class="s1">&#39;length_cycle$\sim </span><span class="si">%i</span><span class="s1">$ for $\beta=</span><span class="si">%i</span><span class="s1">$&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">optimizedParameters</span><span class="p">),</span> <span class="n">betas</span><span class="p">[</span><span class="n">b</span><span class="p">]),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="s1">&#39;Auto_correlation time will be</span><span class="se">\n</span><span class="s1">equal to one at:&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Auto-correlation time&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;length_cycle&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\beta(\frac</span><span class="si">{1}{eV}</span><span class="s1">)$&#39;</span><span class="p">,</span> <span class="n">title_fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="s1">&#39;$auto-correlation = 1$&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/guide_cthyb_convergence_tests_10_0.png" src="../_images/guide_cthyb_convergence_tests_10_0.png" />
</div>
</div>
<p>We observe that for example at <span class="math notranslate nohighlight">\(\beta=10\)</span>, the converged value of <code class="docutils literal notranslate"><span class="pre">length_cycle</span></code> (i.e.&nbsp;when <code class="docutils literal notranslate"><span class="pre">auto-correlation</span> <span class="pre">time</span></code> reaches one) is roughly 187. The calculation here has been performed for a fixed value of <code class="docutils literal notranslate"><span class="pre">n_cycles</span></code> and <code class="docutils literal notranslate"><span class="pre">n_warmup_cycles</span></code> , whereas they should ideally be increased with increasing <span class="math notranslate nohighlight">\(\beta\)</span>.</p>
</div>
<div class="section" id="2.-n_warmup_cycles">
<h2>2. n_warmup_cycles<a class="headerlink" href="#2.-n_warmup_cycles" title="Permalink to this headline"></a></h2>
<p>The system needs to be thermalized first, i.e.&nbsp;for the first few thousand cycles (<code class="docutils literal notranslate"><span class="pre">n_warmup_cycles</span></code>), we don’t make measurements. In order to have an estimate of how many cycles are needed for thermalization, we set <code class="docutils literal notranslate"><span class="pre">n_warmup_cycle</span></code> to be zero in the solver and plot the <code class="docutils literal notranslate"><span class="pre">average_order</span></code> versus the number of cycles. This way, measurements are made from the beginning and the number of cycles at which the <code class="docutils literal notranslate"><span class="pre">average_order</span></code> starts to saturate is a good estimate for <code class="docutils literal notranslate"><span class="pre">n_warmup_cycles</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">t</span> <span class="o">=</span> <span class="mf">1.0</span>    <span class="c1"># Half bandwidth</span>
<span class="n">betas</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">n_loops</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">n_cycles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">8000</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>

<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">betas</span><span class="p">)):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;../../../data/warm_up_b</span><span class="si">%i</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">betas</span>[b]):
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;../../../data/warm_up_b</span><span class="si">%i</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">betas</span>[b])

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n_cycles</span><span class="p">)):</span>
        <span class="n">S</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">(</span><span class="n">beta</span> <span class="o">=</span> <span class="n">betas</span><span class="p">[</span><span class="n">b</span><span class="p">],</span> <span class="n">gf_struct</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)])</span>
        <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span> <span class="o">&lt;&lt;</span> <span class="n">SemiCircular</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
        <span class="c1"># DMFT loop with self-consistency</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_loops</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Iteration = </span><span class="si">%i</span><span class="s2"> / </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_loops</span><span class="p">))</span>
            <span class="c1"># Symmetrize the Green&#39;s function and use self-consistency</span>
            <span class="n">g</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span> <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="p">[</span><span class="s1">&#39;down&#39;</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">g0</span> <span class="ow">in</span> <span class="n">S</span><span class="o">.</span><span class="n">G0_iw</span><span class="p">:</span>
                <span class="n">g0</span> <span class="o">&lt;&lt;</span> <span class="n">inverse</span><span class="p">(</span> <span class="n">iOmega_n</span> <span class="o">+</span> <span class="n">U</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">mu</span> <span class="o">-</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g</span> <span class="p">)</span>

                <span class="c1"># Solve the impurity problem</span>
            <span class="n">S</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">h_int</span> <span class="o">=</span> <span class="n">U</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>   <span class="c1"># Local Hamiltonian</span>
                <span class="n">n_cycles</span>  <span class="o">=</span> <span class="n">n_cycles</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>                   <span class="c1"># Number of QMC cycles</span>
                <span class="n">length_cycle</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>                        <span class="c1"># Number of Monte Carlo moves in a cycle</span>
                <span class="n">n_warmup_cycles</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>                       <span class="c1"># Warmup cycles</span>
                <span class="p">)</span>
            <span class="c1"># Save iterations in archive</span>
            <span class="k">with</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="s1">&#39;../../../data/warm_up_b</span><span class="si">%i</span><span class="s1">/half-U-wu</span><span class="si">%i</span><span class="s1">.h5&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">betas</span><span class="p">[</span><span class="n">b</span><span class="p">],</span> <span class="n">n_cycles</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span> <span class="k">as</span> <span class="n">A</span><span class="p">:</span>
                <span class="n">A</span><span class="p">[</span><span class="s1">&#39;a</span><span class="si">%i</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">i</span>] = S.auto_corr_time
                <span class="n">A</span><span class="p">[</span><span class="s1">&#39;b</span><span class="si">%i</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">i</span>] = S.average_order
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">marker</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-^&#39;</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="s1">&#39;-s&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">betas</span><span class="p">)):</span>
    <span class="n">average_order</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n_cycles</span><span class="p">)):</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="s1">&#39;../../../data/warm_up_b</span><span class="si">%i</span><span class="s1">/half-U-wu</span><span class="si">%i</span><span class="s1">.h5&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">betas</span><span class="p">[</span><span class="n">b</span><span class="p">],</span> <span class="n">n_cycles</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">average_order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="s1">&#39;b0&#39;</span><span class="p">])</span>
    <span class="n">average_order</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">average_order</span><span class="p">),</span> <span class="n">average_order</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_cycles</span><span class="p">,</span> <span class="n">average_order</span><span class="p">,</span> <span class="n">marker</span><span class="p">[</span><span class="n">b</span><span class="p">],</span> <span class="n">fillstyle</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">betas</span>[b])
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Average_order/maximum_order&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;n_cycles&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;n_warmup=0&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\beta(\frac</span><span class="si">{1}{eV}</span><span class="s1">)$&#39;</span><span class="p">,</span> <span class="n">title_fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/guide_cthyb_convergence_tests_14_0.png" src="../_images/guide_cthyb_convergence_tests_14_0.png" />
</div>
</div>
<p>The graph shows that for example at <span class="math notranslate nohighlight">\(\beta=50\)</span> almost 1000 <code class="docutils literal notranslate"><span class="pre">n_warmup_cycles</span></code> are enough to thermalize the system, but for <span class="math notranslate nohighlight">\(\beta=100\)</span> the thermalization is much slower. Again <code class="docutils literal notranslate"><span class="pre">length_cycles</span></code> is kept fixed here whereas it varies for different temperatures.</p>
</div>
<div class="section" id="3.-n_cycles">
<h2>3. n_cycles<a class="headerlink" href="#3.-n_cycles" title="Permalink to this headline"></a></h2>
<p>The Green’s function in imaginary time <span class="math notranslate nohighlight">\(G(\tau\)</span>) obtained from the solver for different number of <code class="docutils literal notranslate"><span class="pre">n_cycles</span></code> is plotted. Converged values of <code class="docutils literal notranslate"><span class="pre">length_cycle</span></code> and <code class="docutils literal notranslate"><span class="pre">n_warmup_cycles</span></code> are used from the previous tests. The Monte Carlo error should decay as $:nbsphinx-math:<cite>sim`$1/sqrt(``n_cycles`</cite>).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;../../../data/n_cycles_b10&#39;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;../../../data/n_cycles_b10&#39;</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="mf">1.0</span>   <span class="c1"># Half bandwidth</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">n_loops</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">n_cycles</span> <span class="o">=</span> <span class="p">[</span><span class="mi">32000</span><span class="p">,</span> <span class="mi">64000</span><span class="p">,</span> <span class="mi">128000</span><span class="p">,</span> <span class="mi">256000</span><span class="p">,</span> <span class="mi">512000</span><span class="p">,</span> <span class="mi">1024000</span><span class="p">,</span> <span class="mi">2048000</span><span class="p">]</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n_cycles</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;n_cycles =&#39;</span><span class="p">,</span> <span class="n">n_cycles</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">(</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gf_struct</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)])</span>
    <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span> <span class="o">&lt;&lt;</span> <span class="n">SemiCircular</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_loops</span><span class="p">):</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Iteration = </span><span class="si">%i</span><span class="s2"> / </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_loops</span><span class="p">))</span>
        <span class="c1"># Symmetrize the Green&#39;s function and use self-consistency</span>
        <span class="n">g</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span> <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="p">[</span><span class="s1">&#39;down&#39;</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">g0</span> <span class="ow">in</span> <span class="n">S</span><span class="o">.</span><span class="n">G0_iw</span><span class="p">:</span>
            <span class="n">g0</span> <span class="o">&lt;&lt;</span> <span class="n">inverse</span><span class="p">(</span> <span class="n">iOmega_n</span> <span class="o">+</span> <span class="n">U</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g</span> <span class="p">)</span>

        <span class="c1"># Solve the impurity problem</span>
        <span class="n">S</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">h_int</span> <span class="o">=</span> <span class="n">U</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>     <span class="c1"># Local Hamiltonian</span>
            <span class="n">n_cycles</span>  <span class="o">=</span> <span class="n">n_cycles</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>                     <span class="c1"># Number of QMC cycles</span>
            <span class="n">length_cycle</span> <span class="o">=</span> <span class="mi">187</span><span class="p">,</span>                          <span class="c1"># Number of Monte Carlo moves in a cycle</span>
            <span class="n">n_warmup_cycles</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>                      <span class="c1"># Warmup cycles</span>
            <span class="p">)</span>

        <span class="c1"># Save iterations in archive</span>
        <span class="k">with</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="s1">&#39;../../../data/n_cycles_b10/half-U-nc</span><span class="si">%i</span><span class="s1">k.h5&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">n_cycles</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">))</span> <span class="k">as</span> <span class="n">A</span><span class="p">:</span>
            <span class="n">A</span><span class="p">[</span><span class="s1">&#39;Gtau-</span><span class="si">%i</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">i</span>] = S.G_tau
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n_cycles</span><span class="p">)):</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="s1">&#39;../../../data/n_cycles_b10/half-U-nc</span><span class="si">%i</span><span class="s1">k.h5&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">n_cycles</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">oplot</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="s1">&#39;Gtau-0&#39;</span><span class="p">][</span><span class="s1">&#39;up&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;n_cycles = </span><span class="si">%i</span><span class="s2">&quot;</span><span class="o">%</span><span class="k">n_cycles</span>[j])
    <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">supylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$G(\tau)$&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;18&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">supxlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\tau$&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span> <span class="mf">0.07</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;18&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\beta=10 (\frac</span><span class="si">{1}{eV}</span><span class="s1">)$&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.93</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;18&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/guide_cthyb_convergence_tests_18_0.png" src="../_images/guide_cthyb_convergence_tests_18_0.png" />
</div>
</div>
<p>As you can see larger <code class="docutils literal notranslate"><span class="pre">n_cycles</span></code> gives a smoother Green’s function, i.e.&nbsp;a smaller error on <span class="math notranslate nohighlight">\(G(\tau\)</span>). It depends on the user’s needs in terms of accuracy as to how large <code class="docutils literal notranslate"><span class="pre">n_cycles</span></code> should be.</p>
</div>
<div class="section" id="4.-n_iw">
<h2>4. n_iw<a class="headerlink" href="#4.-n_iw" title="Permalink to this headline"></a></h2>
<p>The number of Matsubara frequencies used for the Green’s functions. The Green’s function should decay to zero for large <span class="math notranslate nohighlight">\(i\omega_n\)</span>, and capturing this behavior correctly is important for Fourier Transforms and physicality. Here, we plot the electron filling <code class="docutils literal notranslate"><span class="pre">n</span></code> for different sizes of the frequency mesh. The size of the Matsubara frequency mesh is important when calculating the electron filling <code class="docutils literal notranslate"><span class="pre">n</span></code>:</p>
<p>The definition of electron filling is <span class="math notranslate nohighlight">\(n = \langle c^\dagger c\rangle\)</span></p>
<p>and <span class="math notranslate nohighlight">\(\lim_{\tau\to 0} G(\tau) = n\)</span></p>
<p><span class="math notranslate nohighlight">\(G(\tau) = -\langle T c(\tau)c^\dagger\rangle = \langle T c^\dagger c(\tau)\rangle \rightarrow G(\tau=0^-) = \langle c^\dagger c\rangle = n\)</span></p>
<p>The Fourier transform of <span class="math notranslate nohighlight">\(G(\tau=0^-)\)</span> is the sum of <span class="math notranslate nohighlight">\(G(i\omega_n)\)</span> over Matsubara frequencies which is equal to the electron filling.</p>
<p><span class="math notranslate nohighlight">\(G(\tau=0^-)=\sum_{i\omega_n}{e^{i\omega_n0^-}G(i\omega_n)}=\sum_{i\omega_n}{G(i\omega_n)}\)</span></p>
<p>$:nbsphinx-math:<cite>Rightarrow `$ :math:`n=sum_{iomega_n}{G(iomega_n)}</cite></p>
<p>Therefore density converges only if enough number of Matsubabra frequencies <code class="docutils literal notranslate"><span class="pre">n_iw</span></code> are kept in the mesh.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">D</span> <span class="o">=</span> <span class="mf">1.5</span>  <span class="c1"># Half bandwidth</span>
<span class="n">beta</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
<span class="n">n_max</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">640</span><span class="p">]</span> <span class="c1"># Size of the Matsubara frequency mesh</span>
<span class="n">marker</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-^&#39;</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">beta</span><span class="p">)):</span>
    <span class="n">density</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n_max</span><span class="p">)):</span>
        <span class="n">iw_mesh</span> <span class="o">=</span> <span class="n">MeshImFreq</span><span class="p">(</span><span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">S</span><span class="o">=</span><span class="s1">&#39;Fermion&#39;</span><span class="p">,</span> <span class="n">n_max</span><span class="o">=</span><span class="n">n_max</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">Gf</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">iw_mesh</span><span class="p">,</span> <span class="n">target_shape</span><span class="o">=</span><span class="p">[])</span>
        <span class="n">G</span> <span class="o">&lt;&lt;</span> <span class="n">SemiCircular</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
        <span class="n">density</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">density</span><span class="p">())</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_max</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">marker</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fillstyle</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">beta</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">density</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">density</span><span class="p">))</span>
    <span class="n">density</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">abs</span><span class="p">,</span> <span class="n">density</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_max</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">marker</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fillstyle</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">beta</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\beta(\frac</span><span class="si">{1}{eV}</span><span class="s1">)$&#39;</span><span class="p">,</span> <span class="n">title_fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$n_{i\omega}$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$|n-0.5|$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\beta(\frac</span><span class="si">{1}{eV}</span><span class="s1">)$&#39;</span><span class="p">,</span> <span class="n">title_fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$n_{i\omega}$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING: High frequency moments have an error greater than 1e-4.
 Error = 0.000665894
 Please make sure you treat the constant offset analytically!
WARNING: High frequency moments have an error greater than 1e-4.
 Error = 0.00528623
 Please make sure you treat the constant offset analytically!
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/guide_cthyb_convergence_tests_23_1.png" src="../_images/guide_cthyb_convergence_tests_23_1.png" />
</div>
</div>
<p>The warning message printed is a hint that the frequency mesh is too small. Since we are working with the semi-circular density of states at half-filling, the electorn filling converges to 0.5. The error on <code class="docutils literal notranslate"><span class="pre">n</span></code> is plotted on the right which shows that electron filling converges with 320 Matsubara frquencies in the mesh.</p>
<p>So far, we have study the number of Matsubara frequencies only for non-interacting cases. However, interaction can renormalize the shape of the Green’s function, in which case it’s better to directly investigate the Green’s function instead of the electron filling. One can consider that there are enough numbers of Matsubara frequencies in the mesh if the Green’s function is in the <span class="math notranslate nohighlight">\(\frac{1}{\omega}\)</span> decay region (i.e.&nbsp;if the tail of the Green’s function is close to zero).</p>
<p>Below is an example of demonstrating the convergence by looking at the Green’s function (still for the non-interacting case).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">D</span> <span class="o">=</span> <span class="mf">1.5</span>  <span class="c1"># Half bandwidth</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">n_max</span> <span class="o">=</span> <span class="p">[</span><span class="mi">640</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n_max</span><span class="p">)):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">n_max</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">n_max</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
    <span class="n">iw_mesh</span> <span class="o">=</span> <span class="n">MeshImFreq</span><span class="p">(</span><span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="s1">&#39;Fermion&#39;</span><span class="p">,</span> <span class="n">n_max</span><span class="o">=</span><span class="n">n_max</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">Gf</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">iw_mesh</span><span class="p">,</span> <span class="n">target_shape</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">G</span> <span class="o">&lt;&lt;</span> <span class="n">SemiCircular</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="n">n_max</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">G</span><span class="o">.</span><span class="n">imag</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">n_max</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$n_{i\omega}$&#39;</span><span class="p">,</span> <span class="n">title_fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$G(i\omega_n)$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$\omega_n/\omega_</span><span class="si">{max}</span><span class="s2">$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\beta = </span><span class="si">%i</span><span class="s1"> (\frac</span><span class="si">{1}{eV}</span><span class="s1">)$&#39;</span><span class="o">%</span><span class="k">beta</span>, fontsize=16)
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/guide_cthyb_convergence_tests_26_0.png" src="../_images/guide_cthyb_convergence_tests_26_0.png" />
</div>
</div>
<p>Here the mesh with 640 frequencies is the best choice.</p>
</div>
<div class="section" id="5.-n_l">
<h2>5. n_l<a class="headerlink" href="#5.-n_l" title="Permalink to this headline"></a></h2>
<p>The number of Legendre polynomials to use in accumulations of the Green’s function. Representing the Green’s function in terms of Legendre polynomials is a compact basis representation described in <a class="reference external" href="https://journals.aps.org/prb/abstract/10.1103/PhysRevB.84.075145" rel="noopener noreferrer" target="_blank">PRB 84, 075145 (2011)</a>.</p>
<p><span class="math notranslate nohighlight">\(G(\mathcal{l})=\sqrt{2l+1}\int_0^{\beta}{d\tau}P_l[x(\tau)]G(\tau)\)</span></p>
<p>where <span class="math notranslate nohighlight">\(x(\tau)=2\tau/\beta -1\)</span> and <span class="math notranslate nohighlight">\(G(l)\)</span> denotes the coefficients of <span class="math notranslate nohighlight">\(G(\tau)\)</span> in Legendre basis.</p>
<p>We first need to define a function that transforms the Green’s function from the imaginary time domain to the Legendre basis.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">triqs.gf.tools</span> <span class="kn">import</span> <span class="n">fit_legendre</span>

<span class="k">def</span> <span class="nf">ImTime_to_Legendre</span><span class="p">(</span><span class="n">G_tau</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">G_l_cut</span><span class="o">=</span><span class="mf">1e-19</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Filter binned imaginary time Green&#39;s function</span>
<span class="sd">    using a Legendre filter of given order and coefficient threshold.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">g_l</span> <span class="o">=</span> <span class="n">fit_legendre</span><span class="p">(</span><span class="n">G_tau</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
    <span class="n">g_l</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span> <span class="o">*=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">g_l</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">G_l_cut</span><span class="p">)</span>
    <span class="n">g_l</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">enforce_discontinuity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">G_tau</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">target_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">g_l</span>
</pre></div>
</div>
</div>
<p>Next, the Green’s function in imaginary time <span class="math notranslate nohighlight">\(G(\tau\)</span>) is obtained from the solver at <span class="math notranslate nohighlight">\(\mathcal{\beta} = 50 (1/eV)\)</span> and <code class="docutils literal notranslate"><span class="pre">n_l</span></code>=60. We use the function defined in the previous cell to transform <span class="math notranslate nohighlight">\(G(\tau)\)</span> to the Legendre basis.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;../../../data/g_l&#39;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;../../../data/g_l&#39;</span><span class="p">)</span>

<span class="c1"># Parameters of the model</span>
<span class="n">t</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">n_loops</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">n_l</span> <span class="o">=</span> <span class="mi">60</span>
<span class="c1"># Construct the impurity solver</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">(</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span><span class="p">,</span> <span class="n">n_l</span><span class="o">=</span><span class="n">n_l</span><span class="p">,</span> <span class="n">gf_struct</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)])</span>
<span class="c1"># This is a first guess for G</span>
<span class="n">S</span><span class="o">.</span><span class="n">G_iw</span> <span class="o">&lt;&lt;</span> <span class="n">SemiCircular</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_loops</span><span class="p">):</span>

    <span class="n">g</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span> <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="p">[</span><span class="s1">&#39;down&#39;</span><span class="p">]</span> <span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">g0</span> <span class="ow">in</span> <span class="n">S</span><span class="o">.</span><span class="n">G0_iw</span><span class="p">:</span>
        <span class="n">g0</span> <span class="o">&lt;&lt;</span> <span class="n">inverse</span><span class="p">(</span> <span class="n">iOmega_n</span> <span class="o">+</span> <span class="n">U</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g</span> <span class="p">)</span>

    <span class="c1"># Solve the impurity problem</span>
    <span class="n">S</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">h_int</span> <span class="o">=</span> <span class="n">U</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>   <span class="c1"># Local Hamiltonian</span>
        <span class="n">n_cycles</span>  <span class="o">=</span> <span class="mi">256000</span><span class="p">,</span>                           <span class="c1"># Number of QMC cycles</span>
        <span class="n">length_cycle</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
        <span class="n">n_warmup_cycles</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">,</span>                      <span class="c1"># Warmup cycles</span>
        <span class="p">)</span>

    <span class="c1"># Save iteration in archive</span>
    <span class="k">with</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="s2">&quot;../../../data/g_l/half-U-nl</span><span class="si">%i</span><span class="s2">.h5&quot;</span><span class="o">%</span><span class="k">n_l</span>) as A:
        <span class="n">A</span><span class="p">[</span><span class="s1">&#39;Gtau-</span><span class="si">%i</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">i</span>] = S.G_tau
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">R</span> <span class="o">=</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="s1">&#39;../../../data/g_l/half-U-nl</span><span class="si">%i</span><span class="s1">.h5&#39;</span><span class="o">%</span><span class="k">n_l</span>, &#39;r&#39;)
<span class="n">G_l</span> <span class="o">=</span> <span class="n">ImTime_to_Legendre</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="s1">&#39;Gtau-0&#39;</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="n">n_l</span><span class="p">,</span> <span class="n">G_l_cut</span><span class="o">=</span><span class="mf">1e-19</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The cell below separates the odd and even parts of the Legendre Green’s function and the plot tells us how many Legendre plynomials we need to keep in our calcualtion. The cut-off point determines the error on <span class="math notranslate nohighlight">\(G(l)\)</span> and the solver more or less. The coefficients for odd <code class="docutils literal notranslate"><span class="pre">l</span></code> must be zero due to particle-hole symmetry.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">]</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">])</span>
<span class="n">d_even</span><span class="o">=</span><span class="p">[]</span>
<span class="n">d_odd</span><span class="o">=</span><span class="p">[]</span>
<span class="n">dim</span><span class="o">=</span><span class="n">G_l</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">x_even</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">x_odd</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">d_even</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">G_l</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">d_odd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">G_l</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_even</span><span class="p">,</span> <span class="n">d_even</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">MarkerStyle</span><span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">fillstyle</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;l even&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_odd</span><span class="p">,</span> <span class="n">d_odd</span><span class="p">,</span> <span class="s1">&#39;-^&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;l odd&#39;</span><span class="p">)</span>
<span class="n">d_even_abs</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">abs</span><span class="p">,</span> <span class="n">d_even</span><span class="p">))</span>
<span class="n">d_odd_abs</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">abs</span><span class="p">,</span> <span class="n">d_odd</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_even</span><span class="p">,</span> <span class="n">d_even_abs</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">MarkerStyle</span><span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">fillstyle</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_odd</span><span class="p">,</span> <span class="n">d_odd_abs</span><span class="p">,</span> <span class="s1">&#39;-^&#39;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.85</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$l$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$G(l)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$|G(l)|$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/guide_cthyb_convergence_tests_35_0.png" src="../_images/guide_cthyb_convergence_tests_35_0.png" />
</div>
</div>
<p>From inspecting this graph, it is clear that 35 coefficients (<code class="docutils literal notranslate"><span class="pre">l</span></code>) are enough to reach convergence. We can efficiently use this procedure as a noise filter by cutting the number of coefficients after <span class="math notranslate nohighlight">\(G(l)\)</span> reaches its minimum value.</p>
</div>
<div class="section" id="6.-n_tau">
<h2>6. n_tau<a class="headerlink" href="#6.-n_tau" title="Permalink to this headline"></a></h2>
<p>Number of imaginary time points used for the Green’s function. The CTHYB solver calculates the Green’s function at time differences that are randomly sampled, <span class="math notranslate nohighlight">\(G(\tau_i-\tau_j)\)</span> (where <span class="math notranslate nohighlight">\(\tau_i\)</span> and <span class="math notranslate nohighlight">\(\tau_j\)</span> are randomly chosen between 0 and <span class="math notranslate nohighlight">\(\beta\)</span>). Every <span class="math notranslate nohighlight">\(\tau\)</span> value of the grid is associated with a bin of a given width. If the number of <span class="math notranslate nohighlight">\(\tau\)</span> points that fall into each bin is small (or in other words there are a lot of bins, <code class="docutils literal notranslate"><span class="pre">n_tau</span></code> is large) then the
error in that bin will be large. Therefore, the plot of <span class="math notranslate nohighlight">\(G(\tau)\)</span> will show a lot of noise as <code class="docutils literal notranslate"><span class="pre">n_tau</span></code> is increased. However this does not matter because applying a Fourier transform on the Green’s function sums over all the bins and averages out the error. In fact <code class="docutils literal notranslate"><span class="pre">n_tau</span></code> should be as large as possible.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;../../../data/ntau-b10&#39;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;../../../data/ntau-b10&#39;</span><span class="p">)</span>

<span class="c1"># Parameters of the model</span>
<span class="n">t</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">n_loops</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">n_tau</span> <span class="o">=</span> <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">1001</span><span class="p">,</span> <span class="mi">10001</span><span class="p">]</span>
<span class="c1"># Construct the impurity solver</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n_tau</span><span class="p">)):</span>
    <span class="c1"># n_iw=math.floor((1/8)*n_tau[j])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;n_tau =&#39;</span><span class="p">,</span> <span class="n">n_tau</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">(</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span><span class="p">,</span> <span class="n">n_iw</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">n_tau</span><span class="o">=</span><span class="n">n_tau</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">gf_struct</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)])</span>
    <span class="c1"># This is a first guess for G</span>
    <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span> <span class="o">&lt;&lt;</span> <span class="n">SemiCircular</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_loops</span><span class="p">):</span>

        <span class="n">g</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span> <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">S</span><span class="o">.</span><span class="n">G_iw</span><span class="p">[</span><span class="s1">&#39;down&#39;</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">g0</span> <span class="ow">in</span> <span class="n">S</span><span class="o">.</span><span class="n">G0_iw</span><span class="p">:</span>
            <span class="n">g0</span> <span class="o">&lt;&lt;</span> <span class="n">inverse</span><span class="p">(</span> <span class="n">iOmega_n</span> <span class="o">+</span> <span class="n">U</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">g</span> <span class="p">)</span>

        <span class="c1"># Solve the impurity problem</span>
        <span class="n">S</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">h_int</span> <span class="o">=</span> <span class="n">U</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>   <span class="c1"># Local Hamiltonian</span>
            <span class="n">n_cycles</span>  <span class="o">=</span> <span class="mi">256000</span><span class="p">,</span>                           <span class="c1"># Number of QMC cycles</span>
            <span class="n">length_cycle</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
            <span class="n">n_warmup_cycles</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">,</span>                      <span class="c1"># Warmup cycles</span>
            <span class="p">)</span>

        <span class="c1"># Save iteration in archive</span>
        <span class="k">with</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="s2">&quot;../../../data/ntau-b10/half-U-ntau</span><span class="si">%i</span><span class="s2">.h5&quot;</span><span class="o">%</span><span class="k">n_tau</span>[j]) as A:
            <span class="n">A</span><span class="p">[</span><span class="s1">&#39;Gtau-</span><span class="si">%i</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">i</span>] = S.G_tau
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">n_tau</span> <span class="o">=</span> <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">1001</span><span class="p">,</span> <span class="mi">10001</span><span class="p">]</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n_tau</span><span class="p">)):</span>
    <span class="n">A1</span> <span class="o">=</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="s2">&quot;../../../data/ntau-b10/half-U-ntau</span><span class="si">%i</span><span class="s2">.h5&quot;</span><span class="o">%</span><span class="k">n_tau</span>[j], &#39;r&#39;)
    <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">oplot</span><span class="p">(</span><span class="n">A1</span><span class="p">[</span><span class="s1">&#39;Gtau-0&#39;</span><span class="p">][</span><span class="s1">&#39;up&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$n(\tau) = </span><span class="si">%i</span><span class="s2">$&quot;</span><span class="o">%</span><span class="k">n_tau</span>[j])
    <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">supylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$G(\tau)$&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;18&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">supxlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\tau$&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span> <span class="mf">0.07</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;18&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\beta=10 (\frac</span><span class="si">{1}{eV}</span><span class="s1">)$&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.93</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;18&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/guide_cthyb_convergence_tests_39_0.png" src="../_images/guide_cthyb_convergence_tests_39_0.png" />
</div>
</div>
<p>Applying Fourier transform on the Green’s function to go from imaginary time to imaginary frequency domain also shows that it is better to work with larger <code class="docutils literal notranslate"><span class="pre">n_tau</span></code>. As can be seen from the graph below, for small <code class="docutils literal notranslate"><span class="pre">n_tau</span></code> the Green’s function crosses zero which is not physical.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">triqs.gf</span> <span class="kn">import</span> <span class="n">Fourier</span>
<span class="kn">from</span> <span class="nn">triqs.gf</span> <span class="kn">import</span> <span class="n">make_gf_from_fourier</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">iw_mesh</span> <span class="o">=</span> <span class="n">MeshImFreq</span><span class="p">(</span><span class="n">beta</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="s1">&#39;Fermion&#39;</span><span class="p">,</span> <span class="n">n_max</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">gf_struct</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span>
<span class="n">ls</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">]</span>
<span class="n">Giw</span> <span class="o">=</span> <span class="n">BlockGf</span><span class="p">(</span><span class="n">mesh</span><span class="o">=</span><span class="n">iw_mesh</span><span class="p">,</span> <span class="n">gf_struct</span><span class="o">=</span><span class="n">gf_struct</span><span class="p">)</span>
<span class="n">n_tau</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10001</span><span class="p">,</span> <span class="mi">1001</span><span class="p">,</span> <span class="mi">101</span><span class="p">]</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n_tau</span><span class="p">)):</span>
    <span class="n">A1</span> <span class="o">=</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="s2">&quot;../../../data/ntau-b10/half-U-ntau</span><span class="si">%i</span><span class="s2">.h5&quot;</span><span class="o">%</span><span class="k">n_tau</span>[j], &#39;r&#39;)
    <span class="n">Giw</span> <span class="o">&lt;&lt;</span> <span class="n">Fourier</span><span class="p">(</span><span class="n">A1</span><span class="p">[</span><span class="s1">&#39;Gtau-0&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">oplot</span><span class="p">(</span><span class="n">Giw</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$n(\tau) = </span><span class="si">%i</span><span class="s2">$&quot;</span><span class="o">%</span><span class="k">n_tau</span>[j], linestyle=ls[j])
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING: Direct Fourier cannot deduce the high-frequency moments of G(tau) due to noise or a coarse tau-grid.     Please specify the high-frequency moments for higher accuracy.
WARNING: Direct Fourier cannot deduce the high-frequency moments of G(tau) due to noise or a coarse tau-grid.     Please specify the high-frequency moments for higher accuracy.
WARNING: Direct Fourier cannot deduce the high-frequency moments of G(tau) due to noise or a coarse tau-grid.     Please specify the high-frequency moments for higher accuracy.
[Direct Fourier] WARNING: The imaginary time mesh is less than six times as long as the number of positive frequencies.
This can lead to substantial numerical inaccuracies at the boundary of the frequency mesh.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/guide_cthyb_convergence_tests_42_1.png" src="../_images/guide_cthyb_convergence_tests_42_1.png" />
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="slater_five_band.html" class="btn btn-neutral float-left" title="Multiorbital impurity model" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../_ref/triqs_cthyb.multiplet_tools.html" class="btn btn-neutral float-right" title="triqs_cthyb.multiplet_tools" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2014-2021, Simons Foundation, P. Seth, I. Krivenko, H. Strand, M. Ferrero, O. Parcollet.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
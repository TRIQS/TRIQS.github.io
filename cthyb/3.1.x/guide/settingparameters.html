

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Setting the parameters &mdash; TRIQS Hybridization Expansion Solver  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=default"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Random number generators" href="random.html" />
    <link rel="prev" title="An example: the Anderson impurity model" href="aim.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #7E588A" >
          

          
            <a href="../index.html" class="icon icon-home"> TRIQS Hybridization Expansion Solver
          

          
          </a>

          
            
            
              <div class="version">
                3.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Install CTHYB</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html#packaged-versions-of-cthyb">Packaged Versions of CTHyb</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../install.html#ubuntu-debian-packages">Ubuntu Debian packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#anaconda-experimental">Anaconda (experimental)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#id2">Docker</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../install.html#compiling-cthyb-from-source">Compiling CTHYB from source</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../install.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#installation-steps">Installation steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#version-compatibility">Version compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#custom-cmake-options">Custom CMake options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../documentation.html">Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#basic-notions">Basic notions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../basicnotions/cthyb.html">A word on the algorithm</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../documentation.html#user-guide">User guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="aim.html">An example: the Anderson impurity model</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Setting the parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#step-1-construct-the-solver-instance">Step 1 - construct the solver instance</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#step-2-the-hamiltonian">Step 2 - the Hamiltonian</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id1">Examples</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#step-3-the-monte-carlo-parameters">Step 3 - the Monte Carlo parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-6-legendre-or-not">Step 6 - Legendre or not?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-7-prepare-the-non-interacting-green-s-function">Step 7 - prepare the non-interacting Green’s function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-8-we-re-ready-to-go">Step 8 - we’re ready to go!</a></li>
<li class="toctree-l4"><a class="reference internal" href="#final-step-analyze-the-output">Final Step - analyze the output</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="random.html">Random number generators</a></li>
<li class="toctree-l3"><a class="reference internal" href="dmft.html">Building DMFT calculations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="dmft.html#plain-vanilla-dmft-the-bethe-lattice">Plain-vanilla DMFT: the Bethe lattice</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="slater_five_band.html">Another example: a multiorbital impurity model</a></li>
<li class="toctree-l3"><a class="reference internal" href="static_observables_notebook.html">Measuring static observables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="static_observables_notebook.html#Measuring-\hat{\rho}_\mathrm{imp}-in-cthyb">Measuring <span class="math notranslate nohighlight">\(\hat{\rho}_\mathrm{imp}\)</span> in cthyb</a></li>
<li class="toctree-l4"><a class="reference internal" href="static_observables_notebook.html#Compute-expactation-values-of-static-observables">Compute expactation values of static observables</a></li>
<li class="toctree-l4"><a class="reference internal" href="static_observables_notebook.html#Evaluation-of-the-impurity-interaction-energy">Evaluation of the impurity interaction energy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="multiplet_analysis_notebook.html">Multiplet analysis &amp; particle number histograms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="multiplet_analysis_notebook.html#Analysis-of-results">Analysis of results</a><ul>
<li class="toctree-l5"><a class="reference internal" href="multiplet_analysis_notebook.html#plot-particle-number-histogram">plot particle number histogram</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="multiplet_analysis_notebook.html#More-complex-example">More complex example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="dynamic_susceptibility_notebook.html">Dynamical spin-spin susceptibility <span class="math notranslate nohighlight">\(\chi_{S_z S_z}(\tau)\)</span></a></li>
<li class="toctree-l3"><a class="reference internal" href="perturbation_order_notebook.html">Perturbation order histograms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="perturbation_order_notebook.html#Plotting-perturbation-order-histograms">Plotting perturbation order histograms</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#reference-manual">Reference manual</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/solver.html">Solver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/constr_parameters.html">constr() parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/solve_parameters.html">solve() parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/moves.html">QMC moves</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/moves.html#insert-one-pair-of-operators">Insert one pair of operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/moves.html#remove-one-pair-of-operators">Remove one pair of operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/moves.html#insert-two-pairs-of-operators">Insert two pairs of operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/moves.html#remove-two-pairs-of-operators">Remove two pairs of operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/moves.html#shift-one-operator">Shift one operator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/moves.html#global-move-change-of-operator-indices">Global move - change of operator indices</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/measurements.html">Measurements: definitions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/measurements.html#green-s-function">Green’s function</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../reference/measurements.html#imaginary-time">Imaginary time</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/measurements.html#legendre-polynomial-basis">Legendre polynomial basis</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../reference/measurements.html#local-susceptibility-and-other-operator-pairs">Local susceptibility and other operator pairs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/measurements.html#two-particle-green-s-functions">Two-particle Green’s functions</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../reference/measurements.html#imaginary-time-binning">Imaginary time binning</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/measurements.html#matsubara-frequency-measurements">Matsubara frequency measurements</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/measurements.html#mixed-matsubara-frequency-and-legendre-measurements">Mixed Matsubara Frequency and Legendre measurements</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../reference/measurements.html#impurity-density-matrix">Impurity density matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/measurements.html#perturbation-order-histograms">Perturbation order histograms</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/measurements.html#average-sign">Average sign</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/multiplet.html">Utility functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#faqs">FAQs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../faqs.html">Frequently-asked questions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../faqs.html#q-why-is-my-code-running-so-slowly">Q: Why is my code running so slowly?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs.html#q-how-do-i-save-the-triqs-and-cthyb-hash-and-script-for-debugging-purposes">Q: How do I save the triqs and cthyb hash and script for debugging purposes?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs.html#q-why-does-my-data-look-so-noisy">Q: Why does my data look so noisy?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../faqs.html#q-how-do-i-use-the-segment-picture">Q: How do I use the segment picture?</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ChangeLog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-1-0">Version 3.1.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#general">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#jenkins">jenkins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#doc">doc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#cmake">cmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#gh-actions">gh-actions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-0-0">Version 3.0.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#fundamental-green-function-symmetries">Fundamental Green Function Symmetries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#dependency-management">Dependency Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#other-changes">Other Changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-2-1">Version 2.2.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id2">doc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id3">General</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-2-0">Version 2.2.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id4">cmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id5">doc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id6">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#h5">h5</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#packaging">packaging</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-1-0">Version 2.1.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#contributors">Contributors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#testers">Testers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#changes-in-installation-and-cmake-files">Changes in installation and cmake files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#solver-interface">Solver Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#changes-in-behavior">Changes in behavior</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#dependencies">Dependencies</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">Authors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about.html#citation">Citation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#license">License</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#disclaimer">Disclaimer</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">TRIQS Hybridization Expansion Solver</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../documentation.html">Documentation</a> &raquo;</li>
        
      <li>Setting the parameters</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/guide/settingparameters.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="setting-the-parameters">
<h1>Setting the parameters<a class="headerlink" href="#setting-the-parameters" title="Permalink to this headline">¶</a></h1>
<p>Here’s a step-by-step guide that should show you how to prepare a CTQMC run.
Take the time to go through this little guide as it can help you avoid doing
simple mistakes.</p>
<div class="section" id="step-1-construct-the-solver-instance">
<h2>Step 1 - construct the solver instance<a class="headerlink" href="#step-1-construct-the-solver-instance" title="Permalink to this headline">¶</a></h2>
<p>At first you need to create an instance of the CTQMC solver class. This is done
with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">triqs.operators</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">triqs.applications.impurity_solvers.cthyb</span> <span class="kn">import</span> <span class="n">Solver</span>

<span class="c1"># Create a solver instance</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">(</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gf_struct</span> <span class="o">=</span> <span class="n">gf_struct</span><span class="p">)</span>
</pre></div>
</div>
<p>The first parameter of the solver is the inverse temperature. In order to
complete the construction of the instance, you need to figure out what is the
correct structure of the Green’s function for the problem you are considering.
You should always try to take advantage of a possible block structure of the
Green’s function. In a spin-conserving system, the Green’s function can often
be (at least) cut into <em>up</em> and <em>down</em> spin sectors.  When the structure is
clear you can set the parameter <code class="docutils literal notranslate"><span class="pre">gf_struct</span></code>, which is a <code class="docutils literal notranslate"><span class="pre">list()</span></code> or pairs,
each containing the name of the block and the size of the block.</p>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">For a single-band Hubbard model with a local Coulomb interaction, the Green’s function
can be cut in two up/down blocks of size 1. We would have:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gf_struct</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">]</span>
</pre></div>
</div>
</li>
<li><p class="first">For a two-band Hubbard model with a hybridization between the bands, the Green’s function
can be cut in two up/down blocks, but there are off-diagonal orbital elements. We have:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gf_struct</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="step-2-the-hamiltonian">
<h2>Step 2 - the Hamiltonian<a class="headerlink" href="#step-2-the-hamiltonian" title="Permalink to this headline">¶</a></h2>
<p>The solver instance is ready. Now you need to prepare all the parameters
that will enter the <code class="docutils literal notranslate"><span class="pre">solve()</span></code> method and start the calculation. So
the next step is to describe the local Hamiltonian. This is the Hamiltonian
acting on the effective impurity sites/orbitals. It is very important to
<strong>include only the quartic terms and not the quadratic terms</strong> in this
Hamiltonian. The latter terms will be computed from the kownledge of the
non-interacting Green’s function <code class="docutils literal notranslate"><span class="pre">S.G0_iw</span></code> as explained below (see Step 7). The
interacting Hamiltonian is given in the parameter <code class="docutils literal notranslate"><span class="pre">h_int</span></code>.
with the use of <a class="reference external" href="https://triqs.github.io/triqs/latest/documentation/manual/triqs/operators/contents.html#operators" rel="noopener noreferrer" target="_blank" title="(in TRIQS v3.0.2)"><span class="xref std std-ref">second-quantization operators</span></a>.
The arguments in the parenthesis of the <code class="docutils literal notranslate"><span class="pre">c()</span></code>, <code class="docutils literal notranslate"><span class="pre">c_dag()</span></code>
and <code class="docutils literal notranslate"><span class="pre">n()</span></code> operators must be compatible with the structure of the Green’s
function <code class="docutils literal notranslate"><span class="pre">gf_struct</span></code>.</p>
<div class="section" id="id1">
<h3>Examples<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">For a single-band Hubbard model with a local Coulomb interaction:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">h_int</span> <span class="o">=</span> <span class="n">U</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Two-orbital Hubbard model, no inter-orbital interaction, but a hybridization
between the bands (this term will not appear in the local Hamiltonian!):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">h_int</span> <span class="o">=</span> <span class="n">U</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="step-3-the-monte-carlo-parameters">
<h2>Step 3 - the Monte Carlo parameters<a class="headerlink" href="#step-3-the-monte-carlo-parameters" title="Permalink to this headline">¶</a></h2>
<p>There are three parameters that control how many steps and measures are done
during the Monte Carlo sampling. <code class="docutils literal notranslate"><span class="pre">n_cycles</span></code> is the total number of measurement
cycles done. A cycle has <code class="docutils literal notranslate"><span class="pre">length_cycle</span></code> Monte Carlo moves in it.  The
measurements start after <code class="docutils literal notranslate"><span class="pre">n_warmup_cycles</span></code> cycles have been made and there is
a measurement at the end of every cycle. At the end of the run, there will be
<code class="docutils literal notranslate"><span class="pre">n_cycles</span></code> measurements and a total of (<code class="docutils literal notranslate"><span class="pre">n_warmup_cycles</span></code> + <code class="docutils literal notranslate"><span class="pre">n_cycles</span></code>) x
<code class="docutils literal notranslate"><span class="pre">length_cycle</span></code>) moves.</p>
<p>When the solver is spread on a parallel machine, each core will do <code class="docutils literal notranslate"><span class="pre">n_cycles</span></code>
measurements cycles and <code class="docutils literal notranslate"><span class="pre">n_warmup_cycles</span></code> warmup cycles. Therefore the same
input run on a larger number of cores will yield a larger statistics.</p>
</div>
<div class="section" id="step-6-legendre-or-not">
<h2>Step 6 - Legendre or not?<a class="headerlink" href="#step-6-legendre-or-not" title="Permalink to this headline">¶</a></h2>
<p>The CTQMC algorithm computes the Green’s function on the imaginary-time
interval <span class="math notranslate nohighlight">\([0,\beta]\)</span>. By default, <span class="math notranslate nohighlight">\(G(\tau)\)</span> is computed by binning
measurements in <span class="math notranslate nohighlight">\(n_{\tau}\)</span> bins. However, in order to gain memory and to
reduce high-frequency noise, the Green’s function may be expanded on a basis of
<code class="docutils literal notranslate"><span class="pre">n_l</span></code> Legendre polynomials by setting the parameter <code class="docutils literal notranslate"><span class="pre">measure_g_l</span></code> to True.
The question is, how many of these polynomials should one use? Our
recommendation is to do a first <em>test</em> run with a large number of coefficients,
say 80. When the run is over, one can inspect the Legendre Green’s function and
decide how many coefficients should be kept. This will be detailed below.</p>
</div>
<div class="section" id="step-7-prepare-the-non-interacting-green-s-function">
<h2>Step 7 - prepare the non-interacting Green’s function<a class="headerlink" href="#step-7-prepare-the-non-interacting-green-s-function" title="Permalink to this headline">¶</a></h2>
<p>The last step before starting the solver is to prepare the non-interacting
Green’s function of the problem. From the knowledge of this Green’s function,
the solver can extract the hybridization function used in the algorithm and the
quadratic terms of the local Hamiltonian. The non-interacting Green’s function
must be initialized in the member <code class="docutils literal notranslate"><span class="pre">G0_iw</span></code> of the solver instance. For example,
one would write</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">g0</span> <span class="ow">in</span> <span class="n">S</span><span class="o">.</span><span class="n">G0_iw</span><span class="p">:</span>
  <span class="n">g0</span> <span class="o">&lt;&lt;</span> <span class="n">inverse</span><span class="p">(</span><span class="n">iOmega_n</span> <span class="o">-</span> <span class="n">e_f</span> <span class="o">-</span> <span class="n">V</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Wilson</span><span class="p">(</span><span class="n">D</span><span class="p">))</span>
</pre></div>
</div>
<p>to initialize the Green’s function of an impurity embedded in a flat conduction
bath.</p>
</div>
<div class="section" id="step-8-we-re-ready-to-go">
<h2>Step 8 - we’re ready to go!<a class="headerlink" href="#step-8-we-re-ready-to-go" title="Permalink to this headline">¶</a></h2>
<p>Everything is ready at this stage and you just need to call the <code class="docutils literal notranslate"><span class="pre">solve()</span></code>
member of the solver with all the information you prepared, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">S</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">h_int</span> <span class="o">=</span> <span class="n">U</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">n_cycles</span>  <span class="o">=</span> <span class="mi">500000</span><span class="p">,</span>
        <span class="n">length_cycle</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
        <span class="n">n_warmup_cycles</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
<p>or alternatively by predefining a dict of params:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">p</span><span class="p">[</span><span class="s1">&#39;n_warmup_cycles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">p</span><span class="p">[</span><span class="s1">&#39;n_cycles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500000</span>
<span class="n">p</span><span class="p">[</span><span class="s1">&#39;length_cycle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">S</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">h_int</span> <span class="o">=</span> <span class="n">U</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="o">**</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>When you call the solver, the local Hamiltonian (with the quadratic terms) is
shown. Be careful to check that this is indeed the Hamiltonian that you expect!
At the end of the run, the solver has computed the following objects:</p>
<blockquote>
<div><ul class="simple">
<li>The interacting Green’s function of the problem on the imaginary time
axis. This is in the class member <code class="docutils literal notranslate"><span class="pre">G_tau</span></code>.</li>
<li>The interacting Green’s function of the problem on the Matsubara frequency
axis. This is in the class member <code class="docutils literal notranslate"><span class="pre">G_iw</span></code>.</li>
<li>The interacting Legendre Green’s function of the problem, if <cite>measure_g_l=True</cite>.
This is put in the member <code class="docutils literal notranslate"><span class="pre">G_l</span></code>. This output is useful to decide how many
Legendre coefficients should be used.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="final-step-analyze-the-output">
<h2>Final Step - analyze the output<a class="headerlink" href="#final-step-analyze-the-output" title="Permalink to this headline">¶</a></h2>
<p>One of the most important checks that needs to be done is to ensure that the
high-frequency behaviour of your imaginary frequency Green’s function and
self-energy are correct and lead to physically sensible values. You should use
the fitting function <code class="docutils literal notranslate"><span class="pre">tail_fit</span></code> (provided in <code class="docutils literal notranslate"><span class="pre">triqs.gf</span></code>) to determine the
optimal fitting parameters <code class="docutils literal notranslate"><span class="pre">fit_min_n</span></code> and <code class="docutils literal notranslate"><span class="pre">fit_max_n</span></code>.
This post-processing task can also be delegated to the <code class="docutils literal notranslate"><span class="pre">Solver</span></code> object by
setting <code class="docutils literal notranslate"><span class="pre">perform_tail_fit</span> <span class="pre">=</span> <span class="pre">True</span></code> and other <a class="reference internal" href="../reference/solver.html#ctqmc-ref"><span class="std std-ref">solve()</span></a>
parameters related to tail fitting.</p>
<p>If you use the Legendre expansion, you should also decide on the ideal number
of Legendre coefficients to keep for the following runs. If you have saved the
Legendre Green’s function in an archive, you can then plot it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">triqs.gf</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">h5</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">triqs.plot.mpl_interface</span> <span class="kn">import</span> <span class="n">oplot</span>

<span class="n">A</span> <span class="o">=</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="s2">&quot;aim_solution.h5&quot;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">oplot</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="s1">&#39;G_l&#39;</span><span class="p">][</span><span class="s1">&#39;up&#39;</span><span class="p">],</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">x_window</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">45</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../../../../home/build/cthyb/doc/../../../../src/cthyb/doc/guide/legendre_plot.py" rel="noopener noreferrer" target="_blank">Source code</a>, <a class="reference external" href="../../../../home/build/cthyb/doc/../../../../src/cthyb/doc/guide/legendre_plot.png" rel="noopener noreferrer" target="_blank">png</a>, <a class="reference external" href="../../../../home/build/cthyb/doc/../../../../src/cthyb/doc/guide/legendre_plot.hires.png" rel="noopener noreferrer" target="_blank">hires.png</a>, <a class="reference external" href="../../../../home/build/cthyb/doc/../../../../src/cthyb/doc/guide/legendre_plot.pdf" rel="noopener noreferrer" target="_blank">pdf</a>)</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../_images/legendre_plot.png"><img alt="../_images/legendre_plot.png" src="../_images/legendre_plot.png" style="width: 358.4px; height: 268.79999999999995px;" /></a>
</div>
<p>From this plot you see that for <span class="math notranslate nohighlight">\(l &gt; 30\)</span>, the value of the
coefficient is of the order of the statistical noise. There is therefore no
information in the coefficients with <span class="math notranslate nohighlight">\(l &gt; 30\)</span> and one can set
<code class="docutils literal notranslate"><span class="pre">n_l</span> <span class="pre">=</span> <span class="pre">30</span></code> for the following runs. Of course, if you are going to use
more statistics or a larger number of cores, you may have to readjust this
value.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="random.html" class="btn btn-neutral float-right" title="Random number generators" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="aim.html" class="btn btn-neutral float-left" title="An example: the Anderson impurity model" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2014-2021, Simons Foundation, P. Seth, I. Krivenko, H. Strand, M. Ferrero, O. Parcollet.

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
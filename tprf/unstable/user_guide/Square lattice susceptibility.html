
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Square lattice susceptibility and the Random Phase Approximation (RPA) &#8212; TPRF - Two-Particle Response Function tool box for TRIQS  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/triqs.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=default"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>
    <script src="../_static/cufon-yui.js" type="text/javascript"></script>
    <script src="../_static/spaceman.cufonfonts.js" type="text/javascript"></script>
    <script type="text/javascript">
      Cufon.replace('.triqs', { fontFamily: 'spaceman', hover: true }); 
    </script>
 
    <style type="text/css">
      table.right { float: right; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
      
    </style>

  </head><body>
<div class="pageheader">
  <ul>
    
    <li><a href="../install.html">Install</a></li>
    
    <li><a href="../documentation.html">Documentation</a></li>
    
    <li><a href="../issues.html">Issues</a></li>
    
    <li><a href="../about.html">About tprf</a></li>
    
  </ul>
  <div>
    <h1 style="padding:0; margin: 10px 0 0 0;"><a class="triqs" href="../index.html">tprf</a></h1>
    <span style="font-size: 14px; margin: 0px; padding: 0px;">Two-particle response function tool box based on the <a class="triqs" style="font-size: 12px" href="https://triqs.github.io">TRIQS</a> library</span>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
    <li><a href="../index.html">Home</a> &raquo;</li>

        <li class="nav-item nav-item-this"><a href="">Square lattice susceptibility and the Random Phase Approximation (RPA)</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Square lattice susceptibility and the Random Phase Approximation (RPA)</a><ul>
<li><a class="reference internal" href="#Tight-binding-Hamiltonian">Tight binding Hamiltonian</a></li>
<li><a class="reference internal" href="#Dispersion-\epsilon(\mathbf{k})-and-Fermi-surface">Dispersion <span class="math notranslate nohighlight">\(\epsilon(\mathbf{k})\)</span> and Fermi surface</a></li>
<li><a class="reference internal" href="#Bare-generalized-susceptibility-\chi_0">Bare generalized susceptibility <span class="math notranslate nohighlight">\(\chi_0\)</span></a></li>
<li><a class="reference internal" href="#Physical-response-function-\chi_{S_z,-S_z}">Physical response function <span class="math notranslate nohighlight">\(\chi_{S_z, S_z}\)</span></a></li>
<li><a class="reference internal" href="#Random-phase-approximation-(RPA)">Random phase approximation (RPA)</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/user_guide/Square lattice susceptibility.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 7ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Square-lattice-susceptibility-and-the-Random-Phase-Approximation-(RPA)">
<h1>Square lattice susceptibility and the Random Phase Approximation (RPA)<a class="headerlink" href="#Square-lattice-susceptibility-and-the-Random-Phase-Approximation-(RPA)" title="Permalink to this headline">¶</a></h1>
<p>A nice example of two-particle response functions is the two-dimensional square lattice with nearest neighbour hopping <span class="math notranslate nohighlight">\(t\)</span>. Here we will use <code class="docutils literal notranslate"><span class="pre">TRIQS</span></code> and <code class="docutils literal notranslate"><span class="pre">TPRF</span></code> routines to compute the bare generalized susceptibility</p>
<div class="math notranslate nohighlight">
\[\chi_{0, abcd}(i \omega_n, \mathbf{k}) ,\]</div>
<p>and the generalized susecptibility in the random phase approximation (RPA)</p>
<div class="math notranslate nohighlight">
\[\chi^{(RPA)}_{abcd}(i\omega_n, \mathbf{k}) .\]</div>
<p>In order to do this we first have to setup the tight binding Hamiltonian <span class="math notranslate nohighlight">\(H\)</span>, the single particle dispersion <span class="math notranslate nohighlight">\(\epsilon(\mathbf{k})\)</span>, and the single-particle Green’s function <span class="math notranslate nohighlight">\(G_0(i\omega_n, \mathbf{k})\)</span> of the system.</p>
<div class="section" id="Tight-binding-Hamiltonian">
<h2>Tight binding Hamiltonian<a class="headerlink" href="#Tight-binding-Hamiltonian" title="Permalink to this headline">¶</a></h2>
<p>The tight binding Hamiltonian of the square lattice with nearest neigbhour hopping <span class="math notranslate nohighlight">\(t\)</span> takes the form</p>
<div class="math notranslate nohighlight">
\[H = -t \sum_{\langle i, j \rangle, \sigma}
\Big( c^\dagger_{\sigma i} c_{\sigma j} +
      c^\dagger_{\sigma j} c_{\sigma i} \Big)\]</div>
<p>where <span class="math notranslate nohighlight">\(c^\dagger_{\sigma i}\)</span> creates a fermion with spin <span class="math notranslate nohighlight">\(\sigma \in \{\uparrow, \downarrow\}\)</span> on lattice site <span class="math notranslate nohighlight">\(i\)</span>, and <span class="math notranslate nohighlight">\(\langle i, j \rangle\)</span> denotes summation over nearest neighbours <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span>.</p>
<p>A representation of <span class="math notranslate nohighlight">\(H\)</span> can be constructed using the <code class="docutils literal notranslate"><span class="pre">TBLattice</span></code> class in <code class="docutils literal notranslate"><span class="pre">triqs_tprf.tight_binding</span></code> where the hoppings are given as a dictionary with relative coordinate vectors as keys and hopping matrices as values. The unit vectors of the lattice, the position of the site local orbitals and names also needs to be setup, see below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">triqs_tprf.tight_binding</span> <span class="kn">import</span> <span class="n">TBLattice</span>

<span class="n">t</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">TBLattice</span><span class="p">(</span>
    <span class="n">units</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
    <span class="n">hopping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># nearest neighbour hopping -t</span>
        <span class="p">(</span> <span class="mi">0</span><span class="p">,</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span> <span class="o">-</span><span class="n">t</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
        <span class="p">(</span> <span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="o">-</span><span class="n">t</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
        <span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="o">-</span><span class="n">t</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
        <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="o">-</span><span class="n">t</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
        <span class="p">},</span>
    <span class="n">orbital_positions</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">orbital_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="s1">&#39;do&#39;</span><span class="p">],</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Starting on 1 Nodes at : 2019-06-05 17:03:01.636154
</pre></div></div>
</div>
</div>
<div class="section" id="Dispersion-\epsilon(\mathbf{k})-and-Fermi-surface">
<h2>Dispersion <span class="math notranslate nohighlight">\(\epsilon(\mathbf{k})\)</span> and Fermi surface<a class="headerlink" href="#Dispersion-\epsilon(\mathbf{k})-and-Fermi-surface" title="Permalink to this headline">¶</a></h2>
<p>The Fourier transform of the real space hopping to momentum space <span class="math notranslate nohighlight">\(\mathbf{k}\)</span> gives the momentum space dispersion <span class="math notranslate nohighlight">\(\epsilon(\mathbf{k})\)</span> and the alternative representation of <span class="math notranslate nohighlight">\(H\)</span> as</p>
<div class="math notranslate nohighlight">
\[H = \sum_{\mathbf{k}}
\epsilon(\mathbf{k}) c^\dagger_{\sigma \mathbf{k}} c_{\sigma \mathbf{k}}\]</div>
<p>In order to work with <span class="math notranslate nohighlight">\(\epsilon(\mathbf{k})\)</span> numerically we use a discretized representation with an equidistant mesh in <span class="math notranslate nohighlight">\(k_x\)</span> and <span class="math notranslate nohighlight">\(k_y\)</span> using the <code class="docutils literal notranslate"><span class="pre">TRIQS</span></code> mesh <code class="docutils literal notranslate"><span class="pre">MeshBrZone</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">e_k</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">on_mesh_brillouin_zone</span><span class="p">(</span><span class="n">n_k</span> <span class="o">=</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">e_k</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Green Function  with mesh Brillouin Zone Mesh with linear dimensions (32 32 1)
 -- units =
[[0.19635,0,0]
 [0,0.19635,0]
 [0,0,6.28319]]
 -- periodization_matrix =
[[32,0,0]
 [0,32,0]
 [0,0,1]]
 -- Domain: Brillouin Zone with dimension 2, reciprocal matrix
[[6.28319,0,0]
 [0,6.28319,0]
 [0,0,6.28319]] and target_rank 2:

</pre></div></div>
</div>
<p>To visualize <span class="math notranslate nohighlight">\(\epsilon(\mathbf{k})\)</span> we can plot it along the high-symmetry path <span class="math notranslate nohighlight">\(\Gamma - X - M - \Gamma\)</span> in the Brillouin zone.</p>
<p>To build the <span class="math notranslate nohighlight">\(\mathbf{k}\)</span>-space path we use the helper function <code class="docutils literal notranslate"><span class="pre">triqs_tprf.lattice_utils.k_space_path</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span> <span class="o">*</span> <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span> <span class="o">*</span> <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span> <span class="o">*</span> <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

<span class="n">paths</span> <span class="o">=</span> <span class="p">[(</span><span class="n">G</span><span class="p">,</span> <span class="n">X</span><span class="p">),</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">M</span><span class="p">),</span> <span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">G</span><span class="p">)]</span>

<span class="kn">from</span> <span class="nn">triqs_tprf.lattice_utils</span> <span class="kn">import</span> <span class="n">k_space_path</span>
<span class="n">k_vecs</span><span class="p">,</span> <span class="n">k_plot</span><span class="p">,</span> <span class="n">K_plot</span> <span class="o">=</span> <span class="n">k_space_path</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
<span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">kz</span> <span class="o">=</span> <span class="n">k_vecs</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<p>and to evaluate <span class="math notranslate nohighlight">\(\epsilon(\mathbf{k})\)</span> on the path we use a lambda function and the call operator of <code class="docutils literal notranslate"><span class="pre">e_k([k_x,</span> <span class="pre">k_y,</span> <span class="pre">k_z])</span></code> which interpolates on the discretized mesh.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">e_k_interp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">kz</span> <span class="p">:</span> <span class="n">e_k</span><span class="p">([</span><span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">kz</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="n">e_k_interp</span> <span class="o">=</span> <span class="n">e_k_interp</span><span class="p">(</span><span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">kz</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_plot</span><span class="p">,</span> <span class="n">e_k_interp</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">K_plot</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="sa">r</span><span class="s1">&#39;$\Gamma$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$X$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$M$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\Gamma$&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\epsilon(\mathbf{k})$&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/user_guide_Square_lattice_susceptibility_9_0.svg" src="../_images/user_guide_Square_lattice_susceptibility_9_0.svg" /></div>
</div>
<p>From this we can see that the bandwidth is <span class="math notranslate nohighlight">\(4t\)</span> (with <span class="math notranslate nohighlight">\(t=1\)</span>) and that we have a Van Hove singularity at the <span class="math notranslate nohighlight">\(M\)</span> point.</p>
<p>To visualize the dispersion in the <span class="math notranslate nohighlight">\((k_x, k_y)\)</span> plane and the half-filled fermi surface where <span class="math notranslate nohighlight">\(\epsilon(\mathbf{k}) = 0\)</span> we interpolate <code class="docutils literal notranslate"><span class="pre">e_k</span></code> on a two-dimensional grid and use <code class="docutils literal notranslate"><span class="pre">matplotlib.pyplot.contour</span></code> to plot the zero contour.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span> <span class="o">*</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">Kx</span><span class="p">,</span> <span class="n">Ky</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

<span class="n">e_k_interp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="k">lambda</span> <span class="n">kx</span><span class="p">,</span> <span class="n">ky</span> <span class="p">:</span> <span class="n">e_k</span><span class="p">([</span><span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="n">e_k_interp</span> <span class="o">=</span> <span class="n">e_k_interp</span><span class="p">(</span><span class="n">Kx</span><span class="p">,</span> <span class="n">Ky</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">extent</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">k</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">k</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">k</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">e_k_interp</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;RdBu&#39;</span><span class="p">),</span>
           <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">Kx</span><span class="p">,</span> <span class="n">Ky</span><span class="p">,</span> <span class="n">e_k_interp</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$k_x$&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$k_y$&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/user_guide_Square_lattice_susceptibility_12_0.svg" src="../_images/user_guide_Square_lattice_susceptibility_12_0.svg" /></div>
</div>
<p>I.e. the Fermi surface has a diamond shape with perfect nesting of the fermi surface for the momentum transfer vectors <span class="math notranslate nohighlight">\(\mathbf{k}=\pm(\pi, \pi)\)</span> and <span class="math notranslate nohighlight">\(\mathbf{k}=\pm(\pi, -\pi)\)</span>.</p>
</div>
<div class="section" id="Bare-generalized-susceptibility-\chi_0">
<h2>Bare generalized susceptibility <span class="math notranslate nohighlight">\(\chi_0\)</span><a class="headerlink" href="#Bare-generalized-susceptibility-\chi_0" title="Permalink to this headline">¶</a></h2>
<p>The bare generalized (particle-hole) susceptibility <span class="math notranslate nohighlight">\(\chi_0\)</span> is defined as the bubble diagram of a propagating particle hole excitation, i.e.</p>
<div class="math notranslate nohighlight">
\[\chi_0(\tau, \mathbf{r}) = - G(\tau, \mathbf{r}) G(-\tau, -\mathbf{r})\]</div>
<p>where <span class="math notranslate nohighlight">\(G\)</span> is the single-particle Green’s function.</p>
<p>For a non-interacting system the single particle Green’s function <span class="math notranslate nohighlight">\(G_0\)</span> is known analytically</p>
<div class="math notranslate nohighlight">
\[G_0(i\omega_n, \mathbf{k}) =
\frac{1}{ i\omega_n + \mu - \epsilon(\mathbf{k}) }\]</div>
<p>and the product of two Green’s functions can be performed analytically using the Lindhard formula</p>
<div class="math notranslate nohighlight">
\[\chi_0(\omega_n, \mathbf{q}) =
\frac{1}{N_k} \sum_{\mathbf{k}}
 \frac{ f(\epsilon(\mathbf{k})) - f(\epsilon(\mathbf{k}+\mathbf{q})) }
      {i\omega_n + \epsilon(\mathbf{k} + \mathbf{q}) - \epsilon(\mathbf{k}) }\]</div>
<p>where <span class="math notranslate nohighlight">\(f(\cdot)\)</span> is the Fermi distribution function.</p>
<p>For reference this formula is implemented in <code class="docutils literal notranslate"><span class="pre">TPRF</span></code>, for details on the generalization to multiorbital and accidentally degenerate dispersion see the documentation for <code class="docutils literal notranslate"><span class="pre">lindhard_chi00_wk</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">triqs_tprf.lattice</span> <span class="kn">import</span> <span class="n">lindhard_chi00_wk</span>
<span class="n">chi00_wk_analytic</span> <span class="o">=</span> <span class="n">lindhard_chi00_wk</span><span class="p">(</span><span class="n">e_k</span><span class="o">=</span><span class="n">e_k</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">nw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>A computationally more efficient way of computing <span class="math notranslate nohighlight">\(\chi_0\)</span> is to perform the product of two single-particle Green’s functions in imaginary time and real space and then fourier transform back to frequency and momentum space, i.e.</p>
<div class="math notranslate nohighlight">
\[\chi_0(i\omega_n, \mathbf{k}) =
\mathcal{F}_{ \{ \tau, \mathbf{r} \} \rightarrow \{ i\omega_n, \mathbf{k} \} }
\{ -G(\tau, \mathbf{r}) G(-\tau, -\mathbf{r}) \}\]</div>
<p>To do this we first compute the single particle Green’s function of the lattice using the lattice Dyson equation</p>
<div class="math notranslate nohighlight">
\[G(i\omega_n, \mathbf{k})  =
\Big[ i\omega_n + \mu - \epsilon(\mathbf{k}) \Big]^{-1}\]</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">triqs.gf</span> <span class="kn">import</span> <span class="n">MeshImFreq</span><span class="p">,</span> <span class="n">Idx</span>
<span class="kn">from</span> <span class="nn">triqs_tprf.lattice</span> <span class="kn">import</span> <span class="n">lattice_dyson_g0_wk</span>

<span class="n">wmesh</span> <span class="o">=</span> <span class="n">MeshImFreq</span><span class="p">(</span><span class="n">beta</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="s1">&#39;Fermion&#39;</span><span class="p">,</span> <span class="n">n_max</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">g0_wk</span> <span class="o">=</span> <span class="n">lattice_dyson_g0_wk</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">e_k</span><span class="o">=</span><span class="n">e_k</span><span class="p">,</span> <span class="n">mesh</span><span class="o">=</span><span class="n">wmesh</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>And then perform the bubble product using the dedictated function</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">triqs_tprf.lattice_utils</span> <span class="kn">import</span> <span class="n">imtime_bubble_chi0_wk</span>
<span class="n">chi00_wk</span> <span class="o">=</span> <span class="n">imtime_bubble_chi0_wk</span><span class="p">(</span><span class="n">g0_wk</span><span class="p">,</span> <span class="n">nw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

╔╦╗╦═╗╦╔═╗ ╔═╗  ┌┬┐┌─┐┬─┐┌─┐
 ║ ╠╦╝║║═╬╗╚═╗   │ ├─┘├┬┘├┤
 ╩ ╩╚═╩╚═╝╚╚═╝   ┴ ┴  ┴└─└
Two-Particle Response Function tool-box

beta  = 5.0
nk    = 1024
nw    = 60
norb  = 2

Approx. Memory Utilization: 0.01 GB

--&gt; fourier_wk_to_wr
--&gt; fourier_wr_to_tr
--&gt; chi0_w0r_from_grt_PH (bubble in tau &amp; r)
--&gt; chi_wk_from_chi_wr (r-&gt;k)
</pre></div></div>
</div>
</div>
<div class="section" id="Physical-response-function-\chi_{S_z,-S_z}">
<h2>Physical response function <span class="math notranslate nohighlight">\(\chi_{S_z, S_z}\)</span><a class="headerlink" href="#Physical-response-function-\chi_{S_z,-S_z}" title="Permalink to this headline">¶</a></h2>
<p>From the generalized susceptibility <span class="math notranslate nohighlight">\(\chi_{abcd}(i\omega_n, \mathbf{k})\)</span> we can obtain any two particle response function by contracting the rank 4 tensor indices with two quadratic operators. E.g. the spin-spin response along the z-axis is given by</p>
<div class="math notranslate nohighlight">
\[\chi_{S_z, S_z} = \text{Tr}[ S_z \, \chi \, S_z ]\]</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">chi_SzSz_contraction</span><span class="p">(</span><span class="n">chi</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Computes the trace Tr[ S_z \chi S_z ]&quot;&quot;&quot;</span>
    <span class="n">Sz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">([</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">])</span>
    <span class="n">chi_SzSz</span> <span class="o">=</span> <span class="n">chi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">chi_SzSz</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;wqabcd,ab,cd-&gt;wq&#39;</span><span class="p">,</span> <span class="n">chi</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">Sz</span><span class="p">,</span> <span class="n">Sz</span><span class="p">)[:,</span> <span class="p">:]</span>
    <span class="n">chi_SzSz</span> <span class="o">=</span> <span class="n">chi_SzSz</span><span class="p">[</span><span class="n">Idx</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="p">:]</span>
    <span class="k">return</span> <span class="n">chi_SzSz</span>
</pre></div>
</div>
</div>
<p>To look at the structure of <span class="math notranslate nohighlight">\(\chi_0\)</span> we can plot it along the high symmetry path in the Brillouin zone (using the call operator of a triqs Green’s function on <code class="docutils literal notranslate"><span class="pre">MeshBrZone</span></code>).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">interpolate_chi</span><span class="p">(</span><span class="n">chi</span><span class="p">,</span> <span class="n">k_vecs</span><span class="p">):</span>
    <span class="k">assert</span><span class="p">(</span> <span class="n">k_vecs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span> <span class="p">)</span>
    <span class="n">chi_interp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
        <span class="p">[</span><span class="n">k_vecs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">chi</span><span class="o">.</span><span class="n">target_shape</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">kidx</span><span class="p">,</span> <span class="p">(</span><span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">kz</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">k_vecs</span><span class="p">):</span>
        <span class="n">chi_interp</span><span class="p">[</span><span class="n">kidx</span><span class="p">]</span> <span class="o">=</span> <span class="n">chi</span><span class="p">((</span><span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="n">kz</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">chi_interp</span>
</pre></div>
</div>
</div>
<p>Whit some additional plot helper functions we can now look at the spin-spin response</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">plot_chi_1D</span><span class="p">(</span><span class="n">chi</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="n">chi_SzSz</span> <span class="o">=</span> <span class="n">chi_SzSz_contraction</span><span class="p">(</span><span class="n">chi</span><span class="p">)</span>
    <span class="n">chi_interp</span> <span class="o">=</span> <span class="n">interpolate_chi</span><span class="p">(</span><span class="n">chi_SzSz</span><span class="p">,</span> <span class="n">k_vecs</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">k_plot</span><span class="p">,</span> <span class="n">chi_interp</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">K_plot</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">K_plot</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">K_plot</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="sa">r</span><span class="s1">&#39;$\Gamma$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$X$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$M$&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;$\Gamma$&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Spin-response $\chi_{S_z S_z}(\mathbf{q}, \omega=0)$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_chi_1D</span><span class="p">(</span><span class="n">chi00_wk</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$U=0$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/user_guide_Square_lattice_susceptibility_26_0.svg" src="../_images/user_guide_Square_lattice_susceptibility_26_0.svg" /></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">plot_chi</span><span class="p">(</span><span class="n">chi</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">Kx</span><span class="p">,</span> <span class="n">Ky</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="n">k_vecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">Kx</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">Ky</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="mi">0</span><span class="o">*</span><span class="n">Kx</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span><span class="o">.</span><span class="n">T</span>

    <span class="n">chi_SzSz</span> <span class="o">=</span> <span class="n">chi_SzSz_contraction</span><span class="p">(</span><span class="n">chi</span><span class="p">)</span>
    <span class="n">chi_interp</span> <span class="o">=</span> <span class="n">interpolate_chi</span><span class="p">(</span><span class="n">chi_SzSz</span><span class="p">,</span> <span class="n">k_vecs</span><span class="p">)</span>
    <span class="n">chi_interp</span> <span class="o">=</span> <span class="n">chi_interp</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Kx</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
        <span class="n">chi_interp</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;magma&#39;</span><span class="p">),</span>
        <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">k</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">k</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">k</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
        <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">chi_interp</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">label</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$k_x$&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$k_y$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Lindhardt response $\chi^{00}_{S_z S_z}(\mathbf{q}, \omega=0)$&#39;</span>
<span class="n">plot_chi</span><span class="p">(</span><span class="n">chi00_wk</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/user_guide_Square_lattice_susceptibility_28_0.svg" src="../_images/user_guide_Square_lattice_susceptibility_28_0.svg" /></div>
</div>
</div>
<div class="section" id="Random-phase-approximation-(RPA)">
<h2>Random phase approximation (RPA)<a class="headerlink" href="#Random-phase-approximation-(RPA)" title="Permalink to this headline">¶</a></h2>
<p>The full Bethe-Salpeter equation in the particle-hole channel has the form</p>
<div class="math notranslate nohighlight">
\[\chi^{(PH)} = \chi_0 + \chi_0 \Gamma^{(PH)} \chi^{(PH)}\]</div>
<p>where all components are momentum and (three) frequency dependent quantities. In the random phase approximation (RPA) the vertex is apprximated by the (frequency independent) local interaction <span class="math notranslate nohighlight">\(\Gamma^{(PH)} \approx V\)</span>.</p>
<p>The locality and frequency independence simplifies the BSE which formally is solved as</p>
<div class="math notranslate nohighlight">
\[\chi = [ 1 - \chi_0 V ]^{-1} \, \chi_0\]</div>
<p>in <code class="docutils literal notranslate"><span class="pre">TPRF</span></code> there is the dedicated routine for RPA (<code class="docutils literal notranslate"><span class="pre">triqs_tprf.lattice.solve_rpa_PH</span></code>) that can treat the general multiorbital case.</p>
<p>For generality we take the nessecary steps to obtain the four index tensor <span class="math notranslate nohighlight">\(V\)</span> from the operator expression of the Hubbard interaction.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">triqs.operators</span> <span class="kn">import</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span>
<span class="n">H_int</span> <span class="o">=</span> <span class="n">n</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">fundamental_operators</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>

<span class="kn">from</span> <span class="nn">pyed.OperatorUtils</span> <span class="kn">import</span> <span class="n">quartic_tensor_from_operator</span>
<span class="kn">from</span> <span class="nn">pyed.OperatorUtils</span> <span class="kn">import</span> <span class="n">quartic_permutation_symmetrize</span>
<span class="n">V_int_abcd</span> <span class="o">=</span> <span class="n">quartic_tensor_from_operator</span><span class="p">(</span><span class="n">H_int</span><span class="p">,</span> <span class="n">fundamental_operators</span><span class="p">)</span>
<span class="n">V_int_abcd</span> <span class="o">=</span> <span class="n">quartic_permutation_symmetrize</span><span class="p">(</span><span class="n">V_int_abcd</span><span class="p">)</span>

<span class="n">V_abcd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">V_int_abcd</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">V_abcd</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">V_abcd</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">V_int_abcd</span><span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Now we can tune the interaction strength and compute the corresponding RPA generalized susceptibility.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">triqs_tprf.lattice</span> <span class="kn">import</span> <span class="n">solve_rpa_PH</span>

<span class="n">chi_wk_vec</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">U_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">U_vec</span><span class="p">:</span>
    <span class="n">chi_wk</span> <span class="o">=</span> <span class="n">solve_rpa_PH</span><span class="p">(</span><span class="n">chi00_wk</span><span class="p">,</span> <span class="n">u</span> <span class="o">*</span> <span class="n">V_abcd</span><span class="p">)</span>
    <span class="n">chi_wk_vec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chi_wk</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_chi_1D</span><span class="p">(</span><span class="n">chi00_wk</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$U=0$&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">U</span><span class="p">,</span> <span class="n">chi_wk</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">U_vec</span><span class="p">,</span> <span class="n">chi_wk_vec</span><span class="p">):</span>
    <span class="n">plot_chi_1D</span><span class="p">(</span><span class="n">chi_wk</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$U=</span><span class="si">%2.2f</span><span class="s1">$&#39;</span> <span class="o">%</span> <span class="n">U</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/user_guide_Square_lattice_susceptibility_33_0.svg" src="../_images/user_guide_Square_lattice_susceptibility_33_0.svg" /></div>
</div>
<p>We see that the system has an instability at the <span class="math notranslate nohighlight">\(M\)</span> point</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">subp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="o">*</span><span class="n">subp</span><span class="p">);</span> <span class="n">subp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Lindhardt response $\chi^{00}_{S_z S_z}(\mathbf{q}, \omega=0)$&#39;</span>
<span class="n">plot_chi</span><span class="p">(</span><span class="n">chi00_wk</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="o">*</span><span class="n">subp</span><span class="p">);</span> <span class="n">subp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;RPA U=</span><span class="si">%1.0f</span><span class="s1"> $\chi^{00}_{S_z S_z}(\mathbf{q}, \omega=0)$&#39;</span> <span class="o">%</span> <span class="n">U_vec</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">plot_chi</span><span class="p">(</span><span class="n">chi_wk_vec</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/user_guide_Square_lattice_susceptibility_35_0.svg" src="../_images/user_guide_Square_lattice_susceptibility_35_0.svg" /></div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
    <li><a href="../index.html">Home</a> &raquo;</li>

        <li class="nav-item nav-item-this"><a href="">Square lattice susceptibility and the Random Phase Approximation (RPA)</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, H. U.R. Strand.
    </div>
  </body>
</html>
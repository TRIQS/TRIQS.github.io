
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Generating new templates for custom models &#8212; nrgljubljana_interface  documentation</title>
    <link rel="stylesheet" href="../_static/triqs.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://raw.githubusercontent.com/mathjax/MathJax/2.7.8/MathJax.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Parallelization" href="../parallelization.html" />
    <link rel="prev" title="2orb-UJ (QS)" href="../templates/2orb-UJ_QS.html" />
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>
    <script src="../_static/cufon-yui.js" type="text/javascript"></script>
    <script src="../_static/spaceman.cufonfonts.js" type="text/javascript"></script>
    <script type="text/javascript">
      Cufon.replace('.triqs', { fontFamily: 'spaceman', hover: true }); 
    </script>
 
    <style type="text/css">
      table.right { float: right; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
      
    </style>

  </head><body>
<div class="pageheader">
  <ul>
    
    <li><a href="../install.html">Install</a></li>
    
    <li><a href="../documentation.html">Documentation</a></li>
    
    <li><a href="../issues.html">Issues</a></li>
    
    <li><a href="../about.html">About nrgljubljana_interface</a></li>
    
  </ul>
  <div>
    <h1 style="padding:0; margin: 10px 0 0 0;"><a class="triqs" href="../index.html">nrgljubljana_interface</a></h1>
    <span style="font-size: 14px; margin: 0px; padding: 0px;"><a href="https://rokzitko.github.io/nrgljubljana">NRG Ljubljana</a> --  <a class="triqs" style="font-size: 12px" href="https://triqs.github.io">TRIQS</a> interface</span>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../parallelization.html" title="Parallelization"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../templates/2orb-UJ_QS.html" title="2orb-UJ (QS)"
             accesskey="P">previous</a> |</li>
    <li><a href="../index.html">Home</a> &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../documentation.html" accesskey="U">Documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="../templates/2orb-UJ_QS.html"
                        title="previous chapter">2orb-UJ (QS)</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../parallelization.html"
                        title="next chapter">Parallelization</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/guide/defining_models.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="generating-new-templates-for-custom-models">
<span id="defining-models"></span><h1>Generating new templates for custom models<a class="headerlink" href="#generating-new-templates-for-custom-models" title="Permalink to this headline">Â¶</a></h1>
<p>Here we discuss how to add new models to the template library.
As an example, we consider the case of two-orbital impurity model
(model <code class="docutils literal notranslate"><span class="pre">2orb-UJ</span></code>) that comes predefined in the library of default templates.
The files are located in the directory <code class="docutils literal notranslate"><span class="pre">templates/2orb-UJ/QS</span></code>.</p>
<p>The model is defined in <code class="docutils literal notranslate"><span class="pre">2orb-UJ.m</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">def2ch</span><span class="p">[</span><span class="n">nrimp</span><span class="o">=</span><span class="mi">2</span><span class="p">];</span>
<span class="n">impuritybasis</span> <span class="o">=</span> <span class="p">{</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]};</span>

<span class="n">Heps1</span> <span class="o">=</span> <span class="n">eps1</span> <span class="n">number</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]];</span>
<span class="n">Hint1</span> <span class="o">=</span> <span class="n">U1</span> <span class="n">hubbard</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]];</span>
<span class="n">Hhyb1</span> <span class="o">=</span> <span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">hop</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]];</span> <span class="p">(</span><span class="o">*</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="n">the</span> <span class="mi">0</span><span class="o">-</span><span class="n">th</span> <span class="n">site</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Wilson</span> <span class="n">chain</span> <span class="k">for</span> <span class="n">channel</span> <span class="mi">1</span> <span class="o">*</span><span class="p">)</span>

<span class="n">Heps2</span> <span class="o">=</span> <span class="n">eps2</span> <span class="n">number</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]];</span>
<span class="n">Hint2</span> <span class="o">=</span> <span class="n">U2</span> <span class="n">hubbard</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]];</span>
<span class="n">Hhyb2</span> <span class="o">=</span> <span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">hop</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]];</span> <span class="p">(</span><span class="o">*</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="n">the</span> <span class="mi">0</span><span class="o">-</span><span class="n">th</span> <span class="n">site</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Wilson</span> <span class="n">chain</span> <span class="k">for</span> <span class="n">channel</span> <span class="mi">2</span> <span class="o">*</span><span class="p">)</span>

<span class="n">H12</span> <span class="o">=</span> <span class="n">U12</span> <span class="n">nc</span><span class="p">[</span><span class="n">number</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">number</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]]]</span><span class="o">+</span> <span class="n">J12</span> <span class="n">spinspin</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]];</span>

<span class="n">Heps</span> <span class="o">=</span> <span class="n">Heps1</span> <span class="o">+</span> <span class="n">Heps2</span><span class="p">;</span>
<span class="n">Hint</span> <span class="o">=</span> <span class="n">Hint1</span> <span class="o">+</span> <span class="n">Hint2</span> <span class="o">+</span> <span class="n">H12</span><span class="p">;</span>
<span class="n">Hhyb</span> <span class="o">=</span> <span class="n">Hhyb1</span> <span class="o">+</span> <span class="n">Hhyb2</span><span class="p">;</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">H0</span> <span class="o">+</span> <span class="n">Heps</span> <span class="o">+</span> <span class="n">Hint</span> <span class="o">+</span> <span class="n">Hhyb</span><span class="p">;</span>

<span class="n">selfopd1</span> <span class="o">=</span> <span class="p">(</span> <span class="n">Chop</span> <span class="o">@</span> <span class="n">Expand</span> <span class="o">@</span> <span class="n">komutator</span><span class="p">[</span><span class="n">Hint</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="c1">#1, 1, #2]] )&amp;;</span>
<span class="n">selfopd2</span> <span class="o">=</span> <span class="p">(</span> <span class="n">Chop</span> <span class="o">@</span> <span class="n">Expand</span> <span class="o">@</span> <span class="n">komutator</span><span class="p">[</span><span class="n">Hint</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="c1">#1, 2, #2]] )&amp;;</span>
</pre></div>
</div>
<p>The first line declares that this is a two-channel problem with two impurity orbitals.
The second line defines how we label the impurity orbitals. Here we choose consecutively
numbered <code class="docutils literal notranslate"><span class="pre">d[1]</span></code> and <code class="docutils literal notranslate"><span class="pre">d[2]</span></code>. The main part of the file then defines various parts
of the Hamiltonian, making use of <a class="reference external" href="http://nrgljubljana.ijs.si/sneg">sneg</a> function
calls such as <code class="docutils literal notranslate"><span class="pre">number</span></code>, <code class="docutils literal notranslate"><span class="pre">Hubbard</span></code>, <code class="docutils literal notranslate"><span class="pre">spinspin</span></code>, etc. Finally, in the last two lines
we define the auxiliary operators which are used in the âself-energy trickâ to obtain
a high-quality estimate for the self-energy. They are obtained by taking the commutator
between the particle creation/annihilation operators and the interacting part of the
Hamiltonian.</p>
<p>The input file to NRG template generator is <code class="docutils literal notranslate"><span class="pre">param</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">extra</span><span class="p">]</span>
<span class="n">U1</span><span class="o">=</span>
<span class="n">U2</span><span class="o">=</span>
<span class="n">eps1</span><span class="o">=</span>
<span class="n">eps2</span><span class="o">=</span>
<span class="n">U12</span><span class="o">=</span>
<span class="n">J12</span><span class="o">=</span>

<span class="p">[</span><span class="n">param</span><span class="p">]</span>
<span class="n">options</span><span class="o">=</span><span class="n">GENERATE_TEMPLATE</span>
<span class="n">model</span><span class="o">=</span><span class="mi">2</span><span class="n">orb</span><span class="o">-</span><span class="n">UJ</span><span class="o">.</span><span class="n">m</span>
<span class="n">symtype</span><span class="o">=</span><span class="n">QS</span>
<span class="n">ops</span><span class="o">=</span><span class="n">n_d1</span> <span class="n">n_d1</span><span class="o">^</span><span class="mi">2</span> <span class="n">n_d2</span> <span class="n">n_d2</span><span class="o">^</span><span class="mi">2</span> <span class="n">S_d1S_d2</span> <span class="n">n_d1n_d2</span> <span class="n">A_d1</span> <span class="n">A_d2</span> <span class="n">self_d1</span> <span class="n">self_d2</span> <span class="n">sigma_d1</span> <span class="n">sigma_d2</span>

<span class="n">data_has_rescaled_energies</span><span class="o">=</span><span class="n">false</span>
</pre></div>
</div>
<p>Here we declare all parameters (although the values need not be given), instruct
<code class="docutils literal notranslate"><span class="pre">nrginit</span></code> to generate a template file <code class="docutils literal notranslate"><span class="pre">data.in</span></code> rather than a specific instantiation
<code class="docutils literal notranslate"><span class="pre">data</span></code>, define the symmetry type (here <code class="docutils literal notranslate"><span class="pre">QS</span></code>), and list all operators of interest.
The last line is mandatory for generating NRGLjubljana_interface template; it instructs
the code to generate Hamiltonians which are not scaled in terms of the initial energy
scale of the problem, as is customarily done in NRG calculations.</p>
<p>The operators of interest are defined in <code class="docutils literal notranslate"><span class="pre">modeloperators.m</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tt</span><span class="o">=</span><span class="p">{};</span>

<span class="n">tt</span> <span class="o">=</span> <span class="n">Join</span><span class="p">[</span><span class="n">tt</span><span class="p">,</span> <span class="n">mtSingletOp</span><span class="p">[</span><span class="s2">&quot;n_d1&quot;</span><span class="p">,</span>     <span class="n">number</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="p">]];</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">Join</span><span class="p">[</span><span class="n">tt</span><span class="p">,</span> <span class="n">mtSingletOp</span><span class="p">[</span><span class="s2">&quot;n_d2&quot;</span><span class="p">,</span>     <span class="n">number</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="p">]];</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">Join</span><span class="p">[</span><span class="n">tt</span><span class="p">,</span> <span class="n">mtSingletOp</span><span class="p">[</span><span class="s2">&quot;n_d1^2&quot;</span><span class="p">,</span>   <span class="nb">pow</span><span class="p">[</span><span class="n">number</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="mi">2</span><span class="p">]</span> <span class="p">]];</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">Join</span><span class="p">[</span><span class="n">tt</span><span class="p">,</span> <span class="n">mtSingletOp</span><span class="p">[</span><span class="s2">&quot;n_d2^2&quot;</span><span class="p">,</span>   <span class="nb">pow</span><span class="p">[</span><span class="n">number</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="mi">2</span><span class="p">]</span> <span class="p">]];</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">Join</span><span class="p">[</span><span class="n">tt</span><span class="p">,</span> <span class="n">mtSingletOp</span><span class="p">[</span><span class="s2">&quot;S_d1S_d2&quot;</span><span class="p">,</span> <span class="n">spinspin</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="p">]];</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">Join</span><span class="p">[</span><span class="n">tt</span><span class="p">,</span> <span class="n">mtSingletOp</span><span class="p">[</span><span class="s2">&quot;n_d1n_d2&quot;</span><span class="p">,</span> <span class="n">nc</span><span class="p">[</span><span class="n">number</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">number</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]]]</span> <span class="p">]];</span>

<span class="n">tt</span> <span class="o">=</span> <span class="n">Join</span><span class="p">[</span><span class="n">tt</span><span class="p">,</span> <span class="n">mtDoubletOp</span><span class="p">[</span><span class="s2">&quot;A_d1&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">]];</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">Join</span><span class="p">[</span><span class="n">tt</span><span class="p">,</span> <span class="n">mtDoubletOp</span><span class="p">[</span><span class="s2">&quot;A_d2&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">]];</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">Join</span><span class="p">[</span><span class="n">tt</span><span class="p">,</span> <span class="n">mtDoubletOp</span><span class="p">[</span><span class="s2">&quot;self_d1&quot;</span><span class="p">,</span> <span class="n">selfopd1</span> <span class="p">]];</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">Join</span><span class="p">[</span><span class="n">tt</span><span class="p">,</span> <span class="n">mtDoubletOp</span><span class="p">[</span><span class="s2">&quot;self_d2&quot;</span><span class="p">,</span> <span class="n">selfopd2</span> <span class="p">]];</span>

<span class="n">tt</span> <span class="o">=</span> <span class="n">Join</span><span class="p">[</span><span class="n">tt</span><span class="p">,</span> <span class="n">mtTripletOp</span><span class="p">[</span><span class="s2">&quot;sigma_d1&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">]];</span>
<span class="n">tt</span> <span class="o">=</span> <span class="n">Join</span><span class="p">[</span><span class="n">tt</span><span class="p">,</span> <span class="n">mtTripletOp</span><span class="p">[</span><span class="s2">&quot;sigma_d2&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">]];</span>

<span class="n">tt</span>
</pre></div>
</div>
<p>Here we again make use of sneg functions, as well as of high-level functions defined
in <code class="docutils literal notranslate"><span class="pre">initial.m</span></code> which is part of the <code class="docutils literal notranslate"><span class="pre">nrginit</span></code> Mathematica code.</p>
<p>The template files are then obtained by running <code class="docutils literal notranslate"><span class="pre">nrginit</span></code>. This will generate
<code class="docutils literal notranslate"><span class="pre">data.in</span></code>, <code class="docutils literal notranslate"><span class="pre">ham_*</span></code> and <code class="docutils literal notranslate"><span class="pre">op.*</span></code> template files. The log file with some details about
the generation process is saved as <code class="docutils literal notranslate"><span class="pre">mmalog</span></code>.</p>
<p>The main template <code class="docutils literal notranslate"><span class="pre">data.in</span></code> is lengthy and we show only a small chunk:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Input file for NRG Ljubljana</span>
<span class="c1"># symtype 	QS</span>
<span class="c1"># Using sneg version 	1.251</span>
<span class="c1">#!9</span>
<span class="c1"># Number of channels, chain sites, subspaces: </span>
<span class="mi">2</span>	<span class="mi">0</span>	<span class="mi">15</span>
<span class="c1"># SCALE 	1</span>
<span class="c1"># Energies (GS energy subtracted, multiplied by 1/SCALE):</span>
<span class="o">-</span><span class="mi">4</span>	<span class="mi">1</span>
<span class="mi">1</span>
<span class="n">DIAG</span> 	<span class="n">ham_</span><span class="o">-</span><span class="mf">4.1</span>
<span class="o">-</span><span class="mi">3</span>	<span class="mi">2</span>
<span class="mi">4</span>
<span class="n">DIAG</span> 	<span class="n">ham_</span><span class="o">-</span><span class="mf">3.2</span>
<span class="o">-</span><span class="mi">2</span>	<span class="mi">1</span>
<span class="mi">10</span>
<span class="n">DIAG</span> 	<span class="n">ham_</span><span class="o">-</span><span class="mf">2.1</span>
<span class="o">-</span><span class="mi">2</span>	<span class="mi">3</span>
<span class="mi">6</span>
<span class="n">DIAG</span> 	<span class="n">ham_</span><span class="o">-</span><span class="mf">2.3</span>
<span class="o">-</span><span class="mi">1</span>	<span class="mi">2</span>
<span class="mi">20</span>
<span class="n">DIAG</span> 	<span class="n">ham_</span><span class="o">-</span><span class="mf">1.2</span>
<span class="o">-</span><span class="mi">1</span>	<span class="mi">4</span>
<span class="mi">4</span>
<span class="n">DIAG</span> 	<span class="n">ham_</span><span class="o">-</span><span class="mf">1.4</span>
<span class="mi">0</span>	<span class="mi">1</span>
<span class="mi">20</span>
<span class="n">DIAG</span> 	<span class="n">ham_0</span><span class="o">.</span><span class="mi">1</span>
<span class="mi">0</span>	<span class="mi">3</span>
<span class="mi">15</span>
<span class="n">DIAG</span> 	<span class="n">ham_0</span><span class="o">.</span><span class="mi">3</span>
<span class="mi">0</span>	<span class="mi">5</span>
<span class="mi">1</span>
<span class="n">DIAG</span> 	<span class="n">ham_0</span><span class="o">.</span><span class="mi">5</span>
<span class="mi">1</span>	<span class="mi">2</span>
<span class="mi">20</span>
<span class="n">DIAG</span> 	<span class="n">ham_1</span><span class="o">.</span><span class="mi">2</span>
<span class="mi">1</span>	<span class="mi">4</span>
<span class="mi">4</span>
<span class="n">DIAG</span> 	<span class="n">ham_1</span><span class="o">.</span><span class="mi">4</span>
<span class="mi">2</span>	<span class="mi">1</span>
<span class="mi">10</span>
<span class="n">DIAG</span> 	<span class="n">ham_2</span><span class="o">.</span><span class="mi">1</span>
<span class="mi">2</span>	<span class="mi">3</span>
<span class="mi">6</span>
<span class="n">DIAG</span> 	<span class="n">ham_2</span><span class="o">.</span><span class="mi">3</span>
<span class="mi">3</span>	<span class="mi">2</span>
<span class="mi">4</span>
<span class="n">DIAG</span> 	<span class="n">ham_3</span><span class="o">.</span><span class="mi">2</span>
<span class="mi">4</span>	<span class="mi">1</span>
<span class="mi">1</span>
<span class="n">DIAG</span> 	<span class="n">ham_4</span><span class="o">.</span><span class="mi">1</span>
<span class="c1"># Irreducible matrix elements for Wilson chains:</span>
<span class="n">f</span> <span class="mi">0</span> <span class="mi">0</span>
<span class="mi">20</span>
<span class="mi">4</span>	<span class="mi">1</span>	<span class="mi">3</span>	<span class="mi">2</span>
<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">1.4142135623730951</span>	<span class="mf">0.</span>
<span class="mi">3</span>	<span class="mi">2</span>	<span class="mi">2</span>	<span class="mi">3</span>
<span class="mf">0.</span>	<span class="mf">1.224744871391589</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>
<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">1.224744871391589</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>
<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>
<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="o">-</span><span class="mf">1.224744871391589</span>
<span class="mi">3</span>	<span class="mi">2</span>	<span class="mi">2</span>	<span class="mi">1</span>
<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="o">-</span><span class="mf">0.7071067811865475</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>
<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="o">-</span><span class="mf">0.7071067811865475</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>
<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">1.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>
<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="mf">0.</span>	<span class="o">-</span><span class="mf">0.7071067811865475</span>	<span class="mf">0.</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ham_*</span></code> contain the symbolic expressions for the Hamiltonian matrices in various invariant subspaces.
For instance, in the half-filled <span class="math notranslate nohighlight">\(Q=0\)</span> spin triplet <span class="math notranslate nohighlight">\((2S+1)=3\)</span> subspace,
we have <code class="docutils literal notranslate"><span class="pre">ham_0.3</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{{</span><span class="n">eps2</span> <span class="o">+</span> <span class="n">coefzeta</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
  <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="n">eps1</span> <span class="o">+</span> <span class="n">coefzeta</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
  <span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">Sqrt</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">Sqrt</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
  <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="n">Sqrt</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="o">-</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> 
  <span class="n">eps1</span> <span class="o">+</span> <span class="n">eps2</span> <span class="o">+</span> <span class="n">J12</span><span class="o">/</span><span class="mi">4</span> <span class="o">+</span> <span class="n">U12</span> <span class="o">-</span> <span class="n">coefzeta</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">coefzeta</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
  <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">eps2</span> <span class="o">+</span> <span class="n">coefzeta</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
  <span class="o">-</span><span class="p">(</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">Sqrt</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Sqrt</span><span class="p">[</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> 
 <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">eps1</span> <span class="o">+</span> <span class="n">coefzeta</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
  <span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">eps2</span> <span class="o">+</span> <span class="n">U2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
  <span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">Sqrt</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> 
  <span class="o">-</span><span class="p">(</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">Sqrt</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">eps1</span> <span class="o">+</span> <span class="n">eps2</span> <span class="o">-</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">J12</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span> <span class="o">+</span> <span class="n">U12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
  <span class="o">-</span><span class="p">(</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">Sqrt</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">Sqrt</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">},</span> 
 <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">eps1</span> <span class="o">+</span> <span class="n">U1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
  <span class="o">-</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">2</span><span class="p">]},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">Sqrt</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> 
  <span class="o">-</span><span class="p">(</span><span class="n">Sqrt</span><span class="p">[</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">eps1</span> <span class="o">+</span> <span class="n">eps2</span> <span class="o">+</span> <span class="n">J12</span><span class="o">/</span><span class="mi">4</span> <span class="o">+</span> <span class="n">U12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
  <span class="o">-</span><span class="p">(</span><span class="n">Sqrt</span><span class="p">[</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">Sqrt</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span> <span class="mi">0</span><span class="p">},</span> 
 <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
  <span class="n">eps1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">eps2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">U12</span> <span class="o">+</span> <span class="n">U2</span> <span class="o">-</span> <span class="n">coefzeta</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> 
 <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">Sqrt</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">Sqrt</span><span class="p">[</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> 
  <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">eps1</span> <span class="o">+</span> <span class="n">eps2</span> <span class="o">+</span> <span class="n">U1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">U12</span> <span class="o">-</span> <span class="n">coefzeta</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> 
 <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="n">Sqrt</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
  <span class="n">eps1</span> <span class="o">+</span> <span class="n">eps2</span> <span class="o">+</span> <span class="n">J12</span><span class="o">/</span><span class="mi">4</span> <span class="o">+</span> <span class="n">U12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="n">Sqrt</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">},</span> 
 <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
  <span class="n">eps1</span> <span class="o">+</span> <span class="n">eps2</span> <span class="o">+</span> <span class="n">J12</span><span class="o">/</span><span class="mi">4</span> <span class="o">+</span> <span class="n">U12</span> <span class="o">+</span> <span class="n">coefzeta</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">coefzeta</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> 
  <span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">1</span><span class="p">]},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">Sqrt</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> 
  <span class="o">-</span><span class="p">(</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">Sqrt</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="n">Sqrt</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> 
  <span class="n">eps1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">eps2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">U12</span> <span class="o">+</span> <span class="n">U2</span> <span class="o">-</span> <span class="n">coefzeta</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">},</span> 
 <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">gammaPolCh</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> 
  <span class="mi">2</span><span class="o">*</span><span class="n">eps1</span> <span class="o">+</span> <span class="n">eps2</span> <span class="o">+</span> <span class="n">U1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">U12</span> <span class="o">-</span> <span class="n">coefzeta</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]}}</span>
</pre></div>
</div>
<p>In a similar fashion, <code class="docutils literal notranslate"><span class="pre">op.*</span></code> files contain the symbolic forms of the operators. For instance
one part of the auxiliary operator <code class="docutils literal notranslate"><span class="pre">self_d2</span></code> takes the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{{</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">},</span> <span class="p">{</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">},</span> <span class="p">{</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">},</span> <span class="p">{</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">},</span> 
 <span class="p">{</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">},</span> <span class="p">{</span><span class="mf">1.1547005383792517</span><span class="o">*</span><span class="n">U2</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">},</span> 
 <span class="p">{</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6123724356957946</span><span class="o">*</span><span class="n">J12</span> <span class="o">+</span> <span class="mf">0.816496580927726</span><span class="o">*</span><span class="n">U12</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">},</span> 
 <span class="p">{</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">},</span> <span class="p">{</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.11785113019775795</span><span class="o">*</span><span class="n">J12</span> <span class="o">-</span> <span class="mf">0.4714045207910318</span><span class="o">*</span><span class="n">U12</span><span class="p">,</span> 
  <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">},</span> <span class="p">{</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.2886751345948129</span><span class="o">*</span><span class="n">J12</span> <span class="o">-</span> <span class="mf">1.1547005383792517</span><span class="o">*</span><span class="n">U12</span> <span class="o">-</span> 
   <span class="mf">1.1547005383792517</span><span class="o">*</span><span class="n">U2</span><span class="p">,</span> <span class="mf">0.</span><span class="p">},</span> <span class="p">{</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">},</span> 
 <span class="p">{</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.08333333333333336</span><span class="o">*</span><span class="n">J12</span> <span class="o">-</span> <span class="mf">0.3333333333333334</span><span class="o">*</span><span class="n">U12</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">},</span> 
 <span class="p">{</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">},</span> <span class="p">{</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.2886751345948129</span><span class="o">*</span><span class="n">J12</span> <span class="o">-</span> 
   <span class="mf">1.1547005383792517</span><span class="o">*</span><span class="n">U12</span> <span class="o">-</span> <span class="mf">1.1547005383792517</span><span class="o">*</span><span class="n">U2</span><span class="p">},</span> <span class="p">{</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">}}</span>
</pre></div>
</div>
<p>We then need to define the structure of Greenâs functions, separately for
Greenâs functions and for dynamical susceptibility functions, in <code class="docutils literal notranslate"><span class="pre">gf_stuct</span></code>
and <code class="docutils literal notranslate"><span class="pre">chi_struct</span></code>, respectively. Here they are the same:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">imp</span> <span class="mi">2</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">imp</span> <span class="mi">2</span>
</pre></div>
</div>
<p>The quantities that need to be computed are listed in file <code class="docutils literal notranslate"><span class="pre">info</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ops</span><span class="p">:</span><span class="n">n_d1</span> <span class="n">n_d1</span><span class="o">^</span><span class="mi">2</span> <span class="n">n_d2</span> <span class="n">n_d2</span><span class="o">^</span><span class="mi">2</span> <span class="n">S_d1S_d2</span> <span class="n">n_d1n_d2</span> <span class="n">A_d1</span> <span class="n">A_d2</span> <span class="n">self_d1</span> <span class="n">self_d2</span> <span class="n">sigma_d1</span> <span class="n">sigma_d2</span>
<span class="n">specs</span><span class="p">:</span><span class="n">n_d1</span><span class="o">-</span><span class="n">n_d1</span> <span class="n">n_d1</span><span class="o">-</span><span class="n">n_d2</span> <span class="n">n_d2</span><span class="o">-</span><span class="n">n_d1</span> <span class="n">n_d2</span><span class="o">-</span><span class="n">n_d2</span>
<span class="n">specd</span><span class="p">:</span><span class="n">A_d1</span><span class="o">-</span><span class="n">A_d1</span> <span class="n">A_d2</span><span class="o">-</span><span class="n">A_d2</span> <span class="n">self_d1</span><span class="o">-</span><span class="n">A_d1</span> <span class="n">self_d2</span><span class="o">-</span><span class="n">A_d2</span>
<span class="n">spect</span><span class="p">:</span><span class="n">sigma_d1</span><span class="o">-</span><span class="n">sigma_d1</span> <span class="n">sigma_d1</span><span class="o">-</span><span class="n">sigma_d2</span> <span class="n">sigma_d2</span><span class="o">-</span><span class="n">sigma_d1</span> <span class="n">sigma_d2</span><span class="o">-</span><span class="n">sigma_d2</span>
<span class="n">specq</span><span class="p">:</span>
<span class="n">specot</span><span class="p">:</span>
<span class="n">params</span><span class="p">:</span><span class="n">U1</span> <span class="n">U2</span> <span class="n">eps1</span> <span class="n">eps2</span> <span class="n">U12</span> <span class="n">J12</span>
<span class="n">polarized</span><span class="p">:</span>
</pre></div>
</div>
<p>Finally, NRGLjubljana_interface requires a number of initialization, wrapper and processing scripts.
The first, <code class="docutils literal notranslate"><span class="pre">prepare</span></code>, simply copies the required files to the temporary working directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash
DIR=&quot;$( cd &quot;$( dirname &quot;${BASH_SOURCE[0]}&quot; )&quot; &gt;/dev/null 2&gt;&amp;1 &amp;&amp; pwd )&quot;
cp $DIR/data.in $DIR/ham* $DIR/op.* $DIR/discretize $DIR/instantiate $DIR/wilson $DIR/process $DIR/*_struct $DIR/info .
</pre></div>
</div>
<p>The second performs the discretization:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="n">mv</span> <span class="n">param</span> <span class="n">param</span><span class="o">.</span><span class="n">orig</span>

<span class="n">cp</span> <span class="n">param</span><span class="o">.</span><span class="n">orig</span> <span class="n">param</span>
<span class="n">echo</span> <span class="n">dos</span><span class="o">=</span><span class="n">Gamma_imp_00</span><span class="o">.</span><span class="n">dat</span> <span class="o">&gt;&gt;</span><span class="n">param</span>
<span class="n">adapt</span> <span class="n">P</span>
<span class="n">adapt</span> <span class="n">N</span>
<span class="n">mv</span> <span class="n">FSOL</span><span class="o">.</span><span class="n">dat</span> <span class="n">FSOL_imp_00</span><span class="o">.</span><span class="n">dat</span>
<span class="n">mv</span> <span class="n">FSOLNEG</span><span class="o">.</span><span class="n">dat</span> <span class="n">FSOLNEG_imp_00</span><span class="o">.</span><span class="n">dat</span>

<span class="n">cp</span> <span class="n">param</span><span class="o">.</span><span class="n">orig</span> <span class="n">param</span>
<span class="n">echo</span> <span class="n">dos</span><span class="o">=</span><span class="n">Gamma_imp_11</span><span class="o">.</span><span class="n">dat</span> <span class="o">&gt;&gt;</span><span class="n">param</span>
<span class="n">adapt</span> <span class="n">P</span>
<span class="n">adapt</span> <span class="n">N</span>
<span class="n">mv</span> <span class="n">FSOL</span><span class="o">.</span><span class="n">dat</span> <span class="n">FSOL_imp_11</span><span class="o">.</span><span class="n">dat</span>
<span class="n">mv</span> <span class="n">FSOLNEG</span><span class="o">.</span><span class="n">dat</span> <span class="n">FSOLNEG_imp_11</span><span class="o">.</span><span class="n">dat</span>
</pre></div>
</div>
<p>Then comes the most complex one which instantiates the input file for NRG calculation, numerical-valued <code class="docutils literal notranslate"><span class="pre">data</span></code>,
from the symbolic-expression template <code class="docutils literal notranslate"><span class="pre">data.in</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/usr/bin/env perl
# Process a &#39;data.in&#39; template file: fill in the numerical values,
# diagonalize the Hamiltonian matrices, perform the transformations.
# Rok Zitko, 2009-2019

use strict;
use warnings;
use File::Copy;
use Math::Trig;

# Paths to tools used
my $matrix = &quot;matrix&quot;;
my $diag = &quot;diag -B&quot;;
my $unitary = &quot;unitary -B&quot;;

my $verbose = 1;

# Split param file into sections
my $fnparam = &quot;param&quot;;
open (F, &quot;&lt;$fnparam&quot;) or die &quot;Can&#39;t open $fnparam.&quot;;
my $section = &quot;&quot;;
while (&lt;F&gt;) {
    if (/^\[(.*)\]$/) {
        close O if $section ne &quot;&quot;;
        $section = $1;
        my $fnout = &quot;$fnparam.$section&quot;;
        open (O, &quot;&gt;$fnout&quot;) or die &quot;Cant open $fnout.&quot;;
    }
    print O if $section ne &quot;&quot;;
}
close O if $section ne &quot;&quot;;
close F;

system &quot;./wilson&quot;;
my $nr = getparam(&quot;Nmax&quot;);

### Translate data.in -&gt; data
my $fnin = &quot;data.in&quot;;
open(F, &quot;&lt;$fnin&quot;) or die &quot;Can&#39;t open $fnin.&quot;;

my $fnout = &quot;data&quot;;
open(OUT, &quot;&gt;$fnout&quot;) or die &quot;Can&#39;t open $fnout.&quot;;

my $mode = 0; # Current parser mode
my $factor = -1; # Rescale factor for energies
my $smallest = 1e9; # Lowest rescaled energy (Egs=smallest/factor)

my %dim; # Dimensions of invariant subspaces

my $subspaces = -1; # Number of different subspaces
my $Egs = -999; 

my $perch = 1;
if (getparam(&quot;polarized&quot;) eq &quot;true&quot;) {
    $perch = 2;
}
my $channels;
my $coefchannels;
my $fctr = 0;

while (&lt;F&gt;) {
    print;

    if (/^#/) {
        if (/^# SCALE\s+(\S+)$/) {
            # Extract the rescale factor
            $factor = 1.0/$1;
        }
        # Copy comments verbatim
        print OUT;
        next;
    }

    if ($mode == 0) {
        if (!/(\d+)\s+(\d+)\s+(\d+)/) { die &quot;Parse error 1: $_&quot;; }
        $channels = $1;
        $coefchannels = $channels * $perch;
        my $impurities = $2;
        $subspaces = $3;
        $impurities = $nr; # override!
        print &quot;ch=$channels coefch=$coefchannels im=$impurities sub=$subspaces\n&quot;;
        print OUT &quot;$channels $impurities $subspaces\n&quot;;
        $mode = 1;
        next;
    }

    if ($mode == 1) {
        my @buffer;
        my $i;
        for ($i = 1; $i &lt;= $subspaces; $i++) {
            if ($i != 1) { $_ = &lt;F&gt;; }
            if (!/(\S+)\s+(\S+)/) { die &quot;Parse error 2: $_&quot;; }
            my $qnspaces = &quot;$1 $2&quot;;
            my $qn = &quot;$1.$2&quot;;
            my $size;
            chomp($size = &lt;F&gt;);
            $dim{$qn} = $size; # store size!
            print &quot;[$i] $qn dim=$size\n&quot;;
            my $line1;
            chomp($line1 = &lt;F&gt;);
            $line1 =~ /DIAG\s+(\S+)$/;
            my $fn = $1;

            system(&quot;$matrix -c$coefchannels param.extra $fn &gt;ham&quot;);
            if ($? != 0) { die &quot;matrix call error&quot;; }
            copy(&quot;ham&quot;, &quot;ham.$qn&quot;);

            ($factor &gt; 0) or die &quot;no factor?&quot;;
            system(&quot;$diag -q -s $factor -o val -O vec ham&quot;);

            my $eig = `cat val`;
            push(@buffer,  [ &quot;$qnspaces\n$size\n&quot;, $eig ]);
            if ($eig =~ /^([-0-9.]+)(\s|\n)/) {
                my $min = $1;
                if ($smallest &gt; $min) { $smallest = $min; }
            }
            copy(&quot;vec&quot;, &quot;vec.$qn&quot;);
        }
        $Egs=$smallest/$factor;
        print &quot;E_gs=$Egs\n&quot;;

        @buffer = map { $_-&gt;[0].subtract($_-&gt;[1]) } @buffer;
        print OUT @buffer;

        $mode = 2;
        next;
    }

    if ($mode == 2) {
        if (!/f\s+(\d+)\s+(\d+)/) { die &quot;Parse error 3: $_&quot;; }
        print OUT;
        unitary();
        $fctr++;
        if ($fctr == $channels) {
            $mode = 3;
        }
        next;
    }
    
    if ($mode == 3) {
        if (!/^e/) { die &quot;Parse error 5: $_&quot;; }
        my $egs = &lt;F&gt;;
        print OUT &quot;e\n$Egs\n&quot;;
        $mode = 4;
        next;
    }

    if ($mode == 4) {
        if (/^[zZT]/) { # Discretization tables
            $mode = 5;
            next;
        }
        if (/^[spdvt]/) {
            print OUT;
            unitary();
            next;
        }
        die &quot;Parse error 6: $_&quot;;
    }
}

my $adddisc = 1;

if ($adddisc) {
    print OUT &quot;z\n&quot;;
    for (my $ch = 1; $ch &lt;= $perch*$channels; $ch++) {
        print OUT &quot;$nr\n&quot;;
        my $xi = `cat xi${ch}.dat`;
        print OUT &quot;$xi&quot;;
    }
    for (my $ch = 1; $ch &lt;= $perch*$channels; $ch++) {
        print OUT &quot;$nr\n&quot;;
        my $zeta = `cat zeta${ch}.dat`;
        print OUT &quot;$zeta&quot;;
    }
}

sub subtract
{
    my $vals = shift;
    my @l = split(&#39; &#39;, $vals);
    @l = map { $_-$smallest } @l;
    return &quot;@l\n&quot;;
}

sub unitary
{
    chomp(my $nr = &lt;F&gt;);
    print &quot;nr=$nr\n&quot;;
    print OUT &quot;$nr\n&quot;;
    for (my $i = 1; $i &lt;= $nr; $i++) {
        print &quot;unitary i=$i\n&quot;;
        chomp(my $line = &lt;F&gt;);
        if (!($line =~ /(\S+)\s+(\S+)\s+(\S+)\s+(\S+)/)) { die &quot;Parse error 4: $_&quot;; }
        my $qn1spaces = &quot;$1 $2&quot;;
        my $qn1 = &quot;$1.$2&quot;;
        my $dim1 = $dim{$qn1};
        my $qn2spaces = &quot;$3 $4&quot;;
        my $qn2 = &quot;$3.$4&quot;;
        my $dim2 = $dim{$qn2};
        print &quot;$qn1 $dim1 $qn2 $dim2\n&quot;;
        $line = &lt;F&gt;;
        my $c = substr($line, 0, 1);
        if ($c ne &quot;o&quot;) {
            open(O, &quot;&gt;mat&quot;) or die &quot;Can&#39;t open mat for writing.&quot;;
            for (my $n = 1; $n &lt;= $dim1; $n++) {
                print O $line;
                if ($n != $dim1) { $line = &lt;F&gt;; }
            } # for $n
            close(O);
        } else {
            chomp(my $fn = $line);
            -e $fn or die &quot;File not found: $fn&quot;;
            system(&quot;$matrix -c$coefchannels param.extra $fn &gt;mat&quot;);
            if ($? != 0) { die &quot;matrix call error for $fn&quot;; }
        }
        my $cmd = &quot;$unitary -l -q -o mat.res vec.$qn1 mat vec.$qn2&quot;;
        system($cmd);
        if ($? != 0) { die &quot;unitary call error: $cmd&quot;; }
        my $res = `cat mat.res`;
        print OUT &quot;$qn1spaces $qn2spaces\n$res&quot;;
   } # for $i
}

my $target_dir = shift;
if (defined($target_dir) &amp;&amp; -d $target_dir) {
    system &quot;cp param data $target_dir&quot;;
}

sub getparam
{
    my $keyword = shift;
    my $fn = &quot;param&quot;;
    open (G, &quot;&lt;&quot;, $fn) or die &quot;Can&#39;t open $fn for reading: $!\n&quot;;
    while (&lt;G&gt;) {
        if (/^$keyword=(.*)/) {
            return $1;
        }
    }
    close G;
    die &quot;Parsing failure: $keyword not found.&quot;;
}
</pre></div>
</div>
<p>This script, in turn, calls another one that calculates the Wilson chain coefficients:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/usr/bin/env perl

system &quot;mv param param.orig&quot;;
prochyb(&quot;imp_00&quot;,1);
prochyb(&quot;imp_11&quot;,2);

sub prochyb
{
    my $x = shift;
    my $n = shift;
    my $hybfn = &quot;Gamma_${x}.dat&quot;;
    -e $hybfn or die &quot;Hybridisation function $hybfn not found.&quot;;
    -e &quot;FSOL_${x}.dat&quot; or die &quot;FSOL_${x}.dat not found.&quot;;
    -e &quot;FSOLNEG_${x}.dat&quot; or die &quot;FSOLNEG_{x}.dat not found.&quot;;

    system &quot;cp param.orig param&quot;;
    system &quot;echo dos=Gamma_${x}.dat &gt;&gt;param&quot;;
    system &quot;cp FSOL_${x}.dat FSOL.dat&quot;;
    system &quot;cp FSOLNEG_${x}.dat FSOLNEG.dat&quot;;
    system &quot;nrgchain&quot;;

    -e &quot;xi.dat&quot; &amp;&amp; -e &quot;zeta.dat&quot; &amp;&amp; -e &quot;theta.dat&quot; or die &quot;Wilson chain coefficients not found.&quot;;

    system &quot;mv xi.dat xi${n}.dat&quot;;
    system &quot;mv zeta.dat zeta${n}.dat&quot;;
    system &quot;mv theta.dat theta${n}.dat&quot;;
}
</pre></div>
</div>
<p>The last script, <code class="docutils literal notranslate"><span class="pre">process</span></code>, calculates averages over the twist parameter and performs the broadening
of spectral functions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/usr/bin/env perl
use strict;
use warnings;
use Math::Trig;
my $pi = pi();

my $Nz = getparam(&quot;Nz&quot;);
my $min = getparam(&quot;broaden_min&quot;);
my $max = getparam(&quot;broaden_max&quot;);
my $ratio = getparam(&quot;broaden_ratio&quot;);
my $T = getparam(&quot;T&quot;);
my $alpha = getparam(&quot;alpha&quot;);
my $gamma = getparam(&quot;gamma&quot;);
print &quot;Nz=$Nz min=$min max=$max ratio=$ratio T=$T alpha=$alpha gamma=$gamma\n&quot;;
my $pr = &quot;FDM_dens&quot;; # prefix

avg(&quot;spec_${pr}_A_d1-A_d1.bin&quot;,    &quot;A_imp_00&quot;);
avg(&quot;spec_${pr}_A_d2-A_d2.bin&quot;,    &quot;A_imp_11&quot;);
avg(&quot;spec_${pr}_self_d1-A_d1.bin&quot;, &quot;B_imp_00&quot;);
avg(&quot;spec_${pr}_self_d2-A_d2.bin&quot;, &quot;B_imp_11&quot;);

scaley(&quot;A_imp_00&quot;, -$pi, &quot;imG_imp_00&quot;);
scaley(&quot;A_imp_11&quot;, -$pi, &quot;imG_imp_11&quot;);
scaley(&quot;B_imp_00&quot;, -$pi, &quot;imF_imp_00&quot;);
scaley(&quot;B_imp_11&quot;, -$pi, &quot;imF_imp_11&quot;);

kk(&quot;imG_imp_00&quot;);
kk(&quot;imG_imp_11&quot;);
kk(&quot;imF_imp_00&quot;);
kk(&quot;imF_imp_11&quot;);

avg(&quot;corr_${pr}_n_d1-n_d1.bin&quot;,    &quot;imNN_imp_00&quot;);
avg(&quot;corr_${pr}_n_d2-n_d2.bin&quot;,    &quot;imNN_imp_11&quot;);
avg(&quot;corr_${pr}_n_d1-n_d2.bin&quot;,    &quot;imNN_imp_01&quot;);
avg(&quot;corr_${pr}_n_d2-n_d1.bin&quot;,    &quot;imNN_imp_10&quot;);
avg(&quot;spin_${pr}_sigma_d1-sigma_d1.bin&quot;, &quot;imSS_imp_00&quot;);
avg(&quot;spin_${pr}_sigma_d2-sigma_d2.bin&quot;, &quot;imSS_imp_11&quot;);
avg(&quot;spin_${pr}_sigma_d1-sigma_d2.bin&quot;, &quot;imSS_imp_01&quot;);
avg(&quot;spin_${pr}_sigma_d2-sigma_d1.bin&quot;, &quot;imSS_imp_10&quot;);

kk(&quot;imNN_imp_00&quot;);
kk(&quot;imNN_imp_11&quot;);
kk(&quot;imNN_imp_01&quot;);
kk(&quot;imNN_imp_10&quot;);
kk(&quot;imSS_imp_00&quot;);
kk(&quot;imSS_imp_11&quot;);
kk(&quot;imSS_imp_01&quot;);
kk(&quot;imSS_imp_10&quot;);

sub kk {
        my $in = shift;
        $in .= &quot;.dat&quot;;
        my $out;
        ($out = $in) =~ s/^im/re/;
        -e $in or die &quot;Input file not found: $in. Stopped&quot;;
        system(&quot;kk $in $out&quot;);
        -e $out or die &quot;Output file not found:$ out. Stopped&quot;;
    }

sub avg
{
    my $in = shift;
    my $out = shift;
    $out .= &quot;.dat&quot;;
    unlink &quot;$out&quot;;
    system &quot;broaden -x $gamma -m $min -M $max -r $ratio   $in $Nz $alpha $T 1e-9&quot;;
    if ($?) {
	system &quot;echo Broadening of $in failed: $? &gt;&gt;&gt;ERROR&quot;;
	die &quot;broaden failed: $?\n&quot;;                                                                                                                                                                                                                
    }
    my $specfn = &quot;spec.dat&quot;;
    if (!-e $specfn) {
	system &quot;echo Failed to produce broadened spectrum $specfn -&gt; $out. &gt;&gt;&gt;ERROR&quot;;
	die &quot;broaden failed\n&quot;;
    }
    system &quot;mv $specfn $out&quot;;
}

sub getparam
{
    my $keyword = shift;
    my $fn = &quot;param&quot;;
    open (F, &quot;&lt;&quot;, $fn) or die &quot;Can&#39;t open $fn for reading: $!\n&quot;;
    while (&lt;F&gt;) {
	if (/^$keyword=(.*)/) {
	    return $1;
	}
    }
    close F;
    die &quot;Parsing failure: $keyword not found.&quot;;
}

sub scaley
{
    my $fnin = shift;
    my $factor = eval(shift);
    my $fnout = shift;
    $fnin .= &quot;.dat&quot;;
    $fnout .= &quot;.dat&quot;;
    open (F, &quot;&lt;&quot;, $fnin) or die &quot;Can&#39;t open $fnin for reading: $!\n&quot;;
    open (G, &quot;&gt;&quot;, $fnout) or die &quot;Can&#39;t open $fnout for writing: $!\n&quot;;
    while (&lt;F&gt;) {
	if (!/^#/) {
	    chomp;
	    my @d = split;
	    $d[1] = $d[1] * $factor;
	    print G &quot;@d\n&quot;;
	} else {
	    print G;
	}
    }
    close G;
    close F;
}
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../parallelization.html" title="Parallelization"
             >next</a> |</li>
        <li class="right" >
          <a href="../templates/2orb-UJ_QS.html" title="2orb-UJ (QS)"
             >previous</a> |</li>
    <li><a href="../index.html">Home</a> &raquo;</li>

          <li class="nav-item nav-item-1"><a href="../documentation.html" >Documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019 R. Å½itko, N. Wentzell.
    </div>
  </body>
</html>
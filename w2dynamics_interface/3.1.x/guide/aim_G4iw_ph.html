

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Measuring the two-particle Green’s function for our AIM example &mdash; w2dynamics_interface  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Setting the parameters" href="settingparameters.html" />
    <link rel="prev" title="An example: the Anderson impurity model" href="aim.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #7E588A" >
          

          
            <a href="../index.html" class="icon icon-home"> w2dynamics_interface
          

          
          </a>

          
            
            
              <div class="version">
                3.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Install w2dynamics_interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html#compiling-w2dynamics-interface-from-source">Compiling w2dynamics_interface from source</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../install.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#installation-steps">Installation steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#version-compatibility">Version compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#custom-cmake-options">Custom CMake options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../documentation.html">Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#basic-notions">Basic notions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../w2dyn_cthyb.html">Preface</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../documentation.html#user-guide">User guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="aim.html">An example: the Anderson impurity model</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Measuring the two-particle Green’s function for our AIM example</a></li>
<li class="toctree-l3"><a class="reference internal" href="settingparameters.html">Setting the parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-1-construct-the-solver-instance">Step 1 - construct the solver instance</a><ul>
<li class="toctree-l5"><a class="reference internal" href="settingparameters.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-2-the-hamiltonian">Step 2 - the Hamiltonian</a><ul>
<li class="toctree-l5"><a class="reference internal" href="settingparameters.html#id2">Examples</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-3-the-monte-carlo-parameters">Step 3 - the Monte Carlo parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-6-legendre-or-not">Step 6 - Legendre or not?</a></li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-7-prepare-the-non-interacting-green-s-function">Step 7 - prepare the non-interacting Green’s function</a></li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#step-8-we-re-ready-to-go">Step 8 - we’re ready to go!</a></li>
<li class="toctree-l4"><a class="reference internal" href="settingparameters.html#final-step-analyze-the-output">Final Step - analyze the output</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="additional_remarks.html">Additional remarks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="additional_remarks.html#remark-1-defining-the-impurity">Remark 1 - Defining the impurity</a><ul>
<li class="toctree-l5"><a class="reference internal" href="additional_remarks.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="additional_remarks.html#remark-2-kramers-degeneracy">Remark 2 - Kramers degeneracy</a></li>
<li class="toctree-l4"><a class="reference internal" href="additional_remarks.html#remark-3-the-hybridization-function">Remark 3 - The hybridization function</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#python-reference-manual">Python Reference manual</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/solver.html">Solver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/constr_parameters.html">constr() parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/solve_parameters.html">solve() parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ChangeLog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-1-0">Version 3.1.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#general">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#doc">doc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#cmake">cmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#ci">CI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-0-0">Version 3.0.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#id2">General</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#jenkins">jenkins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#id3">cmake</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#solver">solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#converters">converters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#py3">py3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#jenkins-py3">jenkins,py3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-2-0">Version 2.2.0</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About w2dynamics_interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about.html#authors">Authors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#acknowledgments">Acknowledgments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#copyrights">Copyrights</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#citations">Citations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#license-and-disclaimer">License and disclaimer</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">w2dynamics_interface</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../documentation.html">Documentation</a> &raquo;</li>
        
      <li>Measuring the two-particle Green’s function for our AIM example</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/guide/aim_G4iw_ph.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="measuring-the-two-particle-green-s-function-for-our-aim-example">
<span id="aim-g4iw-ph"></span><h1>Measuring the two-particle Green’s function for our AIM example<a class="headerlink" href="#measuring-the-two-particle-green-s-function-for-our-aim-example" title="Permalink to this headline">¶</a></h1>
<p>Let us revisit the <a class="reference internal" href="aim.html#aim"><span class="std std-ref">example</span></a> of a one-orbital Anderson
impurity embedded in a flat (Wilson) conduction bath and look at all
the changes to the Python <a class="reference download internal" download="" href="../_downloads/51557698d6ca8c87c6348321ad207957/aim_G4iw_ph.py"><code class="xref download docutils literal notranslate"><span class="pre">script</span></code></a> needed
to calculate the two-particle Green’s function in particle-hole
frequency convention using worm sampling:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">triqs.gf</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">triqs.operators</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">h5</span> <span class="kn">import</span> <span class="n">HDFArchive</span>
<span class="kn">import</span> <span class="nn">triqs.utility.mpi</span> <span class="k">as</span> <span class="nn">mpi</span>

<span class="kn">from</span> <span class="nn">w2dyn_cthyb</span> <span class="kn">import</span> <span class="n">Solver</span>

<span class="c1"># Parameters</span>
<span class="n">D</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">U</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">4.0</span>
<span class="n">e_f</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="o">-</span><span class="n">U</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="mi">50</span>

<span class="c1"># Construct the impurity solver with the inverse temperature</span>
<span class="c1"># and the structure of the Green&#39;s functions</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">(</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gf_struct</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,[</span><span class="mi">0</span><span class="p">])</span> <span class="p">])</span>

<span class="c1"># Initialize the non-interacting Green&#39;s function S.G0_iw</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">g0</span> <span class="ow">in</span> <span class="n">S</span><span class="o">.</span><span class="n">G0_iw</span><span class="p">:</span> <span class="n">g0</span> <span class="o">&lt;&lt;</span> <span class="n">inverse</span><span class="p">(</span><span class="n">iOmega_n</span> <span class="o">-</span> <span class="n">e_f</span> <span class="o">-</span> <span class="n">V</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Wilson</span><span class="p">(</span><span class="n">D</span><span class="p">))</span>

<span class="c1"># Run the solver. The results will be in S.G2_iw_ph, errors (for parallel runs)</span>
<span class="c1"># in S.G2_iw_ph_error</span>
<span class="n">S</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">h_int</span> <span class="o">=</span> <span class="n">U</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>     <span class="c1"># Local Hamiltonian</span>
        <span class="n">n_cycles</span>  <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span>                     <span class="c1"># Number of QMC cycles</span>
        <span class="n">length_cycle</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>                       <span class="c1"># Length of one cycle</span>
        <span class="n">n_warmup_cycles</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">,</span>                <span class="c1"># Warmup cycles</span>
        <span class="n">measure_G2_iw_ph</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>                 <span class="c1"># Measure G2_iw_ph</span>
        <span class="n">measure_G2_n_bosonic</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>               <span class="c1"># Number of non-negative bosonic frequencies</span>
        <span class="n">measure_G2_n_fermionic</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>             <span class="c1"># Number of non-negative fermionic frequencies</span>
        <span class="c1"># Do not measure one-particle quantities to avoid Z-space sampling</span>
        <span class="n">measure_G_l</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>                     <span class="c1"># Do not measure G_l</span>
        <span class="n">measure_G_tau</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>                   <span class="c1"># Do not measure G_tau</span>

<span class="c1"># Save the results in an HDF5 file (only on the master node)</span>
<span class="k">if</span> <span class="n">mpi</span><span class="o">.</span><span class="n">is_master_node</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="s2">&quot;aim_2p_solution.h5&quot;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">Results</span><span class="p">:</span>
        <span class="n">Results</span><span class="p">[</span><span class="s2">&quot;G2_iw_ph&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">G2_iw_ph</span>
</pre></div>
</div>
<p>Running this script takes about 5 minutes and generates an HDF5
archive file called <code class="file docutils literal notranslate"><span class="pre">aim_2p_solution.h5</span></code>. This file contains the
two-particle Green’s function on two fermionic and one bosonic
frequency.</p>
<p>In detail, necessary or useful changes to calculate the two-particle
Green’s function in addition to or instead of the one-particle Green’s
function are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="n">length_cycle</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>                       <span class="c1"># Length of one cycle</span>
</pre></div>
</div>
<p>The length of one cycle can be reduced considerably as we use worm
sampling, so even in cases where the hybridization operators of the
configuration have not changed much since the last measurement, the
change of the position of the worm operators can lead to a
significantly different contribution to the measurement.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="n">measure_G2_iw_ph</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>                 <span class="c1"># Measure G2_iw_ph</span>
        <span class="n">measure_G2_n_bosonic</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>               <span class="c1"># Number of non-negative bosonic frequencies</span>
        <span class="n">measure_G2_n_fermionic</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>             <span class="c1"># Number of non-negative fermionic frequencies</span>
</pre></div>
</div>
<p>Here, we set the parameter that enables measurement of the
two-particle Green’s function in particle-hole convention, which we
have to do explicitly, and the number of bosonic and fermionic
Matsubara frequencies. The numbers of frequencies here are the same as
the default values, which will lead to a result with one bosonic
Matsubara axis with a total (including negative) of 59 frequencies and
two fermionic Matsubara axes with a total of 60 frequencies each.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="n">measure_G_l</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>                     <span class="c1"># Do not measure G_l</span>
        <span class="n">measure_G_tau</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>                   <span class="c1"># Do not measure G_tau</span>
</pre></div>
</div>
<p>We additionally turn off the measurement of the two one-particle
quantities that would usually be measured by default, so the part of
the calculation where partition function configurations are sampled
can be skipped entirely, as this interface can currently only be used
to measure the two-particle Green’s function using worm sampling. If
we wanted to measure the one-particle Green’s function in the same
solver call (and with the same parameters, including <code class="docutils literal notranslate"><span class="pre">length_cycle</span></code>,
which may not be ideal), we could also leave these parameters at their
default values.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="n">Results</span><span class="p">[</span><span class="s2">&quot;G2_iw_ph&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">G2_iw_ph</span>
</pre></div>
</div>
<p>Finally, in order to write it to an HDF5 file, we access the
two-particle Green’s function, which is stored in the solver object’s
attribute <code class="docutils literal notranslate"><span class="pre">S.G2_iw_ph</span></code> as a <code class="docutils literal notranslate"><span class="pre">Block2Gf</span></code> after the call to
<code class="docutils literal notranslate"><span class="pre">solve()</span></code>. Additionally, if the calculation was parallelized using
MPI, we could also read estimates for the standard errors from
<code class="docutils literal notranslate"><span class="pre">S.G2_iw_ph_error</span></code>.</p>
<p>It should be noted that the measurement of the two-particle Green’s
function is currently only available for models with diagonal
hybridization and a diagonal quadratic part of the local
Hamiltonian. As the interface does not try to identify this case
automatically, all blocks in the block structure must have size 1 or
the solver will terminate when the calculation is attempted.</p>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="settingparameters.html" class="btn btn-neutral float-right" title="Setting the parameters" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="aim.html" class="btn btn-neutral float-left" title="An example: the Anderson impurity model" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019, Simons Foundation.

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Setting the parameters &mdash; w2dynamics_interface  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=f7f783a0" />
      <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />

  
    <link rel="shortcut icon" href="../_static/triqs_favicon.ico"/>
  
        <script src="../_static/jquery.js?v=8dae8fb0"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=default"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Additional remarks" href="additional_remarks.html" />
    <link rel="prev" title="Measuring the two-particle Green’s function for our AIM example" href="aim_G4iw_ph.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #7E588A" >

          
          
          <a href="../index.html" class="icon icon-home">
            w2dynamics_interface
          </a>
              <div class="version">
                3.3.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Install w2dynamics_interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install.html#compiling-w2dynamics-interface-from-source">Compiling w2dynamics_interface from source</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../install.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#installation-steps">Installation steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#version-compatibility">Version compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../install.html#custom-cmake-options">Custom CMake options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../documentation.html">Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#basic-notions">Basic notions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../w2dyn_cthyb.html">Preface</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../documentation.html#user-guide">User guide</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="aim.html">An example: the Anderson impurity model</a></li>
<li class="toctree-l3"><a class="reference internal" href="aim_G4iw_ph.html">Measuring the two-particle Green’s function for our AIM example</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Setting the parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#step-1-construct-the-solver-instance">Step 1 - construct the solver instance</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#step-2-the-hamiltonian">Step 2 - the Hamiltonian</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id2">Examples</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#step-3-the-monte-carlo-parameters">Step 3 - the Monte Carlo parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-6-legendre-or-not">Step 6 - Legendre or not?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-7-prepare-the-non-interacting-green-s-function">Step 7 - prepare the non-interacting Green’s function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-8-we-re-ready-to-go">Step 8 - we’re ready to go!</a></li>
<li class="toctree-l4"><a class="reference internal" href="#final-step-analyze-the-output">Final Step - analyze the output</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="additional_remarks.html">Additional remarks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="additional_remarks.html#remark-1-defining-the-impurity">Remark 1 - Defining the impurity</a><ul>
<li class="toctree-l5"><a class="reference internal" href="additional_remarks.html#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="additional_remarks.html#remark-2-kramers-degeneracy">Remark 2 - Kramers degeneracy</a></li>
<li class="toctree-l4"><a class="reference internal" href="additional_remarks.html#remark-3-the-hybridization-function">Remark 3 - The hybridization function</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../documentation.html#python-reference-manual">Python Reference manual</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/solver.html">Solver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/constr_parameters.html">constr() parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/solve_parameters.html">solve() parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../issues.html">Reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ChangeLog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-3-0">Version 3.3.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#general">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#cmake">cmake</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-2-0">Version 3.2.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id2">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id3">cmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#jenkins">jenkins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#fix">fix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-1-0">Version 3.1.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id4">General</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#doc">doc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#id5">cmake</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ChangeLog.html#ci">CI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-3-0-0">Version 3.0.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#id6">General</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#id7">jenkins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#id8">cmake</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#solver">solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#converters">converters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#py3">py3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#jenkins-py3">jenkins,py3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ChangeLog.html#version-2-2-0">Version 2.2.0</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About w2dynamics_interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about.html#authors">Authors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#acknowledgments">Acknowledgments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#copyrights">Copyrights</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#citations">Citations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about.html#license-and-disclaimer">License and disclaimer</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #7E588A" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">w2dynamics_interface</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../documentation.html">Documentation</a></li>
      <li class="breadcrumb-item active">Setting the parameters</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/guide/settingparameters.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="setting-the-parameters">
<h1>Setting the parameters<a class="headerlink" href="#setting-the-parameters" title="Link to this heading"></a></h1>
<p><span class="red">This section is exactly the same as in the documentation of triqs_cthyb:</span></p>
<p><a class="reference external" href="https://triqs.github.io/cthyb/master/guide/settingparameters.html" rel="noopener noreferrer" target="_blank">Setting the parameters</a></p>
<p>Here’s a step-by-step guide that should show you how to prepare a CTQMC run.
Take the time to go through this little guide as it can help you avoid doing
simple mistakes.</p>
<section id="step-1-construct-the-solver-instance">
<h2>Step 1 - construct the solver instance<a class="headerlink" href="#step-1-construct-the-solver-instance" title="Link to this heading"></a></h2>
<p>At first you need to create an instance of the CTQMC solver class. This is done
with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">triqs.operators</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">w2dyn_cthyb</span> <span class="kn">import</span> <span class="n">Solver</span>

<span class="c1"># Create a solver instance</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">(</span><span class="n">beta</span> <span class="o">=</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gf_struct</span> <span class="o">=</span> <span class="n">gf_struct</span><span class="p">)</span>
</pre></div>
</div>
<p>The first parameter of the solver is the inverse temperature. In order to
complete the construction of the instance, you need to figure out what is the
correct structure of the Green’s function for the problem you are considering.
You should always try to take advantage of a possible block structure of the
Green’s function. In a spin-conserving system, the Green’s function can often
be (at least) cut into <em>up</em> and <em>down</em> spin sectors.  When the structure is
clear you can set the parameter <code class="docutils literal notranslate"><span class="pre">gf_struct</span></code>, which is a <code class="docutils literal notranslate"><span class="pre">list()</span></code> or pairs,
each containing the name of the block and a list of the indices of the block.</p>
<section id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Link to this heading"></a></h3>
<ul>
<li><p>For a single-band Hubbard model with a local Coulomb interaction, the Green’s function
can be cut in two up/down blocks of size 1. We would have:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gf_struct</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,[</span><span class="mi">0</span><span class="p">])</span> <span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>For a two-band Hubbard model with a hybridization between the bands, the Green’s function
can be cut in two up/down blocks, but there are off-diagonal orbital elements. We have:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gf_struct</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="step-2-the-hamiltonian">
<h2>Step 2 - the Hamiltonian<a class="headerlink" href="#step-2-the-hamiltonian" title="Link to this heading"></a></h2>
<p>The solver instance is ready. Now you need to prepare all the parameters
that will enter the <code class="docutils literal notranslate"><span class="pre">solve()</span></code> method and start the calculation. So
the next step is to describe the local Hamiltonian. This is the Hamiltonian
acting on the effective impurity sites/orbitals. It is very important to
<strong>include only the quartic terms and not the quadratic terms</strong> in this
Hamiltonian. The latter terms will be computed from the kownledge of the
non-interacting Green’s function <code class="docutils literal notranslate"><span class="pre">S.G0_iw</span></code> as explained below (see Step 7). The
interacting Hamiltonian is given in the parameter <code class="docutils literal notranslate"><span class="pre">h_int</span></code>.
with the use of <a class="reference external" href="https://triqs.github.io/triqs/latest/documentation/manual/triqs/operators/contents.html#operators" rel="noopener noreferrer" target="_blank" title="(in TRIQS v3.3.1)"><span class="xref std std-ref">second-quantization operators</span></a>.
The arguments in the parenthesis of the <code class="docutils literal notranslate"><span class="pre">c()</span></code>, <code class="docutils literal notranslate"><span class="pre">c_dag()</span></code>
and <code class="docutils literal notranslate"><span class="pre">n()</span></code> operators must be compatible with the structure of the Green’s
function <code class="docutils literal notranslate"><span class="pre">gf_struct</span></code>.</p>
<section id="id2">
<h3>Examples<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<ul>
<li><p>For a single-band Hubbard model with a local Coulomb interaction:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">h_int</span> <span class="o">=</span> <span class="n">U</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Two-orbital Hubbard model, no inter-orbital interaction, but a hybridization
between the bands (this term will not appear in the local Hamiltonian!):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">h_int</span> <span class="o">=</span> <span class="n">U</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="step-3-the-monte-carlo-parameters">
<h2>Step 3 - the Monte Carlo parameters<a class="headerlink" href="#step-3-the-monte-carlo-parameters" title="Link to this heading"></a></h2>
<p>There are three parameters that control how many steps and measures are done
during the Monte Carlo sampling. <code class="docutils literal notranslate"><span class="pre">n_cycles</span></code> is the total number of measurement
cycles done. A cycle has <code class="docutils literal notranslate"><span class="pre">length_cycle</span></code> Monte Carlo moves in it.  The
measurements start after <code class="docutils literal notranslate"><span class="pre">n_warmup_cycles</span></code> cycles have been made and there is
a measurement at the end of every cycle. At the end of the run, there will be
<code class="docutils literal notranslate"><span class="pre">n_cycles</span></code> measurements and a total of (<code class="docutils literal notranslate"><span class="pre">n_warmup_cycles</span></code> + <code class="docutils literal notranslate"><span class="pre">n_cycles</span></code>) x
<code class="docutils literal notranslate"><span class="pre">length_cycle</span></code>) moves.</p>
<p>When the solver is spread on a parallel machine, each core will do <code class="docutils literal notranslate"><span class="pre">n_cycles</span></code>
measurements cycles and <code class="docutils literal notranslate"><span class="pre">n_warmup_cycles</span></code> warmup cycles. Therefore the same
input run on a larger number of cores will yield a larger statistics.</p>
</section>
<section id="step-6-legendre-or-not">
<h2>Step 6 - Legendre or not?<a class="headerlink" href="#step-6-legendre-or-not" title="Link to this heading"></a></h2>
<p>The CTQMC algorithm computes the Green’s function on the imaginary-time
interval <span class="math notranslate nohighlight">\([0,\beta]\)</span>. By default, <span class="math notranslate nohighlight">\(G(\tau)\)</span> is computed by binning
measurements in <span class="math notranslate nohighlight">\(n_{\tau}\)</span> bins. However, in order to gain memory and to
reduce high-frequency noise, the Green’s function may be expanded on a basis of
<code class="docutils literal notranslate"><span class="pre">n_l</span></code> Legendre polynomials by setting the parameter <code class="docutils literal notranslate"><span class="pre">measure_g_l</span></code> to True.
The question is, how many of these polynomials should one use? Our
recommendation is to do a first <em>test</em> run with a large number of coefficients,
say 80. When the run is over, one can inspect the Legendre Green’s function and
decide how many coefficients should be kept. This will be detailed below.</p>
</section>
<section id="step-7-prepare-the-non-interacting-green-s-function">
<h2>Step 7 - prepare the non-interacting Green’s function<a class="headerlink" href="#step-7-prepare-the-non-interacting-green-s-function" title="Link to this heading"></a></h2>
<p>The last step before starting the solver is to prepare the non-interacting
Green’s function of the problem. From the knowledge of this Green’s function,
the solver can extract the hybridization function used in the algorithm and the
quadratic terms of the local Hamiltonian. The non-interacting Green’s function
must be initialized in the member <code class="docutils literal notranslate"><span class="pre">G0_iw</span></code> of the solver instance. For example,
one would write</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">g0</span> <span class="ow">in</span> <span class="n">S</span><span class="o">.</span><span class="n">G0_iw</span><span class="p">:</span>
  <span class="n">g0</span> <span class="o">&lt;&lt;</span> <span class="n">inverse</span><span class="p">(</span><span class="n">iOmega_n</span> <span class="o">-</span> <span class="n">e_f</span> <span class="o">-</span> <span class="n">V</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Wilson</span><span class="p">(</span><span class="n">D</span><span class="p">))</span>
</pre></div>
</div>
<p>to initialize the Green’s function of an impurity embedded in a flat conduction
bath.</p>
</section>
<section id="step-8-we-re-ready-to-go">
<h2>Step 8 - we’re ready to go!<a class="headerlink" href="#step-8-we-re-ready-to-go" title="Link to this heading"></a></h2>
<p>Everything is ready at this stage and you just need to call the <code class="docutils literal notranslate"><span class="pre">solve()</span></code>
member of the solver with all the information you prepared, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">S</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">h_int</span> <span class="o">=</span> <span class="n">U</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">n_cycles</span>  <span class="o">=</span> <span class="mi">500000</span><span class="p">,</span>
        <span class="n">length_cycle</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
        <span class="n">n_warmup_cycles</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
<p>or alternatively by predefining a dict of params:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">p</span><span class="p">[</span><span class="s1">&#39;n_warmup_cycles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">p</span><span class="p">[</span><span class="s1">&#39;n_cycles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500000</span>
<span class="n">p</span><span class="p">[</span><span class="s1">&#39;length_cycle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">S</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">h_int</span> <span class="o">=</span> <span class="n">U</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="p">(</span><span class="s1">&#39;down&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="o">**</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>When you call the solver, the local Hamiltonian (with the quadratic terms) is
shown. Be careful to check that this is indeed the Hamiltonian that you expect!
At the end of the run, the solver has computed the following objects:</p>
<blockquote>
<div><ul class="simple">
<li><p>The interacting Green’s function of the problem on the imaginary time
axis. This is in the class member <code class="docutils literal notranslate"><span class="pre">G_tau</span></code>.</p></li>
<li><p>The interacting Green’s function of the problem on the Matsubara frequency
axis. This is in the class member <code class="docutils literal notranslate"><span class="pre">G_iw</span></code>.</p></li>
<li><p>The interacting Legendre Green’s function of the problem, if <cite>measure_g_l=True</cite>.
This is put in the member <code class="docutils literal notranslate"><span class="pre">G_l</span></code>. This output is useful to decide how many
Legendre coefficients should be used.</p></li>
</ul>
</div></blockquote>
</section>
<section id="final-step-analyze-the-output">
<h2>Final Step - analyze the output<a class="headerlink" href="#final-step-analyze-the-output" title="Link to this heading"></a></h2>
<p>One of the most important checks that needs to be done is to ensure that the
high-frequency behaviour of your imaginary frequency Green’s function and
self-energy are correct and lead to physically sensible values. You should use
the fitting function <code class="docutils literal notranslate"><span class="pre">tail_fit</span></code> (provided in <code class="docutils literal notranslate"><span class="pre">triqs.gf</span></code>) to determine the
optimal fitting parameters <code class="docutils literal notranslate"><span class="pre">fit_min_n</span></code> and <code class="docutils literal notranslate"><span class="pre">fit_max_n</span></code>.
This post-processing task can also be delegated to the <code class="docutils literal notranslate"><span class="pre">Solver</span></code> object by
setting <code class="docutils literal notranslate"><span class="pre">perform_tail_fit</span> <span class="pre">=</span> <span class="pre">True</span></code> and other <a class="reference internal" href="../reference/solver.html#ctqmc-ref"><span class="std std-ref">solve()</span></a>
parameters related to tail fitting.</p>
<p>If you use the Legendre expansion, you should also decide on the ideal number
of Legendre coefficients to keep for the following runs. If you have saved the
Legendre Green’s function in an archive, you can then plot it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">triqs.gf</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">h5</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">triqs.plot.mpl_interface</span> <span class="kn">import</span> <span class="n">oplot</span>

<span class="n">A</span> <span class="o">=</span> <span class="n">HDFArchive</span><span class="p">(</span><span class="s2">&quot;aim_solution.h5&quot;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">oplot</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="s1">&#39;G_l&#39;</span><span class="p">][</span><span class="s1">&#39;up&#39;</span><span class="p">],</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">x_window</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">45</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
<p>From this plot you see that for <span class="math notranslate nohighlight">\(l &gt; 30\)</span>, the value of the
coefficient is of the order of the statistical noise. There is therefore no
information in the coefficients with <span class="math notranslate nohighlight">\(l &gt; 30\)</span> and one can set
<code class="docutils literal notranslate"><span class="pre">n_l</span> <span class="pre">=</span> <span class="pre">30</span></code> for the following runs. Of course, if you are going to use
more statistics or a larger number of cores, you may have to readjust this
value.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="aim_G4iw_ph.html" class="btn btn-neutral float-left" title="Measuring the two-particle Green’s function for our AIM example" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="additional_remarks.html" class="btn btn-neutral float-right" title="Additional remarks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Simons Foundation.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>